<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>MIDIMon Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="Transform MIDI controllers into advanced macro pads with RGB feedback and timing-based triggers">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>‚Üê</kbd> or <kbd>‚Üí</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">MIDIMon Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/amiable-dev/midimon" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p><strong>Transform any MIDI controller into an advanced, context-aware macro pad with professional-grade feedback and timing-based triggers.</strong></p>
<p>MIDIMon is a powerful Rust-based MIDI controller mapping system that goes beyond simple note-to-key bindings. It provides velocity sensitivity, long press detection, double-tap, chord recognition, and full RGB LED feedback for modern workflows.</p>
<h2 id="key-features"><a class="header" href="#key-features">Key Features</a></h2>
<h3 id="core-capabilities-v200"><a class="header" href="#core-capabilities-v200">Core Capabilities (v2.0.0)</a></h3>
<p><strong>Event Detection</strong>:</p>
<ul>
<li><strong>4 Core Triggers</strong>: Note, Velocity Range, Encoder, Control Change</li>
<li><strong>5 Advanced Triggers</strong>: Long Press, Double-Tap, Chord, Aftertouch, Pitch Bend</li>
<li><strong>10 Action Types</strong>: Keystroke, Text, Launch, Shell, Volume Control, and more</li>
</ul>
<p><strong>Visual Interface (NEW!)</strong>:</p>
<ul>
<li><strong>Tauri GUI</strong>: Modern desktop app for visual configuration</li>
<li><strong>MIDI Learn</strong>: One-click auto-detection of MIDI inputs</li>
<li><strong>Live Preview</strong>: Real-time event monitoring and testing</li>
<li><strong>Device Templates</strong>: 6 built-in templates for popular controllers</li>
</ul>
<p><strong>Daemon Infrastructure (NEW!)</strong>:</p>
<ul>
<li><strong>Background Service</strong>: Runs as system service with auto-start</li>
<li><strong>Hot-Reload</strong>: Config changes applied in 0-10ms without restart</li>
<li><strong>IPC Control</strong>: Control daemon via CLI or GUI</li>
<li><strong>Per-App Profiles</strong>: Automatic profile switching</li>
</ul>
<p><strong>LED &amp; Feedback</strong>:</p>
<ul>
<li><strong>10 LED Schemes</strong>: Reactive, Rainbow, Pulse, Breathing, and custom patterns</li>
<li><strong>Multi-Mode System</strong>: Switch between mapping sets on the fly</li>
<li><strong>Device Profile Support</strong>: Load Native Instruments Controller Editor configurations</li>
</ul>
<h3 id="performance"><a class="header" href="#performance">Performance</a></h3>
<ul>
<li>Response latency: <strong>&lt;1ms</strong> typical</li>
<li>Memory footprint: <strong>5-10MB</strong></li>
<li>CPU usage: <strong>&lt;1%</strong> idle, <strong>&lt;5%</strong> active</li>
<li>Binary size: <strong>3-5MB</strong> (optimized)</li>
</ul>
<h2 id="who-is-midimon-for"><a class="header" href="#who-is-midimon-for">Who is MIDIMon For?</a></h2>
<h3 id="music-producers"><a class="header" href="#music-producers">Music Producers</a></h3>
<p>Control DAWs, plugins, and effects with velocity-sensitive, multi-layer mappings.</p>
<h3 id="software-developers"><a class="header" href="#software-developers">Software Developers</a></h3>
<p>Streamline coding workflows with mode-based hotkey systems and build tool shortcuts.</p>
<h3 id="content-creators"><a class="header" href="#content-creators">Content Creators</a></h3>
<p>Manage streaming, recording, and editing with physical MIDI controls.</p>
<h3 id="power-users"><a class="header" href="#power-users">Power Users</a></h3>
<p>Replace expensive macro pads with affordable MIDI controllers that do more.</p>
<h2 id="why-midimon"><a class="header" href="#why-midimon">Why MIDIMon?</a></h2>
<p>Unlike existing MIDI mapping tools, MIDIMon provides:</p>
<ul>
<li><strong>Advanced Timing</strong>: Long press, double-tap, chord detection out of the box</li>
<li><strong>Velocity Sensitivity</strong>: Different actions for soft/medium/hard pad hits</li>
<li><strong>Full RGB Feedback</strong>: Not just on/off LEDs, but animated schemes and reactive color</li>
<li><strong>Modern Architecture</strong>: Fast Rust core, hot-reload config (coming soon), cross-platform</li>
<li><strong>Open Source</strong>: Fully customizable, extensible, community-driven</li>
</ul>
<h2 id="quick-example"><a class="header" href="#quick-example">Quick Example</a></h2>
<pre><code class="language-toml"># Press pad lightly for copy, hard for paste
[[modes.mappings]]
trigger = { type = "VelocityRange", note = 36 }
soft = { action = { type = "Keystroke", key = "C", modifiers = ["Cmd"] } }
hard = { action = { type = "Keystroke", key = "V", modifiers = ["Cmd"] } }

# Hold for 2 seconds to open terminal
[[modes.mappings]]
trigger = { type = "LongPress", note = 37, duration_ms = 2000 }
action = { type = "Launch", path = "/Applications/Utilities/Terminal.app" }
</code></pre>
<h2 id="platform-support"><a class="header" href="#platform-support">Platform Support</a></h2>
<ul>
<li><strong>macOS</strong>: Full support (11+ Big Sur, Apple Silicon + Intel)</li>
<li><strong>Linux</strong>: Planned for Phase 4 (Q4 2025)</li>
<li><strong>Windows</strong>: Planned for Phase 4 (Q4 2025)</li>
</ul>
<h2 id="device-compatibility"><a class="header" href="#device-compatibility">Device Compatibility</a></h2>
<ul>
<li><strong>Fully Supported</strong>: Native Instruments Maschine Mikro MK3 (RGB LEDs, HID access)</li>
<li><strong>MIDI-Only Support</strong>: Any USB MIDI controller with basic LED feedback</li>
<li><strong>Coming Soon</strong>: Launchpad, APC Mini, Korg nanoKontrol, and more</li>
</ul>
<h2 id="get-started"><a class="header" href="#get-started">Get Started</a></h2>
<p>Ready to dive in? Check out the <a href="getting-started/quick-start.html">Quick Start Guide</a> or <a href="installation/macos.html">Installation Instructions</a>.</p>
<h2 id="project-status"><a class="header" href="#project-status">Project Status</a></h2>
<p>MIDIMon is currently at <strong>v2.0.0</strong> with production-ready daemon infrastructure and visual GUI configuration.</p>
<p><strong>What's New in v2.0.0</strong>:</p>
<ul>
<li>üéõÔ∏è <strong>Tauri GUI</strong>: Visual configuration editor with MIDI Learn mode</li>
<li>üîÑ <strong>Hot-Reload Daemon</strong>: 0-10ms config reloads without restart</li>
<li>üéØ <strong>Per-App Profiles</strong>: Automatic profile switching based on active app</li>
<li>üìä <strong>Live Event Console</strong>: Real-time MIDI event monitoring</li>
<li>üì¶ <strong>Device Templates</strong>: 6 built-in templates for popular controllers</li>
</ul>
<p>See the <a href="resources/roadmap.html">Roadmap</a> for planned features and <a href="resources/changelog.html">Changelog</a> for full release notes.</p>
<h2 id="community"><a class="header" href="#community">Community</a></h2>
<ul>
<li><strong>GitHub</strong>: <a href="https://github.com/amiable-dev/midimon">https://github.com/amiable-dev/midimon</a></li>
<li><strong>Discussions</strong>: <a href="https://github.com/amiable-dev/midimon/discussions">https://github.com/amiable-dev/midimon/discussions</a></li>
<li><strong>Issues</strong>: <a href="https://github.com/amiable-dev/midimon/issues">https://github.com/amiable-dev/midimon/issues</a></li>
</ul>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>MIDIMon is open source software licensed under the <strong>MIT License</strong>. See <a href="https://github.com/amiable-dev/midimon/blob/main/LICENSE">LICENSE</a> for details.</p>
<hr />
<p><strong>Next</strong>: <a href="installation/macos.html">Install MIDIMon</a> | <a href="getting-started/quick-start.html">Quick Start</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="macos-installation-guide"><a class="header" href="#macos-installation-guide">macOS Installation Guide</a></h1>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>This guide walks through installing and configuring MIDIMon v2.0.0 on macOS. MIDIMon now includes a background daemon service with a modern Tauri-based GUI for visual configuration.</p>
<p><strong>Installation Options</strong>:</p>
<ul>
<li><strong>Option 1 (Recommended)</strong>: Download pre-built GUI app + daemon binaries from <a href="https://github.com/amiable-dev/midimon/releases">GitHub Releases</a></li>
<li><strong>Option 2</strong>: Build from source (developers/advanced users)</li>
</ul>
<p>Installation takes approximately 10-15 minutes.</p>
<h2 id="option-1-install-pre-built-binaries-recommended"><a class="header" href="#option-1-install-pre-built-binaries-recommended">Option 1: Install Pre-Built Binaries (Recommended)</a></h2>
<h3 id="1-download-midimon"><a class="header" href="#1-download-midimon">1. Download MIDIMon</a></h3>
<p>Visit the <a href="https://github.com/amiable-dev/midimon/releases/latest">Releases Page</a> and download:</p>
<p><strong>For GUI + Daemon (Recommended)</strong>:</p>
<ul>
<li><code>midimon-gui-macos-universal.tar.gz</code> - GUI application with daemon</li>
<li><strong>OR</strong> download daemon separately: <code>midimon-aarch64-apple-darwin.tar.gz</code> (Apple Silicon) or <code>midimon-x86_64-apple-darwin.tar.gz</code> (Intel)</li>
</ul>
<h3 id="2-install-the-gui-application"><a class="header" href="#2-install-the-gui-application">2. Install the GUI Application</a></h3>
<pre><code class="language-bash"># Extract the GUI app
tar xzf midimon-gui-macos-universal.tar.gz

# Move to Applications folder
mv "MIDIMon GUI.app" /Applications/

# Open the app
open /Applications/"MIDIMon GUI.app"
</code></pre>
<h3 id="3-install-the-daemon-binary-optional---gui-includes-daemon"><a class="header" href="#3-install-the-daemon-binary-optional---gui-includes-daemon">3. Install the Daemon Binary (Optional - GUI includes daemon)</a></h3>
<p>If you want to use the daemon independently:</p>
<pre><code class="language-bash"># Extract daemon binary
tar xzf midimon-*.tar.gz

# Make it executable
chmod +x midimon

# Move to PATH
sudo mv midimon /usr/local/bin/

# Verify installation
midimon --version
</code></pre>
<p><strong>Skip to <a href="installation/macos.html#configuring-macos-permissions">Configuring macOS Permissions</a></strong></p>
<hr />
<h2 id="option-2-build-from-source"><a class="header" href="#option-2-build-from-source">Option 2: Build from Source</a></h2>
<h3 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h3>
<h4 id="1-rust-toolchain"><a class="header" href="#1-rust-toolchain">1. Rust Toolchain</a></h4>
<p>MIDIMon is written in Rust and requires the Rust compiler and Cargo build system.</p>
<p><strong>Check if Rust is already installed</strong>:</p>
<pre><code class="language-bash">rustc --version
cargo --version
</code></pre>
<p>If you see version numbers (e.g., <code>rustc 1.75.0</code>), skip to step 2.</p>
<p><strong>Install Rust using rustup</strong>:</p>
<pre><code class="language-bash">curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
</code></pre>
<p>Follow the prompts and select the default installation. Then reload your shell:</p>
<pre><code class="language-bash">source $HOME/.cargo/env
</code></pre>
<p><strong>Verify installation</strong>:</p>
<pre><code class="language-bash">rustc --version  # Should show: rustc 1.75.0 (or later)
cargo --version  # Should show: cargo 1.75.0 (or later)
</code></pre>
<h4 id="2-nodejs-and-npm-for-gui-only"><a class="header" href="#2-nodejs-and-npm-for-gui-only">2. Node.js and npm (for GUI only)</a></h4>
<p>Required if building the Tauri GUI:</p>
<pre><code class="language-bash"># Install Node.js via Homebrew
brew install node@20

# Verify installation
node --version  # Should show: v20.x.x
npm --version   # Should show: 10.x.x
</code></pre>
<h3 id="2-native-instruments-drivers-for-maschine-mikro-mk3"><a class="header" href="#2-native-instruments-drivers-for-maschine-mikro-mk3">2. Native Instruments Drivers (for Maschine Mikro MK3)</a></h3>
<p>If using a Maschine Mikro MK3, install Native Instruments drivers for full RGB LED support.</p>
<p><strong>Download and install</strong>:</p>
<ol>
<li>Visit <a href="https://www.native-instruments.com/en/support/downloads/">Native Instruments Downloads</a></li>
<li>Download <strong>Native Access</strong> (the NI installation manager)</li>
<li>Install Native Access and sign in (free account)</li>
<li>In Native Access, install:
<ul>
<li><strong>Maschine</strong> software (includes drivers)</li>
<li><strong>Controller Editor</strong> (for creating custom profiles, optional)</li>
</ul>
</li>
</ol>
<p><strong>Verify driver installation</strong>:</p>
<pre><code class="language-bash">system_profiler SPUSBDataType | grep -i maschine
</code></pre>
<p>You should see output like:</p>
<pre><code>Maschine Mikro MK3:
  Product ID: 0x1600
  Vendor ID: 0x17cc  (Native Instruments)
</code></pre>
<h3 id="3-xcode-command-line-tools"><a class="header" href="#3-xcode-command-line-tools">3. Xcode Command Line Tools</a></h3>
<p>Required for compiling native dependencies:</p>
<pre><code class="language-bash">xcode-select --install
</code></pre>
<p>If already installed, you'll see: "command line tools are already installed".</p>
<h3 id="building-from-source"><a class="header" href="#building-from-source">Building from Source</a></h3>
<h4 id="1-clone-the-repository"><a class="header" href="#1-clone-the-repository">1. Clone the Repository</a></h4>
<pre><code class="language-bash"># Choose a location for the project
cd ~/projects  # or wherever you keep code

# Clone the repository
git clone https://github.com/amiable-dev/midimon.git
cd midimon
</code></pre>
<h4 id="2-build-the-daemon"><a class="header" href="#2-build-the-daemon">2. Build the Daemon</a></h4>
<p><strong>Release build</strong> (recommended for regular use):</p>
<pre><code class="language-bash"># Build the entire workspace (daemon + core)
cargo build --release --workspace

# Or build just the daemon binary
cargo build --release --package midimon-daemon
</code></pre>
<p>The release build takes 2-5 minutes on modern hardware and produces an optimized binary (~3-5MB) in <code>target/release/midimon</code>.</p>
<p><strong>Build output</strong>:</p>
<pre><code>   Compiling midimon-core v2.0.0 (/Users/you/projects/midimon/midimon-core)
   Compiling midimon-daemon v2.0.0 (/Users/you/projects/midimon/midimon-daemon)
    Finished release [optimized] target(s) in 2m 14s
</code></pre>
<h4 id="3-build-the-gui-optional"><a class="header" href="#3-build-the-gui-optional">3. Build the GUI (Optional)</a></h4>
<pre><code class="language-bash"># Install frontend dependencies
cd midimon-gui/ui
npm ci

# Build the frontend
npm run build

# Build the Tauri backend
cd ../src-tauri
cargo build --release

# The GUI app bundle will be at:
# midimon-gui/src-tauri/target/release/bundle/macos/MIDIMon GUI.app
</code></pre>
<h4 id="4-verify-the-build"><a class="header" href="#4-verify-the-build">4. Verify the Build</a></h4>
<pre><code class="language-bash"># Test daemon binary
./target/release/midimon --version

# Or run it
./target/release/midimon

# Test GUI (if built)
open midimon-gui/src-tauri/target/release/bundle/macos/"MIDIMon GUI.app"
</code></pre>
<h2 id="setting-up-configuration"><a class="header" href="#setting-up-configuration">Setting Up Configuration</a></h2>
<h3 id="using-the-gui-recommended"><a class="header" href="#using-the-gui-recommended">Using the GUI (Recommended)</a></h3>
<p>v2.0.0 includes a visual configuration editor:</p>
<ol>
<li>
<p><strong>Open MIDIMon GUI</strong>:</p>
<pre><code class="language-bash">open /Applications/"MIDIMon GUI.app"
</code></pre>
</li>
<li>
<p><strong>Connect your MIDI device</strong> in the device panel</p>
</li>
<li>
<p><strong>Use MIDI Learn mode</strong>:</p>
<ul>
<li>Click "Learn" next to any trigger</li>
<li>Press a pad/button on your controller</li>
<li>The trigger config auto-fills</li>
<li>Assign an action (keystroke, launch app, etc.)</li>
</ul>
</li>
<li>
<p><strong>Save configuration</strong> - automatically writes to <code>~/.config/midimon/config.toml</code></p>
</li>
</ol>
<p>See <a href="installation/../getting-started/gui-quick-start.html">GUI Quick Start</a> for detailed tutorial.</p>
<h3 id="manual-configuration-advanced"><a class="header" href="#manual-configuration-advanced">Manual Configuration (Advanced)</a></h3>
<p>If you prefer to edit <code>config.toml</code> manually:</p>
<p><strong>Config location</strong>: <code>~/.config/midimon/config.toml</code></p>
<p><strong>Create a minimal config</strong>:</p>
<pre><code class="language-bash">mkdir -p ~/.config/midimon

cat &gt; ~/.config/midimon/config.toml &lt;&lt; 'EOF'
[device]
name = "Mikro"
auto_connect = true

[[modes]]
name = "Default"
color = "blue"

[[modes.mappings]]
description = "Test mapping - Copy"
[modes.mappings.trigger]
type = "Note"
note = 12
[modes.mappings.action]
type = "Keystroke"
keys = "c"
modifiers = ["cmd"]

[[global_mappings]]
description = "Emergency exit (hold pad 0 for 3 seconds)"
[global_mappings.trigger]
type = "LongPress"
note = 0
hold_duration_ms = 3000
[global_mappings.action]
type = "Shell"
command = "killall midimon"
EOF
</code></pre>
<p>This creates a basic configuration with:</p>
<ul>
<li>One mode (Default)</li>
<li>One test mapping (pad 12 = Cmd+C)</li>
<li>One emergency exit (hold pad 0 to quit)</li>
</ul>
<p><strong>Hot-reload</strong>: The daemon automatically reloads config within 0-10ms when you save changes.</p>
<h2 id="configuring-macos-permissions"><a class="header" href="#configuring-macos-permissions">Configuring macOS Permissions</a></h2>
<h3 id="input-monitoring-permission-required-for-hidled-control"><a class="header" href="#input-monitoring-permission-required-for-hidled-control">Input Monitoring Permission (Required for HID/LED Control)</a></h3>
<p>macOS requires explicit permission for applications to access HID devices like the Maschine Mikro MK3.</p>
<p><strong>Grant permission</strong>:</p>
<ol>
<li>
<p>Run MIDIMon once:</p>
<pre><code class="language-bash">cargo run --release 2
</code></pre>
</li>
<li>
<p>macOS will show a permission dialog: <strong>"midimon would like to receive keystrokes from any application"</strong></p>
</li>
<li>
<p>Click <strong>Open System Settings</strong> or manually navigate:</p>
<ul>
<li>Open <strong>System Settings</strong> ‚Üí <strong>Privacy &amp; Security</strong> ‚Üí <strong>Input Monitoring</strong></li>
<li>Find <code>midimon</code> (or <code>Terminal</code> if running via <code>cargo run</code>)</li>
<li>Toggle the switch to <strong>ON</strong></li>
</ul>
</li>
<li>
<p>Restart MIDIMon:</p>
<pre><code class="language-bash">cargo run --release 2
</code></pre>
</li>
</ol>
<p><strong>Verify HID access</strong>:</p>
<pre><code class="language-bash">DEBUG=1 cargo run --release 2
</code></pre>
<p>Look for:</p>
<pre><code>[DEBUG] HID device opened successfully
[DEBUG] LED controller initialized
</code></pre>
<p>If you see "HID device open failed", check:</p>
<ul>
<li>Input Monitoring permission is enabled</li>
<li>USB cable is connected</li>
<li>Native Instruments drivers are installed</li>
</ul>
<h3 id="accessibility-permission-optional-for-advanced-actions"><a class="header" href="#accessibility-permission-optional-for-advanced-actions">Accessibility Permission (Optional, for Advanced Actions)</a></h3>
<p>Some actions (e.g., controlling other apps programmatically) may require Accessibility permission:</p>
<ol>
<li>Go to <strong>System Settings</strong> ‚Üí <strong>Privacy &amp; Security</strong> ‚Üí <strong>Accessibility</strong></li>
<li>Click the <strong>+</strong> button</li>
<li>Navigate to <code>target/release/midimon</code> (or add <code>Terminal</code>)</li>
<li>Click <strong>Open</strong></li>
</ol>
<p>This is optional and only needed for specific advanced features.</p>
<h2 id="verifying-usb-connection"><a class="header" href="#verifying-usb-connection">Verifying USB Connection</a></h2>
<h3 id="check-usb-device-enumeration"><a class="header" href="#check-usb-device-enumeration">Check USB Device Enumeration</a></h3>
<pre><code class="language-bash">system_profiler SPUSBDataType | grep -i mikro
</code></pre>
<p>Expected output:</p>
<pre><code>Maschine Mikro MK3:
  Product ID: 0x1600
  Vendor ID: 0x17cc (Native Instruments)
  Serial Number: XXXXX
  Location ID: 0x14200000 / 5
</code></pre>
<h3 id="check-midi-connectivity"><a class="header" href="#check-midi-connectivity">Check MIDI Connectivity</a></h3>
<pre><code class="language-bash"># Open Audio MIDI Setup
open -a "Audio MIDI Setup"
</code></pre>
<p>In the <strong>MIDI Studio</strong> window (Window ‚Üí Show MIDI Studio):</p>
<ul>
<li>You should see "Maschine Mikro MK3" listed</li>
<li>It should be connected (not grayed out)</li>
<li>Double-click to view its properties</li>
</ul>
<h3 id="test-midi-events"><a class="header" href="#test-midi-events">Test MIDI Events</a></h3>
<pre><code class="language-bash"># Run diagnostic tool
cargo run --bin midi_diagnostic 2
</code></pre>
<p>Press pads on your controller. You should see:</p>
<pre><code>[NoteOn] ch:0 note:12 vel:87
[NoteOff] ch:0 note:12 vel:0
</code></pre>
<p>If nothing appears:</p>
<ul>
<li>Check USB cable</li>
<li>Verify correct port number (try 0, 1, 2, etc.)</li>
<li>Restart the device</li>
<li>Check Audio MIDI Setup</li>
</ul>
<h2 id="running-midimon"><a class="header" href="#running-midimon">Running MIDIMon</a></h2>
<h3 id="using-the-gui-recommended-1"><a class="header" href="#using-the-gui-recommended-1">Using the GUI (Recommended)</a></h3>
<p>The simplest way to run MIDIMon v2.0.0:</p>
<ol>
<li>
<p><strong>Launch the GUI</strong>:</p>
<pre><code class="language-bash">open /Applications/"MIDIMon GUI.app"
</code></pre>
</li>
<li>
<p><strong>The daemon starts automatically</strong> in the background</p>
</li>
<li>
<p><strong>Control via GUI</strong>:</p>
<ul>
<li>View real-time MIDI events in the Event Console</li>
<li>Edit configuration visually</li>
<li>Monitor daemon status in the status bar</li>
<li>Pause/resume/reload from the GUI</li>
</ul>
</li>
<li>
<p><strong>Control via menu bar</strong> (when daemon is running):</p>
<ul>
<li>Click the MIDIMon icon in menu bar</li>
<li>Quick actions: Pause, Reload Config, Open GUI, Quit</li>
</ul>
</li>
</ol>
<h3 id="using-the-daemon-cli"><a class="header" href="#using-the-daemon-cli">Using the Daemon CLI</a></h3>
<p>For headless operation or scripting:</p>
<p><strong>Start the daemon</strong>:</p>
<pre><code class="language-bash"># Start daemon in foreground
midimon

# Start daemon in background
midimon &amp;

# Or use launchd (see Auto-Start section below)
</code></pre>
<p><strong>Control the daemon</strong> with <code>midimonctl</code>:</p>
<pre><code class="language-bash"># Check status
midimonctl status

# Reload configuration
midimonctl reload

# Stop daemon
midimonctl stop

# Validate config without reloading
midimonctl validate

# Ping daemon (latency check)
midimonctl ping
</code></pre>
<p><strong>Output formats</strong>:</p>
<pre><code class="language-bash"># Human-readable output (default)
midimonctl status

# JSON output (for scripting)
midimonctl status --json
</code></pre>
<h3 id="legacy-cli-options-daemon"><a class="header" href="#legacy-cli-options-daemon">Legacy CLI Options (Daemon)</a></h3>
<p>The daemon binary still supports v1.0.0 CLI arguments:</p>
<pre><code class="language-bash"># With LED lighting scheme
midimon --led reactive

# With device profile
midimon --profile ~/Downloads/my-profile.ncmm3

# With debug logging
DEBUG=1 midimon
</code></pre>
<h2 id="auto-start-on-login"><a class="header" href="#auto-start-on-login">Auto-Start on Login</a></h2>
<h3 id="option-1-gui-auto-start-recommended"><a class="header" href="#option-1-gui-auto-start-recommended">Option 1: GUI Auto-Start (Recommended)</a></h3>
<p>The MIDIMon GUI includes built-in auto-start functionality:</p>
<ol>
<li>Open <strong>MIDIMon GUI</strong> ‚Üí <strong>Settings</strong></li>
<li>Enable <strong>"Start MIDIMon on login"</strong></li>
<li>Click <strong>Save</strong></li>
</ol>
<p>This creates a LaunchAgent automatically and handles daemon startup.</p>
<h3 id="option-2-manual-launchagent-setup"><a class="header" href="#option-2-manual-launchagent-setup">Option 2: Manual LaunchAgent Setup</a></h3>
<p>For daemon-only auto-start (no GUI):</p>
<h4 id="1-create-launchagent-plist"><a class="header" href="#1-create-launchagent-plist">1. Create LaunchAgent plist</a></h4>
<pre><code class="language-bash">mkdir -p ~/Library/LaunchAgents

cat &gt; ~/Library/LaunchAgents/com.midimon.daemon.plist &lt;&lt; 'EOF'
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
&lt;dict&gt;
    &lt;key&gt;Label&lt;/key&gt;
    &lt;string&gt;com.midimon.daemon&lt;/string&gt;

    &lt;key&gt;ProgramArguments&lt;/key&gt;
    &lt;array&gt;
        &lt;string&gt;/usr/local/bin/midimon&lt;/string&gt;
    &lt;/array&gt;

    &lt;key&gt;RunAtLoad&lt;/key&gt;
    &lt;true/&gt;

    &lt;key&gt;KeepAlive&lt;/key&gt;
    &lt;dict&gt;
        &lt;key&gt;Crashed&lt;/key&gt;
        &lt;true/&gt;
    &lt;/dict&gt;

    &lt;key&gt;StandardOutPath&lt;/key&gt;
    &lt;string&gt;/tmp/midimon.log&lt;/string&gt;

    &lt;key&gt;StandardErrorPath&lt;/key&gt;
    &lt;string&gt;/tmp/midimon.err&lt;/string&gt;

    &lt;key&gt;EnvironmentVariables&lt;/key&gt;
    &lt;dict&gt;
        &lt;key&gt;PATH&lt;/key&gt;
        &lt;string&gt;/usr/local/bin:/usr/bin:/bin&lt;/string&gt;
    &lt;/dict&gt;
&lt;/dict&gt;
&lt;/plist&gt;
EOF
</code></pre>
<h4 id="2-load-the-launchagent"><a class="header" href="#2-load-the-launchagent">2. Load the LaunchAgent</a></h4>
<pre><code class="language-bash">launchctl load ~/Library/LaunchAgents/com.midimon.daemon.plist
</code></pre>
<h4 id="3-verify-its-running"><a class="header" href="#3-verify-its-running">3. Verify It's Running</a></h4>
<pre><code class="language-bash"># Check launchd
launchctl list | grep midimon

# Check daemon status
midimonctl status
</code></pre>
<p>You should see:</p>
<pre><code>MIDIMon Daemon Status:
  State: Running
  Uptime: 2m 15s
  Config: /Users/you/.config/midimon/config.toml
  IPC Socket: /tmp/midimon.sock
</code></pre>
<h4 id="4-control-the-launchagent"><a class="header" href="#4-control-the-launchagent">4. Control the LaunchAgent</a></h4>
<pre><code class="language-bash"># Stop
launchctl unload ~/Library/LaunchAgents/com.midimon.daemon.plist

# Start
launchctl load ~/Library/LaunchAgents/com.midimon.daemon.plist

# Restart
launchctl unload ~/Library/LaunchAgents/com.midimon.daemon.plist
launchctl load ~/Library/LaunchAgents/com.midimon.daemon.plist
</code></pre>
<h4 id="5-check-logs"><a class="header" href="#5-check-logs">5. Check Logs</a></h4>
<pre><code class="language-bash"># Standard output
tail -f /tmp/midimon.log

# Errors
tail -f /tmp/midimon.err

# Or use daemon status
midimonctl status --json | jq
</code></pre>
<h2 id="post-installation-steps"><a class="header" href="#post-installation-steps">Post-Installation Steps</a></h2>
<h3 id="1-test-your-mappings"><a class="header" href="#1-test-your-mappings">1. Test Your Mappings</a></h3>
<p>Press pads on your controller and verify actions execute correctly.</p>
<p><strong>Test checklist</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
Pad presses trigger actions</li>
<li><input disabled="" type="checkbox"/>
LEDs respond to presses (if using Mikro MK3)</li>
<li><input disabled="" type="checkbox"/>
Mode switching works (if configured)</li>
<li><input disabled="" type="checkbox"/>
Encoder controls work (if mapped)</li>
<li><input disabled="" type="checkbox"/>
Long press detection works</li>
<li><input disabled="" type="checkbox"/>
Double-tap detection works</li>
</ul>
<h3 id="2-customize-configtoml"><a class="header" href="#2-customize-configtoml">2. Customize config.toml</a></h3>
<p>Edit <code>config.toml</code> to add your own mappings. See:</p>
<ul>
<li><a href="installation/../getting-started/first-mapping.html">First Mapping Tutorial</a></li>
<li><a href="installation/../getting-started/modes.html">Modes Guide</a></li>
<li><a href="installation/../configuration/overview.html">Configuration Overview</a></li>
</ul>
<h3 id="3-create-device-profile-optional"><a class="header" href="#3-create-device-profile-optional">3. Create Device Profile (Optional)</a></h3>
<p>If you want custom pad layouts:</p>
<ol>
<li>Open <strong>Native Instruments Controller Editor</strong></li>
<li>Select <strong>Maschine Mikro MK3</strong></li>
<li>Edit pad pages (A-H)</li>
<li>Save as <code>.ncmm3</code> file</li>
<li>Use with <code>--profile</code> flag</li>
</ol>
<p>See <a href="installation/../DEVICE_PROFILES.html">Device Profiles Documentation</a> for details.</p>
<h2 id="platform-specific-notes"><a class="header" href="#platform-specific-notes">Platform-Specific Notes</a></h2>
<h3 id="macos-versions"><a class="header" href="#macos-versions">macOS Versions</a></h3>
<p><strong>Tested on</strong>:</p>
<ul>
<li>macOS Sonoma (14.x) - Full support</li>
<li>macOS Ventura (13.x) - Full support</li>
<li>macOS Monterey (12.x) - Full support</li>
</ul>
<p><strong>Known issues</strong>:</p>
<ul>
<li>macOS Big Sur (11.x) and earlier: HID shared device access may not work</li>
</ul>
<h3 id="apple-silicon-m1m2m3"><a class="header" href="#apple-silicon-m1m2m3">Apple Silicon (M1/M2/M3)</a></h3>
<p>MIDIMon works natively on Apple Silicon:</p>
<pre><code class="language-bash"># Build for current architecture
cargo build --release

# Binary will be ARM64 (aarch64) on M1/M2/M3
file target/release/midimon
# Output: target/release/midimon: Mach-O 64-bit executable arm64
</code></pre>
<p>No special configuration needed - all dependencies support ARM64.</p>
<h3 id="intel-macs"><a class="header" href="#intel-macs">Intel Macs</a></h3>
<p>Works identically to Apple Silicon. If you need a universal binary:</p>
<pre><code class="language-bash"># Build for both architectures
rustup target add x86_64-apple-darwin
rustup target add aarch64-apple-darwin

cargo build --release --target x86_64-apple-darwin
cargo build --release --target aarch64-apple-darwin

# Combine into universal binary
lipo -create \
    target/x86_64-apple-darwin/release/midimon \
    target/aarch64-apple-darwin/release/midimon \
    -output midimon-universal
</code></pre>
<h3 id="shared-device-access"><a class="header" href="#shared-device-access">Shared Device Access</a></h3>
<p>MIDIMon uses <code>macos-shared-device</code> feature in <code>hidapi</code> to allow concurrent access with NI Controller Editor. This means:</p>
<ul>
<li>‚úÖ You can run MIDIMon and Controller Editor simultaneously</li>
<li>‚úÖ Both can control LEDs without conflicts</li>
<li>‚úÖ Both receive MIDI input</li>
</ul>
<p>This is enabled by default in <code>Cargo.toml</code>:</p>
<pre><code class="language-toml">[dependencies]
hidapi = { version = "2.4", features = ["macos-shared-device"] }
</code></pre>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="build-errors"><a class="header" href="#build-errors">Build Errors</a></h3>
<p><strong>Error</strong>: <code>error: linker 'cc' not found</code></p>
<p><strong>Solution</strong>: Install Xcode Command Line Tools:</p>
<pre><code class="language-bash">xcode-select --install
</code></pre>
<hr />
<p><strong>Error</strong>: <code>error: could not compile 'hidapi'</code></p>
<p><strong>Solution</strong>: Update Rust and dependencies:</p>
<pre><code class="language-bash">rustup update
cargo clean
cargo build --release
</code></pre>
<hr />
<h3 id="runtime-errors"><a class="header" href="#runtime-errors">Runtime Errors</a></h3>
<p><strong>Error</strong>: <code>No MIDI input ports available</code></p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Check USB connection</li>
<li>Open Audio MIDI Setup and verify device appears</li>
<li>Try different USB port</li>
<li>Restart device</li>
</ol>
<hr />
<p><strong>Error</strong>: <code>Failed to open HID device</code></p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Grant Input Monitoring permission (see above)</li>
<li>Install Native Instruments drivers</li>
<li>Check USB cable and connection</li>
<li>Try running with sudo (not recommended long-term):
<pre><code class="language-bash">sudo ./target/release/midimon 2
</code></pre>
</li>
</ol>
<hr />
<p><strong>Error</strong>: <code>Permission denied (os error 13)</code></p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Check Input Monitoring permission</li>
<li>Verify binary has correct permissions:
<pre><code class="language-bash">ls -l target/release/midimon
chmod +x target/release/midimon
</code></pre>
</li>
</ol>
<hr />
<h3 id="led-issues"><a class="header" href="#led-issues">LED Issues</a></h3>
<p><strong>LEDs not lighting up</strong>:</p>
<ol>
<li>Verify Native Instruments drivers installed</li>
<li>Check Input Monitoring permission</li>
<li>Test with different LED scheme:
<pre><code class="language-bash">cargo run --release 2 --led rainbow
</code></pre>
</li>
<li>Check DEBUG output:
<pre><code class="language-bash">DEBUG=1 cargo run --release 2
</code></pre>
</li>
</ol>
<p><strong>LEDs lighting wrong pads</strong>:</p>
<ol>
<li>Verify you're using a device profile</li>
<li>Check profile has correct note mappings</li>
<li>See <a href="installation/../DEVICE_PROFILES.html">Device Profiles</a></li>
<li>Use pad mapper to verify notes:
<pre><code class="language-bash">cargo run --bin pad_mapper
</code></pre>
</li>
</ol>
<h2 id="next-steps"><a class="header" href="#next-steps">Next Steps</a></h2>
<p>Now that MIDIMon v2.0.0 is installed and running:</p>
<h3 id="for-gui-users"><a class="header" href="#for-gui-users">For GUI Users</a></h3>
<ol>
<li><strong>Learn the GUI</strong>: Read <a href="installation/../getting-started/gui-quick-start.html">GUI Quick Start Guide</a></li>
<li><strong>MIDI Learn Tutorial</strong>: See <a href="installation/../getting-started/midi-learn.html">MIDI Learn Mode</a></li>
<li><strong>Device Templates</strong>: Check <a href="installation/../guides/device-templates.html">Using Device Templates</a></li>
<li><strong>Per-App Profiles</strong>: Set up <a href="installation/../guides/per-app-profiles.html">Application-Specific Profiles</a></li>
</ol>
<h3 id="for-cli-users"><a class="header" href="#for-cli-users">For CLI Users</a></h3>
<ol>
<li><strong>Daemon Control</strong>: Read <a href="installation/../guides/daemon.html">Daemon &amp; Hot-Reload Guide</a></li>
<li><strong>CLI Reference</strong>: See <a href="installation/../reference/cli.html">midimonctl Commands</a></li>
<li><strong>Manual Configuration</strong>: Check <a href="installation/../configuration/overview.html">Configuration Overview</a></li>
<li><strong>Advanced Actions</strong>: Explore <a href="installation/../reference/actions.html">Actions Reference</a></li>
</ol>
<h3 id="for-all-users"><a class="header" href="#for-all-users">For All Users</a></h3>
<ul>
<li><strong>Troubleshooting</strong>: <a href="installation/../troubleshooting/common-issues.html">Common Issues</a></li>
<li><strong>LED Customization</strong>: <a href="installation/../guides/led-system.html">LED System Documentation</a></li>
<li><strong>Diagnostic Tools</strong>: <a href="installation/../troubleshooting/diagnostics.html">Debugging Guide</a></li>
</ul>
<h2 id="getting-help"><a class="header" href="#getting-help">Getting Help</a></h2>
<p>If you encounter issues:</p>
<ol>
<li>Check <a href="installation/../troubleshooting/common-issues.html">Common Issues</a></li>
<li>Use <a href="installation/../troubleshooting/diagnostics.html">Diagnostic Tools</a></li>
<li>Enable debug logging: <code>DEBUG=1 cargo run --release 2</code></li>
<li>File an issue on GitHub with:
<ul>
<li>macOS version</li>
<li>Hardware (Intel/Apple Silicon)</li>
<li>Device model</li>
<li>Error messages</li>
<li>Output of <code>cargo --version</code> and <code>rustc --version</code></li>
</ul>
</li>
</ol>
<hr />
<p><strong>Last Updated</strong>: November 14, 2025 (v2.0.0)
<strong>macOS Support</strong>: 11.0+ (Big Sur and later)
<strong>Architecture</strong>: Universal Binary (Intel + Apple Silicon)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linux-installation"><a class="header" href="#linux-installation">Linux Installation</a></h1>
<blockquote>
<p><strong>Note</strong>: This section is under development and will be completed in Phase 1 (Q1 2025).</p>
<p>For now, please refer to:</p>
<ul>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/README.md">README.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/CLAUDE.md">CLAUDE.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/discussions">GitHub Discussions</a></li>
</ul>
</blockquote>
<h2 id="coming-soon"><a class="header" href="#coming-soon">Coming Soon</a></h2>
<p>This page will cover:</p>
<ul>
<li>TBD</li>
</ul>
<hr />
<p><strong>Help Wanted</strong>: We're looking for contributors to help write documentation. See <a href="installation/../development/contributing.html">Contributing Guide</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="windows-installation"><a class="header" href="#windows-installation">Windows Installation</a></h1>
<blockquote>
<p><strong>Note</strong>: This section is under development and will be completed in Phase 1 (Q1 2025).</p>
<p>For now, please refer to:</p>
<ul>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/README.md">README.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/CLAUDE.md">CLAUDE.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/discussions">GitHub Discussions</a></li>
</ul>
</blockquote>
<h2 id="coming-soon-1"><a class="header" href="#coming-soon-1">Coming Soon</a></h2>
<p>This page will cover:</p>
<ul>
<li>TBD</li>
</ul>
<hr />
<p><strong>Help Wanted</strong>: We're looking for contributors to help write documentation. See <a href="installation/../development/contributing.html">Contributing Guide</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="building-midimon-from-source"><a class="header" href="#building-midimon-from-source">Building MIDIMon from Source</a></h1>
<h2 id="overview-1"><a class="header" href="#overview-1">Overview</a></h2>
<p>This guide covers building MIDIMon from source code on any supported platform. Whether you're developing new features, customizing behavior, or just want to run the latest code, this guide walks through the complete build process.</p>
<h2 id="prerequisites-1"><a class="header" href="#prerequisites-1">Prerequisites</a></h2>
<h3 id="rust-toolchain"><a class="header" href="#rust-toolchain">Rust Toolchain</a></h3>
<p>MIDIMon requires Rust 1.70.0 or later.</p>
<h4 id="installing-rust"><a class="header" href="#installing-rust">Installing Rust</a></h4>
<p>The recommended way to install Rust is via <strong>rustup</strong>, the official Rust toolchain installer:</p>
<pre><code class="language-bash"># macOS/Linux
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# Windows (PowerShell)
# Download and run: https://win.rustup.rs/
</code></pre>
<p>Follow the installation prompts. The installer will:</p>
<ol>
<li>Install <code>rustc</code> (Rust compiler)</li>
<li>Install <code>cargo</code> (Rust package manager and build tool)</li>
<li>Configure your shell environment</li>
</ol>
<p><strong>After installation</strong>, reload your shell:</p>
<pre><code class="language-bash"># macOS/Linux
source $HOME/.cargo/env

# Windows: Close and reopen terminal
</code></pre>
<p><strong>Verify installation</strong>:</p>
<pre><code class="language-bash">rustc --version  # Should show: rustc 1.75.0 (or later)
cargo --version  # Should show: cargo 1.75.0 (or later)
</code></pre>
<h4 id="updating-rust"><a class="header" href="#updating-rust">Updating Rust</a></h4>
<p>Keep your toolchain up to date:</p>
<pre><code class="language-bash">rustup update
</code></pre>
<h2 id="workspace-architecture-v020"><a class="header" href="#workspace-architecture-v020">Workspace Architecture (v0.2.0+)</a></h2>
<p>MIDIMon uses a <strong>Cargo workspace</strong> with three packages since v0.2.0:</p>
<h3 id="package-structure"><a class="header" href="#package-structure">Package Structure</a></h3>
<ol>
<li>
<p><strong>midimon-core</strong> - Pure Rust engine library</p>
<ul>
<li>Zero UI dependencies (no colored output, pure logic)</li>
<li>Public API for embedding in other applications</li>
<li>30+ public types exported</li>
<li>Event processing, mapping engine, action execution</li>
</ul>
</li>
<li>
<p><strong>midimon-daemon</strong> - CLI daemon + diagnostic tools</p>
<ul>
<li>Main <code>midimon</code> binary (daemon service)</li>
<li><code>midimonctl</code> - CLI control tool (v1.0.0+)</li>
<li>6 diagnostic binaries:
<ul>
<li><code>midi_diagnostic</code> - MIDI event viewer</li>
<li><code>led_diagnostic</code> - LED testing tool</li>
<li><code>led_tester</code> - Interactive LED control</li>
<li><code>pad_mapper</code> - Note number mapper</li>
<li><code>test_midi</code> - Port connectivity test</li>
<li><code>midi_simulator</code> - MIDI event simulator (testing)</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>midimon</strong> (root) - Backward compatibility layer</p>
<ul>
<li>Re-exports midimon-core types</li>
<li>For existing v0.1.0 tests only</li>
<li>New code should use midimon-core directly</li>
</ul>
</li>
</ol>
<h3 id="when-to-use-each-package"><a class="header" href="#when-to-use-each-package">When to Use Each Package</a></h3>
<ul>
<li><strong>Use midimon-core</strong>: Embed MIDIMon in your application</li>
<li><strong>Use midimon-daemon</strong>: Run as standalone CLI/daemon</li>
<li><strong>Use midimon (root)</strong>: Only for backward compatibility</li>
</ul>
<h3 id="public-api-example"><a class="header" href="#public-api-example">Public API Example</a></h3>
<pre><code class="language-rust">use midimon_core::{Config, MappingEngine, EventProcessor, ActionExecutor};

let config = Config::load("config.toml")?;
let mut engine = MappingEngine::new();
// Process events, execute actions...</code></pre>
<h3 id="platform-specific-dependencies"><a class="header" href="#platform-specific-dependencies">Platform-Specific Dependencies</a></h3>
<h4 id="macos"><a class="header" href="#macos">macOS</a></h4>
<p><strong>Required</strong>:</p>
<ul>
<li><strong>Xcode Command Line Tools</strong>: Provides compilers and linkers
<pre><code class="language-bash">xcode-select --install
</code></pre>
</li>
</ul>
<p><strong>Optional (for Maschine Mikro MK3)</strong>:</p>
<ul>
<li><strong>Native Instruments Drivers</strong>: Required for HID/LED support
<ul>
<li>Download from <a href="https://www.native-instruments.com/en/support/downloads/">Native Instruments</a></li>
<li>Install via Native Access</li>
</ul>
</li>
</ul>
<p><strong>Verify</strong>:</p>
<pre><code class="language-bash"># Check compiler
clang --version

# Check USB device (if connected)
system_profiler SPUSBDataType | grep -i mikro
</code></pre>
<h4 id="linux-ubuntudebian"><a class="header" href="#linux-ubuntudebian">Linux (Ubuntu/Debian)</a></h4>
<p><strong>Required</strong>:</p>
<pre><code class="language-bash">sudo apt update
sudo apt install -y \
    build-essential \
    pkg-config \
    libasound2-dev \
    libudev-dev \
    libusb-1.0-0-dev
</code></pre>
<p><strong>For Fedora/RHEL</strong>:</p>
<pre><code class="language-bash">sudo dnf install -y \
    gcc \
    pkg-config \
    alsa-lib-devel \
    systemd-devel \
    libusbx-devel
</code></pre>
<p><strong>For Arch Linux</strong>:</p>
<pre><code class="language-bash">sudo pacman -S base-devel alsa-lib systemd-libs libusb
</code></pre>
<p><strong>udev rules</strong> (for HID access without sudo):</p>
<p>Create <code>/etc/udev/rules.d/50-midimon.rules</code>:</p>
<pre><code class="language-bash">sudo tee /etc/udev/rules.d/50-midimon.rules &lt;&lt; 'EOF'
# Native Instruments Maschine Mikro MK3
SUBSYSTEM=="usb", ATTRS{idVendor}=="17cc", ATTRS{idProduct}=="1600", MODE="0666", GROUP="plugdev"

# Generic MIDI devices
SUBSYSTEM=="usb", ATTRS{bInterfaceClass}=="01", ATTRS{bInterfaceSubClass}=="03", MODE="0666", GROUP="plugdev"
EOF

sudo udevadm control --reload-rules
sudo udevadm trigger
</code></pre>
<p>Add your user to the <code>plugdev</code> group:</p>
<pre><code class="language-bash">sudo usermod -a -G plugdev $USER
# Log out and back in for changes to take effect
</code></pre>
<h4 id="windows"><a class="header" href="#windows">Windows</a></h4>
<p><strong>Required</strong>:</p>
<ul>
<li>
<p><strong>Microsoft C++ Build Tools</strong>: For compiling native dependencies</p>
<ul>
<li>Download: <a href="https://visualstudio.microsoft.com/downloads/">Visual Studio Build Tools</a></li>
<li>Install "Desktop development with C++" workload</li>
</ul>
<p>OR</p>
<ul>
<li>Full Visual Studio (Community edition is free)</li>
</ul>
</li>
</ul>
<p><strong>Optional</strong>:</p>
<ul>
<li><strong>Native Instruments Drivers</strong>: For Maschine Mikro MK3 support
<ul>
<li>Download from <a href="https://www.native-instruments.com/en/support/downloads/">Native Instruments</a></li>
<li>Install via Native Access</li>
</ul>
</li>
</ul>
<p><strong>Verify</strong>:</p>
<pre><code class="language-powershell"># Check MSVC compiler
where cl

# Check Rust
rustc --version
cargo --version
</code></pre>
<h2 id="cloning-the-repository"><a class="header" href="#cloning-the-repository">Cloning the Repository</a></h2>
<h3 id="via-git"><a class="header" href="#via-git">Via Git</a></h3>
<pre><code class="language-bash"># HTTPS (recommended for most users)
git clone https://github.com/yourusername/midimon.git
cd midimon

# SSH (if you have SSH keys configured)
git clone git@github.com:yourusername/midimon.git
cd midimon
</code></pre>
<h3 id="verify-repository-contents"><a class="header" href="#verify-repository-contents">Verify Repository Contents</a></h3>
<pre><code class="language-bash">ls -la

# Expected files/directories:
# - Cargo.toml     (Rust project manifest)
# - Cargo.lock     (Dependency lock file)
# - src/           (Source code)
# - config.toml    (Example configuration)
# - README.md      (Project readme)
# - docs/          (Documentation)
</code></pre>
<h2 id="build-commands"><a class="header" href="#build-commands">Build Commands</a></h2>
<h3 id="workspace-builds-v020"><a class="header" href="#workspace-builds-v020">Workspace Builds (v0.2.0+)</a></h3>
<p>Build the entire workspace (all 3 packages in parallel):</p>
<pre><code class="language-bash"># Development build
cargo build --workspace

# Release build (optimized)
cargo build --release --workspace
</code></pre>
<p><strong>Build times</strong> (workspace):</p>
<ul>
<li>Clean build: ~12s (was 15-20s in v0.1.0)</li>
<li>Incremental: &lt;2s</li>
<li>Parallel compilation across all packages</li>
</ul>
<h3 id="package-specific-builds"><a class="header" href="#package-specific-builds">Package-Specific Builds</a></h3>
<p>Build individual packages for faster iteration:</p>
<pre><code class="language-bash"># Core engine only
cargo build --package midimon-core
cargo build -p midimon-core  # Short form

# Daemon + tools
cargo build -p midimon-daemon

# Compatibility layer
cargo build -p midimon

# Specific binary
cargo build --release --bin midimon
cargo build --release --bin midimonctl
cargo build --release --bin midi_diagnostic
</code></pre>
<h3 id="running-binaries"><a class="header" href="#running-binaries">Running Binaries</a></h3>
<pre><code class="language-bash"># Main daemon
cargo run --release --bin midimon 2

# Daemon control
cargo run --release --bin midimonctl status

# Diagnostic tool
cargo run --release --bin midi_diagnostic 2
</code></pre>
<h3 id="debug-build"><a class="header" href="#debug-build">Debug Build</a></h3>
<p>Fastest compilation, includes debug symbols, no optimization:</p>
<pre><code class="language-bash">cargo build
</code></pre>
<p><strong>Output</strong>: <code>target/debug/midimon</code> (~10-20MB binary)</p>
<p><strong>When to use</strong>:</p>
<ul>
<li>Development and testing</li>
<li>Debugging with <code>lldb</code>/<code>gdb</code></li>
<li>Frequent recompilation</li>
</ul>
<p><strong>Performance</strong>: ~20-30% slower than release builds</p>
<h3 id="release-build"><a class="header" href="#release-build">Release Build</a></h3>
<p>Optimized compilation, stripped debug symbols, smaller binary:</p>
<pre><code class="language-bash">cargo build --release
</code></pre>
<p><strong>Output</strong>: <code>target/release/midimon</code> (~3-5MB binary)</p>
<p><strong>When to use</strong>:</p>
<ul>
<li>Production use</li>
<li>Performance-critical applications</li>
<li>Distribution</li>
</ul>
<p><strong>Build time</strong>: 12s clean, &lt;2s incremental (workspace)</p>
<p><strong>Performance</strong>: Full optimization, &lt;1ms MIDI latency</p>
<h3 id="clean-build"><a class="header" href="#clean-build">Clean Build</a></h3>
<p>Remove all build artifacts and start fresh:</p>
<pre><code class="language-bash"># Clean build artifacts
cargo clean

# Then rebuild
cargo build --release
</code></pre>
<p><strong>When to use</strong>:</p>
<ul>
<li>After updating dependencies</li>
<li>Troubleshooting build issues</li>
<li>Freeing disk space (build artifacts can be 1-2GB)</li>
</ul>
<h3 id="check-only-no-binary"><a class="header" href="#check-only-no-binary">Check Only (No Binary)</a></h3>
<p>Verify code compiles without producing a binary:</p>
<pre><code class="language-bash">cargo check
</code></pre>
<p><strong>Fastest</strong> way to verify code correctness during development. Use this for quick iteration.</p>
<h3 id="run-directly"><a class="header" href="#run-directly">Run Directly</a></h3>
<p>Build and run in one command:</p>
<pre><code class="language-bash"># Debug mode
cargo run

# Release mode (recommended)
cargo run --release

# With arguments
cargo run --release -- 2 --led reactive
</code></pre>
<p>Note the <code>--</code> separator between cargo arguments and program arguments.</p>
<h2 id="build-optimization"><a class="header" href="#build-optimization">Build Optimization</a></h2>
<h3 id="release-profile-configuration"><a class="header" href="#release-profile-configuration">Release Profile Configuration</a></h3>
<p>MIDIMon's <code>Cargo.toml</code> includes optimized release settings:</p>
<pre><code class="language-toml">[profile.release]
opt-level = 3        # Maximum optimization
lto = true           # Link-Time Optimization (smaller binary, longer build)
codegen-units = 1    # Single codegen unit (better optimization)
strip = true         # Strip debug symbols (smaller binary)
panic = 'abort'      # Abort on panic (smaller binary, no unwinding)
</code></pre>
<p><strong>Results</strong>:</p>
<ul>
<li>Binary size: ~3-5MB (vs ~15-20MB without optimization)</li>
<li>Startup time: &lt;100ms</li>
<li>MIDI latency: &lt;1ms</li>
<li>Memory usage: 5-10MB</li>
</ul>
<h3 id="custom-optimization-levels"><a class="header" href="#custom-optimization-levels">Custom Optimization Levels</a></h3>
<p>Override optimization for specific dependencies:</p>
<pre><code class="language-toml"># In Cargo.toml
[profile.dev.package.midir]
opt-level = 3  # Optimize MIDI library even in debug builds
</code></pre>
<h3 id="faster-debug-builds"><a class="header" href="#faster-debug-builds">Faster Debug Builds</a></h3>
<p>Trade optimization for compile speed during development:</p>
<pre><code class="language-toml"># In Cargo.toml
[profile.dev]
opt-level = 1        # Basic optimization
debug = true         # Keep debug symbols
incremental = true   # Enable incremental compilation
</code></pre>
<h3 id="parallel-compilation"><a class="header" href="#parallel-compilation">Parallel Compilation</a></h3>
<p>Cargo uses all CPU cores by default. To limit:</p>
<pre><code class="language-bash"># Use 4 cores
cargo build -j 4

# Use 1 core (debugging build issues)
cargo build -j 1
</code></pre>
<h2 id="cross-compilation"><a class="header" href="#cross-compilation">Cross-Compilation</a></h2>
<h3 id="macos-universal-binary-intel--apple-silicon"><a class="header" href="#macos-universal-binary-intel--apple-silicon">macOS: Universal Binary (Intel + Apple Silicon)</a></h3>
<p>Build a single binary that runs on both architectures:</p>
<pre><code class="language-bash"># Install targets
rustup target add x86_64-apple-darwin
rustup target add aarch64-apple-darwin

# Build for both
cargo build --release --target x86_64-apple-darwin
cargo build --release --target aarch64-apple-darwin

# Create universal binary
lipo -create \
    target/x86_64-apple-darwin/release/midimon \
    target/aarch64-apple-darwin/release/midimon \
    -output target/release/midimon-universal

# Verify
file target/release/midimon-universal
# Output: Mach-O universal binary with 2 architectures: [x86_64:Mach-O 64-bit executable x86_64] [arm64]
</code></pre>
<h3 id="linux-cross-compile-for-different-architectures"><a class="header" href="#linux-cross-compile-for-different-architectures">Linux: Cross-Compile for Different Architectures</a></h3>
<pre><code class="language-bash"># Install target
rustup target add aarch64-unknown-linux-gnu

# Install cross-compiler (Ubuntu/Debian)
sudo apt install gcc-aarch64-linux-gnu

# Build
cargo build --release --target aarch64-unknown-linux-gnu
</code></pre>
<h3 id="windows-cross-compile-from-linux"><a class="header" href="#windows-cross-compile-from-linux">Windows: Cross-Compile from Linux</a></h3>
<p>Using the <code>cross</code> tool:</p>
<pre><code class="language-bash"># Install cross
cargo install cross

# Build for Windows
cross build --release --target x86_64-pc-windows-gnu
</code></pre>
<h2 id="dependency-management"><a class="header" href="#dependency-management">Dependency Management</a></h2>
<h3 id="updating-dependencies"><a class="header" href="#updating-dependencies">Updating Dependencies</a></h3>
<pre><code class="language-bash"># Update all dependencies to latest compatible versions
cargo update

# Check for outdated dependencies
cargo outdated

# Update specific dependency
cargo update -p midir
</code></pre>
<h3 id="dependency-audit"><a class="header" href="#dependency-audit">Dependency Audit</a></h3>
<p>Check for security vulnerabilities:</p>
<pre><code class="language-bash"># Install cargo-audit
cargo install cargo-audit

# Run audit
cargo audit
</code></pre>
<h3 id="vendoring-dependencies-offline-builds"><a class="header" href="#vendoring-dependencies-offline-builds">Vendoring Dependencies (Offline Builds)</a></h3>
<p>For building without internet access:</p>
<pre><code class="language-bash"># Download all dependencies
cargo vendor

# Configure to use vendored deps
mkdir -p .cargo
cat &gt; .cargo/config.toml &lt;&lt; 'EOF'
[source.crates-io]
replace-with = "vendored-sources"

[source.vendored-sources]
directory = "vendor"
EOF

# Now cargo build works offline
cargo build --release
</code></pre>
<h2 id="binary-size-optimization"><a class="header" href="#binary-size-optimization">Binary Size Optimization</a></h2>
<h3 id="size-comparison"><a class="header" href="#size-comparison">Size Comparison</a></h3>
<pre><code class="language-bash"># Default release build
cargo build --release
ls -lh target/release/midimon
# ~3-5MB

# Further optimization
cargo build --release --features "optimize-size"
ls -lh target/release/midimon
# ~2-3MB
</code></pre>
<h3 id="extreme-size-reduction"><a class="header" href="#extreme-size-reduction">Extreme Size Reduction</a></h3>
<p>Add to <code>Cargo.toml</code>:</p>
<pre><code class="language-toml">[profile.release-min]
inherits = "release"
opt-level = "z"      # Optimize for size
lto = true
codegen-units = 1
strip = true
panic = 'abort'
</code></pre>
<p>Build with:</p>
<pre><code class="language-bash">cargo build --profile release-min
</code></pre>
<p>Result: ~1-2MB binary (may be slightly slower)</p>
<h3 id="analyze-binary-size"><a class="header" href="#analyze-binary-size">Analyze Binary Size</a></h3>
<pre><code class="language-bash"># Install cargo-bloat
cargo install cargo-bloat

# Analyze
cargo bloat --release --crates
cargo bloat --release -n 20  # Show top 20 functions by size
</code></pre>
<h2 id="development-builds"><a class="header" href="#development-builds">Development Builds</a></h2>
<h3 id="watch-mode-auto-rebuild-on-changes"><a class="header" href="#watch-mode-auto-rebuild-on-changes">Watch Mode (Auto-Rebuild on Changes)</a></h3>
<pre><code class="language-bash"># Install cargo-watch
cargo install cargo-watch

# Auto-rebuild on save
cargo watch -x check
cargo watch -x 'run -- 2'
cargo watch -x 'test'
</code></pre>
<h3 id="build-with-specific-features"><a class="header" href="#build-with-specific-features">Build with Specific Features</a></h3>
<pre><code class="language-bash"># Build with all features
cargo build --all-features

# Build with specific feature
cargo build --features "midi-learn"

# Build without default features
cargo build --no-default-features
</code></pre>
<h3 id="build-examples-and-binaries"><a class="header" href="#build-examples-and-binaries">Build Examples and Binaries</a></h3>
<p>MIDIMon includes diagnostic tools:</p>
<pre><code class="language-bash"># Build all binaries
cargo build --release --bins

# Build specific binary
cargo build --release --bin midi_diagnostic

# List available binaries
ls target/release/midi_*
# midi_diagnostic
# led_diagnostic
# led_tester
# pad_mapper
# test_midi
</code></pre>
<h2 id="testing-builds"><a class="header" href="#testing-builds">Testing Builds</a></h2>
<h3 id="run-tests"><a class="header" href="#run-tests">Run Tests</a></h3>
<pre><code class="language-bash"># Run all tests
cargo test

# Run tests with output
cargo test -- --nocapture

# Run specific test
cargo test test_event_processor

# Run tests with release optimizations
cargo test --release
</code></pre>
<h3 id="run-benchmarks"><a class="header" href="#run-benchmarks">Run Benchmarks</a></h3>
<pre><code class="language-bash"># Install cargo-criterion
cargo install cargo-criterion

# Run benchmarks
cargo bench
</code></pre>
<h3 id="integration-tests"><a class="header" href="#integration-tests">Integration Tests</a></h3>
<pre><code class="language-bash"># Run only integration tests
cargo test --test '*'

# Run with real MIDI device (requires hardware)
cargo test --test integration_midi -- --ignored
</code></pre>
<h2 id="troubleshooting-build-issues"><a class="header" href="#troubleshooting-build-issues">Troubleshooting Build Issues</a></h2>
<h3 id="common-errors"><a class="header" href="#common-errors">Common Errors</a></h3>
<h4 id="error-linker-cc-not-found"><a class="header" href="#error-linker-cc-not-found">Error: "linker 'cc' not found"</a></h4>
<p><strong>Cause</strong>: Missing C compiler</p>
<p><strong>Solution</strong>:</p>
<ul>
<li><strong>macOS</strong>: <code>xcode-select --install</code></li>
<li><strong>Linux</strong>: <code>sudo apt install build-essential</code></li>
<li><strong>Windows</strong>: Install Visual Studio Build Tools</li>
</ul>
<hr />
<h4 id="error-could-not-compile-hidapi"><a class="header" href="#error-could-not-compile-hidapi">Error: "could not compile 'hidapi'"</a></h4>
<p><strong>Cause</strong>: Missing USB/HID development libraries</p>
<p><strong>Solution</strong>:</p>
<ul>
<li><strong>macOS</strong>: Install Xcode Command Line Tools</li>
<li><strong>Linux</strong>: <code>sudo apt install libudev-dev libusb-1.0-0-dev</code></li>
<li><strong>Windows</strong>: Install Windows SDK</li>
</ul>
<hr />
<h4 id="error-failed-to-fetch-dependencies"><a class="header" href="#error-failed-to-fetch-dependencies">Error: "failed to fetch dependencies"</a></h4>
<p><strong>Cause</strong>: Network issues or outdated index</p>
<p><strong>Solution</strong>:</p>
<pre><code class="language-bash"># Update cargo index
cargo update

# Or manually remove and re-fetch
rm -rf ~/.cargo/registry/index
cargo build
</code></pre>
<hr />
<h4 id="error-out-of-disk-space"><a class="header" href="#error-out-of-disk-space">Error: "out of disk space"</a></h4>
<p><strong>Cause</strong>: Build artifacts consuming too much space</p>
<p><strong>Solution</strong>:</p>
<pre><code class="language-bash"># Clean all build artifacts
cargo clean

# Clean entire cargo cache (frees 1-5GB)
rm -rf ~/.cargo/registry/cache
rm -rf ~/.cargo/registry/src
</code></pre>
<hr />
<h3 id="incremental-build-issues"><a class="header" href="#incremental-build-issues">Incremental Build Issues</a></h3>
<p>If incremental builds produce errors:</p>
<pre><code class="language-bash"># Disable incremental compilation
CARGO_INCREMENTAL=0 cargo build --release

# Or add to ~/.cargo/config.toml:
[build]
incremental = false
</code></pre>
<h3 id="dependency-conflicts"><a class="header" href="#dependency-conflicts">Dependency Conflicts</a></h3>
<p>If cargo reports conflicting dependencies:</p>
<pre><code class="language-bash"># Show dependency tree
cargo tree

# Show why a dependency is included
cargo tree -i &lt;dependency-name&gt;

# Update all dependencies
cargo update
</code></pre>
<h2 id="build-performance-tips"><a class="header" href="#build-performance-tips">Build Performance Tips</a></h2>
<h3 id="parallel-compilation-1"><a class="header" href="#parallel-compilation-1">Parallel Compilation</a></h3>
<p>Use all CPU cores:</p>
<pre><code class="language-bash"># Set in ~/.cargo/config.toml
[build]
jobs = 8  # Or number of cores
</code></pre>
<h3 id="use-faster-linker"><a class="header" href="#use-faster-linker">Use Faster Linker</a></h3>
<h4 id="macos-1"><a class="header" href="#macos-1">macOS</a></h4>
<pre><code class="language-bash"># Install zld (faster linker)
brew install michaeleisel/zld/zld

# Configure in .cargo/config.toml
[target.x86_64-apple-darwin]
rustflags = ["-C", "link-arg=-fuse-ld=/usr/local/bin/zld"]

[target.aarch64-apple-darwin]
rustflags = ["-C", "link-arg=-fuse-ld=/opt/homebrew/bin/zld"]
</code></pre>
<h4 id="linux"><a class="header" href="#linux">Linux</a></h4>
<pre><code class="language-bash"># Install mold (very fast linker)
sudo apt install mold  # Ubuntu 22.04+
# or download from: https://github.com/rui314/mold

# Configure in .cargo/config.toml
[target.x86_64-unknown-linux-gnu]
linker = "clang"
rustflags = ["-C", "link-arg=-fuse-ld=mold"]
</code></pre>
<p><strong>Result</strong>: 2-3x faster linking (especially for incremental builds)</p>
<h3 id="use-sccache-shared-compilation-cache"><a class="header" href="#use-sccache-shared-compilation-cache">Use sccache (Shared Compilation Cache)</a></h3>
<pre><code class="language-bash"># Install sccache
cargo install sccache

# Configure
export RUSTC_WRAPPER=sccache

# Check stats
sccache --show-stats
</code></pre>
<p>Speeds up rebuilds across multiple projects.</p>
<h2 id="distribution"><a class="header" href="#distribution">Distribution</a></h2>
<h3 id="creating-release-artifacts"><a class="header" href="#creating-release-artifacts">Creating Release Artifacts</a></h3>
<pre><code class="language-bash"># Build optimized binary
cargo build --release

# Copy to distribution directory
mkdir -p dist
cp target/release/midimon dist/
cp config.toml dist/config.example.toml
cp README.md dist/

# Create tarball
cd dist
tar czf midimon-v0.1.0-macos-aarch64.tar.gz *
</code></pre>
<h3 id="code-signing-macos"><a class="header" href="#code-signing-macos">Code Signing (macOS)</a></h3>
<p>For distribution outside the App Store:</p>
<pre><code class="language-bash"># Sign the binary
codesign --force --deep --sign "Developer ID Application: Your Name" \
    target/release/midimon

# Verify signature
codesign -dv --verbose=4 target/release/midimon

# Notarize (requires paid Apple Developer account)
xcrun notarytool submit midimon.zip \
    --keychain-profile "AC_PASSWORD" \
    --wait
</code></pre>
<h2 id="next-steps-1"><a class="header" href="#next-steps-1">Next Steps</a></h2>
<p>After building successfully:</p>
<ol>
<li><strong>Run the binary</strong>: <code>./target/release/midimon</code></li>
<li><strong>Configure mappings</strong>: Edit <code>config.toml</code></li>
<li><strong>Read documentation</strong>:
<ul>
<li><a href="installation/macos.html">macOS Installation</a></li>
<li><a href="installation/../getting-started/first-mapping.html">First Mapping</a></li>
<li><a href="installation/../configuration/overview.html">Configuration Overview</a></li>
</ul>
</li>
</ol>
<h2 id="see-also"><a class="header" href="#see-also">See Also</a></h2>
<ul>
<li><a href="https://doc.rust-lang.org/cargo/">Cargo Book</a> - Complete cargo documentation</li>
<li><a href="https://doc.rust-lang.org/nightly/rustc/platform-support.html">Rust Platform Support</a> - All supported targets</li>
<li><a href="installation/../reference/cli-commands.html">CLI Commands</a> - Running the binary with options</li>
</ul>
<hr />
<p><strong>Last Updated</strong>: November 11, 2025
<strong>Rust Version</strong>: 1.70.0+ required, 1.75.0+ recommended</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="quick-start-guide"><a class="header" href="#quick-start-guide">Quick Start Guide</a></h1>
<p>Get MIDIMon v2.0.0 up and running in under 5 minutes using the visual GUI.</p>
<h2 id="prerequisites-2"><a class="header" href="#prerequisites-2">Prerequisites</a></h2>
<ul>
<li><strong>macOS 11.0+</strong> (Big Sur or later) - Intel or Apple Silicon</li>
<li><strong>MIDI controller</strong> (any USB MIDI device - Maschine Mikro MK3 recommended for full RGB LED support)</li>
<li><strong>10 minutes</strong> for installation</li>
</ul>
<h2 id="step-1-download-midimon"><a class="header" href="#step-1-download-midimon">Step 1: Download MIDIMon</a></h2>
<p>Visit the <a href="https://github.com/amiable-dev/midimon/releases/latest">GitHub Releases page</a> and download:</p>
<p><strong>For most users</strong> (recommended):</p>
<ul>
<li><code>midimon-gui-macos-universal.tar.gz</code> - GUI application (includes daemon)</li>
</ul>
<p><strong>For CLI-only users</strong>:</p>
<ul>
<li><code>midimon-aarch64-apple-darwin.tar.gz</code> (Apple Silicon)</li>
<li><code>midimon-x86_64-apple-darwin.tar.gz</code> (Intel)</li>
</ul>
<h2 id="step-2-install-the-gui"><a class="header" href="#step-2-install-the-gui">Step 2: Install the GUI</a></h2>
<pre><code class="language-bash"># Extract the downloaded file
tar xzf midimon-gui-macos-universal.tar.gz

# Move to Applications folder
mv "MIDIMon GUI.app" /Applications/

# Open the app
open /Applications/"MIDIMon GUI.app"
</code></pre>
<p><strong>First launch</strong>: macOS will ask for permissions. Grant <strong>Input Monitoring</strong> permission when prompted (required for LED control and device access).</p>
<h2 id="step-3-connect-your-device"><a class="header" href="#step-3-connect-your-device">Step 3: Connect Your Device</a></h2>
<ol>
<li>
<p><strong>Plug in your MIDI controller</strong> via USB</p>
</li>
<li>
<p><strong>In the MIDIMon GUI</strong>, go to the <strong>Device Connection</strong> panel</p>
</li>
<li>
<p>Your device should appear in the list. Click <strong>Connect</strong></p>
</li>
<li>
<p>The status bar at the bottom should show: <strong>"Connected to [Your Device]"</strong></p>
</li>
</ol>
<p>If your device doesn't appear:</p>
<ul>
<li>Check USB cable</li>
<li>Try a different USB port</li>
<li>See <a href="getting-started/../troubleshooting/device-connection.html">Troubleshooting Device Connection</a></li>
</ul>
<h2 id="step-4-create-your-first-mapping-with-midi-learn"><a class="header" href="#step-4-create-your-first-mapping-with-midi-learn">Step 4: Create Your First Mapping with MIDI Learn</a></h2>
<p>The fastest way to create a mapping is using <strong>MIDI Learn mode</strong>:</p>
<ol>
<li>
<p><strong>Click "Add Mapping"</strong> in the Mappings panel</p>
</li>
<li>
<p><strong>Click "Learn"</strong> next to the Trigger field</p>
</li>
<li>
<p><strong>Press any pad/button</strong> on your MIDI controller</p>
</li>
<li>
<p>The trigger configuration <strong>auto-fills</strong> with the detected input</p>
</li>
<li>
<p><strong>Choose an action</strong>:</p>
<ul>
<li><strong>Keystroke</strong> - Press a key (e.g., Cmd+C for copy)</li>
<li><strong>Launch</strong> - Open an application</li>
<li><strong>Text</strong> - Type text</li>
<li><strong>Shell</strong> - Run a command</li>
</ul>
</li>
<li>
<p><strong>Click "Save"</strong></p>
</li>
<li>
<p><strong>Test it!</strong> Press the same pad/button - the action should execute</p>
</li>
</ol>
<p><strong>Example</strong>: Map pad to open Spotify:</p>
<ul>
<li>Trigger: Note 36 (auto-detected via MIDI Learn)</li>
<li>Action: Launch ‚Üí <code>/Applications/Spotify.app</code></li>
</ul>
<h2 id="step-5-explore-advanced-features"><a class="header" href="#step-5-explore-advanced-features">Step 5: Explore Advanced Features</a></h2>
<h3 id="velocity-sensitivity"><a class="header" href="#velocity-sensitivity">Velocity Sensitivity</a></h3>
<p>Map different actions based on how hard you hit a pad:</p>
<ol>
<li>Select trigger type: <strong>Velocity Range</strong></li>
<li>Use MIDI Learn to detect the note</li>
<li>Set velocity ranges:
<ul>
<li><strong>Soft</strong> (0-40): Pause playback</li>
<li><strong>Hard</strong> (81-127): Skip track</li>
</ul>
</li>
</ol>
<h3 id="long-press-detection"><a class="header" href="#long-press-detection">Long Press Detection</a></h3>
<p>Hold a pad for 2+ seconds to trigger a different action:</p>
<ol>
<li>Select trigger type: <strong>Long Press</strong></li>
<li>Use MIDI Learn</li>
<li>Set <strong>Hold Duration</strong>: 2000ms</li>
<li>Action: Open Calculator</li>
</ol>
<h3 id="chord-detection"><a class="header" href="#chord-detection">Chord Detection</a></h3>
<p>Press multiple pads simultaneously:</p>
<ol>
<li>Select trigger type: <strong>Chord</strong></li>
<li>Use MIDI Learn and press all pads within 100ms</li>
<li>Action: Launch your favorite app</li>
</ol>
<h2 id="step-6-use-device-templates"><a class="header" href="#step-6-use-device-templates">Step 6: Use Device Templates</a></h2>
<p>Skip manual configuration with built-in device templates:</p>
<ol>
<li>
<p>Go to <strong>Settings</strong> ‚Üí <strong>Device Templates</strong></p>
</li>
<li>
<p><strong>Select your controller</strong>:</p>
<ul>
<li>Maschine Mikro MK3</li>
<li>Launchpad Mini</li>
<li>APC Mini</li>
<li>Korg nanoKONTROL2</li>
<li>Novation Launchkey Mini</li>
<li>AKAI MPK Mini</li>
</ul>
</li>
<li>
<p>Click <strong>Load Template</strong></p>
</li>
<li>
<p>The template loads pre-configured mappings for common workflows</p>
</li>
<li>
<p><strong>Customize</strong> as needed using MIDI Learn</p>
</li>
</ol>
<h2 id="step-7-enable-auto-start-optional"><a class="header" href="#step-7-enable-auto-start-optional">Step 7: Enable Auto-Start (Optional)</a></h2>
<p>Run MIDIMon automatically when you log in:</p>
<ol>
<li>
<p>Go to <strong>Settings</strong> ‚Üí <strong>General</strong></p>
</li>
<li>
<p>Enable <strong>"Start MIDIMon on login"</strong></p>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
</ol>
<p>The daemon will now start automatically in the background every time you log in.</p>
<h2 id="using-the-daemon-cli-optional"><a class="header" href="#using-the-daemon-cli-optional">Using the Daemon CLI (Optional)</a></h2>
<p>For advanced users who prefer terminal control:</p>
<pre><code class="language-bash"># Check daemon status
midimonctl status

# Reload configuration (hot-reload in 0-10ms)
midimonctl reload

# Stop daemon
midimonctl stop

# Validate config without reloading
midimonctl validate

# Ping daemon (check latency)
midimonctl ping
</code></pre>
<p>See <a href="getting-started/../guides/daemon.html">Daemon &amp; CLI Guide</a> for full details.</p>
<h2 id="per-app-profiles-automatic-profile-switching"><a class="header" href="#per-app-profiles-automatic-profile-switching">Per-App Profiles (Automatic Profile Switching)</a></h2>
<p>MIDIMon v2.0.0 can automatically switch configurations based on which application is active:</p>
<ol>
<li>
<p>Go to <strong>Per-App Profiles</strong> in the GUI</p>
</li>
<li>
<p><strong>Add a new profile</strong>:</p>
<ul>
<li>Application: Select an app (e.g., "Visual Studio Code")</li>
<li>Profile: Select a config profile</li>
</ul>
</li>
<li>
<p>When you switch to that application, MIDIMon automatically loads the configured profile</p>
</li>
<li>
<p><strong>Example use cases</strong>:</p>
<ul>
<li><strong>Logic Pro</strong>: Pads control DAW functions (play, record, etc.)</li>
<li><strong>VS Code</strong>: Pads trigger common shortcuts (run, debug, search)</li>
<li><strong>Chrome</strong>: Pads control tabs and navigation</li>
</ul>
</li>
</ol>
<h2 id="live-event-console"><a class="header" href="#live-event-console">Live Event Console</a></h2>
<p>Debug your mappings in real-time:</p>
<ol>
<li>
<p>Go to <strong>Event Console</strong> in the GUI</p>
</li>
<li>
<p><strong>Watch MIDI events</strong> as they happen:</p>
<ul>
<li>Note On/Off</li>
<li>Velocity values</li>
<li>Control Change</li>
<li>Pitch Bend</li>
<li>Aftertouch</li>
</ul>
</li>
<li>
<p><strong>Filter events</strong> by type or note number</p>
</li>
<li>
<p><strong>Export logs</strong> for debugging</p>
</li>
</ol>
<p>This is invaluable for troubleshooting "why isn't my mapping working?"</p>
<h2 id="troubleshooting-1"><a class="header" href="#troubleshooting-1">Troubleshooting</a></h2>
<h3 id="device-not-found"><a class="header" href="#device-not-found">Device Not Found</a></h3>
<ol>
<li>
<p><strong>Check USB connection</strong>:</p>
<pre><code class="language-bash">system_profiler SPUSBDataType | grep -i midi
</code></pre>
</li>
<li>
<p><strong>Restart the daemon</strong>:</p>
<pre><code class="language-bash">midimonctl stop
open /Applications/"MIDIMon GUI.app"
</code></pre>
</li>
<li>
<p><strong>Check Audio MIDI Setup</strong>:</p>
<pre><code class="language-bash">open -a "Audio MIDI Setup"
</code></pre>
</li>
</ol>
<h3 id="leds-not-working"><a class="header" href="#leds-not-working">LEDs Not Working</a></h3>
<ol>
<li>
<p><strong>Ensure Native Instruments drivers are installed</strong> (for Maschine controllers)</p>
</li>
<li>
<p><strong>Grant Input Monitoring permission</strong>:</p>
<ul>
<li>System Settings ‚Üí Privacy &amp; Security ‚Üí Input Monitoring</li>
<li>Enable for "MIDIMon GUI"</li>
</ul>
</li>
<li>
<p><strong>Check LED scheme</strong> in GUI Settings</p>
</li>
<li>
<p><strong>View debug logs</strong> in Event Console</p>
</li>
</ol>
<h3 id="mappings-not-triggering"><a class="header" href="#mappings-not-triggering">Mappings Not Triggering</a></h3>
<ol>
<li>
<p><strong>Use Event Console</strong> to verify MIDI events are being received</p>
</li>
<li>
<p><strong>Use MIDI Learn</strong> to verify the correct note numbers</p>
</li>
<li>
<p><strong>Check mode</strong> - is the mapping in the current mode or global?</p>
</li>
<li>
<p><strong>Reload config</strong>:</p>
<pre><code class="language-bash">midimonctl reload
</code></pre>
</li>
</ol>
<h3 id="permission-denied-macos"><a class="header" href="#permission-denied-macos">Permission Denied (macOS)</a></h3>
<p>If you see "Permission denied" errors:</p>
<ol>
<li><strong>System Settings</strong> ‚Üí <strong>Privacy &amp; Security</strong> ‚Üí <strong>Input Monitoring</strong></li>
<li>Add <strong>"MIDIMon GUI"</strong> to the list</li>
<li>Restart the GUI app</li>
</ol>
<h2 id="next-steps-2"><a class="header" href="#next-steps-2">Next Steps</a></h2>
<p>Now that you're up and running:</p>
<h3 id="for-gui-users-1"><a class="header" href="#for-gui-users-1">For GUI Users</a></h3>
<ul>
<li><a href="getting-started/./midi-learn.html">MIDI Learn Tutorial</a> - Master MIDI Learn mode</li>
<li><a href="getting-started/../guides/device-templates.html">Device Templates Guide</a> - Use pre-built templates</li>
<li><a href="getting-started/../guides/per-app-profiles.html">Per-App Profiles Guide</a> - Set up application-specific profiles</li>
<li><a href="getting-started/../guides/event-console.html">Live Event Console</a> - Debug with real-time monitoring</li>
</ul>
<h3 id="for-cli-users-1"><a class="header" href="#for-cli-users-1">For CLI Users</a></h3>
<ul>
<li><a href="getting-started/../guides/daemon.html">Daemon &amp; Hot-Reload</a> - Master the daemon CLI</li>
<li><a href="getting-started/../configuration/overview.html">Manual Configuration</a> - Edit config.toml</li>
<li><a href="getting-started/../reference/triggers.html">Advanced Triggers</a> - All trigger types</li>
<li><a href="getting-started/../reference/actions.html">Advanced Actions</a> - All action types</li>
</ul>
<h3 id="for-all-users-1"><a class="header" href="#for-all-users-1">For All Users</a></h3>
<ul>
<li><a href="getting-started/./modes.html">Understanding Modes</a> - Multi-mode workflow management</li>
<li><a href="getting-started/../guides/led-system.html">LED System</a> - Customize LED feedback</li>
<li><a href="getting-started/../configuration/examples.html">Example Configurations</a> - Pre-built configs</li>
</ul>
<h2 id="performance-1"><a class="header" href="#performance-1">Performance</a></h2>
<p>MIDIMon v2.0.0 is highly optimized:</p>
<ul>
<li><strong>Response latency</strong>: &lt;1ms typical</li>
<li><strong>Config hot-reload</strong>: 0-10ms</li>
<li><strong>IPC round-trip</strong>: &lt;1ms</li>
<li><strong>Memory usage</strong>: 5-10MB (daemon), ~60MB (GUI)</li>
<li><strong>CPU usage</strong>: &lt;1% idle, &lt;5% active</li>
<li><strong>Binary size</strong>: ~3-5MB (release with LTO)</li>
</ul>
<h2 id="getting-help-1"><a class="header" href="#getting-help-1">Getting Help</a></h2>
<ul>
<li><a href="getting-started/../troubleshooting/common-issues.html">Troubleshooting Guide</a></li>
<li><a href="getting-started/../troubleshooting/faq.html">FAQ</a></li>
<li><a href="https://github.com/amiable-dev/midimon/discussions">GitHub Discussions</a></li>
<li><a href="https://github.com/amiable-dev/midimon/issues">Report Issues</a></li>
</ul>
<hr />
<p><strong>Congratulations!</strong> You now have MIDIMon v2.0.0 running with visual configuration, hot-reload, and per-app profiles. üéâ</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="your-first-mapping"><a class="header" href="#your-first-mapping">Your First Mapping</a></h1>
<p>Learn how to create custom mappings by building a practical example step-by-step.</p>
<h2 id="what-youll-build"><a class="header" href="#what-youll-build">What You'll Build</a></h2>
<p>A simple pad mapping that opens Visual Studio Code when you press pad 1 (Note 60).</p>
<h2 id="understanding-mapping-structure"><a class="header" href="#understanding-mapping-structure">Understanding Mapping Structure</a></h2>
<p>Every mapping has two parts:</p>
<pre><code class="language-toml">[[modes.mappings]]
trigger = { ... }  # What activates the mapping
action = { ... }   # What happens when activated
</code></pre>
<p>Think of it as: <strong>"When [trigger], do [action]"</strong></p>
<h2 id="step-1-open-your-config-file"><a class="header" href="#step-1-open-your-config-file">Step 1: Open Your Config File</a></h2>
<p>The config file is <code>config.toml</code> in your project root:</p>
<pre><code class="language-bash">cd /path/to/midimon
open config.toml  # macOS
# or
nano config.toml  # Terminal editor
</code></pre>
<h2 id="step-2-find-the-modes-section"><a class="header" href="#step-2-find-the-modes-section">Step 2: Find the Modes Section</a></h2>
<p>Scroll down to find the <code>[[modes]]</code> section. It looks like this:</p>
<pre><code class="language-toml">[[modes]]
name = "Default"
color = "blue"

[[modes.mappings]]
# Existing mappings here...
</code></pre>
<h2 id="step-3-add-your-mapping"><a class="header" href="#step-3-add-your-mapping">Step 3: Add Your Mapping</a></h2>
<p>Add this <strong>at the end</strong> of the <code>[[modes.mappings]]</code> section:</p>
<pre><code class="language-toml">[[modes.mappings]]
trigger = { Note = { note = 60, velocity_min = 0 } }
action = { Launch = { app_path = "/Applications/Visual Studio Code.app" } }
</code></pre>
<p><strong>What this means</strong>:</p>
<ul>
<li><strong>trigger</strong>: When pad Note 60 is pressed (any velocity ‚â•0)</li>
<li><strong>action</strong>: Launch Visual Studio Code</li>
</ul>
<h2 id="step-4-save-and-reload"><a class="header" href="#step-4-save-and-reload">Step 4: Save and Reload</a></h2>
<ol>
<li><strong>Save</strong> the file (Cmd+S or Ctrl+O in nano)</li>
<li><strong>Stop</strong> MIDIMon if it's running (Ctrl+C)</li>
<li><strong>Restart</strong> it:</li>
</ol>
<pre><code class="language-bash">cargo run --release 2
</code></pre>
<h2 id="step-5-test-it"><a class="header" href="#step-5-test-it">Step 5: Test It</a></h2>
<p>Press the <strong>first pad</strong> (bottom-left on Mikro MK3). Visual Studio Code should launch!</p>
<h2 id="understanding-note-numbers"><a class="header" href="#understanding-note-numbers">Understanding Note Numbers</a></h2>
<p>How do you know which pad is Note 60?</p>
<h3 id="quick-reference-maschine-mikro-mk3"><a class="header" href="#quick-reference-maschine-mikro-mk3">Quick Reference (Maschine Mikro MK3)</a></h3>
<pre><code>Pad Layout (4x4 grid):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 60 ‚îÇ 61 ‚îÇ 62 ‚îÇ 63 ‚îÇ  Top row
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 64 ‚îÇ 65 ‚îÇ 66 ‚îÇ 67 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 68 ‚îÇ 69 ‚îÇ 70 ‚îÇ 71 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   72   73   74   75    Bottom row
</code></pre>
<h3 id="find-note-numbers-for-any-device"><a class="header" href="#find-note-numbers-for-any-device">Find Note Numbers for Any Device</a></h3>
<p>Use the pad mapper tool:</p>
<pre><code class="language-bash">cargo run --bin pad_mapper
</code></pre>
<p>Then press each pad to see its note number.</p>
<h2 id="common-mapping-patterns"><a class="header" href="#common-mapping-patterns">Common Mapping Patterns</a></h2>
<h3 id="pattern-1-keyboard-shortcut"><a class="header" href="#pattern-1-keyboard-shortcut">Pattern 1: Keyboard Shortcut</a></h3>
<pre><code class="language-toml">[[modes.mappings]]
trigger = { Note = { note = 61, velocity_min = 0 } }
action = { Keystroke = { keys = ["Cmd", "T"] } }  # New tab
</code></pre>
<h3 id="pattern-2-type-text"><a class="header" href="#pattern-2-type-text">Pattern 2: Type Text</a></h3>
<pre><code class="language-toml">[[modes.mappings]]
trigger = { Note = { note = 62, velocity_min = 0 } }
action = { Text = { text = "user@example.com" } }
</code></pre>
<h3 id="pattern-3-run-shell-command"><a class="header" href="#pattern-3-run-shell-command">Pattern 3: Run Shell Command</a></h3>
<pre><code class="language-toml">[[modes.mappings]]
trigger = { Note = { note = 63, velocity_min = 0 } }
action = { Shell = { command = "open -a Calculator" } }
</code></pre>
<h3 id="pattern-4-volume-control"><a class="header" href="#pattern-4-volume-control">Pattern 4: Volume Control</a></h3>
<pre><code class="language-toml">[[modes.mappings]]
trigger = { Note = { note = 64, velocity_min = 0 } }
action = { VolumeControl = "VolumeUp" }
</code></pre>
<h2 id="next-steps-3"><a class="header" href="#next-steps-3">Next Steps</a></h2>
<ul>
<li><a href="getting-started/./modes.html">Understanding Modes</a> - Create mode-based workflows</li>
<li><a href="getting-started/../configuration/overview.html">Configuration Overview</a> - Full config reference</li>
<li><a href="getting-started/../reference/trigger-types.html">All Trigger Types</a> - Complete trigger reference</li>
<li><a href="getting-started/../reference/action-types.html">All Action Types</a> - Complete action reference</li>
<li><a href="getting-started/../configuration/examples.html">Example Configurations</a> - Pre-built configs</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="midi-learn-mode"><a class="header" href="#midi-learn-mode">MIDI Learn Mode</a></h1>
<p><strong>MIDI Learn</strong> is the fastest way to create mappings in MIDIMon v2.0.0. Instead of manually entering note numbers and MIDI parameters, simply press a pad/button on your controller and let MIDIMon auto-detect everything.</p>
<h2 id="what-is-midi-learn"><a class="header" href="#what-is-midi-learn">What is MIDI Learn?</a></h2>
<p>MIDI Learn is a one-click workflow:</p>
<ol>
<li><strong>Click "Learn"</strong> next to a trigger field</li>
<li><strong>Press a control</strong> on your MIDI device (pad, encoder, button, etc.)</li>
<li><strong>MIDIMon auto-fills</strong> the trigger configuration</li>
<li><strong>Assign an action</strong> and save</li>
</ol>
<p>That's it! No need to know note numbers, CC values, or MIDI channels.</p>
<h2 id="how-to-use-midi-learn"><a class="header" href="#how-to-use-midi-learn">How to Use MIDI Learn</a></h2>
<h3 id="basic-workflow"><a class="header" href="#basic-workflow">Basic Workflow</a></h3>
<ol>
<li>
<p><strong>Open MIDIMon GUI</strong> and ensure your device is connected</p>
</li>
<li>
<p><strong>Navigate to Mappings</strong> panel</p>
</li>
<li>
<p><strong>Click "Add Mapping"</strong> or edit an existing one</p>
</li>
<li>
<p><strong>Click the "Learn" button</strong> next to the Trigger field</p>
</li>
<li>
<p><strong>MIDI Learn window opens</strong> with a 10-second countdown:</p>
<pre><code>MIDI Learn Mode

Waiting for MIDI input...
Press any control on your device

Time remaining: 8 seconds
[Cancel]
</code></pre>
</li>
<li>
<p><strong>Press any control</strong> on your MIDI device:</p>
<ul>
<li>Pad</li>
<li>Button</li>
<li>Encoder/knob</li>
<li>Fader</li>
<li>Touch strip</li>
</ul>
</li>
<li>
<p><strong>Trigger auto-fills</strong>:</p>
<pre><code>Trigger Type: Note
Note: 36
Channel: 0
</code></pre>
</li>
<li>
<p><strong>Assign an action</strong> (Keystroke, Launch, Text, etc.)</p>
</li>
<li>
<p><strong>Click "Save"</strong></p>
</li>
<li>
<p><strong>Test it!</strong> Press the same control - the action should execute</p>
</li>
</ol>
<h3 id="supported-trigger-types"><a class="header" href="#supported-trigger-types">Supported Trigger Types</a></h3>
<p>MIDI Learn auto-detects and configures these trigger types:</p>
<h4 id="1-note-basic-padbutton-press"><a class="header" href="#1-note-basic-padbutton-press">1. Note (Basic Pad/Button Press)</a></h4>
<p><strong>What it detects</strong>:</p>
<ul>
<li>Note number</li>
<li>MIDI channel</li>
<li>Velocity range (if applicable)</li>
</ul>
<p><strong>Example</strong>:</p>
<ul>
<li>Press pad ‚Üí Auto-fills: <code>Note: 36, Channel: 0</code></li>
</ul>
<p><strong>Use cases</strong>:</p>
<ul>
<li>Basic pad mappings</li>
<li>Button presses</li>
<li>Keyboard keys</li>
</ul>
<h4 id="2-velocity-range-pressure-sensitive"><a class="header" href="#2-velocity-range-pressure-sensitive">2. Velocity Range (Pressure-Sensitive)</a></h4>
<p><strong>What it detects</strong>:</p>
<ul>
<li>Note number</li>
<li>Soft/medium/hard press patterns</li>
<li>Velocity thresholds</li>
</ul>
<p><strong>Example</strong>:</p>
<ul>
<li>Press pad softly ‚Üí <code>VelocityRange: Note 36, Min: 0, Max: 40</code></li>
<li>Press pad hard ‚Üí <code>VelocityRange: Note 36, Min: 81, Max: 127</code></li>
</ul>
<p><strong>Use cases</strong>:</p>
<ul>
<li>Different actions for soft vs hard hits</li>
<li>Velocity-sensitive controls</li>
</ul>
<h4 id="3-long-press"><a class="header" href="#3-long-press">3. Long Press</a></h4>
<p><strong>What it detects</strong>:</p>
<ul>
<li>Note number</li>
<li>Hold duration (auto-calculated from your press)</li>
</ul>
<p><strong>Example</strong>:</p>
<ul>
<li>Hold pad for 2 seconds ‚Üí <code>LongPress: Note 36, Duration: 2000ms</code></li>
</ul>
<p><strong>Use cases</strong>:</p>
<ul>
<li>Hold pad to open app</li>
<li>Long press for alternate action</li>
</ul>
<h4 id="4-double-tap"><a class="header" href="#4-double-tap">4. Double-Tap</a></h4>
<p><strong>What it detects</strong>:</p>
<ul>
<li>Note number</li>
<li>Double-tap timing window</li>
</ul>
<p><strong>Example</strong>:</p>
<ul>
<li>Tap pad twice quickly ‚Üí <code>DoubleTap: Note 36, Window: 300ms</code></li>
</ul>
<p><strong>Use cases</strong>:</p>
<ul>
<li>Quick double-tap for special actions</li>
<li>Distinguishing single vs double taps</li>
</ul>
<h4 id="5-chord-multiple-notes"><a class="header" href="#5-chord-multiple-notes">5. Chord (Multiple Notes)</a></h4>
<p><strong>What it detects</strong>:</p>
<ul>
<li>All pressed notes</li>
<li>Chord window (how fast notes must be pressed together)</li>
</ul>
<p><strong>Example</strong>:</p>
<ul>
<li>Press pads 36, 40, 43 together ‚Üí <code>Chord: [36, 40, 43], Window: 100ms</code></li>
</ul>
<p><strong>Use cases</strong>:</p>
<ul>
<li>Shortcuts requiring multiple pads</li>
<li>Musical chord detection</li>
</ul>
<h4 id="6-encoderknob-rotation"><a class="header" href="#6-encoderknob-rotation">6. Encoder/Knob Rotation</a></h4>
<p><strong>What it detects</strong>:</p>
<ul>
<li>CC (Control Change) number</li>
<li>Direction (Clockwise/Counterclockwise)</li>
<li>Value range</li>
</ul>
<p><strong>Example</strong>:</p>
<ul>
<li>Turn encoder right ‚Üí <code>EncoderTurn: CC 1, Direction: Clockwise</code></li>
<li>Turn encoder left ‚Üí <code>EncoderTurn: CC 1, Direction: Counterclockwise</code></li>
</ul>
<p><strong>Use cases</strong>:</p>
<ul>
<li>Volume control</li>
<li>Scrolling</li>
<li>Parameter adjustment</li>
</ul>
<h4 id="7-control-change-cc"><a class="header" href="#7-control-change-cc">7. Control Change (CC)</a></h4>
<p><strong>What it detects</strong>:</p>
<ul>
<li>CC number</li>
<li>Value range</li>
<li>Continuous vs momentary</li>
</ul>
<p><strong>Example</strong>:</p>
<ul>
<li>Move fader ‚Üí <code>CC: 7, Range: 0-127</code></li>
<li>Press button ‚Üí <code>CC: 64, Value: 127</code></li>
</ul>
<p><strong>Use cases</strong>:</p>
<ul>
<li>Faders</li>
<li>Knobs with CC messages</li>
<li>Sustain pedals</li>
</ul>
<h4 id="8-aftertouch-pressure"><a class="header" href="#8-aftertouch-pressure">8. Aftertouch (Pressure)</a></h4>
<p><strong>What it detects</strong>:</p>
<ul>
<li>Note number (if channel aftertouch)</li>
<li>Pressure threshold</li>
</ul>
<p><strong>Example</strong>:</p>
<ul>
<li>Press pad harder after initial hit ‚Üí <code>Aftertouch: Note 36, Threshold: 64</code></li>
</ul>
<p><strong>Use cases</strong>:</p>
<ul>
<li>Pressure-sensitive effects</li>
<li>Dynamic parameter control</li>
</ul>
<h4 id="9-pitch-bend"><a class="header" href="#9-pitch-bend">9. Pitch Bend</a></h4>
<p><strong>What it detects</strong>:</p>
<ul>
<li>Pitch bend range</li>
<li>Direction (Up/Down/Center)</li>
</ul>
<p><strong>Example</strong>:</p>
<ul>
<li>Move pitch wheel up ‚Üí <code>PitchBend: Direction: Up, Threshold: 8192</code></li>
</ul>
<p><strong>Use cases</strong>:</p>
<ul>
<li>Pitch wheel mappings</li>
<li>Touch strip controls</li>
</ul>
<h2 id="advanced-midi-learn-features"><a class="header" href="#advanced-midi-learn-features">Advanced MIDI Learn Features</a></h2>
<h3 id="countdown-timer"><a class="header" href="#countdown-timer">Countdown Timer</a></h3>
<p>The MIDI Learn window shows a <strong>10-second countdown</strong>. This gives you time to:</p>
<ul>
<li>Position your hand</li>
<li>Find the right control</li>
<li>Try different velocities</li>
</ul>
<p><strong>Countdown reaches zero</strong> ‚Üí MIDI Learn cancels automatically</p>
<h3 id="cancellation"><a class="header" href="#cancellation">Cancellation</a></h3>
<p>Click <strong>"Cancel"</strong> at any time to abort MIDI Learn without creating a mapping.</p>
<p><strong>Keyboard shortcut</strong>: Press <code>Esc</code> to cancel</p>
<h3 id="pattern-detection"><a class="header" href="#pattern-detection">Pattern Detection</a></h3>
<p>MIDI Learn is <strong>smart</strong> - it detects patterns automatically:</p>
<p><strong>Long Press Detection</strong>:</p>
<ul>
<li>If you hold a pad for &gt;1 second during Learn mode, MIDIMon suggests a Long Press trigger</li>
</ul>
<p><strong>Double-Tap Detection</strong>:</p>
<ul>
<li>If you tap a pad twice quickly, MIDIMon suggests a Double-Tap trigger</li>
</ul>
<p><strong>Chord Detection</strong>:</p>
<ul>
<li>If you press multiple pads within 100ms, MIDIMon suggests a Chord trigger</li>
</ul>
<p><strong>Velocity Variation</strong>:</p>
<ul>
<li>If you press the same pad with varying velocities, MIDIMon suggests a Velocity Range trigger</li>
</ul>
<h3 id="velocity-range-suggestions"><a class="header" href="#velocity-range-suggestions">Velocity Range Suggestions</a></h3>
<p>When MIDI Learn detects a note, it suggests velocity ranges:</p>
<pre><code>MIDI Learn Complete!

Detected: Note 36

Suggested velocity ranges:
- Soft (0-40): Gentle tap
- Medium (41-80): Normal press
- Hard (81-127): Strong hit

Create separate mappings for each range?
[Yes] [No, use single Note trigger]
</code></pre>
<p>This makes it easy to create pressure-sensitive mappings.</p>
<h2 id="troubleshooting-2"><a class="header" href="#troubleshooting-2">Troubleshooting</a></h2>
<h3 id="no-midi-input-detected"><a class="header" href="#no-midi-input-detected">No MIDI Input Detected</a></h3>
<p><strong>Symptoms</strong>: MIDI Learn countdown reaches zero without detecting anything</p>
<p><strong>Solutions</strong>:</p>
<ol>
<li><strong>Check device connection</strong>: Ensure MIDI device is connected and showing in Device Panel</li>
<li><strong>Check Event Console</strong>: Open Event Console and verify MIDI events are being received</li>
<li><strong>Try different control</strong>: Some controls may not send MIDI (e.g., mode buttons on some devices)</li>
<li><strong>Check MIDI channel</strong>: Some devices send on non-zero channels</li>
</ol>
<h3 id="wrong-note-number-detected"><a class="header" href="#wrong-note-number-detected">Wrong Note Number Detected</a></h3>
<p><strong>Symptoms</strong>: MIDI Learn detects the wrong note</p>
<p><strong>Solutions</strong>:</p>
<ol>
<li><strong>Verify in Event Console</strong>: Check what MIDI events are actually being sent</li>
<li><strong>Check pad page</strong>: Some controllers have multiple pad pages (A-H)</li>
<li><strong>Load device template</strong>: Use a pre-configured template for your controller</li>
<li><strong>Manual override</strong>: Click "Advanced" and manually enter the correct note number</li>
</ol>
<h3 id="multiple-events-detected"><a class="header" href="#multiple-events-detected">Multiple Events Detected</a></h3>
<p><strong>Symptoms</strong>: MIDI Learn shows "Multiple events detected, please try again"</p>
<p><strong>Solutions</strong>:</p>
<ol>
<li><strong>Press only one control</strong> at a time</li>
<li><strong>Wait for pad to release</strong> before pressing again</li>
<li><strong>Disable auto-repeat</strong>: Some controllers send rapid-fire messages</li>
</ol>
<h3 id="velocity-not-detected"><a class="header" href="#velocity-not-detected">Velocity Not Detected</a></h3>
<p><strong>Symptoms</strong>: MIDI Learn only creates Note trigger, not Velocity Range</p>
<p><strong>Solutions</strong>:</p>
<ol>
<li><strong>Vary velocity</strong>: Try pressing soft, medium, and hard during different Learn attempts</li>
<li><strong>Manual configuration</strong>: Create Velocity Range trigger manually after Learn</li>
<li><strong>Check controller</strong>: Some pads don't send velocity (always velocity 127)</li>
</ol>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<h3 id="example-1-basic-pad-mapping"><a class="header" href="#example-1-basic-pad-mapping">Example 1: Basic Pad Mapping</a></h3>
<p><strong>Goal</strong>: Map pad to copy text (Cmd+C)</p>
<ol>
<li>Click "Add Mapping"</li>
<li>Click "Learn" next to Trigger</li>
<li>Press pad ‚Üí Auto-fills <code>Note: 36</code></li>
<li>Select Action: <strong>Keystroke</strong></li>
<li>Use Keystroke Picker: Press <code>Cmd+C</code></li>
<li>Save</li>
</ol>
<p><strong>Result</strong>: Pressing pad executes Cmd+C</p>
<h3 id="example-2-velocity-sensitive-volume"><a class="header" href="#example-2-velocity-sensitive-volume">Example 2: Velocity-Sensitive Volume</a></h3>
<p><strong>Goal</strong>: Soft press = volume down, hard press = volume up</p>
<ol>
<li>
<p>Click "Add Mapping"</p>
</li>
<li>
<p>Click "Learn" next to Trigger</p>
</li>
<li>
<p>Press pad <strong>softly</strong> ‚Üí Auto-fills <code>VelocityRange: Note 36, Min: 0, Max: 40</code></p>
</li>
<li>
<p>Action: <strong>Volume Control</strong> ‚Üí <strong>Down</strong></p>
</li>
<li>
<p>Save</p>
</li>
<li>
<p>Click "Add Mapping" again</p>
</li>
<li>
<p>Click "Learn"</p>
</li>
<li>
<p>Press <strong>same pad hard</strong> ‚Üí Auto-fills <code>VelocityRange: Note 36, Min: 81, Max: 127</code></p>
</li>
<li>
<p>Action: <strong>Volume Control</strong> ‚Üí <strong>Up</strong></p>
</li>
<li>
<p>Save</p>
</li>
</ol>
<p><strong>Result</strong>: Soft press = volume down, hard press = volume up</p>
<h3 id="example-3-long-press-to-launch-app"><a class="header" href="#example-3-long-press-to-launch-app">Example 3: Long Press to Launch App</a></h3>
<p><strong>Goal</strong>: Hold pad for 2 seconds to open Spotify</p>
<ol>
<li>Click "Add Mapping"</li>
<li>Click "Learn" next to Trigger</li>
<li><strong>Hold pad for 2+ seconds</strong> ‚Üí Auto-fills <code>LongPress: Note 36, Duration: 2000ms</code></li>
<li>Action: <strong>Launch</strong> ‚Üí Select <code>/Applications/Spotify.app</code></li>
<li>Save</li>
</ol>
<p><strong>Result</strong>: Holding pad for 2 seconds opens Spotify</p>
<h3 id="example-4-encoder-for-volume"><a class="header" href="#example-4-encoder-for-volume">Example 4: Encoder for Volume</a></h3>
<p><strong>Goal</strong>: Turn encoder to adjust volume</p>
<ol>
<li>
<p>Click "Add Mapping"</p>
</li>
<li>
<p>Click "Learn" next to Trigger</p>
</li>
<li>
<p><strong>Turn encoder right</strong> ‚Üí Auto-fills <code>EncoderTurn: CC 1, Direction: Clockwise</code></p>
</li>
<li>
<p>Action: <strong>Volume Control</strong> ‚Üí <strong>Up</strong></p>
</li>
<li>
<p>Save</p>
</li>
<li>
<p>Click "Add Mapping" again</p>
</li>
<li>
<p>Click "Learn"</p>
</li>
<li>
<p><strong>Turn encoder left</strong> ‚Üí Auto-fills <code>EncoderTurn: CC 1, Direction: Counterclockwise</code></p>
</li>
<li>
<p>Action: <strong>Volume Control</strong> ‚Üí <strong>Down</strong></p>
</li>
<li>
<p>Save</p>
</li>
</ol>
<p><strong>Result</strong>: Turning encoder controls system volume</p>
<h2 id="tips--best-practices"><a class="header" href="#tips--best-practices">Tips &amp; Best Practices</a></h2>
<h3 id="tip-1-use-event-console"><a class="header" href="#tip-1-use-event-console">Tip 1: Use Event Console</a></h3>
<p>Before starting MIDI Learn:</p>
<ol>
<li>Open <strong>Event Console</strong></li>
<li>Press your control</li>
<li>Verify the MIDI event appears</li>
</ol>
<p>This helps debug "Learn not detecting" issues.</p>
<h3 id="tip-2-learn-in-context"><a class="header" href="#tip-2-learn-in-context">Tip 2: Learn in Context</a></h3>
<p>When creating <strong>per-app profiles</strong>, Learn with that app in focus:</p>
<ol>
<li>Switch to target app (e.g., Logic Pro)</li>
<li>Switch back to MIDIMon GUI</li>
<li>Use MIDI Learn</li>
<li>Assign action relevant to that app</li>
</ol>
<h3 id="tip-3-batch-learn"><a class="header" href="#tip-3-batch-learn">Tip 3: Batch Learn</a></h3>
<p>Create multiple mappings quickly:</p>
<ol>
<li>Click "Learn"</li>
<li>Press control</li>
<li>Assign action</li>
<li>Save</li>
<li>Immediately click "Add Mapping" and repeat</li>
</ol>
<h3 id="tip-4-device-templates-first"><a class="header" href="#tip-4-device-templates-first">Tip 4: Device Templates First</a></h3>
<p>Before manual Learn:</p>
<ol>
<li>Check if a device template exists for your controller</li>
<li>Load template to get 90% of mappings</li>
<li>Use Learn to customize the remaining 10%</li>
</ol>
<h3 id="tip-5-test-immediately"><a class="header" href="#tip-5-test-immediately">Tip 5: Test Immediately</a></h3>
<p>After creating a mapping:</p>
<ol>
<li>Click "Save"</li>
<li><strong>Immediately test</strong> by pressing the control</li>
<li>Verify action executes correctly</li>
<li>Adjust if needed</li>
</ol>
<h2 id="next-steps-4"><a class="header" href="#next-steps-4">Next Steps</a></h2>
<ul>
<li><a href="getting-started/../guides/device-templates.html">Device Templates</a> - Pre-configured controller mappings</li>
<li><a href="getting-started/../reference/triggers.html">Trigger Reference</a> - All trigger types explained</li>
<li><a href="getting-started/../reference/actions.html">Action Reference</a> - All action types explained</li>
<li><a href="getting-started/../guides/per-app-profiles.html">Per-App Profiles</a> - Automatic profile switching</li>
</ul>
<hr />
<p><strong>Last Updated</strong>: November 14, 2025 (v2.0.0)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="modes-context-switching-for-different-workflows"><a class="header" href="#modes-context-switching-for-different-workflows">Modes: Context Switching for Different Workflows</a></h1>
<h2 id="overview-2"><a class="header" href="#overview-2">Overview</a></h2>
<p>Modes are MIDIMon's system for context switching - they allow you to define completely different mapping sets for different workflows, all accessible from the same MIDI controller. Think of modes as "profiles" or "layers" that transform your controller's behavior based on what you're doing.</p>
<p>For example:</p>
<ul>
<li><strong>Default Mode</strong>: General productivity shortcuts (copy, paste, window switching)</li>
<li><strong>Developer Mode</strong>: IDE shortcuts, terminal commands, debugging tools</li>
<li><strong>Media Mode</strong>: Audio/video playback controls, screen capture, streaming tools</li>
</ul>
<p>Modes enable a single 16-pad controller to provide hundreds of distinct functions without reconfiguring anything.</p>
<h2 id="mode-architecture"><a class="header" href="#mode-architecture">Mode Architecture</a></h2>
<h3 id="mode-structure-in-configtoml"><a class="header" href="#mode-structure-in-configtoml">Mode Structure in config.toml</a></h3>
<p>Modes are defined in your <code>config.toml</code> using the <code>[[modes]]</code> array:</p>
<pre><code class="language-toml">[[modes]]
name = "Default"
color = "blue"

[[modes.mappings]]
description = "Copy text"
[modes.mappings.trigger]
type = "Note"
note = 12
[modes.mappings.action]
type = "Keystroke"
keys = "c"
modifiers = ["cmd"]

[[modes.mappings]]
description = "Paste text"
[modes.mappings.trigger]
type = "Note"
note = 13
[modes.mappings.action]
type = "Keystroke"
keys = "v"
modifiers = ["cmd"]

[[modes]]
name = "Developer"
color = "green"

[[modes.mappings]]
description = "Run tests"
[modes.mappings.trigger]
type = "Note"
note = 12
[modes.mappings.action]
type = "Shell"
command = "cargo test"

[[modes.mappings]]
description = "Git commit"
[modes.mappings.trigger]
type = "Note"
note = 13
[modes.mappings.action]
type = "Shell"
command = "git commit"
</code></pre>
<p><strong>Key Points</strong>:</p>
<ul>
<li>Each <code>[[modes]]</code> section defines a complete mode</li>
<li><code>name</code>: Displayed in console when switching modes</li>
<li><code>color</code>: LED feedback color theme (optional but recommended)</li>
<li><code>[[modes.mappings]]</code>: Array of triggers and actions for this mode</li>
</ul>
<h3 id="mode-colors-and-led-feedback"><a class="header" href="#mode-colors-and-led-feedback">Mode Colors and LED Feedback</a></h3>
<p>Each mode can have a distinct color theme for visual identification:</p>
<p><strong>Available Colors</strong>:</p>
<ul>
<li><code>blue</code> - Default mode (calm, general use)</li>
<li><code>green</code> - Development/productivity (focused work)</li>
<li><code>purple</code> - Media/creative (entertainment)</li>
<li><code>red</code> - Emergency/system (critical functions)</li>
<li><code>yellow</code> - Testing/debug (temporary mappings)</li>
<li><code>white</code> - Neutral (fallback)</li>
</ul>
<p><strong>How Colors Work</strong>:</p>
<pre><code class="language-toml">[[modes]]
name = "Default"
color = "blue"  # All pads in this mode default to blue when idle
</code></pre>
<p>When using the <code>reactive</code> lighting scheme:</p>
<ul>
<li>Idle pads show the mode's base color at dim brightness</li>
<li>Pressed pads light up with velocity-based colors (green/yellow/red)</li>
<li>Released pads fade back to the mode's base color</li>
</ul>
<p>When using static patterns (rainbow, wave, etc.):</p>
<ul>
<li>The mode color is used as the primary theme color</li>
<li>Pattern variations are tinted with the mode color</li>
</ul>
<h2 id="global-vs-mode-specific-mappings"><a class="header" href="#global-vs-mode-specific-mappings">Global vs Mode-Specific Mappings</a></h2>
<p>MIDIMon supports two types of mappings:</p>
<h3 id="mode-specific-mappings"><a class="header" href="#mode-specific-mappings">Mode-Specific Mappings</a></h3>
<p>Defined inside <code>[[modes.mappings]]</code>, these only work when that mode is active:</p>
<pre><code class="language-toml">[[modes]]
name = "Media"
color = "purple"

[[modes.mappings]]
description = "Play/Pause"
[modes.mappings.trigger]
type = "Note"
note = 12
[modes.mappings.action]
type = "Keystroke"
keys = "space"
modifiers = []
</code></pre>
<p>This Play/Pause mapping only works in Media mode.</p>
<h3 id="global-mappings"><a class="header" href="#global-mappings">Global Mappings</a></h3>
<p>Defined in <code>[[global_mappings]]</code> at the top level, these work in ALL modes:</p>
<pre><code class="language-toml">[[global_mappings]]
description = "Emergency exit"
[global_mappings.trigger]
type = "LongPress"
note = 0
hold_duration_ms = 3000
[global_mappings.action]
type = "Shell"
command = "killall midimon"

[[global_mappings]]
description = "Volume up (always available)"
[global_mappings.trigger]
type = "EncoderTurn"
direction = "Clockwise"
[global_mappings.action]
type = "VolumeControl"
operation = "Up"
</code></pre>
<p><strong>Use Cases for Global Mappings</strong>:</p>
<ul>
<li>Emergency shutdown (long press escape)</li>
<li>Volume control (encoder always controls volume)</li>
<li>Mode switching (dedicated mode-change buttons)</li>
<li>System-wide shortcuts (screenshots, lock screen)</li>
</ul>
<p><strong>Priority Order</strong>:</p>
<ol>
<li>Mode-specific mappings are checked first</li>
<li>If no match, global mappings are checked</li>
<li>If still no match, the event is ignored</li>
</ol>
<p>This means mode-specific mappings can "override" global ones by using the same trigger.</p>
<h2 id="switching-between-modes"><a class="header" href="#switching-between-modes">Switching Between Modes</a></h2>
<p>There are three ways to switch modes:</p>
<h3 id="1-encoder-rotation"><a class="header" href="#1-encoder-rotation">1. Encoder Rotation</a></h3>
<p>The most common method - use your encoder as a mode selector:</p>
<pre><code class="language-toml">[[global_mappings]]
description = "Next mode (encoder clockwise)"
[global_mappings.trigger]
type = "EncoderTurn"
direction = "Clockwise"
[global_mappings.action]
type = "ModeChange"
mode = "next"

[[global_mappings]]
description = "Previous mode (encoder counter-clockwise)"
[global_mappings.trigger]
type = "EncoderTurn"
direction = "CounterClockwise"
[global_mappings.action]
type = "ModeChange"
mode = "previous"
</code></pre>
<p>This creates a circular mode selector:</p>
<ul>
<li>Turn clockwise: Default ‚Üí Developer ‚Üí Media ‚Üí Default...</li>
<li>Turn counter-clockwise: Default ‚Üí Media ‚Üí Developer ‚Üí Default...</li>
</ul>
<h3 id="2-dedicated-mode-buttons"><a class="header" href="#2-dedicated-mode-buttons">2. Dedicated Mode Buttons</a></h3>
<p>Assign specific pads to jump directly to modes:</p>
<pre><code class="language-toml">[[global_mappings]]
description = "Jump to Developer mode"
[global_mappings.trigger]
type = "Note"
note = 15  # Top-right pad
[global_mappings.action]
type = "ModeChange"
mode = "Developer"

[[global_mappings]]
description = "Jump to Media mode"
[global_mappings.trigger]
type = "Note"
note = 11  # Another pad
[global_mappings.action]
type = "ModeChange"
mode = "Media"
</code></pre>
<h3 id="3-chord-based-mode-switching"><a class="header" href="#3-chord-based-mode-switching">3. Chord-Based Mode Switching</a></h3>
<p>Use pad combinations for advanced mode switching:</p>
<pre><code class="language-toml">[[global_mappings]]
description = "Secret admin mode (pads 0+1+2 together)"
[global_mappings.trigger]
type = "NoteChord"
notes = [0, 1, 2]
chord_timeout_ms = 100
[global_mappings.action]
type = "ModeChange"
mode = "Admin"
</code></pre>
<p><strong>ModeChange Action Parameters</strong>:</p>
<ul>
<li><code>mode = "next"</code> - Cycle to next mode</li>
<li><code>mode = "previous"</code> - Cycle to previous mode</li>
<li><code>mode = "Default"</code> - Jump to specific mode by name (case-sensitive)</li>
<li><code>mode = 0</code> - Jump to mode by index (0-based)</li>
</ul>
<h2 id="practical-mode-examples"><a class="header" href="#practical-mode-examples">Practical Mode Examples</a></h2>
<h3 id="example-1-three-mode-general-setup"><a class="header" href="#example-1-three-mode-general-setup">Example 1: Three-Mode General Setup</a></h3>
<pre><code class="language-toml"># Mode 0: Default (General Productivity)
[[modes]]
name = "Default"
color = "blue"

[[modes.mappings]]
description = "Copy"
[modes.mappings.trigger]
type = "Note"
note = 12
[modes.mappings.action]
type = "Keystroke"
keys = "c"
modifiers = ["cmd"]

[[modes.mappings]]
description = "Paste"
[modes.mappings.trigger]
type = "Note"
note = 13
[modes.mappings.action]
type = "Keystroke"
keys = "v"
modifiers = ["cmd"]

[[modes.mappings]]
description = "Switch to next app"
[modes.mappings.trigger]
type = "Note"
note = 14
[modes.mappings.action]
type = "Keystroke"
keys = "tab"
modifiers = ["cmd"]

# Mode 1: Developer (Coding Tools)
[[modes]]
name = "Developer"
color = "green"

[[modes.mappings]]
description = "Run tests"
[modes.mappings.trigger]
type = "Note"
note = 12
[modes.mappings.action]
type = "Shell"
command = "cargo test"

[[modes.mappings]]
description = "Build release"
[modes.mappings.trigger]
type = "Note"
note = 13
[modes.mappings.action]
type = "Shell"
command = "cargo build --release"

[[modes.mappings]]
description = "Open terminal"
[modes.mappings.trigger]
type = "Note"
note = 14
[modes.mappings.action]
type = "Launch"
app = "Terminal"

# Mode 2: Media (Audio/Video Control)
[[modes]]
name = "Media"
color = "purple"

[[modes.mappings]]
description = "Play/Pause"
[modes.mappings.trigger]
type = "Note"
note = 12
[modes.mappings.action]
type = "Keystroke"
keys = "space"
modifiers = []

[[modes.mappings]]
description = "Next track"
[modes.mappings.trigger]
type = "Note"
note = 13
[modes.mappings.action]
type = "Keystroke"
keys = "right"
modifiers = ["cmd"]

[[modes.mappings]]
description = "Screenshot"
[modes.mappings.trigger]
type = "Note"
note = 14
[modes.mappings.action]
type = "Keystroke"
keys = "4"
modifiers = ["cmd", "shift"]

# Global: Mode switching and volume
[[global_mappings]]
description = "Next mode"
[global_mappings.trigger]
type = "EncoderTurn"
direction = "Clockwise"
[global_mappings.action]
type = "ModeChange"
mode = "next"

[[global_mappings]]
description = "Previous mode"
[global_mappings.trigger]
type = "EncoderTurn"
direction = "CounterClockwise"
[global_mappings.action]
type = "ModeChange"
mode = "previous"
</code></pre>
<h3 id="example-2-context-aware-developer-modes"><a class="header" href="#example-2-context-aware-developer-modes">Example 2: Context-Aware Developer Modes</a></h3>
<pre><code class="language-toml"># General development
[[modes]]
name = "Dev-General"
color = "green"

[[modes.mappings]]
description = "Save all"
[modes.mappings.trigger]
type = "Note"
note = 12
[modes.mappings.action]
type = "Keystroke"
keys = "s"
modifiers = ["cmd", "alt"]

# Rust-specific
[[modes]]
name = "Dev-Rust"
color = "green"

[[modes.mappings]]
description = "cargo check"
[modes.mappings.trigger]
type = "Note"
note = 12
[modes.mappings.action]
type = "Shell"
command = "cargo check"

[[modes.mappings]]
description = "cargo fmt"
[modes.mappings.trigger]
type = "Note"
note = 13
[modes.mappings.action]
type = "Shell"
command = "cargo fmt"

# Python-specific
[[modes]]
name = "Dev-Python"
color = "green"

[[modes.mappings]]
description = "pytest"
[modes.mappings.trigger]
type = "Note"
note = 12
[modes.mappings.action]
type = "Shell"
command = "pytest"

[[modes.mappings]]
description = "black format"
[modes.mappings.trigger]
type = "Note"
note = 13
[modes.mappings.action]
type = "Shell"
command = "black ."
</code></pre>
<h3 id="example-3-velocity-sensitive-multi-mode"><a class="header" href="#example-3-velocity-sensitive-multi-mode">Example 3: Velocity-Sensitive Multi-Mode</a></h3>
<p>Combine modes with velocity detection for even more control:</p>
<pre><code class="language-toml">[[modes]]
name = "Advanced"
color = "yellow"

# Soft press: Small increase
[[modes.mappings]]
description = "Small volume up"
[modes.mappings.trigger]
type = "VelocityRange"
note = 12
min_velocity = 0
max_velocity = 40
[modes.mappings.action]
type = "Shell"
command = "osascript -e 'set volume output volume (output volume of (get volume settings) + 5)'"

# Hard press: Large increase
[[modes.mappings]]
description = "Large volume up"
[modes.mappings.trigger]
type = "VelocityRange"
note = 12
min_velocity = 81
max_velocity = 127
[modes.mappings.action]
type = "Shell"
command = "osascript -e 'set volume output volume (output volume of (get volume settings) + 20)'"
</code></pre>
<h2 id="mode-design-best-practices"><a class="header" href="#mode-design-best-practices">Mode Design Best Practices</a></h2>
<h3 id="1-use-descriptive-names"><a class="header" href="#1-use-descriptive-names">1. Use Descriptive Names</a></h3>
<pre><code class="language-toml"># Good: Clear what the mode does
[[modes]]
name = "Media-Playback"

# Bad: Ambiguous
[[modes]]
name = "Mode3"
</code></pre>
<h3 id="2-assign-consistent-color-themes"><a class="header" href="#2-assign-consistent-color-themes">2. Assign Consistent Color Themes</a></h3>
<pre><code class="language-toml"># Productivity modes: Blue family
[[modes]]
name = "Default"
color = "blue"

[[modes]]
name = "Email"
color = "blue"

# Development modes: Green family
[[modes]]
name = "Developer"
color = "green"

[[modes]]
name = "Testing"
color = "green"

# Creative modes: Purple/Magenta family
[[modes]]
name = "Media"
color = "purple"

[[modes]]
name = "Design"
color = "magenta"
</code></pre>
<h3 id="3-keep-mode-count-manageable"><a class="header" href="#3-keep-mode-count-manageable">3. Keep Mode Count Manageable</a></h3>
<p><strong>Recommended</strong>: 3-5 modes for most users</p>
<ul>
<li>Too few modes: You'll run out of pads for all your functions</li>
<li>Too many modes: You'll forget which mode you're in</li>
</ul>
<p><strong>Strategy</strong>: Group related functions into modes rather than creating a mode for every app.</p>
<h3 id="4-reserve-global-mappings-for-critical-functions"><a class="header" href="#4-reserve-global-mappings-for-critical-functions">4. Reserve Global Mappings for Critical Functions</a></h3>
<p>Only use <code>[[global_mappings]]</code> for:</p>
<ul>
<li>Mode switching itself</li>
<li>Emergency shutdowns</li>
<li>System-wide controls (volume, screen lock)</li>
<li>Functions that should work regardless of mode</li>
</ul>
<h3 id="5-use-mode-colors-for-visual-feedback"><a class="header" href="#5-use-mode-colors-for-visual-feedback">5. Use Mode Colors for Visual Feedback</a></h3>
<p>If your device supports LED feedback:</p>
<ul>
<li>Test each mode and verify the color matches the function</li>
<li>Use calming colors (blue, green) for frequent modes</li>
<li>Use attention-grabbing colors (red, yellow) for special modes</li>
</ul>
<h3 id="6-document-your-modes"><a class="header" href="#6-document-your-modes">6. Document Your Modes</a></h3>
<p>Add descriptions to help remember your layout:</p>
<pre><code class="language-toml">[[modes]]
name = "Developer"
color = "green"
# Description comments help future you remember the layout:
# Pad 0-3: Git commands (status, add, commit, push)
# Pad 4-7: Build commands (check, test, build, run)
# Pad 8-11: IDE shortcuts (format, refactor, debug, terminal)
# Pad 12-15: Project navigation (files, search, grep, docs)

[[modes.mappings]]
description = "Git status"
[modes.mappings.trigger]
type = "Note"
note = 0
[modes.mappings.action]
type = "Shell"
command = "git status"
</code></pre>
<h2 id="advanced-mode-techniques"><a class="header" href="#advanced-mode-techniques">Advanced Mode Techniques</a></h2>
<h3 id="mode-specific-timing-adjustments"><a class="header" href="#mode-specific-timing-adjustments">Mode-Specific Timing Adjustments</a></h3>
<p>Override advanced settings per mode:</p>
<pre><code class="language-toml">[advanced_settings]
chord_timeout_ms = 100
double_tap_timeout_ms = 300
hold_threshold_ms = 2000

[[modes]]
name = "Gaming"
color = "red"
# Gaming mode needs faster response
# (Note: Per-mode advanced settings not yet implemented,
#  but this is the planned syntax)
</code></pre>
<h3 id="conditional-mode-switching"><a class="header" href="#conditional-mode-switching">Conditional Mode Switching</a></h3>
<p>Combine with Conditional actions for smart mode switching:</p>
<pre><code class="language-toml">[[global_mappings]]
description = "Auto-switch to Dev mode if VS Code is active"
[global_mappings.trigger]
type = "Note"
note = 15
[global_mappings.action]
type = "Conditional"
condition = "ActiveApp"
value = "Visual Studio Code"
then_action = { type = "ModeChange", mode = "Developer" }
else_action = { type = "ModeChange", mode = "Default" }
</code></pre>
<h3 id="mode-sequences"><a class="header" href="#mode-sequences">Mode Sequences</a></h3>
<p>Chain mode changes with other actions:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Open Spotify and switch to Media mode"
[modes.mappings.trigger]
type = "Note"
note = 15
[modes.mappings.action]
type = "Sequence"
actions = [
    { type = "Launch", app = "Spotify" },
    { type = "Delay", duration_ms = 1000 },
    { type = "ModeChange", mode = "Media" }
]
</code></pre>
<h2 id="troubleshooting-modes"><a class="header" href="#troubleshooting-modes">Troubleshooting Modes</a></h2>
<h3 id="mode-not-switching"><a class="header" href="#mode-not-switching">Mode Not Switching</a></h3>
<p><strong>Symptoms</strong>: Encoder turns but mode doesn't change</p>
<p><strong>Checks</strong>:</p>
<ul>
<li>Verify <code>[[global_mappings]]</code> contains ModeChange actions</li>
<li>Check encoder is mapped correctly (use <code>cargo run --bin midi_diagnostic 2</code>)</li>
<li>Ensure mode names are spelled exactly as defined</li>
<li>Look for console output confirming mode changes</li>
</ul>
<p><strong>Debug</strong>:</p>
<pre><code class="language-bash">DEBUG=1 cargo run --release 2
# Look for: "Mode changed: Default -&gt; Developer"
</code></pre>
<h3 id="mappings-not-working-in-mode"><a class="header" href="#mappings-not-working-in-mode">Mappings Not Working in Mode</a></h3>
<p><strong>Symptoms</strong>: Pad press does nothing in a specific mode</p>
<p><strong>Checks</strong>:</p>
<ul>
<li>Verify you're in the correct mode (check console output)</li>
<li>Confirm note numbers match (use <code>cargo run --bin pad_mapper</code>)</li>
<li>Check <code>[[modes.mappings]]</code> is properly nested under the mode</li>
<li>Ensure TOML syntax is valid</li>
</ul>
<p><strong>Test</strong>:</p>
<pre><code class="language-bash"># Add a simple test mapping to verify mode is active
[[modes.mappings]]
description = "Test mode active"
[modes.mappings.trigger]
type = "Note"
note = 0
[modes.mappings.action]
type = "Shell"
command = "echo 'Mode working!' | tee /dev/tty"
</code></pre>
<h3 id="conflicting-mappings"><a class="header" href="#conflicting-mappings">Conflicting Mappings</a></h3>
<p><strong>Symptoms</strong>: Unexpected action triggers</p>
<p><strong>Checks</strong>:</p>
<ul>
<li>Global mappings override mode mappings if using same trigger</li>
<li>Multiple modes might have similar triggers</li>
<li>Check for copy-paste errors in note numbers</li>
</ul>
<p><strong>Solution</strong>: Use unique note numbers for each function, or intentionally use the priority system:</p>
<pre><code class="language-toml"># Global: Emergency stop (works everywhere)
[[global_mappings]]
[global_mappings.trigger]
type = "LongPress"
note = 0

# Mode: Normal pad 0 function (only when not held)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 0
</code></pre>
<h2 id="see-also-1"><a class="header" href="#see-also-1">See Also</a></h2>
<ul>
<li><a href="getting-started/first-mapping.html">First Mapping Tutorial</a> - Learn basic mapping syntax</li>
<li><a href="getting-started/../configuration/overview.html">Configuration Overview</a> - Complete config.toml structure</li>
<li><a href="getting-started/../reference/actions.html">Actions Reference</a> - All available actions including ModeChange</li>
<li><a href="getting-started/../LED_SYSTEM.html">LED System</a> - How mode colors work with LED feedback</li>
</ul>
<hr />
<p><strong>Last Updated</strong>: November 11, 2025
<strong>Implementation Status</strong>: Fully functional in current release</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="daemon--hot-reload-guide"><a class="header" href="#daemon--hot-reload-guide">Daemon &amp; Hot-Reload Guide</a></h1>
<p>MIDIMon v2.0.0 introduces a production-ready background daemon service with lightning-fast configuration hot-reloading.</p>
<h2 id="architecture-overview"><a class="header" href="#architecture-overview">Architecture Overview</a></h2>
<p>The MIDIMon daemon runs as a background service, providing:</p>
<ul>
<li><strong>Hot-Reload</strong>: Configuration changes applied in 0-10ms without restart</li>
<li><strong>IPC Control</strong>: Control via CLI (<code>midimonctl</code>) or GUI</li>
<li><strong>State Persistence</strong>: Automatic state saving with atomic writes</li>
<li><strong>Crash Recovery</strong>: Auto-restart with KeepAlive (when using LaunchAgent)</li>
<li><strong>Menu Bar Integration</strong>: macOS menu bar for quick actions</li>
</ul>
<h2 id="starting-the-daemon"><a class="header" href="#starting-the-daemon">Starting the Daemon</a></h2>
<h3 id="via-gui-recommended"><a class="header" href="#via-gui-recommended">Via GUI (Recommended)</a></h3>
<p>Open the MIDIMon GUI app - the daemon starts automatically in the background.</p>
<h3 id="via-cli"><a class="header" href="#via-cli">Via CLI</a></h3>
<pre><code class="language-bash"># Start daemon in foreground
midimon

# Start daemon in background
midimon &amp;

# Check if daemon is running
ps aux | grep midimon | grep -v grep

# Check daemon status via IPC
midimonctl status
</code></pre>
<h3 id="via-launchagent-auto-start"><a class="header" href="#via-launchagent-auto-start">Via LaunchAgent (Auto-Start)</a></h3>
<p>See <a href="guides/../installation/macos.html#auto-start-on-login">macOS Installation Guide</a> for LaunchAgent setup.</p>
<h2 id="controlling-the-daemon"><a class="header" href="#controlling-the-daemon">Controlling the Daemon</a></h2>
<h3 id="midimonctl-cli"><a class="header" href="#midimonctl-cli">midimonctl CLI</a></h3>
<p>The <code>midimonctl</code> command provides full control over the daemon:</p>
<h4 id="status"><a class="header" href="#status">Status</a></h4>
<pre><code class="language-bash"># Human-readable status
midimonctl status

# Example output:
# MIDIMon Daemon Status:
#   State: Running
#   Uptime: 1h 23m 45s
#   Config: /Users/you/.config/midimon/config.toml
#   Last Reload: 2m 15s ago
#   IPC Socket: /tmp/midimon.sock
#   PID: 12345
</code></pre>
<p><strong>JSON output</strong> (for scripting):</p>
<pre><code class="language-bash">midimonctl status --json

# Example output:
# {
#   "state": "Running",
#   "uptime_seconds": 5025,
#   "config_path": "/Users/you/.config/midimon/config.toml",
#   "last_reload_seconds": 135,
#   "ipc_socket": "/tmp/midimon.sock",
#   "pid": 12345
# }
</code></pre>
<h4 id="reload-configuration"><a class="header" href="#reload-configuration">Reload Configuration</a></h4>
<pre><code class="language-bash"># Reload config (hot-reload in 0-10ms)
midimonctl reload

# Example output:
# Config reloaded successfully in 3ms
# Loaded 15 mappings across 3 modes
</code></pre>
<p>This applies configuration changes <strong>without restarting</strong> the daemon or interrupting active MIDI connections.</p>
<p><strong>Performance</strong>: Config reload completes in <strong>0-10ms</strong> on average (vs. ~500ms for full restart).</p>
<h4 id="validate-configuration"><a class="header" href="#validate-configuration">Validate Configuration</a></h4>
<pre><code class="language-bash"># Validate config without reloading
midimonctl validate

# Example output (success):
# ‚úì Config is valid
# Found 3 modes with 15 total mappings
# Found 2 global mappings
# No errors detected

# Example output (error):
# ‚úó Config validation failed:
# Error in mode 'Default', mapping 3:
#   Invalid note number: 128 (must be 0-127)
</code></pre>
<p>This is useful for:</p>
<ul>
<li>Testing config changes before applying</li>
<li>CI/CD validation</li>
<li>Pre-commit hooks</li>
</ul>
<h4 id="stop-daemon"><a class="header" href="#stop-daemon">Stop Daemon</a></h4>
<pre><code class="language-bash"># Graceful shutdown
midimonctl stop

# Example output:
# Daemon stopped gracefully
</code></pre>
<p>The daemon saves its state before shutting down.</p>
<h4 id="ping-latency-check"><a class="header" href="#ping-latency-check">Ping (Latency Check)</a></h4>
<pre><code class="language-bash"># Check IPC round-trip latency
midimonctl ping

# Example output:
# Pong! Round-trip: 0.43ms
</code></pre>
<p>This verifies the daemon is responsive and measures IPC performance.</p>
<h2 id="configuration-hot-reload"><a class="header" href="#configuration-hot-reload">Configuration Hot-Reload</a></h2>
<h3 id="how-it-works"><a class="header" href="#how-it-works">How It Works</a></h3>
<ol>
<li><strong>File Watcher</strong>: Monitors <code>~/.config/midimon/config.toml</code> for changes</li>
<li><strong>Debouncing</strong>: 500ms debounce window to avoid redundant reloads</li>
<li><strong>Parsing</strong>: Validates TOML syntax and config structure</li>
<li><strong>Atomic Swap</strong>: Replaces active config with new one in a single operation</li>
<li><strong>Reload Time</strong>: <strong>0-10ms</strong> typical (measured)</li>
</ol>
<h3 id="workflow"><a class="header" href="#workflow">Workflow</a></h3>
<p>Edit your config file:</p>
<pre><code class="language-bash"># Open in your editor
code ~/.config/midimon/config.toml

# Make changes and save
</code></pre>
<p><strong>Automatic reload</strong> happens within 500-510ms of saving:</p>
<pre><code>[2025-11-14 10:30:15] Config file changed
[2025-11-14 10:30:15] Waiting 500ms for debounce...
[2025-11-14 10:30:15] Reloading config...
[2025-11-14 10:30:15] Config reloaded successfully in 3ms
</code></pre>
<p>Or <strong>manually trigger</strong> reload:</p>
<pre><code class="language-bash">midimonctl reload
</code></pre>
<h3 id="what-gets-reloaded"><a class="header" href="#what-gets-reloaded">What Gets Reloaded</a></h3>
<ul>
<li>‚úÖ All mappings (modes + global)</li>
<li>‚úÖ Device settings</li>
<li>‚úÖ LED schemes</li>
<li>‚úÖ Advanced settings (timeouts, thresholds)</li>
<li>‚ùå IPC socket path (requires daemon restart)</li>
<li>‚ùå Auto-start settings (requires LaunchAgent reload)</li>
</ul>
<h3 id="error-handling"><a class="header" href="#error-handling">Error Handling</a></h3>
<p>If config reload fails:</p>
<pre><code class="language-bash"># Example: Invalid TOML syntax
midimonctl reload

# Output:
# ‚úó Config reload failed: TOML parse error
# Error at line 42: expected '=' after key 'trigger'
# Previous config still active (no changes applied)
</code></pre>
<p>The daemon <strong>keeps the previous valid config</strong> and continues running.</p>
<h2 id="state-persistence"><a class="header" href="#state-persistence">State Persistence</a></h2>
<p>The daemon automatically saves state to <code>~/.config/midimon/state.json</code>:</p>
<h3 id="what-gets-saved"><a class="header" href="#what-gets-saved">What Gets Saved</a></h3>
<ul>
<li>Current mode</li>
<li>Active LED scheme</li>
<li>Per-app profile assignments</li>
<li>Last known device connection</li>
</ul>
<h3 id="atomic-writes"><a class="header" href="#atomic-writes">Atomic Writes</a></h3>
<p>State is saved using atomic writes to prevent corruption:</p>
<ol>
<li>Write to temporary file: <code>state.json.tmp</code></li>
<li>Verify write succeeded</li>
<li>Rename to <code>state.json</code> (atomic operation)</li>
<li>SHA256 checksum for integrity</li>
</ol>
<h3 id="emergency-save"><a class="header" href="#emergency-save">Emergency Save</a></h3>
<p>The daemon registers signal handlers to save state on:</p>
<ul>
<li><code>SIGTERM</code> (graceful shutdown)</li>
<li><code>SIGINT</code> (Ctrl+C)</li>
<li><code>SIGHUP</code> (hangup)</li>
</ul>
<h2 id="ipc-protocol"><a class="header" href="#ipc-protocol">IPC Protocol</a></h2>
<p>The daemon uses <strong>Unix domain sockets</strong> for inter-process communication.</p>
<h3 id="socket-location"><a class="header" href="#socket-location">Socket Location</a></h3>
<p>Default: <code>/tmp/midimon.sock</code></p>
<h3 id="protocol"><a class="header" href="#protocol">Protocol</a></h3>
<p><strong>Format</strong>: JSON messages over Unix socket</p>
<p><strong>Request</strong>:</p>
<pre><code class="language-json">{
  "command": "reload",
  "args": {}
}
</code></pre>
<p><strong>Response</strong>:</p>
<pre><code class="language-json">{
  "status": "success",
  "message": "Config reloaded successfully",
  "duration_ms": 3
}
</code></pre>
<h3 id="available-commands"><a class="header" href="#available-commands">Available Commands</a></h3>
<ul>
<li><code>status</code> - Get daemon status</li>
<li><code>reload</code> - Reload configuration</li>
<li><code>validate</code> - Validate config without reloading</li>
<li><code>stop</code> - Graceful shutdown</li>
<li><code>ping</code> - Latency check</li>
</ul>
<h3 id="security-limits"><a class="header" href="#security-limits">Security Limits</a></h3>
<p>The IPC protocol enforces security limits to prevent abuse:</p>
<p><strong>Request Size Limit</strong>: 1MB (1,048,576 bytes)</p>
<p>Requests exceeding this limit will be rejected with error code <code>1004</code> (InvalidRequest):</p>
<pre><code class="language-json">{
  "status": "error",
  "error": {
    "code": 1004,
    "message": "Request too large: 1500000 bytes exceeds maximum of 1048576 bytes (1MB)",
    "details": {
      "request_size": 1500000,
      "max_size": 1048576,
      "security": "Request rejected to prevent memory exhaustion"
    }
  }
}
</code></pre>
<p><strong>Why this limit exists</strong>: Prevents memory exhaustion denial-of-service attacks where an attacker sends arbitrarily large requests to consume daemon memory.</p>
<p><strong>Is 1MB enough?</strong>: Yes. Typical IPC requests are:</p>
<ul>
<li><code>status</code>: ~200 bytes</li>
<li><code>reload</code>: ~100 bytes</li>
<li><code>validate</code>: ~150 bytes</li>
<li><code>ping</code>: ~50 bytes</li>
</ul>
<p>Even large configuration payloads are well under 100KB. The 1MB limit provides 10x safety margin.</p>
<h2 id="performance-metrics"><a class="header" href="#performance-metrics">Performance Metrics</a></h2>
<p>The daemon tracks and reports performance metrics:</p>
<h3 id="config-reload-latency"><a class="header" href="#config-reload-latency">Config Reload Latency</a></h3>
<pre><code class="language-bash">midimonctl status --json | jq '.metrics.reload_latency_ms'
# Output: 3.2
</code></pre>
<p><strong>Targets</strong>:</p>
<ul>
<li>‚úÖ &lt;10ms: Excellent (target met in v2.0.0)</li>
<li>‚ö†Ô∏è 10-50ms: Acceptable</li>
<li>‚ùå &gt;50ms: Investigate</li>
</ul>
<h3 id="ipc-round-trip"><a class="header" href="#ipc-round-trip">IPC Round-Trip</a></h3>
<pre><code class="language-bash">midimonctl ping
# Output: Pong! Round-trip: 0.43ms
</code></pre>
<p><strong>Targets</strong>:</p>
<ul>
<li>‚úÖ &lt;1ms: Excellent (target met in v2.0.0)</li>
<li>‚ö†Ô∏è 1-5ms: Acceptable</li>
<li>‚ùå &gt;5ms: Investigate</li>
</ul>
<h3 id="memory-usage"><a class="header" href="#memory-usage">Memory Usage</a></h3>
<pre><code class="language-bash">ps aux | grep midimon | awk '{print $6/1024 " MB"}'
# Output: 8.2 MB
</code></pre>
<p><strong>Targets</strong>:</p>
<ul>
<li>‚úÖ 5-10MB: Normal (daemon only)</li>
<li>‚ö†Ô∏è 10-20MB: Acceptable</li>
<li>‚ùå &gt;20MB: Investigate memory leak</li>
</ul>
<h3 id="cpu-usage"><a class="header" href="#cpu-usage">CPU Usage</a></h3>
<pre><code class="language-bash">top -pid $(pgrep midimon) -stats cpu -l 1 | tail -1
# Output: 0.3%
</code></pre>
<p><strong>Targets</strong>:</p>
<ul>
<li>‚úÖ &lt;1%: Idle (no MIDI activity)</li>
<li>‚úÖ &lt;5%: Active (processing MIDI events)</li>
<li>‚ö†Ô∏è 5-10%: Heavy load</li>
<li>‚ùå &gt;10%: Investigate</li>
</ul>
<h2 id="menu-bar-integration-macos"><a class="header" href="#menu-bar-integration-macos">Menu Bar Integration (macOS)</a></h2>
<p>The daemon includes an optional menu bar icon:</p>
<h3 id="features"><a class="header" href="#features">Features</a></h3>
<ul>
<li><strong>Status indicator</strong>: Running (green), Stopped (gray), Error (red)</li>
<li><strong>Quick actions</strong>:
<ul>
<li>Pause/Resume</li>
<li>Reload Config</li>
<li>Open GUI</li>
<li>Quit</li>
</ul>
</li>
</ul>
<h3 id="enable-menu-bar"><a class="header" href="#enable-menu-bar">Enable Menu Bar</a></h3>
<p>In GUI Settings:</p>
<ol>
<li>Go to <strong>Settings</strong> ‚Üí <strong>General</strong></li>
<li>Enable <strong>"Show menu bar icon"</strong></li>
<li>Click <strong>Save</strong></li>
</ol>
<p>Or edit config:</p>
<pre><code class="language-toml">[settings]
show_menu_bar = true
</code></pre>
<h2 id="troubleshooting-3"><a class="header" href="#troubleshooting-3">Troubleshooting</a></h2>
<h3 id="daemon-wont-start"><a class="header" href="#daemon-wont-start">Daemon Won't Start</a></h3>
<p><strong>Check if already running</strong>:</p>
<pre><code class="language-bash">ps aux | grep midimon
</code></pre>
<p>If already running, stop it first:</p>
<pre><code class="language-bash">midimonctl stop
</code></pre>
<p><strong>Check logs</strong>:</p>
<pre><code class="language-bash"># If using LaunchAgent
tail -f /tmp/midimon.err

# If running manually
midimon  # Run in foreground to see errors
</code></pre>
<h3 id="config-wont-reload"><a class="header" href="#config-wont-reload">Config Won't Reload</a></h3>
<p><strong>Validate config syntax</strong>:</p>
<pre><code class="language-bash">midimonctl validate
</code></pre>
<p><strong>Check file watcher</strong>:</p>
<pre><code class="language-bash"># Manually trigger reload
midimonctl reload
</code></pre>
<p><strong>Check file permissions</strong>:</p>
<pre><code class="language-bash">ls -l ~/.config/midimon/config.toml
# Should be readable by your user
</code></pre>
<h3 id="high-latency"><a class="header" href="#high-latency">High Latency</a></h3>
<p><strong>Check IPC performance</strong>:</p>
<pre><code class="language-bash">midimonctl ping
</code></pre>
<p><strong>Check system load</strong>:</p>
<pre><code class="language-bash">top -l 1 | head -10
</code></pre>
<p><strong>Restart daemon</strong>:</p>
<pre><code class="language-bash">midimonctl stop
midimon &amp;
</code></pre>
<h3 id="state-not-persisting"><a class="header" href="#state-not-persisting">State Not Persisting</a></h3>
<p><strong>Check state file</strong>:</p>
<pre><code class="language-bash">ls -l ~/.config/midimon/state.json
cat ~/.config/midimon/state.json | jq
</code></pre>
<p><strong>Check file permissions</strong>:</p>
<pre><code class="language-bash"># State directory should be writable
ls -ld ~/.config/midimon
</code></pre>
<h2 id="advanced-configuration"><a class="header" href="#advanced-configuration">Advanced Configuration</a></h2>
<h3 id="custom-ipc-socket-path"><a class="header" href="#custom-ipc-socket-path">Custom IPC Socket Path</a></h3>
<p>Edit daemon config (future feature):</p>
<pre><code class="language-toml">[daemon]
ipc_socket = "/tmp/my-custom-midimon.sock"
</code></pre>
<p>Then tell <code>midimonctl</code> to use it:</p>
<pre><code class="language-bash">export MIDIMON_SOCKET=/tmp/my-custom-midimon.sock
midimonctl status
</code></pre>
<h3 id="custom-config-path"><a class="header" href="#custom-config-path">Custom Config Path</a></h3>
<p>Run daemon with custom config:</p>
<pre><code class="language-bash">midimon --config /path/to/config.toml
</code></pre>
<p>Or set environment variable:</p>
<pre><code class="language-bash">export MIDIMON_CONFIG=/path/to/config.toml
midimon
</code></pre>
<h3 id="logging"><a class="header" href="#logging">Logging</a></h3>
<p>Enable debug logging:</p>
<pre><code class="language-bash">DEBUG=1 midimon
</code></pre>
<p>Output includes:</p>
<ul>
<li>Config reload events</li>
<li>IPC requests/responses</li>
<li>State persistence operations</li>
<li>MIDI event processing (verbose)</li>
</ul>
<h2 id="next-steps-5"><a class="header" href="#next-steps-5">Next Steps</a></h2>
<ul>
<li><a href="guides/./per-app-profiles.html">Per-App Profiles</a> - Automatic profile switching</li>
<li><a href="guides/../reference/cli.html">CLI Reference</a> - Complete CLI documentation</li>
<li><a href="guides/../configuration/overview.html">Configuration Overview</a> - Config file reference</li>
<li><a href="guides/../advanced/performance.html">Performance Tuning</a> - Optimization guide</li>
</ul>
<hr />
<p><strong>Last Updated</strong>: November 14, 2025 (v2.0.0)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gui-configuration"><a class="header" href="#gui-configuration">GUI Configuration</a></h1>
<p>The MIDIMon GUI provides a visual interface for configuring your MIDI controller without manually editing TOML files.</p>
<h2 id="overview-3"><a class="header" href="#overview-3">Overview</a></h2>
<p>The GUI application is built with Tauri v2 and provides:</p>
<ul>
<li><strong>Visual mode management</strong> - Create and edit mapping modes with different button layouts</li>
<li><strong>Mapping editor</strong> - Configure triggers and actions with visual selectors</li>
<li><strong>MIDI Learn</strong> - Auto-detect trigger patterns by pressing device buttons</li>
<li><strong>Device management</strong> - Connect to MIDI devices and apply templates</li>
<li><strong>Profile management</strong> - Per-app profiles that switch automatically</li>
<li><strong>Live event console</strong> - Debug MIDI events in real-time</li>
<li><strong>Settings panel</strong> - Configure application preferences</li>
</ul>
<h2 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h2>
<h3 id="launch-the-gui"><a class="header" href="#launch-the-gui">Launch the GUI</a></h3>
<pre><code class="language-bash"># Start the GUI application
./midimon-gui

# Or if installed system-wide
midimon-gui
</code></pre>
<p>The GUI will appear in your system tray with quick access to:</p>
<ul>
<li>Status display</li>
<li>Reload configuration</li>
<li>Pause/resume processing</li>
<li>Mode switching</li>
<li>Open config file</li>
<li>View logs</li>
</ul>
<h3 id="initial-setup"><a class="header" href="#initial-setup">Initial Setup</a></h3>
<ol>
<li>
<p><strong>Connect a Device</strong></p>
<ul>
<li>Navigate to <strong>Devices</strong> tab</li>
<li>Select your MIDI controller from the list</li>
<li>Click <strong>Connect</strong></li>
</ul>
</li>
<li>
<p><strong>Choose a Template</strong> (optional)</p>
<ul>
<li>Click <strong>Device Templates</strong></li>
<li>Select a pre-configured template for your device</li>
<li>Click <strong>Apply Template</strong></li>
</ul>
</li>
<li>
<p><strong>Create Your First Mode</strong></p>
<ul>
<li>Navigate to <strong>Modes</strong> tab</li>
<li>Click <strong>+ Add Mode</strong></li>
<li>Set a name and color</li>
<li>Click <strong>Save</strong></li>
</ul>
</li>
</ol>
<h2 id="mode-configuration"><a class="header" href="#mode-configuration">Mode Configuration</a></h2>
<h3 id="creating-modes"><a class="header" href="#creating-modes">Creating Modes</a></h3>
<p>Modes allow different button mappings for different contexts (e.g., "Development", "Media", "Gaming").</p>
<ol>
<li>Go to <strong>Modes</strong> tab</li>
<li>Click <strong>+ Add Mode</strong></li>
<li>Fill in:
<ul>
<li><strong>Name</strong>: Descriptive name (e.g., "Video Editing")</li>
<li><strong>Color</strong>: Visual identifier (blue, green, purple, etc.)</li>
</ul>
</li>
<li>Click <strong>Save</strong></li>
</ol>
<h3 id="editing-modes"><a class="header" href="#editing-modes">Editing Modes</a></h3>
<ol>
<li>Select the mode from the list</li>
<li>Click <strong>Edit Mode</strong></li>
<li>Modify settings:
<ul>
<li>Name</li>
<li>Color</li>
<li>Mode-specific mappings</li>
</ul>
</li>
<li>Click <strong>Save Changes</strong></li>
</ol>
<h3 id="deleting-modes"><a class="header" href="#deleting-modes">Deleting Modes</a></h3>
<ol>
<li>Select the mode</li>
<li>Click <strong>Delete Mode</strong></li>
<li>Confirm deletion</li>
</ol>
<p><strong>Note</strong>: You cannot delete the last remaining mode.</p>
<h2 id="mapping-configuration"><a class="header" href="#mapping-configuration">Mapping Configuration</a></h2>
<h3 id="creating-mappings"><a class="header" href="#creating-mappings">Creating Mappings</a></h3>
<p>Mappings define what happens when you press a button or turn a knob.</p>
<ol>
<li>Go to <strong>Mappings</strong> tab</li>
<li>Choose:
<ul>
<li><strong>Mode-specific</strong> mappings (active only in selected mode)</li>
<li><strong>Global</strong> mappings (active across all modes)</li>
</ul>
</li>
<li>Click <strong>+ Add Mapping</strong></li>
</ol>
<h3 id="using-midi-learn"><a class="header" href="#using-midi-learn">Using MIDI Learn</a></h3>
<p>The fastest way to create mappings:</p>
<ol>
<li>Click <strong>üéπ MIDI Learn</strong> button</li>
<li>Press/turn the button/knob on your device</li>
<li>MIDIMon detects the pattern (note, velocity, long press, etc.)</li>
<li>The trigger is auto-filled</li>
<li>Configure the action (what to do)</li>
<li>Click <strong>Save Mapping</strong></li>
</ol>
<p>See the <a href="guides/../getting-started/midi-learn.html">MIDI Learn guide</a> for details.</p>
<h3 id="manual-trigger-configuration"><a class="header" href="#manual-trigger-configuration">Manual Trigger Configuration</a></h3>
<p>If you prefer manual setup:</p>
<h4 id="trigger-types"><a class="header" href="#trigger-types">Trigger Types</a></h4>
<ul>
<li>
<p><strong>Note</strong>: Basic note on/off</p>
<ul>
<li>Set note number (0-127)</li>
<li>Optional velocity range</li>
</ul>
</li>
<li>
<p><strong>Velocity Range</strong>: Different actions for soft/medium/hard presses</p>
<ul>
<li>Soft: 0-40</li>
<li>Medium: 41-80</li>
<li>Hard: 81-127</li>
</ul>
</li>
<li>
<p><strong>Long Press</strong>: Hold detection</p>
<ul>
<li>Set duration (default 2000ms)</li>
</ul>
</li>
<li>
<p><strong>Double Tap</strong>: Quick double-press</p>
<ul>
<li>Set timeout window (default 300ms)</li>
</ul>
</li>
<li>
<p><strong>Note Chord</strong>: Multiple notes simultaneously</p>
<ul>
<li>Add 2+ notes</li>
<li>Set detection window (default 100ms)</li>
</ul>
</li>
<li>
<p><strong>Encoder Turn</strong>: Knob rotation</p>
<ul>
<li>Set CC number</li>
<li>Choose direction (Clockwise/CounterClockwise)</li>
</ul>
</li>
<li>
<p><strong>Control Change (CC)</strong>: MIDI CC messages</p>
<ul>
<li>Set CC number</li>
<li>Optional value range</li>
</ul>
</li>
<li>
<p><strong>Aftertouch</strong>: Pressure sensitivity</p>
<ul>
<li>Optional minimum pressure</li>
</ul>
</li>
<li>
<p><strong>Pitch Bend</strong>: Touch strip control</p>
<ul>
<li>Optional value range</li>
</ul>
</li>
</ul>
<h3 id="action-configuration"><a class="header" href="#action-configuration">Action Configuration</a></h3>
<h4 id="action-types"><a class="header" href="#action-types">Action Types</a></h4>
<ul>
<li>
<p><strong>Keystroke</strong>: Keyboard shortcuts</p>
<ul>
<li>Select modifiers (Ctrl, Alt, Shift, Super/Cmd)</li>
<li>Set key(s)</li>
</ul>
</li>
<li>
<p><strong>Text</strong>: Type text strings</p>
<ul>
<li>Enter text to type</li>
</ul>
</li>
<li>
<p><strong>Launch</strong>: Open applications</p>
<ul>
<li>Enter application name or path</li>
</ul>
</li>
<li>
<p><strong>Shell</strong>: Execute shell commands</p>
<ul>
<li>Enter command</li>
<li>Optional working directory</li>
</ul>
</li>
<li>
<p><strong>Volume Control</strong>: System volume</p>
<ul>
<li>Up/Down/Mute/Set</li>
</ul>
</li>
<li>
<p><strong>Mode Change</strong>: Switch modes</p>
<ul>
<li>Select target mode</li>
</ul>
</li>
<li>
<p><strong>Sequence</strong>: Chain multiple actions</p>
<ul>
<li>Add multiple actions in order</li>
</ul>
</li>
<li>
<p><strong>Delay</strong>: Wait between actions</p>
<ul>
<li>Set duration in milliseconds</li>
</ul>
</li>
<li>
<p><strong>Mouse Click</strong>: Simulate mouse input</p>
<ul>
<li>Left/Right/Middle button</li>
<li>Single/Double/Triple click</li>
</ul>
</li>
<li>
<p><strong>Repeat</strong>: Repeat an action</p>
<ul>
<li>Set count</li>
</ul>
</li>
</ul>
<h3 id="editing-mappings"><a class="header" href="#editing-mappings">Editing Mappings</a></h3>
<ol>
<li>In the <strong>Mappings</strong> tab</li>
<li>Click the mapping to edit</li>
<li>Modify trigger or action</li>
<li>Click <strong>Save Changes</strong></li>
</ol>
<h3 id="deleting-mappings"><a class="header" href="#deleting-mappings">Deleting Mappings</a></h3>
<ol>
<li>Select the mapping</li>
<li>Click <strong>Delete</strong></li>
<li>Confirm deletion</li>
</ol>
<h2 id="device-management"><a class="header" href="#device-management">Device Management</a></h2>
<h3 id="connecting-devices"><a class="header" href="#connecting-devices">Connecting Devices</a></h3>
<ol>
<li>Go to <strong>Devices</strong> tab</li>
<li>View available MIDI devices</li>
<li>See connection status</li>
<li>Monitor daemon status (running, uptime, events processed)</li>
</ol>
<h3 id="using-device-templates"><a class="header" href="#using-device-templates">Using Device Templates</a></h3>
<p>Templates provide pre-configured mappings for popular controllers:</p>
<ol>
<li>Click <strong>üìã Device Templates</strong></li>
<li>Browse available templates:
<ul>
<li>Maschine Mikro MK3</li>
<li>Launchpad Mini</li>
<li>Korg nanoKONTROL</li>
<li>Custom templates</li>
</ul>
</li>
<li>Select a template</li>
<li>Click <strong>Apply</strong></li>
<li>Reload daemon configuration</li>
</ol>
<h3 id="profile-management"><a class="header" href="#profile-management">Profile Management</a></h3>
<p>Profiles let you switch entire configurations:</p>
<ol>
<li>Click <strong>üîÑ Profiles</strong></li>
<li>View available profiles</li>
<li>Switch manually or enable per-app automatic switching</li>
<li>Export/import profiles for backup</li>
</ol>
<h2 id="per-app-profiles"><a class="header" href="#per-app-profiles">Per-App Profiles</a></h2>
<p>Automatically switch profiles based on the frontmost application.</p>
<p>See the <a href="guides/./per-app-profiles.html">Per-App Profiles guide</a> for complete setup.</p>
<h2 id="live-event-console-1"><a class="header" href="#live-event-console-1">Live Event Console</a></h2>
<p>Debug MIDI events in real-time:</p>
<ol>
<li>Go to <strong>Settings</strong> tab</li>
<li>Click <strong>üìä Show Event Console</strong></li>
<li>View live MIDI events:
<ul>
<li>Note on/off</li>
<li>Velocity values</li>
<li>Control changes</li>
<li>Timing information</li>
</ul>
</li>
<li>Use for troubleshooting and discovering note numbers</li>
</ol>
<h2 id="settings"><a class="header" href="#settings">Settings</a></h2>
<h3 id="application-settings"><a class="header" href="#application-settings">Application Settings</a></h3>
<p>Configure MIDIMon preferences:</p>
<ul>
<li><strong>Auto-start</strong>: Launch on system startup</li>
<li><strong>Log Level</strong>: Control logging verbosity (debug, info, warn, error)</li>
<li><strong>Theme</strong>: Light/dark theme (future)</li>
</ul>
<h3 id="configuration-file"><a class="header" href="#configuration-file">Configuration File</a></h3>
<p>View and edit the raw config file:</p>
<ol>
<li>See the file path</li>
<li>Click <strong>üìã</strong> to copy path to clipboard</li>
<li>Click <strong>üìù</strong> to open in your default editor</li>
</ol>
<h2 id="menu-bar-system-tray"><a class="header" href="#menu-bar-system-tray">Menu Bar (System Tray)</a></h2>
<p>The menu bar icon provides quick access:</p>
<h3 id="menu-options"><a class="header" href="#menu-options">Menu Options</a></h3>
<ul>
<li><strong>Status</strong>: View daemon state</li>
<li><strong>Reload Configuration</strong>: Hot-reload config changes</li>
<li><strong>Pause Processing</strong>: Temporarily disable event processing</li>
<li><strong>Resume Processing</strong>: Re-enable event processing</li>
<li><strong>Switch Mode</strong>: Quick mode switching
<ul>
<li>Default</li>
<li>Development</li>
<li>Media</li>
</ul>
</li>
<li><strong>View Logs</strong>: Open system logs</li>
<li><strong>Open Config File</strong>: Edit configuration</li>
<li><strong>Quit MIDIMon</strong>: Stop daemon and quit</li>
</ul>
<h3 id="icon-states"><a class="header" href="#icon-states">Icon States</a></h3>
<ul>
<li><strong>üü¢ Running</strong>: Daemon active and processing events</li>
<li><strong>üü° Paused</strong>: Processing paused</li>
<li><strong>üî¥ Stopped</strong>: Daemon not running</li>
<li><strong>‚ö†Ô∏è Error</strong>: Error state</li>
</ul>
<h2 id="keyboard-shortcuts"><a class="header" href="#keyboard-shortcuts">Keyboard Shortcuts</a></h2>
<p>Global shortcuts (when GUI is focused):</p>
<ul>
<li><strong>Cmd/Ctrl + R</strong>: Reload configuration</li>
<li><strong>Cmd/Ctrl + Q</strong>: Quit application</li>
<li><strong>Cmd/Ctrl + ,</strong>: Open settings</li>
</ul>
<h2 id="tips--best-practices-1"><a class="header" href="#tips--best-practices-1">Tips &amp; Best Practices</a></h2>
<ol>
<li>
<p><strong>Use MIDI Learn</strong> for faster setup - it's more accurate than manual entry</p>
</li>
<li>
<p><strong>Test mappings immediately</strong> after creation - press the button to verify</p>
</li>
<li>
<p><strong>Start with global mappings</strong> for frequently used actions (volume, mode switch)</p>
</li>
<li>
<p><strong>Use descriptive names</strong> for modes and mappings - future you will thank you</p>
</li>
<li>
<p><strong>Export your config regularly</strong> - back up your work</p>
</li>
<li>
<p><strong>Use the event console</strong> when troubleshooting - see exactly what MIDI data is coming in</p>
</li>
<li>
<p><strong>Organize with modes</strong> - keep related mappings together</p>
</li>
<li>
<p><strong>Device templates save time</strong> - start with a template and customize</p>
</li>
</ol>
<h2 id="troubleshooting-4"><a class="header" href="#troubleshooting-4">Troubleshooting</a></h2>
<h3 id="gui-wont-connect-to-daemon"><a class="header" href="#gui-wont-connect-to-daemon">GUI Won't Connect to Daemon</a></h3>
<ol>
<li>Check daemon is running: <code>midimonctl status</code></li>
<li>Start daemon if needed: <code>midimon</code></li>
<li>Check IPC socket exists: <code>ls /tmp/midimon.sock</code></li>
<li>Restart daemon: <code>midimonctl stop &amp;&amp; midimon</code></li>
</ol>
<h3 id="mappings-not-saving"><a class="header" href="#mappings-not-saving">Mappings Not Saving</a></h3>
<ol>
<li>Check file permissions on config file</li>
<li>Verify config path in Settings tab</li>
<li>Check daemon logs for errors</li>
<li>Try manual edit to verify TOML syntax</li>
</ol>
<h3 id="midi-events-not-detected"><a class="header" href="#midi-events-not-detected">MIDI Events Not Detected</a></h3>
<ol>
<li>Check device connection in Devices tab</li>
<li>Use event console to verify MIDI data</li>
<li>Ensure correct MIDI port selected</li>
<li>Check device permissions (Input Monitoring on macOS)</li>
</ol>
<h3 id="menu-bar-icon-missing"><a class="header" href="#menu-bar-icon-missing">Menu Bar Icon Missing</a></h3>
<ul>
<li>macOS: Check System Settings ‚Üí Privacy &amp; Security ‚Üí Accessibility</li>
<li>Linux: Ensure system tray extension installed</li>
<li>Try restarting the GUI application</li>
</ul>
<h2 id="next-steps-6"><a class="header" href="#next-steps-6">Next Steps</a></h2>
<ul>
<li>Learn about <a href="guides/../getting-started/midi-learn.html">MIDI Learn mode</a></li>
<li>Set up <a href="guides/./per-app-profiles.html">per-app profiles</a></li>
<li>Explore <a href="guides/./device-templates.html">device templates</a></li>
<li>Configure <a href="guides/./led-system.html">LED feedback</a></li>
<li>Use the <a href="guides/./event-console.html">event console</a> for debugging</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="device-templates-guide"><a class="header" href="#device-templates-guide">Device Templates Guide</a></h1>
<p>Device templates provide pre-configured mappings for popular MIDI controllers, letting you get started in seconds instead of hours.</p>
<h2 id="what-are-device-templates"><a class="header" href="#what-are-device-templates">What are Device Templates?</a></h2>
<p>Device templates are pre-built configuration profiles that include:</p>
<ul>
<li><strong>Note mappings</strong> for all pads/buttons</li>
<li><strong>Common actions</strong> (copy/paste, play/pause, volume control)</li>
<li><strong>LED configurations</strong> optimized for each device</li>
<li><strong>Mode layouts</strong> designed for typical workflows</li>
</ul>
<p>Instead of manually mapping 16+ pads, load a template and customize only what you need.</p>
<h2 id="built-in-templates-v200"><a class="header" href="#built-in-templates-v200">Built-In Templates (v2.0.0)</a></h2>
<p>MIDIMon includes 6 built-in templates for popular controllers:</p>
<h3 id="1-maschine-mikro-mk3"><a class="header" href="#1-maschine-mikro-mk3">1. Maschine Mikro MK3</a></h3>
<p><strong>Full RGB LED support, 16 pads, encoder</strong></p>
<p><strong>Pre-configured</strong>:</p>
<ul>
<li>16 velocity-sensitive pads</li>
<li>Encoder for volume control</li>
<li>4 modes (Default, Development, Media, Custom)</li>
<li>Reactive LED feedback</li>
</ul>
<p><strong>Best for</strong>: Music production, software development, general productivity</p>
<h3 id="2-launchpad-mini-mk3"><a class="header" href="#2-launchpad-mini-mk3">2. Launchpad Mini MK3</a></h3>
<p><strong>RGB LED grid, 64 pads</strong></p>
<p><strong>Pre-configured</strong>:</p>
<ul>
<li>8x8 pad grid</li>
<li>Scene launch buttons</li>
<li>Rainbow LED schemes</li>
<li>Mode selection via top row</li>
</ul>
<p><strong>Best for</strong>: Ableton Live control, clip launching, grid-based workflows</p>
<h3 id="3-novation-launchkey-mini-mk3"><a class="header" href="#3-novation-launchkey-mini-mk3">3. Novation Launchkey Mini MK3</a></h3>
<p><strong>25 keys, 16 pads, 8 knobs</strong></p>
<p><strong>Pre-configured</strong>:</p>
<ul>
<li>16 drum pads</li>
<li>8 knobs for parameter control</li>
<li>Pitch/modulation wheels</li>
<li>Transport controls</li>
</ul>
<p><strong>Best for</strong>: Music production, MIDI sequencing, DAW control</p>
<h3 id="4-akai-mpk-mini-mk3"><a class="header" href="#4-akai-mpk-mini-mk3">4. AKAI MPK Mini MK3</a></h3>
<p><strong>25 keys, 8 pads, 8 knobs</strong></p>
<p><strong>Pre-configured</strong>:</p>
<ul>
<li>8 MPC-style pads</li>
<li>8 assignable knobs</li>
<li>Arpeggiator controls</li>
<li>4-way joystick</li>
</ul>
<p><strong>Best for</strong>: Beat making, music production, performance</p>
<h3 id="5-korg-nanokontrol2"><a class="header" href="#5-korg-nanokontrol2">5. Korg nanoKONTROL2</a></h3>
<p><strong>8 faders, 8 knobs, 24 buttons</strong></p>
<p><strong>Pre-configured</strong>:</p>
<ul>
<li>8-channel mixer layout</li>
<li>Transport controls</li>
<li>Scene/marker buttons</li>
<li>Fader automation</li>
</ul>
<p><strong>Best for</strong>: DAW mixing, transport control, automation</p>
<h3 id="6-apc-mini"><a class="header" href="#6-apc-mini">6. APC Mini</a></h3>
<p><strong>64 pads, 9 faders</strong></p>
<p><strong>Pre-configured</strong>:</p>
<ul>
<li>8x8 clip launch grid</li>
<li>Scene launch column</li>
<li>9 channel faders</li>
<li>Shift button combinations</li>
</ul>
<p><strong>Best for</strong>: Ableton Live, clip launching, mixing</p>
<h2 id="loading-a-template"><a class="header" href="#loading-a-template">Loading a Template</a></h2>
<h3 id="via-gui-recommended-1"><a class="header" href="#via-gui-recommended-1">Via GUI (Recommended)</a></h3>
<ol>
<li>
<p><strong>Open MIDIMon GUI</strong></p>
</li>
<li>
<p><strong>Go to Settings</strong> ‚Üí <strong>Device Templates</strong></p>
</li>
<li>
<p><strong>Select your controller</strong> from the dropdown</p>
</li>
<li>
<p><strong>Click "Load Template"</strong></p>
</li>
<li>
<p><strong>Confirm</strong> the load (replaces current config)</p>
</li>
<li>
<p><strong>Test</strong> - Press pads to verify mappings</p>
</li>
<li>
<p><strong>Customize</strong> using MIDI Learn for any changes</p>
</li>
</ol>
<h3 id="via-cli-1"><a class="header" href="#via-cli-1">Via CLI</a></h3>
<p>Templates are stored as TOML files in:</p>
<pre><code>~/.config/midimon/templates/
</code></pre>
<p><strong>Load manually</strong>:</p>
<pre><code class="language-bash"># Copy template to config location
cp ~/.config/midimon/templates/maschine-mikro-mk3.toml ~/.config/midimon/config.toml

# Reload daemon
midimonctl reload
</code></pre>
<h2 id="template-structure"><a class="header" href="#template-structure">Template Structure</a></h2>
<p>Templates are standard <code>config.toml</code> files with device-specific optimizations:</p>
<pre><code class="language-toml">[device]
name = "Maschine Mikro MK3"
template = "maschine-mikro-mk3"
auto_connect = true

[led_feedback]
scheme = "reactive"
default_color = [0, 120, 255]  # Blue

[[modes]]
name = "Default"
color = "blue"

[[modes.mappings]]
description = "Pad 1 - Copy"
[modes.mappings.trigger]
type = "Note"
note = 36
[modes.mappings.action]
type = "Keystroke"
keys = "c"
modifiers = ["cmd"]

# ... more mappings
</code></pre>
<h2 id="customizing-templates"><a class="header" href="#customizing-templates">Customizing Templates</a></h2>
<p>After loading a template:</p>
<h3 id="1-use-midi-learn"><a class="header" href="#1-use-midi-learn">1. Use MIDI Learn</a></h3>
<p>The fastest way to modify mappings:</p>
<ol>
<li>Click <strong>Edit</strong> on any mapping</li>
<li>Click <strong>Learn</strong> next to the trigger</li>
<li>Press the pad/button you want</li>
<li>Update the action</li>
<li>Save</li>
</ol>
<h3 id="2-add-new-modes"><a class="header" href="#2-add-new-modes">2. Add New Modes</a></h3>
<p>Templates include 2-4 modes. Add more:</p>
<ol>
<li>Go to <strong>Modes</strong> panel</li>
<li>Click <strong>Add Mode</strong></li>
<li>Set name and color</li>
<li>Add mappings using MIDI Learn</li>
</ol>
<h3 id="3-adjust-led-schemes"><a class="header" href="#3-adjust-led-schemes">3. Adjust LED Schemes</a></h3>
<p>Change LED behavior:</p>
<ol>
<li>Go to <strong>Settings</strong> ‚Üí <strong>LED Feedback</strong></li>
<li>Select scheme: Reactive, Rainbow, Pulse, etc.</li>
<li>Customize colors</li>
<li>Save</li>
</ol>
<h3 id="4-export-customized-template"><a class="header" href="#4-export-customized-template">4. Export Customized Template</a></h3>
<p>Save your modifications:</p>
<ol>
<li>Go to <strong>Settings</strong> ‚Üí <strong>Export Config</strong></li>
<li>Save as new template file</li>
<li>Share with others or use on other machines</li>
</ol>
<h2 id="creating-custom-templates"><a class="header" href="#creating-custom-templates">Creating Custom Templates</a></h2>
<p>You can create templates for controllers not included:</p>
<h3 id="step-1-map-your-device"><a class="header" href="#step-1-map-your-device">Step 1: Map Your Device</a></h3>
<ol>
<li><strong>Connect device</strong> and use MIDI Learn for all controls</li>
<li><strong>Organize into modes</strong> (Default, Media, Development, etc.)</li>
<li><strong>Configure LED feedback</strong> (if supported)</li>
<li><strong>Test thoroughly</strong> with real workflows</li>
</ol>
<h3 id="step-2-export-template"><a class="header" href="#step-2-export-template">Step 2: Export Template</a></h3>
<ol>
<li><strong>Settings</strong> ‚Üí <strong>Export Config</strong></li>
<li>Save as <code>my-controller-name.toml</code></li>
</ol>
<h3 id="step-3-add-metadata"><a class="header" href="#step-3-add-metadata">Step 3: Add Metadata</a></h3>
<p>Edit the exported file to add template metadata:</p>
<pre><code class="language-toml">[template]
name = "My Controller"
description = "Template for My MIDI Controller v2"
author = "Your Name"
version = "1.0.0"
created_at = "2025-11-14"
device_ids = ["USB MIDI Device", "My Controller MIDI 1"]
</code></pre>
<h3 id="step-4-test-template"><a class="header" href="#step-4-test-template">Step 4: Test Template</a></h3>
<ol>
<li><strong>Reset config</strong> to default</li>
<li><strong>Load your template</strong></li>
<li><strong>Verify all mappings</strong> work</li>
<li><strong>Check LED behavior</strong></li>
</ol>
<h3 id="step-5-share-optional"><a class="header" href="#step-5-share-optional">Step 5: Share (Optional)</a></h3>
<p>Submit to MIDIMon template library:</p>
<ol>
<li>Create PR to <code>config/device_templates/</code> directory</li>
<li>Include template file + documentation</li>
<li>Add device to compatibility matrix</li>
</ol>
<h2 id="template-compatibility"><a class="header" href="#template-compatibility">Template Compatibility</a></h2>
<p>Templates are forward-compatible across MIDIMon versions:</p>
<ul>
<li>‚úÖ v2.0.0 templates work in v2.1.0+</li>
<li>‚ö†Ô∏è Newer features may not load in older versions</li>
<li>‚úÖ Missing features gracefully ignored</li>
</ul>
<h2 id="troubleshooting-5"><a class="header" href="#troubleshooting-5">Troubleshooting</a></h2>
<h3 id="template-not-loading"><a class="header" href="#template-not-loading">Template Not Loading</a></h3>
<p><strong>Symptoms</strong>: "Failed to load template" error</p>
<p><strong>Solutions</strong>:</p>
<ol>
<li><strong>Check template file</strong> exists in <code>~/.config/midimon/templates/</code></li>
<li><strong>Validate TOML syntax</strong>: <code>midimonctl validate --config path/to/template.toml</code></li>
<li><strong>Check permissions</strong>: Template file must be readable</li>
<li><strong>View error details</strong> in Event Console</li>
</ol>
<h3 id="wrong-note-numbers"><a class="header" href="#wrong-note-numbers">Wrong Note Numbers</a></h3>
<p><strong>Symptoms</strong>: Template loads but pads don't trigger actions</p>
<p><strong>Solutions</strong>:</p>
<ol>
<li><strong>Check device mode</strong>: Some controllers have multiple MIDI modes</li>
<li><strong>Verify MIDI channel</strong>: Template may use different channel than device</li>
<li><strong>Use MIDI Learn</strong> to detect actual note numbers</li>
<li><strong>Check Event Console</strong> to see incoming MIDI events</li>
</ol>
<h3 id="leds-not-working-1"><a class="header" href="#leds-not-working-1">LEDs Not Working</a></h3>
<p><strong>Symptoms</strong>: Template loads but LEDs don't respond</p>
<p><strong>Solutions</strong>:</p>
<ol>
<li><strong>Check device supports RGB</strong>: Some controllers only have single-color LEDs</li>
<li><strong>Verify HID access</strong>: Grant Input Monitoring permission</li>
<li><strong>Try different LED scheme</strong>: Some schemes may not work on all devices</li>
<li><strong>Check template LED config</strong>: May be disabled in template</li>
</ol>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="tip-1-load-template-first"><a class="header" href="#tip-1-load-template-first">Tip 1: Load Template First</a></h3>
<p>When setting up a new controller:</p>
<ol>
<li><strong>Load template first</strong> (if available)</li>
<li><strong>Test default mappings</strong></li>
<li><strong>Customize only what you need</strong></li>
</ol>
<p>This saves 90% of setup time.</p>
<h3 id="tip-2-create-per-app-variants"><a class="header" href="#tip-2-create-per-app-variants">Tip 2: Create Per-App Variants</a></h3>
<p>Use templates as a base for per-app profiles:</p>
<ol>
<li>Load template</li>
<li>Customize for specific app (Logic Pro, VS Code, etc.)</li>
<li>Export as new template</li>
<li>Assign to app in Per-App Profiles</li>
</ol>
<h3 id="tip-3-version-your-templates"><a class="header" href="#tip-3-version-your-templates">Tip 3: Version Your Templates</a></h3>
<p>When customizing templates:</p>
<pre><code class="language-toml">[template]
version = "1.0.0"
base_template = "maschine-mikro-mk3"
customized_by = "Your Name"
customized_at = "2025-11-14"
</code></pre>
<p>This helps track changes over time.</p>
<h3 id="tip-4-test-before-sharing"><a class="header" href="#tip-4-test-before-sharing">Tip 4: Test Before Sharing</a></h3>
<p>Before submitting templates:</p>
<ul>
<li>‚úÖ Test all mappings</li>
<li>‚úÖ Verify LED feedback</li>
<li>‚úÖ Test in multiple apps</li>
<li>‚úÖ Document any device-specific quirks</li>
</ul>
<h2 id="next-steps-7"><a class="header" href="#next-steps-7">Next Steps</a></h2>
<ul>
<li><a href="guides/../getting-started/midi-learn.html">MIDI Learn Mode</a> - Customize templates</li>
<li><a href="guides/./per-app-profiles.html">Per-App Profiles</a> - Create app-specific variants</li>
<li><a href="guides/./led-system.html">LED System</a> - Customize LED behavior</li>
<li><a href="guides/../configuration/overview.html">Configuration Reference</a> - Template file format</li>
</ul>
<hr />
<p><strong>Last Updated</strong>: November 14, 2025 (v2.0.0)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="per-app-profiles-1"><a class="header" href="#per-app-profiles-1">Per-App Profiles</a></h1>
<p>Automatically switch configurations based on the frontmost application. Use different MIDI mappings for VS Code, Photoshop, Final Cut Pro, etc.</p>
<h2 id="overview-4"><a class="header" href="#overview-4">Overview</a></h2>
<p>Per-app profiles enable context-aware MIDI control:</p>
<ul>
<li><strong>Automatic switching</strong>: Profiles activate when you switch apps</li>
<li><strong>App-specific mappings</strong>: Different buttons for different workflows</li>
<li><strong>Manual override</strong>: Force a specific profile when needed</li>
<li><strong>Profile inheritance</strong>: Share common mappings across profiles</li>
</ul>
<h2 id="getting-started-1"><a class="header" href="#getting-started-1">Getting Started</a></h2>
<h3 id="1-enable-app-detection"><a class="header" href="#1-enable-app-detection">1. Enable App Detection</a></h3>
<pre><code class="language-bash"># macOS: Grant Accessibility permissions
# System Settings ‚Üí Privacy &amp; Security ‚Üí Accessibility ‚Üí MIDIMon

# Verify app detection is working
midimonctl frontmost-app
</code></pre>
<h3 id="2-create-profiles"><a class="header" href="#2-create-profiles">2. Create Profiles</a></h3>
<h4 id="via-gui"><a class="header" href="#via-gui">Via GUI</a></h4>
<ol>
<li>Open MIDIMon GUI</li>
<li>Navigate to <strong>Devices</strong> tab</li>
<li>Click <strong>üîÑ Profiles</strong></li>
<li>Click <strong>+ New Profile</strong></li>
<li>Enter profile name (e.g., "vscode-profile")</li>
<li>Configure mappings</li>
<li>Save profile</li>
</ol>
<h4 id="via-config-file"><a class="header" href="#via-config-file">Via Config File</a></h4>
<p>Create separate profile files in <code>~/.config/midimon/profiles/</code>:</p>
<pre><code class="language-bash">~/.config/midimon/profiles/
‚îú‚îÄ‚îÄ default.toml          # Fallback profile
‚îú‚îÄ‚îÄ vscode.toml           # VS Code mappings
‚îú‚îÄ‚îÄ photoshop.toml        # Photoshop mappings
‚îî‚îÄ‚îÄ fcpx.toml             # Final Cut Pro mappings
</code></pre>
<h3 id="3-register-app-associations"><a class="header" href="#3-register-app-associations">3. Register App Associations</a></h3>
<p>Map applications to profiles:</p>
<h4 id="gui-method"><a class="header" href="#gui-method">GUI Method</a></h4>
<ol>
<li>In Profile Manager dialog</li>
<li>Click <strong>Associate App</strong></li>
<li>Select profile</li>
<li>Choose application from list</li>
<li>Click <strong>Save</strong></li>
</ol>
<h4 id="config-method"><a class="header" href="#config-method">Config Method</a></h4>
<p>Edit <code>~/.config/midimon/app_profiles.toml</code>:</p>
<pre><code class="language-toml">[app_associations]
"Visual Studio Code" = "vscode"
"Code" = "vscode"  # Alternative app name
"Adobe Photoshop" = "photoshop"
"Final Cut Pro" = "fcpx"
</code></pre>
<h2 id="profile-configuration"><a class="header" href="#profile-configuration">Profile Configuration</a></h2>
<h3 id="profile-structure"><a class="header" href="#profile-structure">Profile Structure</a></h3>
<p>Each profile is a complete MIDIMon configuration:</p>
<pre><code class="language-toml"># profiles/vscode.toml

[device]
name = "Mikro"
auto_connect = true

[[modes]]
name = "Coding"
color = "blue"

# Code navigation mappings
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 36

[modes.mappings.action]
type = "Keystroke"
modifiers = ["Ctrl"]
keys = "P"  # Quick file open

[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 37

[modes.mappings.action]
type = "Keystroke"
modifiers = ["Ctrl", "Shift"]
keys = "F"  # Find in files

# Debug controls
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 38

[modes.mappings.action]
type = "Keystroke"
keys = "F5"  # Start debugging
</code></pre>
<h3 id="shared-mappings"><a class="header" href="#shared-mappings">Shared Mappings</a></h3>
<p>Use global mappings that work across all profiles:</p>
<pre><code class="language-toml"># In each profile, include common mappings
[[global_mappings]]
[global_mappings.trigger]
type = "EncoderTurn"
cc = 7
direction = "Clockwise"

[global_mappings.action]
type = "VolumeControl"
action = "Up"
</code></pre>
<h2 id="app-detection"><a class="header" href="#app-detection">App Detection</a></h2>
<h3 id="supported-platforms"><a class="header" href="#supported-platforms">Supported Platforms</a></h3>
<ul>
<li><strong>macOS</strong>: Full support via Accessibility API</li>
<li><strong>Linux</strong>: Full support via X11/Wayland</li>
<li><strong>Windows</strong>: Full support via Win32 API</li>
</ul>
<h3 id="app-name-matching"><a class="header" href="#app-name-matching">App Name Matching</a></h3>
<p>MIDIMon matches application names flexibly:</p>
<pre><code class="language-toml"># All of these will match Visual Studio Code
"Visual Studio Code" = "vscode"
"Code" = "vscode"
"code" = "vscode"
"VSCode" = "vscode"
</code></pre>
<h3 id="wildcards"><a class="header" href="#wildcards">Wildcards</a></h3>
<p>Use wildcards for partial matching:</p>
<pre><code class="language-toml">"*Adobe*" = "adobe-suite"  # Matches any Adobe app
"Chrome*" = "browser"       # Matches Chrome variants
</code></pre>
<h2 id="profile-switching"><a class="header" href="#profile-switching">Profile Switching</a></h2>
<h3 id="automatic-switching"><a class="header" href="#automatic-switching">Automatic Switching</a></h3>
<p>When app detection is enabled:</p>
<ol>
<li>Focus changes to new application</li>
<li>MIDIMon detects the frontmost app</li>
<li>Looks up associated profile</li>
<li>Loads and activates profile</li>
<li>LED feedback shows profile change (optional)</li>
</ol>
<p>Switching latency: ~50ms</p>
<h3 id="manual-override"><a class="header" href="#manual-override">Manual Override</a></h3>
<p>Force a specific profile:</p>
<h4 id="gui-method-1"><a class="header" href="#gui-method-1">GUI Method</a></h4>
<ol>
<li>Click <strong>üîÑ Profiles</strong> button</li>
<li>Select profile from list</li>
<li>Click <strong>Activate</strong></li>
</ol>
<h4 id="cli-method"><a class="header" href="#cli-method">CLI Method</a></h4>
<pre><code class="language-bash">midimonctl switch-profile vscode
</code></pre>
<h3 id="default-fallback"><a class="header" href="#default-fallback">Default Fallback</a></h3>
<p>If no profile matches the current app, MIDIMon uses:</p>
<ol>
<li><code>default</code> profile (if exists)</li>
<li>Main <code>config.toml</code></li>
</ol>
<h2 id="use-cases"><a class="header" href="#use-cases">Use Cases</a></h2>
<h3 id="software-development"><a class="header" href="#software-development">Software Development</a></h3>
<pre><code class="language-toml"># profiles/dev.toml
# Buttons for common IDE actions

[[modes.mappings]]
# Run tests
[modes.mappings.trigger]
type = "Note"
note = 36
[modes.mappings.action]
type = "Keystroke"
modifiers = ["Ctrl"]
keys = "T"

[[modes.mappings]]
# Git commit
[modes.mappings.trigger]
type = "Note"
note = 37
[modes.mappings.action]
type = "Shell"
command = "git commit"

[[modes.mappings]]
# Format code
[modes.mappings.trigger]
type = "Note"
note = 38
[modes.mappings.action]
type = "Keystroke"
modifiers = ["Shift", "Alt"]
keys = "F"
</code></pre>
<h3 id="video-editing"><a class="header" href="#video-editing">Video Editing</a></h3>
<pre><code class="language-toml"># profiles/video.toml
# Timeline control and playback

[[modes.mappings]]
# Play/Pause
[modes.mappings.trigger]
type = "Note"
note = 36
[modes.mappings.action]
type = "Keystroke"
keys = "Space"

[[modes.mappings]]
# Cut clip
[modes.mappings.trigger]
type = "Note"
note = 37
[modes.mappings.action]
type = "Keystroke"
modifiers = ["Cmd"]
keys = "B"

[[modes.mappings]]
# Ripple delete
[modes.mappings.trigger]
type = "LongPress"
note = 37
duration_ms = 1000
[modes.mappings.action]
type = "Keystroke"
modifiers = ["Shift"]
keys = "Delete"
</code></pre>
<h3 id="photo-editing"><a class="header" href="#photo-editing">Photo Editing</a></h3>
<pre><code class="language-toml"># profiles/photo.toml
# Brush size, zoom, undo/redo

[[modes.mappings]]
# Increase brush size
[modes.mappings.trigger]
type = "EncoderTurn"
cc = 1
direction = "Clockwise"
[modes.mappings.action]
type = "Keystroke"
keys = "]"

[[modes.mappings]]
# Decrease brush size
[modes.mappings.trigger]
type = "EncoderTurn"
cc = 1
direction = "CounterClockwise"
[modes.mappings.action]
type = "Keystroke"
keys = "["

[[modes.mappings]]
# Undo
[modes.mappings.trigger]
type = "Note"
note = 36
[modes.mappings.action]
type = "Keystroke"
modifiers = ["Cmd"]
keys = "Z"
</code></pre>
<h2 id="profile-management-1"><a class="header" href="#profile-management-1">Profile Management</a></h2>
<h3 id="export-profiles"><a class="header" href="#export-profiles">Export Profiles</a></h3>
<p>Share or back up profiles:</p>
<h4 id="gui-method-2"><a class="header" href="#gui-method-2">GUI Method</a></h4>
<ol>
<li>Profile Manager ‚Üí Select profile</li>
<li>Click <strong>Export</strong></li>
<li>Choose format (TOML/JSON)</li>
<li>Save file</li>
</ol>
<h4 id="cli-method-1"><a class="header" href="#cli-method-1">CLI Method</a></h4>
<pre><code class="language-bash">midimonctl export-profile vscode &gt; vscode-profile.toml
</code></pre>
<h3 id="import-profiles"><a class="header" href="#import-profiles">Import Profiles</a></h3>
<p>Load profiles from files:</p>
<h4 id="gui-method-3"><a class="header" href="#gui-method-3">GUI Method</a></h4>
<ol>
<li>Profile Manager ‚Üí <strong>Import</strong></li>
<li>Select file</li>
<li>Choose name for imported profile</li>
<li>Click <strong>Import</strong></li>
</ol>
<h4 id="cli-method-2"><a class="header" href="#cli-method-2">CLI Method</a></h4>
<pre><code class="language-bash">midimonctl import-profile vscode-profile.toml
</code></pre>
<h3 id="profile-validation"><a class="header" href="#profile-validation">Profile Validation</a></h3>
<p>Test profiles before activating:</p>
<pre><code class="language-bash">midimonctl validate-profile vscode
</code></pre>
<h2 id="troubleshooting-6"><a class="header" href="#troubleshooting-6">Troubleshooting</a></h2>
<h3 id="app-not-detected"><a class="header" href="#app-not-detected">App Not Detected</a></h3>
<ol>
<li>
<p><strong>Check permissions</strong>:</p>
<ul>
<li>macOS: Accessibility permissions granted</li>
<li>Linux: Running with sufficient privileges</li>
<li>Windows: No UAC blocking</li>
</ul>
</li>
<li>
<p><strong>Verify app name</strong>:</p>
<pre><code class="language-bash">midimonctl frontmost-app
</code></pre>
</li>
<li>
<p><strong>Check association</strong>:</p>
<ul>
<li>Ensure app name in config matches actual name</li>
<li>Use wildcards if app name varies</li>
</ul>
</li>
</ol>
<h3 id="profile-not-switching"><a class="header" href="#profile-not-switching">Profile Not Switching</a></h3>
<ol>
<li>
<p><strong>Check app detection is enabled</strong>:</p>
<pre><code class="language-bash">midimonctl status
</code></pre>
</li>
<li>
<p><strong>Verify profile exists</strong>:</p>
<pre><code class="language-bash">ls ~/.config/midimon/profiles/
</code></pre>
</li>
<li>
<p><strong>Test manual switch</strong>:</p>
<pre><code class="language-bash">midimonctl switch-profile vscode
</code></pre>
</li>
<li>
<p><strong>Check logs</strong>:</p>
<pre><code class="language-bash">midimonctl logs | grep profile
</code></pre>
</li>
</ol>
<h3 id="wrong-profile-activates"><a class="header" href="#wrong-profile-activates">Wrong Profile Activates</a></h3>
<ol>
<li>Check association priority</li>
<li>Verify no conflicting wildcards</li>
<li>Review app name matching in logs</li>
</ol>
<h2 id="best-practices-1"><a class="header" href="#best-practices-1">Best Practices</a></h2>
<ol>
<li>
<p><strong>Start with defaults</strong>: Create a base profile with common mappings</p>
</li>
<li>
<p><strong>Use inheritance</strong>: Share global mappings across profiles</p>
</li>
<li>
<p><strong>Test thoroughly</strong>: Verify each profile works in target app</p>
</li>
<li>
<p><strong>Name clearly</strong>: Use descriptive profile names (e.g., "davinci-resolve" not "prof1")</p>
</li>
<li>
<p><strong>Document mappings</strong>: Add comments in TOML files</p>
</li>
<li>
<p><strong>Version control</strong>: Keep profiles in git for history</p>
</li>
<li>
<p><strong>Export regularly</strong>: Back up working profiles</p>
</li>
<li>
<p><strong>Share templates</strong>: Contribute profiles for popular apps</p>
</li>
</ol>
<h2 id="advanced-features"><a class="header" href="#advanced-features">Advanced Features</a></h2>
<h3 id="conditional-switching"><a class="header" href="#conditional-switching">Conditional Switching</a></h3>
<p>Switch based on multiple criteria:</p>
<pre><code class="language-toml">[switching_rules]
# Only switch to fcpx profile if specific project is open
[[switching_rules.conditions]]
app = "Final Cut Pro"
window_title = "*MyProject*"
profile = "fcpx-myproject"
</code></pre>
<h3 id="profile-chains"><a class="header" href="#profile-chains">Profile Chains</a></h3>
<p>Load multiple profiles in sequence:</p>
<pre><code class="language-toml">[profile_chain]
base = "default"
overlay = "vscode"
# Loads default, then overlays vscode-specific mappings
</code></pre>
<h3 id="hot-reload"><a class="header" href="#hot-reload">Hot Reload</a></h3>
<p>Profiles support hot reload:</p>
<ol>
<li>Edit profile file</li>
<li>Save changes</li>
<li>Switch to different app and back</li>
<li>Profile reloads automatically</li>
</ol>
<h2 id="next-steps-8"><a class="header" href="#next-steps-8">Next Steps</a></h2>
<ul>
<li>Learn about <a href="guides/../getting-started/midi-learn.html">MIDI Learn</a> to quickly create profile mappings</li>
<li>Set up <a href="guides/./device-templates.html">device templates</a> for consistent layouts</li>
<li>Use the <a href="guides/./event-console.html">event console</a> to test profile mappings</li>
<li>Explore <a href="guides/./led-system.html">LED feedback</a> for visual profile indication</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="led-system"><a class="header" href="#led-system">LED System</a></h1>
<p>MIDIMon provides RGB LED feedback for controllers that support it, creating visual indicators for pad presses, modes, and system state.</p>
<h2 id="overview-5"><a class="header" href="#overview-5">Overview</a></h2>
<p>The LED system provides:</p>
<ul>
<li><strong>Real-time feedback</strong>: LEDs respond instantly to pad presses</li>
<li><strong>Mode visualization</strong>: Different colors for different modes</li>
<li><strong>Multiple schemes</strong>: Reactive, rainbow, breathing, and more</li>
<li><strong>Velocity sensitivity</strong>: LED brightness/color reflects press intensity</li>
<li><strong>HID support</strong>: Direct RGB control for Maschine Mikro MK3 and similar devices</li>
<li><strong>MIDI fallback</strong>: Basic on/off for standard MIDI controllers</li>
</ul>
<h2 id="supported-devices"><a class="header" href="#supported-devices">Supported Devices</a></h2>
<h3 id="full-rgb-support-hid"><a class="header" href="#full-rgb-support-hid">Full RGB Support (HID)</a></h3>
<ul>
<li><strong>Native Instruments Maschine Mikro MK3</strong>: 16 RGB pads</li>
<li><strong>Maschine MK3</strong>: 16 RGB pads</li>
<li><strong>Other HID RGB devices</strong>: Configurable via device profiles</li>
</ul>
<h3 id="midi-led-support"><a class="header" href="#midi-led-support">MIDI LED Support</a></h3>
<ul>
<li><strong>Launchpad series</strong>: Note-based LED control</li>
<li><strong>APC series</strong>: CC-based LED control</li>
<li><strong>Generic MIDI</strong>: Via Note On/Off messages</li>
</ul>
<h2 id="lighting-schemes"><a class="header" href="#lighting-schemes">Lighting Schemes</a></h2>
<h3 id="reactive-default"><a class="header" href="#reactive-default">Reactive (Default)</a></h3>
<p>LEDs respond to pad velocity and fade after release:</p>
<ul>
<li><strong>Soft</strong> (0-40): Green</li>
<li><strong>Medium</strong> (41-80): Yellow</li>
<li><strong>Hard</strong> (81-127): Red</li>
<li><strong>Fade time</strong>: 1 second</li>
</ul>
<pre><code class="language-bash"># Enable reactive mode
midimon --led reactive 2
</code></pre>
<h3 id="rainbow"><a class="header" href="#rainbow">Rainbow</a></h3>
<p>Rotating rainbow pattern across all pads:</p>
<pre><code class="language-bash">midimon --led rainbow 2
</code></pre>
<h3 id="breathing"><a class="header" href="#breathing">Breathing</a></h3>
<p>Pulsing effect synced across all pads:</p>
<pre><code class="language-bash">midimon --led breathing 2
</code></pre>
<h3 id="wave"><a class="header" href="#wave">Wave</a></h3>
<p>Cascading wave pattern:</p>
<pre><code class="language-bash">midimon --led wave 2
</code></pre>
<h3 id="sparkle"><a class="header" href="#sparkle">Sparkle</a></h3>
<p>Random twinkling effect:</p>
<pre><code class="language-bash">midimon --led sparkle 2
</code></pre>
<h3 id="vu-meter"><a class="header" href="#vu-meter">VU Meter</a></h3>
<p>Bottom-to-top audio level visualization:</p>
<pre><code class="language-bash">midimon --led vumeter 2
</code></pre>
<h3 id="static"><a class="header" href="#static">Static</a></h3>
<p>Solid color based on current mode:</p>
<pre><code class="language-bash">midimon --led static 2
</code></pre>
<h3 id="off"><a class="header" href="#off">Off</a></h3>
<p>Disable LED feedback:</p>
<pre><code class="language-bash">midimon --led off 2
</code></pre>
<h2 id="configuration"><a class="header" href="#configuration">Configuration</a></h2>
<h3 id="global-led-settings"><a class="header" href="#global-led-settings">Global LED Settings</a></h3>
<p>In <code>config.toml</code>:</p>
<pre><code class="language-toml">[led_settings]
scheme = "reactive"
brightness = 100  # 0-100
fade_time_ms = 1000
enable_mode_colors = true
</code></pre>
<h3 id="mode-specific-colors"><a class="header" href="#mode-specific-colors">Mode-Specific Colors</a></h3>
<p>Each mode can have its own LED color theme:</p>
<pre><code class="language-toml">[[modes]]
name = "Default"
color = "blue"  # LEDs tint blue when in this mode

[[modes]]
name = "Development"
color = "green"

[[modes]]
name = "Media"
color = "purple"
</code></pre>
<p>Available colors:</p>
<ul>
<li><code>blue</code>, <code>green</code>, <code>purple</code>, <code>red</code>, <code>yellow</code>, <code>orange</code>, <code>pink</code>, <code>cyan</code>, <code>white</code></li>
</ul>
<h3 id="per-mapping-led-feedback"><a class="header" href="#per-mapping-led-feedback">Per-Mapping LED Feedback</a></h3>
<p>Individual mappings can override LED behavior:</p>
<pre><code class="language-toml">[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 36

[modes.mappings.action]
type = "Keystroke"
keys = "Space"

[modes.mappings.led]
color = "red"
brightness = 80
duration_ms = 500  # Override fade time
</code></pre>
<h2 id="hid-led-control-maschine-mikro-mk3"><a class="header" href="#hid-led-control-maschine-mikro-mk3">HID LED Control (Maschine Mikro MK3)</a></h2>
<h3 id="direct-rgb-access"><a class="header" href="#direct-rgb-access">Direct RGB Access</a></h3>
<p>MIDIMon uses HID for precise RGB control:</p>
<ul>
<li><strong>Latency</strong>: &lt;1ms response time</li>
<li><strong>Color depth</strong>: 24-bit RGB (16.7M colors)</li>
<li><strong>Refresh rate</strong>: 60Hz</li>
<li><strong>Shared access</strong>: Works alongside Native Instruments software</li>
</ul>
<h3 id="led-mapping"><a class="header" href="#led-mapping">LED Mapping</a></h3>
<p>Physical pad layout to LED indices:</p>
<pre><code>Pad Page A-H (16 pads):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 36 ‚îÇ 37 ‚îÇ 38 ‚îÇ 39 ‚îÇ  LED indices 0-3
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 40 ‚îÇ 41 ‚îÇ 42 ‚îÇ 43 ‚îÇ  LED indices 4-7
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 44 ‚îÇ 45 ‚îÇ 46 ‚îÇ 47 ‚îÇ  LED indices 8-11
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 48 ‚îÇ 49 ‚îÇ 50 ‚îÇ 51 ‚îÇ  LED indices 12-15
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre>
<h3 id="custom-hid-patterns"><a class="header" href="#custom-hid-patterns">Custom HID Patterns</a></h3>
<p>Advanced users can create custom LED patterns:</p>
<pre><code class="language-rust">// Example: Custom chase pattern
pub fn led_chase_pattern(leds: &amp;mut MikroMK3LEDs, frame: u32) {
    let pos = (frame / 10) % 16;
    for i in 0..16 {
        if i == pos {
            leds.set_pad_rgb(i, 255, 0, 0); // Red
        } else if i == (pos + 1) % 16 {
            leds.set_pad_rgb(i, 128, 0, 0); // Dim red
        } else {
            leds.set_pad_rgb(i, 0, 0, 0); // Off
        }
    }
    leds.update();
}</code></pre>
<h2 id="midi-led-control"><a class="header" href="#midi-led-control">MIDI LED Control</a></h2>
<h3 id="standard-midi-devices"><a class="header" href="#standard-midi-devices">Standard MIDI Devices</a></h3>
<p>For devices without HID RGB support, MIDIMon uses MIDI:</p>
<pre><code class="language-toml">[led_settings]
use_midi_leds = true
midi_channel = 1
note_on_velocity = 127  # LED on brightness
note_off_velocity = 0   # LED off
</code></pre>
<h3 id="launchpad-style-control"><a class="header" href="#launchpad-style-control">Launchpad-Style Control</a></h3>
<p>Map LED colors to velocity values:</p>
<pre><code class="language-toml">[led_settings.midi_colors]
red = 5
green = 21
yellow = 13
amber = 9
off = 12
</code></pre>
<h3 id="custom-midi-led-mapping"><a class="header" href="#custom-midi-led-mapping">Custom MIDI LED Mapping</a></h3>
<p>Define custom LED control messages:</p>
<pre><code class="language-toml">[[led_settings.custom_mappings]]
pad = 36  # MIDI note
led_on = { type = "NoteOn", channel = 1, note = 36, velocity = 127 }
led_off = { type = "NoteOff", channel = 1, note = 36, velocity = 0 }
color_map = { red = 5, green = 21, yellow = 13 }
</code></pre>
<h2 id="gui-configuration-1"><a class="header" href="#gui-configuration-1">GUI Configuration</a></h2>
<h3 id="via-settings-panel"><a class="header" href="#via-settings-panel">Via Settings Panel</a></h3>
<ol>
<li>Open MIDIMon GUI</li>
<li>Navigate to <strong>Settings</strong> tab</li>
<li>Scroll to <strong>LED Configuration</strong></li>
<li>Select scheme from dropdown</li>
<li>Adjust brightness slider</li>
<li>Configure fade time</li>
<li>Enable/disable mode colors</li>
<li>Click <strong>Save</strong></li>
</ol>
<h2 id="performance-optimization"><a class="header" href="#performance-optimization">Performance Optimization</a></h2>
<h3 id="reduce-led-updates"><a class="header" href="#reduce-led-updates">Reduce LED Updates</a></h3>
<p>For battery-powered devices or performance optimization:</p>
<pre><code class="language-toml">[led_settings]
update_rate_hz = 30  # Default: 60Hz
skip_intermediate_frames = true  # Only update on significant changes
</code></pre>
<h3 id="disable-leds-selectively"><a class="header" href="#disable-leds-selectively">Disable LEDs Selectively</a></h3>
<p>Turn off LEDs for specific modes:</p>
<pre><code class="language-toml">[[modes]]
name = "Silent Mode"
color = "off"  # No LED feedback in this mode
</code></pre>
<h2 id="troubleshooting-7"><a class="header" href="#troubleshooting-7">Troubleshooting</a></h2>
<h3 id="leds-not-responding"><a class="header" href="#leds-not-responding">LEDs Not Responding</a></h3>
<ol>
<li>
<p><strong>Check device support</strong>:</p>
<pre><code class="language-bash"># List HID devices
ls /dev/hidraw*  # Linux
system_profiler SPUSBDataType  # macOS
</code></pre>
</li>
<li>
<p><strong>Verify permissions</strong> (macOS):</p>
<ul>
<li>System Settings ‚Üí Privacy &amp; Security ‚Üí Input Monitoring</li>
<li>Grant access to MIDIMon</li>
</ul>
</li>
<li>
<p><strong>Test with diagnostic tool</strong>:</p>
<pre><code class="language-bash">cargo run --bin led_diagnostic
</code></pre>
</li>
<li>
<p><strong>Check HID access</strong>:</p>
<pre><code class="language-bash"># macOS: Ensure shared device access
DEBUG=1 midimon 2 --led reactive
</code></pre>
</li>
</ol>
<h3 id="wrong-colors"><a class="header" href="#wrong-colors">Wrong Colors</a></h3>
<ol>
<li>Verify color mapping in config</li>
<li>Check if device uses non-standard RGB order (some use GRB or BGR)</li>
<li>Try different lighting scheme</li>
<li>Calibrate brightness</li>
</ol>
<h3 id="flickering-leds"><a class="header" href="#flickering-leds">Flickering LEDs</a></h3>
<ol>
<li>Reduce update rate: <code>update_rate_hz = 30</code></li>
<li>Enable frame skipping: <code>skip_intermediate_frames = true</code></li>
<li>Check USB power supply</li>
<li>Disable other LED-controlling software</li>
</ol>
<h3 id="leds-stuck-onoff"><a class="header" href="#leds-stuck-onoff">LEDs Stuck On/Off</a></h3>
<ol>
<li>Restart MIDIMon</li>
<li>Power cycle MIDI device</li>
<li>Check for conflicting LED control (e.g., Native Instruments software)</li>
<li>Reset LEDs: <code>midimon --led off 2</code> then restart</li>
</ol>
<h2 id="advanced-customization"><a class="header" href="#advanced-customization">Advanced Customization</a></h2>
<h3 id="create-custom-schemes"><a class="header" href="#create-custom-schemes">Create Custom Schemes</a></h3>
<p>Write custom lighting patterns in <code>~/.config/midimon/led_schemes/</code>:</p>
<pre><code class="language-rust">// custom_pulse.rs
pub struct CustomPulse {
    frame: u32,
}

impl LedScheme for CustomPulse {
    fn update(&amp;mut self, leds: &amp;mut dyn PadFeedback) {
        self.frame += 1;
        let brightness = ((self.frame as f32 / 30.0).sin() * 127.0 + 128.0) as u8;

        for i in 0..16 {
            leds.set_pad_color(i, brightness, brightness, 255);
        }
    }
}</code></pre>
<p>Load custom scheme:</p>
<pre><code class="language-toml">[led_settings]
scheme = "custom:custom_pulse"
</code></pre>
<h3 id="mode-transition-effects"><a class="header" href="#mode-transition-effects">Mode Transition Effects</a></h3>
<p>Animate LED transitions when switching modes:</p>
<pre><code class="language-toml">[led_settings.transitions]
enabled = true
duration_ms = 300
effect = "fade"  # fade, sweep, flash
</code></pre>
<h2 id="best-practices-2"><a class="header" href="#best-practices-2">Best Practices</a></h2>
<ol>
<li>
<p><strong>Start with reactive</strong>: Most intuitive for new users</p>
</li>
<li>
<p><strong>Match mode colors to usage</strong>: Visual cues help remember mode purpose</p>
</li>
<li>
<p><strong>Test visibility</strong>: Ensure LEDs visible in your lighting conditions</p>
</li>
<li>
<p><strong>Don't overdo it</strong>: Complex animations can be distracting</p>
</li>
<li>
<p><strong>Battery consideration</strong>: Disable LEDs for battery-powered setups</p>
</li>
<li>
<p><strong>Accessibility</strong>: Use high-contrast colors for visibility</p>
</li>
</ol>
<h2 id="integration-examples"><a class="header" href="#integration-examples">Integration Examples</a></h2>
<h3 id="led-feedback-for-successfailure"><a class="header" href="#led-feedback-for-successfailure">LED Feedback for Success/Failure</a></h3>
<p>Flash green on success, red on failure:</p>
<pre><code class="language-toml">[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 36

[modes.mappings.action]
type = "Shell"
command = "./run_tests.sh"

[modes.mappings.led]
success_color = "green"
failure_color = "red"
flash_duration_ms = 500
</code></pre>
<h3 id="vu-meter-for-audio-input"><a class="header" href="#vu-meter-for-audio-input">VU Meter for Audio Input</a></h3>
<p>Display audio levels:</p>
<pre><code class="language-bash">midimon --led vumeter --audio-input "System Audio" 2
</code></pre>
<h3 id="custom-mode-indicators"><a class="header" href="#custom-mode-indicators">Custom Mode Indicators</a></h3>
<p>Reserve specific pads for mode indication:</p>
<pre><code class="language-toml">[led_settings.mode_indicators]
pad_36 = "mode_0"  # Blue when in mode 0
pad_37 = "mode_1"  # Green when in mode 1
pad_38 = "mode_2"  # Purple when in mode 2
always_on = true
</code></pre>
<h2 id="next-steps-9"><a class="header" href="#next-steps-9">Next Steps</a></h2>
<ul>
<li>Explore <a href="guides/./gui.html">GUI configuration</a> for visual LED setup</li>
<li>Use <a href="guides/../getting-started/midi-learn.html">MIDI Learn</a> with LED feedback</li>
<li>Set up <a href="guides/./per-app-profiles.html">per-app profiles</a> with different LED schemes</li>
<li>Try the <a href="guides/./event-console.html">event console</a> to debug LED behavior</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="event-console"><a class="header" href="#event-console">Event Console</a></h1>
<p>The Live Event Console provides real-time visualization of MIDI events, helping you debug mappings, discover note numbers, and understand your controller's behavior.</p>
<h2 id="overview-6"><a class="header" href="#overview-6">Overview</a></h2>
<p>The Event Console displays:</p>
<ul>
<li><strong>MIDI events</strong>: Note on/off, CC, aftertouch, pitch bend</li>
<li><strong>Timing information</strong>: Timestamps and event duration</li>
<li><strong>Velocity data</strong>: Press intensity values</li>
<li><strong>Processed events</strong>: Long press, double-tap, chord detection</li>
<li><strong>Action execution</strong>: What actions were triggered</li>
<li><strong>Error messages</strong>: Failed actions or validation issues</li>
</ul>
<h2 id="access-the-console"><a class="header" href="#access-the-console">Access the Console</a></h2>
<h3 id="gui-method-4"><a class="header" href="#gui-method-4">GUI Method</a></h3>
<ol>
<li>Open MIDIMon GUI</li>
<li>Navigate to <strong>Settings</strong> tab</li>
<li>Click <strong>üìä Show Event Console</strong></li>
<li>View live events in real-time</li>
</ol>
<h3 id="cli-method-3"><a class="header" href="#cli-method-3">CLI Method</a></h3>
<pre><code class="language-bash"># Monitor all events
midimonctl events

# Filter by event type
midimonctl events --type note

# Follow mode (live tail)
midimonctl events --follow
</code></pre>
<h2 id="event-types"><a class="header" href="#event-types">Event Types</a></h2>
<h3 id="midi-events"><a class="header" href="#midi-events">MIDI Events</a></h3>
<h4 id="note-onoff"><a class="header" href="#note-onoff">Note On/Off</a></h4>
<pre><code>[12:34:56.789] NOTE_ON  | Note: 36 | Vel: 87 | Ch: 1
[12:34:57.120] NOTE_OFF | Note: 36 | Vel: 0  | Ch: 1
Duration: 331ms
</code></pre>
<h4 id="control-change"><a class="header" href="#control-change">Control Change</a></h4>
<pre><code>[12:34:58.456] CC | CC: 7 | Value: 64 | Ch: 1
</code></pre>
<h4 id="aftertouch"><a class="header" href="#aftertouch">Aftertouch</a></h4>
<pre><code>[12:35:00.123] AFTERTOUCH | Pressure: 95 | Ch: 1
</code></pre>
<h4 id="pitch-bend"><a class="header" href="#pitch-bend">Pitch Bend</a></h4>
<pre><code>[12:35:01.789] PITCH_BEND | Value: 8192 | Ch: 1
</code></pre>
<h3 id="processed-events"><a class="header" href="#processed-events">Processed Events</a></h3>
<h4 id="long-press-detected"><a class="header" href="#long-press-detected">Long Press Detected</a></h4>
<pre><code>[12:35:05.000] LONG_PRESS | Note: 36 | Duration: 2150ms
Trigger matched: "Emergency Stop" (mapping #5)
</code></pre>
<h4 id="double-tap-detected"><a class="header" href="#double-tap-detected">Double Tap Detected</a></h4>
<pre><code>[12:35:10.100] DOUBLE_TAP | Note: 37 | Interval: 245ms
Trigger matched: "Quick Launch" (mapping #8)
</code></pre>
<h4 id="chord-detected"><a class="header" href="#chord-detected">Chord Detected</a></h4>
<pre><code>[12:35:15.500] CHORD | Notes: [36, 40, 43] | Window: 87ms
Trigger matched: "Save All" (mapping #12)
</code></pre>
<h4 id="encoder-turn"><a class="header" href="#encoder-turn">Encoder Turn</a></h4>
<pre><code>[12:35:20.750] ENCODER_TURN | CC: 1 | Direction: Clockwise | Steps: 3
Trigger matched: "Volume Up" (mapping #2)
</code></pre>
<h3 id="action-execution"><a class="header" href="#action-execution">Action Execution</a></h3>
<pre><code>[12:35:25.100] ACTION_START | Type: Keystroke
  Modifiers: [Cmd, Shift]
  Keys: "S"
[12:35:25.105] ACTION_COMPLETE | Duration: 5ms | Status: Success
</code></pre>
<h3 id="errors"><a class="header" href="#errors">Errors</a></h3>
<pre><code>[12:35:30.000] ERROR | Failed to execute shell command
  Command: "/usr/bin/notexist"
  Error: "No such file or directory"
  Mapping: #15 ("Custom Script")
</code></pre>
<h2 id="filtering-events"><a class="header" href="#filtering-events">Filtering Events</a></h2>
<h3 id="by-event-type"><a class="header" href="#by-event-type">By Event Type</a></h3>
<pre><code class="language-bash"># Only note events
midimonctl events --type note

# Only CC events
midimonctl events --type cc

# Only processed events
midimonctl events --type processed

# Only actions
midimonctl events --type action

# Only errors
midimonctl events --type error
</code></pre>
<h3 id="by-midi-channel"><a class="header" href="#by-midi-channel">By MIDI Channel</a></h3>
<pre><code class="language-bash">midimonctl events --channel 1
</code></pre>
<h3 id="by-note-range"><a class="header" href="#by-note-range">By Note Range</a></h3>
<pre><code class="language-bash"># Only pads (notes 36-51)
midimonctl events --note-min 36 --note-max 51
</code></pre>
<h3 id="by-time-range"><a class="header" href="#by-time-range">By Time Range</a></h3>
<pre><code class="language-bash"># Last 5 minutes
midimonctl events --since 5m

# Last hour
midimonctl events --since 1h

# Specific time
midimonctl events --since "2025-01-15 12:00"
</code></pre>
<h2 id="use-cases-1"><a class="header" href="#use-cases-1">Use Cases</a></h2>
<h3 id="discover-note-numbers"><a class="header" href="#discover-note-numbers">Discover Note Numbers</a></h3>
<p><strong>Problem</strong>: Don't know which MIDI note a pad sends</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Open Event Console</li>
<li>Press the pad</li>
<li>See <code>NOTE_ON | Note: 36</code> in console</li>
<li>Use note 36 in your mapping</li>
</ol>
<pre><code>[12:40:00.000] NOTE_ON | Note: 36 | Vel: 92 | Ch: 1
                       ‚Üë
                   This is the note number
</code></pre>
<h3 id="debug-long-press-not-triggering"><a class="header" href="#debug-long-press-not-triggering">Debug Long Press Not Triggering</a></h3>
<p><strong>Problem</strong>: Long press mapping not activating</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Open Event Console</li>
<li>Hold the pad</li>
<li>Check if <code>LONG_PRESS</code> event appears</li>
<li>Compare duration with your config:</li>
</ol>
<pre><code>[12:45:00.000] NOTE_ON    | Note: 36 | Vel: 87
[12:45:01.500] NOTE_OFF   | Note: 36 | Duration: 1500ms
                                      ‚Üë
                        Too short! Config requires 2000ms
</code></pre>
<p>Fix by reducing <code>duration_ms</code> in config or holding longer.</p>
<h3 id="verify-velocity-ranges"><a class="header" href="#verify-velocity-ranges">Verify Velocity Ranges</a></h3>
<p><strong>Problem</strong>: Soft/medium/hard velocity ranges not working as expected</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Press pad softly: Check velocity value</li>
<li>Press pad medium: Check velocity value</li>
<li>Press pad hard: Check velocity value</li>
<li>Adjust ranges in config</li>
</ol>
<pre><code>Soft press:   [12:50:00.000] NOTE_ON | Vel: 25  ‚Üê Within 0-40
Medium press: [12:50:05.000] NOTE_ON | Vel: 65  ‚Üê Within 41-80
Hard press:   [12:50:10.000] NOTE_ON | Vel: 110 ‚Üê Within 81-127
</code></pre>
<h3 id="debug-chord-detection"><a class="header" href="#debug-chord-detection">Debug Chord Detection</a></h3>
<p><strong>Problem</strong>: Chord mapping not triggering</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Press chord notes</li>
<li>Check timing window in console:</li>
</ol>
<pre><code>[13:00:00.000] NOTE_ON | Note: 36
[13:00:00.150] NOTE_ON | Note: 40  ‚Üê 150ms gap, too slow!
[13:00:00.300] NOTE_ON | Note: 43

Config requires all notes within 100ms
</code></pre>
<p>Fix: Press notes faster OR increase <code>chord_timeout_ms</code> in config.</p>
<h3 id="test-action-execution"><a class="header" href="#test-action-execution">Test Action Execution</a></h3>
<p><strong>Problem</strong>: Action not executing as expected</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Trigger the mapping</li>
<li>Watch action execution in console</li>
<li>Check for errors</li>
</ol>
<pre><code>[13:05:00.000] ACTION_START | Type: Shell
  Command: "open -a 'Visual Studio Code'"
[13:05:00.250] ACTION_COMPLETE | Duration: 250ms | Status: Success

vs.

[13:05:05.000] ACTION_START | Type: Shell
  Command: "open -a 'NotExist'"
[13:05:05.100] ERROR | Application not found
                ‚Üë
            This tells you what went wrong
</code></pre>
<h3 id="monitor-system-performance"><a class="header" href="#monitor-system-performance">Monitor System Performance</a></h3>
<p>Watch event processing latency:</p>
<pre><code>[13:10:00.000] NOTE_ON      | Note: 36
[13:10:00.001] PROCESSED    | Duration: 1ms  ‚Üê Very fast!
[13:10:00.002] ACTION_START
[13:10:00.007] ACTION_COMPLETE | Duration: 5ms

Total: 7ms from button press to action complete
</code></pre>
<p>If latency &gt;50ms, investigate performance issues.</p>
<h2 id="gui-console-features"><a class="header" href="#gui-console-features">GUI Console Features</a></h2>
<h3 id="visual-event-timeline"><a class="header" href="#visual-event-timeline">Visual Event Timeline</a></h3>
<p>The GUI console includes a visual timeline showing:</p>
<ul>
<li>Event type (color-coded)</li>
<li>Timestamp</li>
<li>Event details</li>
<li>Expandable for full info</li>
</ul>
<h3 id="event-highlighting"><a class="header" href="#event-highlighting">Event Highlighting</a></h3>
<ul>
<li><strong>Green</strong>: Successful events</li>
<li><strong>Yellow</strong>: Warnings (e.g., near timeout)</li>
<li><strong>Red</strong>: Errors</li>
<li><strong>Blue</strong>: Info (e.g., mode changes)</li>
</ul>
<h3 id="auto-scroll"><a class="header" href="#auto-scroll">Auto-Scroll</a></h3>
<p>Console auto-scrolls to latest events. Click <strong>Pause</strong> to freeze for inspection.</p>
<h3 id="event-export"><a class="header" href="#event-export">Event Export</a></h3>
<ol>
<li>Select events</li>
<li>Click <strong>Export</strong></li>
<li>Save as JSON/CSV for analysis</li>
</ol>
<h3 id="event-statistics"><a class="header" href="#event-statistics">Event Statistics</a></h3>
<p>View live statistics:</p>
<ul>
<li>Events per second</li>
<li>Average velocity</li>
<li>Most-pressed pad</li>
<li>Error rate</li>
</ul>
<h2 id="advanced-features-1"><a class="header" href="#advanced-features-1">Advanced Features</a></h2>
<h3 id="pattern-recording"><a class="header" href="#pattern-recording">Pattern Recording</a></h3>
<p>Record event sequences for analysis:</p>
<pre><code class="language-bash">midimonctl record-events --duration 30s --output session.json
</code></pre>
<p>Playback recorded events:</p>
<pre><code class="language-bash">midimonctl playback-events session.json
</code></pre>
<h3 id="event-filtering-rules"><a class="header" href="#event-filtering-rules">Event Filtering Rules</a></h3>
<p>Create custom filters in config:</p>
<pre><code class="language-toml">[event_console]
[[event_console.filters]]
name = "Only My Pads"
include_notes = [36, 37, 38, 39]
include_types = ["note", "processed"]

[[event_console.filters]]
name = "Errors Only"
include_types = ["error"]
min_severity = "warning"
</code></pre>
<p>Activate filter in GUI or CLI:</p>
<pre><code class="language-bash">midimonctl events --filter "Only My Pads"
</code></pre>
<h3 id="event-triggers"><a class="header" href="#event-triggers">Event Triggers</a></h3>
<p>Trigger actions based on events:</p>
<pre><code class="language-toml">[event_console.triggers]
[[event_console.triggers.rules]]
condition = "error_rate &gt; 5 per_minute"
action = { type = "Notification", message = "High error rate detected!" }

[[event_console.triggers.rules]]
condition = "note_36 pressed &gt; 10 times in 5s"
action = { type = "Notification", message = "Stop mashing that button!" }
</code></pre>
<h3 id="performance-profiling"><a class="header" href="#performance-profiling">Performance Profiling</a></h3>
<p>Enable detailed performance metrics:</p>
<pre><code class="language-toml">[event_console]
enable_profiling = true
track_latency = true
track_memory = true
</code></pre>
<p>View profiling data:</p>
<pre><code class="language-bash">midimonctl events --profiling
</code></pre>
<p>Output includes:</p>
<ul>
<li>Event processing time</li>
<li>Memory allocation</li>
<li>CPU usage per event</li>
<li>Bottleneck identification</li>
</ul>
<h2 id="troubleshooting-8"><a class="header" href="#troubleshooting-8">Troubleshooting</a></h2>
<h3 id="console-not-updating"><a class="header" href="#console-not-updating">Console Not Updating</a></h3>
<ol>
<li>Check daemon is running: <code>midimonctl status</code></li>
<li>Verify events are being generated (press pads)</li>
<li>Restart daemon: <code>midimonctl restart</code></li>
<li>Check event monitoring is active: <code>midimonctl is-event-monitoring-active</code></li>
</ol>
<h3 id="too-many-events"><a class="header" href="#too-many-events">Too Many Events</a></h3>
<p>Filter aggressively:</p>
<pre><code class="language-bash"># Only errors and warnings
midimonctl events --type error --type warning

# Debounce rapid events
midimonctl events --debounce 100ms
</code></pre>
<p>Or reduce update rate in config:</p>
<pre><code class="language-toml">[event_console]
max_events_per_second = 30
</code></pre>
<h3 id="missing-events"><a class="header" href="#missing-events">Missing Events</a></h3>
<ol>
<li>
<p>Check buffer size isn't full:</p>
<pre><code class="language-toml">[event_console]
buffer_size = 10000  # Increase if needed
</code></pre>
</li>
<li>
<p>Verify event types are enabled:</p>
<pre><code class="language-toml">[event_console]
capture_midi = true
capture_processed = true
capture_actions = true
</code></pre>
</li>
<li>
<p>Check log level:</p>
<pre><code class="language-bash">DEBUG=1 midimonctl events
</code></pre>
</li>
</ol>
<h2 id="best-practices-3"><a class="header" href="#best-practices-3">Best Practices</a></h2>
<ol>
<li><strong>Start with full view</strong>: See all event types initially</li>
<li><strong>Filter progressively</strong>: Add filters as you narrow down issues</li>
<li><strong>Use follow mode</strong>: <code>-f</code> flag for live monitoring</li>
<li><strong>Export for analysis</strong>: Save interesting sessions</li>
<li><strong>Watch timing</strong>: Event timing reveals latency issues</li>
<li><strong>Compare configs</strong>: Record events, change config, compare results</li>
<li><strong>Document discoveries</strong>: Note note numbers and velocities for future reference</li>
</ol>
<h2 id="integration-with-other-tools"><a class="header" href="#integration-with-other-tools">Integration with Other Tools</a></h2>
<h3 id="export-to-csv-for-analysis"><a class="header" href="#export-to-csv-for-analysis">Export to CSV for Analysis</a></h3>
<pre><code class="language-bash">midimonctl events --output events.csv --duration 60s
</code></pre>
<p>Analyze in Excel/Google Sheets:</p>
<ul>
<li>Event frequency</li>
<li>Velocity distribution</li>
<li>Timing patterns</li>
</ul>
<h3 id="send-to-external-monitoring"><a class="header" href="#send-to-external-monitoring">Send to External Monitoring</a></h3>
<pre><code class="language-bash"># Stream events to external tool
midimonctl events --format json | jq '.' | your-monitoring-tool
</code></pre>
<h3 id="log-to-file"><a class="header" href="#log-to-file">Log to File</a></h3>
<pre><code class="language-bash"># Continuous logging
midimonctl events -f &gt;&gt; midimon-events.log
</code></pre>
<h2 id="next-steps-10"><a class="header" href="#next-steps-10">Next Steps</a></h2>
<ul>
<li>Use console to build mappings with <a href="guides/../getting-started/midi-learn.html">MIDI Learn</a></li>
<li>Debug complex triggers in <a href="guides/./gui.html#mapping-configuration">mapping configuration</a></li>
<li>Monitor <a href="guides/./led-system.html">LED feedback</a> in real-time</li>
<li>Analyze <a href="guides/./per-app-profiles.html">per-app profile</a> switching behavior</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="customizing-velocity-response"><a class="header" href="#customizing-velocity-response">Customizing Velocity Response</a></h1>
<p>Learn how to control the relationship between how hard you hit a pad and what action is triggered using velocity mappings.</p>
<hr />
<h2 id="overview-7"><a class="header" href="#overview-7">Overview</a></h2>
<p>Velocity mappings allow you to transform the input velocity (how hard you press a pad) into a different output velocity. This is useful for:</p>
<ul>
<li><strong>Normalizing velocity</strong>: Make soft and hard hits more consistent</li>
<li><strong>Amplifying dynamics</strong>: Make subtle differences more pronounced</li>
<li><strong>Creating custom response curves</strong>: Match your playing style</li>
</ul>
<hr />
<h2 id="velocity-mapping-types"><a class="header" href="#velocity-mapping-types">Velocity Mapping Types</a></h2>
<p>MIDIMon supports four velocity mapping types:</p>
<h3 id="1-fixed"><a class="header" href="#1-fixed">1. Fixed</a></h3>
<p><strong>Output is always the same velocity, regardless of input</strong></p>
<pre><code class="language-toml">[velocity_mapping]
type = "Fixed"
velocity = 100  # Always outputs velocity 100 (0-127)
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Trigger actions that don't need velocity variation</li>
<li>Ensure consistent behavior regardless of how hard you hit</li>
<li>Simplify testing and debugging</li>
</ul>
<p><strong>Example</strong>: Launch an application with a single tap (any velocity)</p>
<hr />
<h3 id="2-passthrough"><a class="header" href="#2-passthrough">2. PassThrough</a></h3>
<p><strong>Output velocity = input velocity (1:1 mapping)</strong></p>
<pre><code class="language-toml">velocity_mapping = "PassThrough"
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Natural, unmodified velocity response</li>
<li>When you want direct MIDI pass-through</li>
<li>Default behavior when no mapping specified</li>
</ul>
<p><strong>Example</strong>: Control DAW volume with natural dynamics</p>
<hr />
<h3 id="3-linear"><a class="header" href="#3-linear">3. Linear</a></h3>
<p><strong>Maps full input range (0-127) to custom output range</strong></p>
<pre><code class="language-toml">[velocity_mapping]
type = "Linear"
min = 40   # Minimum output velocity
max = 110  # Maximum output velocity
</code></pre>
<p><strong>Behavior</strong>:</p>
<ul>
<li>Input 0 ‚Üí Output <code>min</code></li>
<li>Input 127 ‚Üí Output <code>max</code></li>
<li>Values between are scaled proportionally</li>
</ul>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Compress dynamic range (e.g., 0-127 ‚Üí 60-100)</li>
<li>Expand subtle playing into wider range (e.g., 0-127 ‚Üí 20-127)</li>
<li>Shift velocity range up or down</li>
</ul>
<p><strong>Example</strong>: Make soft hits louder while preventing excessively loud hits</p>
<pre><code class="language-toml">min = 50   # Softest hit = 50 (instead of 0)
max = 110  # Hardest hit = 110 (instead of 127)
</code></pre>
<hr />
<h3 id="4-curve"><a class="header" href="#4-curve">4. Curve</a></h3>
<p><strong>Applies non-linear transformation with adjustable intensity</strong></p>
<pre><code class="language-toml">[velocity_mapping]
type = "Curve"
curve_type = "Exponential"  # or "Logarithmic" or "SCurve"
intensity = 0.7             # 0.0 = linear, 1.0 = maximum effect
</code></pre>
<h4 id="curve-types"><a class="header" href="#curve-types">Curve Types</a></h4>
<p><strong>Exponential</strong> (<code>output = input^(1-intensity)</code>):</p>
<ul>
<li>Makes soft hits louder while preserving hard hits</li>
<li>Higher intensity = more compression of soft notes</li>
<li>Great for making subtle playing more audible</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">curve_type = "Exponential"
intensity = 0.8  # Boost soft hits significantly
</code></pre>
<p><strong>Logarithmic</strong> (<code>output = log(1 + intensity √ó input)</code>):</p>
<ul>
<li>Compresses dynamic range</li>
<li>Makes loud hits quieter relative to soft hits</li>
<li>Useful for taming aggressive playing</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">curve_type = "Logarithmic"
intensity = 0.6  # Moderate compression
</code></pre>
<p><strong>S-Curve</strong> (Sigmoid function):</p>
<ul>
<li>Smooth acceleration in middle range</li>
<li>Soft and hard extremes less affected</li>
<li>Natural-feeling response with "sweet spot"</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">curve_type = "SCurve"
intensity = 0.5  # Balanced S-curve
</code></pre>
<hr />
<h2 id="gui-configuration-2"><a class="header" href="#gui-configuration-2">GUI Configuration</a></h2>
<p>The GUI provides a visual velocity curve editor with real-time preview:</p>
<ol>
<li><strong>Open a mapping</strong> in the Mappings view</li>
<li><strong>Locate Velocity Mapping section</strong></li>
<li><strong>Select mapping type</strong> from dropdown:
<ul>
<li>Fixed</li>
<li>Pass-Through</li>
<li>Linear</li>
<li>Curve</li>
</ul>
</li>
<li><strong>Adjust parameters</strong>:
<ul>
<li>Fixed: Set velocity (0-127)</li>
<li>Linear: Set min/max range</li>
<li>Curve: Choose curve type and intensity (0.0-1.0)</li>
</ul>
</li>
<li><strong>Preview curve</strong> in the graph:
<ul>
<li>X-axis: Input velocity (0-127)</li>
<li>Y-axis: Output velocity (0-127)</li>
<li>Diagonal line: 1:1 reference (Pass-Through)</li>
<li>Colored line: Your configured curve</li>
</ul>
</li>
</ol>
<p>The preview updates in real-time as you adjust parameters, allowing you to dial in the perfect response.</p>
<hr />
<h2 id="practical-examples"><a class="header" href="#practical-examples">Practical Examples</a></h2>
<h3 id="example-1-consistent-application-launch"><a class="header" href="#example-1-consistent-application-launch">Example 1: Consistent Application Launch</a></h3>
<p>Make any tap launch an app, regardless of velocity:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Launch browser (any velocity)"

[modes.mappings.trigger]
type = "Note"
note = 5

[modes.mappings.velocity_mapping]
type = "Fixed"
velocity = 100  # Doesn't matter for Launch action

[modes.mappings.action]
type = "Launch"
app = "Safari"
</code></pre>
<hr />
<h3 id="example-2-gentle-volume-control"><a class="header" href="#example-2-gentle-volume-control">Example 2: Gentle Volume Control</a></h3>
<p>Compress volume adjustments for smoother control:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Gentle volume up"

[modes.mappings.trigger]
type = "Note"
note = 10

[modes.mappings.velocity_mapping]
type = "Linear"
min = 60   # Even softest tap has impact
max = 100  # Prevent ear-splitting jumps

[modes.mappings.action]
type = "VolumeControl"
operation = "Up"
</code></pre>
<hr />
<h3 id="example-3-expressive-midi-control"><a class="header" href="#example-3-expressive-midi-control">Example 3: Expressive MIDI Control</a></h3>
<p>Boost soft playing for more expressive DAW control:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Expressive note trigger"

[modes.mappings.trigger]
type = "Note"
note = 1

[modes.mappings.velocity_mapping]
type = "Curve"
curve_type = "Exponential"
intensity = 0.7  # Make soft notes more audible

[modes.mappings.action]
type = "SendMidi"
port = "Virtual MIDI Port"
message_type = "NoteOn"
channel = 0
note = 60
# Velocity is passed from the mapped input velocity
</code></pre>
<hr />
<h3 id="example-4-s-curve-for-natural-feel"><a class="header" href="#example-4-s-curve-for-natural-feel">Example 4: S-Curve for Natural Feel</a></h3>
<p>Create a responsive curve with smooth acceleration:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Natural dynamics"

[modes.mappings.trigger]
type = "Note"
note = 3

[modes.mappings.velocity_mapping]
type = "Curve"
curve_type = "SCurve"
intensity = 0.5  # Balanced response

[modes.mappings.action]
type = "SendMidi"
port = "IAC Driver Bus 1"
message_type = "CC"
channel = 0
controller = 7  # Volume CC
# CC value derived from mapped velocity
</code></pre>
<hr />
<h2 id="tips--best-practices-2"><a class="header" href="#tips--best-practices-2">Tips &amp; Best Practices</a></h2>
<h3 id="finding-your-curve"><a class="header" href="#finding-your-curve">Finding Your Curve</a></h3>
<ol>
<li><strong>Start with PassThrough</strong> and test your natural playing</li>
<li><strong>Identify issues</strong>:
<ul>
<li>Soft hits not registering? ‚Üí Try Exponential curve</li>
<li>Too much variation? ‚Üí Try Linear compression</li>
<li>Need smoothing? ‚Üí Try S-Curve</li>
</ul>
</li>
<li><strong>Adjust intensity gradually</strong> (0.3 ‚Üí 0.5 ‚Üí 0.7)</li>
<li><strong>Use the preview graph</strong> to visualize the transformation</li>
</ol>
<h3 id="per-action-tuning"><a class="header" href="#per-action-tuning">Per-Action Tuning</a></h3>
<p>Different actions may need different curves:</p>
<ul>
<li><strong>Launch/Shell</strong>: Fixed (velocity doesn't matter)</li>
<li><strong>Volume Control</strong>: Linear compression (0-127 ‚Üí 60-100)</li>
<li><strong>MIDI Output</strong>: Curve (Exponential for expression, Logarithmic for drums)</li>
<li><strong>Keystroke</strong>: Usually PassThrough or Fixed</li>
</ul>
<h3 id="testing"><a class="header" href="#testing">Testing</a></h3>
<p>After configuring a velocity mapping:</p>
<ol>
<li><strong>Save your config</strong> (hot-reload applies changes)</li>
<li><strong>Test range</strong>: Hit the pad softly, medium, hard</li>
<li><strong>Check preview graph</strong>: Does curve match your intent?</li>
<li><strong>Iterate</strong>: Adjust intensity or type as needed</li>
</ol>
<hr />
<h2 id="advanced-velocity-sensitive-actions"><a class="header" href="#advanced-velocity-sensitive-actions">Advanced: Velocity-Sensitive Actions</a></h2>
<p>Combine velocity mappings with velocity-sensitive triggers:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Soft hit = text, hard hit = keystroke"

[modes.mappings.trigger]
type = "VelocityRange"
note = 7
soft_max = 40
medium_max = 80

[modes.mappings.velocity_mapping]
type = "Curve"
curve_type = "Exponential"
intensity = 0.6  # Emphasize differences

[modes.mappings.action]
type = "VelocityRange"
soft_action = { type = "Text", text = "Hello" }
medium_action = { type = "Keystroke", keys = "space", modifiers = [] }
hard_action = { type = "Launch", app = "Terminal" }
</code></pre>
<p>The velocity mapping transforms the input before the VelocityRange thresholds are applied.</p>
<hr />
<h2 id="mathematical-details"><a class="header" href="#mathematical-details">Mathematical Details</a></h2>
<p>For those interested in the underlying transformations:</p>
<p><strong>Exponential</strong>:</p>
<pre><code>output = input^(1 - intensity)
</code></pre>
<ul>
<li><code>intensity = 0</code> ‚Üí linear (no change)</li>
<li><code>intensity = 1</code> ‚Üí maximum compression (all inputs ‚Üí 127)</li>
</ul>
<p><strong>Logarithmic</strong>:</p>
<pre><code>normalized_input = input / 127
output = log(1 + intensity √ó normalized_input) / log(1 + intensity) √ó 127
</code></pre>
<ul>
<li><code>intensity = 0</code> ‚Üí linear</li>
<li><code>intensity = 1</code> ‚Üí maximum compression</li>
</ul>
<p><strong>S-Curve</strong> (Sigmoid):</p>
<pre><code>normalized_input = input / 127
k = intensity √ó 10 + 0.5  # Steepness factor
sigmoid = 1 / (1 + e^(-k √ó (normalized_input - 0.5)))
output = normalize(sigmoid) √ó 127
</code></pre>
<ul>
<li>Lower <code>intensity</code> ‚Üí gentler curve</li>
<li>Higher <code>intensity</code> ‚Üí sharper transition in midrange</li>
</ul>
<hr />
<h2 id="related-documentation"><a class="header" href="#related-documentation">Related Documentation</a></h2>
<ul>
<li><a href="guides/../configuration/curves.html">Configuration: Velocity Mappings</a> - Complete TOML reference</li>
<li><a href="guides/context-aware.html">Context-Aware Mappings</a> - Combine with conditionals</li>
<li><a href="guides/../configuration/actions.html">Configuration: Actions</a> - Action types reference</li>
<li><a href="guides/per-app-profiles.html">Guides: Per-App Profiles</a> - Different curves per application</li>
</ul>
<hr />
<p><strong>Next</strong>: Learn about <a href="guides/context-aware.html">Context-Aware Mappings</a> to make your velocity curves change based on time, app, or mode.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="context-aware-mappings"><a class="header" href="#context-aware-mappings">Context-Aware Mappings</a></h1>
<p>Make your MIDI controller adapt to your workflow by executing different actions based on time, active application, current mode, or day of week.</p>
<hr />
<h2 id="overview-8"><a class="header" href="#overview-8">Overview</a></h2>
<p>Context-aware mappings use <strong>conditional actions</strong> to change behavior dynamically. Instead of always doing the same thing, your controller can:</p>
<ul>
<li>Switch profiles based on work hours vs evening</li>
<li>Route commands to the frontmost application</li>
<li>Execute different actions on weekdays vs weekends</li>
<li>Adapt to the current mode</li>
</ul>
<p>This eliminates the need to manually switch profiles throughout the day.</p>
<hr />
<h2 id="basic-conditional-structure"><a class="header" href="#basic-conditional-structure">Basic Conditional Structure</a></h2>
<pre><code class="language-toml">[[modes.mappings]]
description = "Context-aware action"

[modes.mappings.trigger]
type = "Note"
note = 5

[modes.mappings.action]
type = "Conditional"
condition = { /* condition goes here */ }
then_action = { /* action if condition is true */ }
else_action = { /* optional action if condition is false */ }
</code></pre>
<hr />
<h2 id="condition-types"><a class="header" href="#condition-types">Condition Types</a></h2>
<h3 id="1-always"><a class="header" href="#1-always">1. Always</a></h3>
<p><strong>Always executes the then_action</strong></p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"
condition = "Always"
then_action = { type = "Keystroke", keys = "space", modifiers = [] }
</code></pre>
<p><strong>Use Case</strong>: Testing, default behavior, or when you just want the <code>then_action</code> wrapper.</p>
<hr />
<h3 id="2-never"><a class="header" href="#2-never">2. Never</a></h3>
<p><strong>Never executes the then_action (effectively disables the mapping)</strong></p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"
condition = "Never"
then_action = { type = "Launch", app = "Disabled App" }
</code></pre>
<p><strong>Use Case</strong>: Temporarily disable a mapping without deleting it.</p>
<hr />
<h3 id="3-timerange"><a class="header" href="#3-timerange">3. TimeRange</a></h3>
<p><strong>Executes only during specific hours (24-hour format)</strong></p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "TimeRange"
start = "09:00"
end = "17:00"

[modes.mappings.action.then_action]
type = "Launch"
app = "Slack"

[modes.mappings.action.else_action]
type = "Text"
text = "Outside work hours"
</code></pre>
<p><strong>Features</strong>:</p>
<ul>
<li>Automatically handles ranges crossing midnight (e.g., <code>22:00</code> to <code>06:00</code>)</li>
<li>Time is checked when action is triggered (not when config is loaded)</li>
</ul>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Work mode (9am-5pm): Launch productivity apps</li>
<li>Evening mode (5pm-11pm): Launch entertainment apps</li>
<li>Night mode (11pm-9am): Disable noisy actions</li>
</ul>
<hr />
<h3 id="4-dayofweek"><a class="header" href="#4-dayofweek">4. DayOfWeek</a></h3>
<p><strong>Executes only on specific days</strong></p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "DayOfWeek"
days = [1, 2, 3, 4, 5]  # Monday=1 through Sunday=7

[modes.mappings.action.then_action]
type = "Shell"
command = "open ~/Work"

[modes.mappings.action.else_action]
type = "Shell"
command = "open ~/Personal"
</code></pre>
<p><strong>Day Numbers</strong>:</p>
<ul>
<li>1 = Monday</li>
<li>2 = Tuesday</li>
<li>3 = Wednesday</li>
<li>4 = Thursday</li>
<li>5 = Friday</li>
<li>6 = Saturday</li>
<li>7 = Sunday</li>
</ul>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Weekday-only shortcuts (work apps)</li>
<li>Weekend-only shortcuts (gaming, hobbies)</li>
<li>Different behaviors for different days</li>
</ul>
<hr />
<h3 id="5-apprunning"><a class="header" href="#5-apprunning">5. AppRunning</a></h3>
<p><strong>Checks if a specific application is currently running</strong></p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "AppRunning"
app_name = "Logic Pro"

[modes.mappings.action.then_action]
type = "Keystroke"
keys = "space"
modifiers = []  # Play/pause in Logic

[modes.mappings.action.else_action]
type = "Launch"
app = "Logic Pro"
</code></pre>
<p><strong>Platform Support</strong>:</p>
<ul>
<li>‚úÖ macOS: Uses <code>pgrep</code> (case-insensitive)</li>
<li>‚úÖ Linux: Uses <code>pgrep</code> (case-insensitive)</li>
<li>‚ùå Windows: Not yet supported</li>
</ul>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Smart play/pause (launch DAW if not running, play/pause if running)</li>
<li>Toggle between apps (if browser running, open it; else launch IDE)</li>
<li>Conditional workflows based on running processes</li>
</ul>
<p><strong>Note</strong>: Uses partial string matching. <code>"Chrome"</code> matches <code>"Google Chrome Helper"</code>.</p>
<hr />
<h3 id="6-appfrontmost"><a class="header" href="#6-appfrontmost">6. AppFrontmost</a></h3>
<p><strong>Checks if a specific application has focus (active window)</strong></p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "AppFrontmost"
app_name = "Safari"

[modes.mappings.action.then_action]
type = "Keystroke"
keys = "t"
modifiers = ["cmd"]  # New tab in Safari

[modes.mappings.action.else_action]
type = "Text"
text = "Not in Safari"
</code></pre>
<p><strong>Platform Support</strong>:</p>
<ul>
<li>‚úÖ macOS: Uses NSWorkspace API</li>
<li>‚ùå Linux: Not yet supported</li>
<li>‚ùå Windows: Not yet supported</li>
</ul>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>App-specific shortcuts (browser shortcuts vs IDE shortcuts)</li>
<li>Context-switching workflows</li>
<li>Smart key remapping based on frontmost app</li>
</ul>
<p><strong>Note</strong>: Checks the actual frontmost application, not just if it's running.</p>
<hr />
<h3 id="7-modeis"><a class="header" href="#7-modeis">7. ModeIs</a></h3>
<p><strong>Checks if the current mode matches</strong></p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "ModeIs"
mode = "Development"

[modes.mappings.action.then_action]
type = "Shell"
command = "git status"

[modes.mappings.action.else_action]
type = "Text"
text = "Switch to Development mode first"
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Mode-specific behaviors within global mappings</li>
<li>Validate mode before executing sensitive commands</li>
<li>Different actions for different modes on same pad</li>
</ul>
<p><strong>Note</strong>: Mode name must match exactly (case-sensitive).</p>
<hr />
<h3 id="8-and-logical-and"><a class="header" href="#8-and-logical-and">8. And (Logical AND)</a></h3>
<p><strong>All sub-conditions must be true</strong></p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "And"
conditions = [
  { type = "TimeRange", start = "09:00", end = "17:00" },
  { type = "DayOfWeek", days = [1, 2, 3, 4, 5] },
  { type = "AppRunning", app_name = "Slack" }
]

[modes.mappings.action.then_action]
type = "Keystroke"
keys = "s"
modifiers = ["cmd", "shift"]  # Search in Slack during work hours on weekdays
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Work mode: weekdays AND business hours AND specific app</li>
<li>Complex conditions requiring multiple criteria</li>
</ul>
<hr />
<h3 id="9-or-logical-or"><a class="header" href="#9-or-logical-or">9. Or (Logical OR)</a></h3>
<p><strong>At least one sub-condition must be true</strong></p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "Or"
conditions = [
  { type = "AppFrontmost", app_name = "Safari" },
  { type = "AppFrontmost", app_name = "Chrome" },
  { type = "AppFrontmost", app_name = "Firefox" }
]

[modes.mappings.action.then_action]
type = "Keystroke"
keys = "t"
modifiers = ["cmd"]  # New tab in any browser
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Action applies to multiple apps</li>
<li>Alternative conditions (weekend OR evening)</li>
</ul>
<hr />
<h3 id="10-not-logical-not"><a class="header" href="#10-not-logical-not">10. Not (Logical NOT)</a></h3>
<p><strong>Inverts the result of a condition</strong></p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "Not"
condition = { type = "AppRunning", app_name = "Music" }

[modes.mappings.action.then_action]
type = "Launch"
app = "Music"

[modes.mappings.action.else_action]
type = "Text"
text = "Music already running"
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>"If NOT running, launch"</li>
<li>"If NOT work hours, disable"</li>
<li>Invert any condition logic</li>
</ul>
<hr />
<h2 id="gui-configuration-3"><a class="header" href="#gui-configuration-3">GUI Configuration</a></h2>
<p>The Conditional Action Editor in the GUI provides:</p>
<ol>
<li><strong>Condition Type Selector</strong>: Dropdown with descriptions</li>
<li><strong>Time Pickers</strong>: Visual time selection for TimeRange</li>
<li><strong>Day Toggles</strong>: Click days for DayOfWeek conditions</li>
<li><strong>Text Inputs</strong>: For app names (AppRunning, AppFrontmost)</li>
<li><strong>Mode Dropdown</strong>: Auto-populated from available modes (ModeIs)</li>
<li><strong>Logical Operators</strong>: Add/remove sub-conditions for And/Or
<ul>
<li>Simple (non-nested) And/Or/Not supported</li>
<li>Complex nested logic requires TOML editing</li>
</ul>
</li>
<li><strong>Then/Else Actions</strong>: Full ActionSelector for both branches</li>
<li><strong>Optional Else</strong>: Toggle to add/remove else_action</li>
</ol>
<p><strong>To Configure</strong>:</p>
<ol>
<li>Select action type = "Conditional"</li>
<li>Choose condition type</li>
<li>Fill in condition parameters</li>
<li>Configure then_action</li>
<li>(Optional) Enable else_action and configure</li>
<li>Save</li>
</ol>
<hr />
<h2 id="practical-examples-1"><a class="header" href="#practical-examples-1">Practical Examples</a></h2>
<h3 id="example-1-work-hours-profile"><a class="header" href="#example-1-work-hours-profile">Example 1: Work Hours Profile</a></h3>
<p>Different behavior during work hours vs personal time:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Smart launcher - Slack at work, Discord after hours"

[modes.mappings.trigger]
type = "Note"
note = 8

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "And"
conditions = [
  { type = "TimeRange", start = "09:00", end = "17:00" },
  { type = "DayOfWeek", days = [1, 2, 3, 4, 5] }
]

[modes.mappings.action.then_action]
type = "Launch"
app = "Slack"

[modes.mappings.action.else_action]
type = "Launch"
app = "Discord"
</code></pre>
<hr />
<h3 id="example-2-app-aware-playpause"><a class="header" href="#example-2-app-aware-playpause">Example 2: App-Aware Play/Pause</a></h3>
<p>Different shortcuts for different media apps:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Universal play/pause"

[modes.mappings.trigger]
type = "Note"
note = 1

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "Or"
conditions = [
  { type = "AppFrontmost", app_name = "Spotify" },
  { type = "AppFrontmost", app_name = "Music" }
]

[modes.mappings.action.then_action]
type = "Keystroke"
keys = "space"
modifiers = []

[modes.mappings.action.else_action]
type = "Conditional"
condition = { type = "AppFrontmost", app_name = "Logic Pro" }
then_action = { type = "Keystroke", keys = "Return", modifiers = [] }
else_action = { type = "VolumeControl", operation = "Mute" }
</code></pre>
<p>Nested conditionals: Spotify/Music ‚Üí space, Logic ‚Üí Return, else ‚Üí Mute</p>
<hr />
<h3 id="example-3-weekend-gaming-mode"><a class="header" href="#example-3-weekend-gaming-mode">Example 3: Weekend Gaming Mode</a></h3>
<p>Enable gaming shortcuts only on weekends:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Discord overlay (weekends only)"

[modes.mappings.trigger]
type = "Note"
note = 15

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "DayOfWeek"
days = [6, 7]  # Saturday, Sunday

[modes.mappings.action.then_action]
type = "Keystroke"
keys = "`"
modifiers = ["shift", "cmd"]

# No else_action (does nothing on weekdays)
</code></pre>
<hr />
<h3 id="example-4-smart-daw-control"><a class="header" href="#example-4-smart-daw-control">Example 4: Smart DAW Control</a></h3>
<p>Launch DAW if not running, otherwise send MIDI:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Launch or control Logic Pro"

[modes.mappings.trigger]
type = "Note"
note = 5

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "AppRunning"
app_name = "Logic Pro"

[modes.mappings.action.then_action]
type = "SendMidi"
port = "IAC Driver Bus 1"
message_type = "NoteOn"
channel = 0
note = 60
velocity = 100

[modes.mappings.action.else_action]
type = "Launch"
app = "Logic Pro"
</code></pre>
<hr />
<h2 id="advanced-nested-conditions"><a class="header" href="#advanced-nested-conditions">Advanced: Nested Conditions</a></h2>
<p>Combine multiple logical operators for complex logic:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Complex work mode: (weekday AND work hours) OR (weekend AND app running)"

[modes.mappings.trigger]
type = "Note"
note = 10

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "Or"
conditions = [
  {
    type = "And"
    conditions = [
      { type = "DayOfWeek", days = [1, 2, 3, 4, 5] },
      { type = "TimeRange", start = "09:00", end = "17:00" }
    ]
  },
  {
    type = "And"
    conditions = [
      { type = "DayOfWeek", days = [6, 7] },
      { type = "AppRunning", app_name = "Xcode" }
    ]
  }
]

[modes.mappings.action.then_action]
type = "Shell"
command = "open ~/Code"
</code></pre>
<p><strong>Translation</strong>: Open code folder if:</p>
<ul>
<li>(Monday-Friday AND 9am-5pm) OR</li>
<li>(Saturday-Sunday AND Xcode is running)</li>
</ul>
<hr />
<h2 id="tips--best-practices-3"><a class="header" href="#tips--best-practices-3">Tips &amp; Best Practices</a></h2>
<h3 id="start-simple"><a class="header" href="#start-simple">Start Simple</a></h3>
<p>Begin with single conditions:</p>
<ol>
<li>Test TimeRange alone</li>
<li>Test AppRunning alone</li>
<li>Combine with And/Or once individual conditions work</li>
</ol>
<h3 id="use-descriptive-mappings"><a class="header" href="#use-descriptive-mappings">Use Descriptive Mappings</a></h3>
<pre><code class="language-toml">description = "Slack during work (Mon-Fri 9-5), Discord otherwise"
</code></pre>
<p>Clear descriptions help when debugging.</p>
<h3 id="test-edge-cases"><a class="header" href="#test-edge-cases">Test Edge Cases</a></h3>
<ul>
<li>Midnight crossing (TimeRange: 22:00 - 02:00)</li>
<li>Day transitions (Saturday ‚Üí Sunday at midnight)</li>
<li>App name variations ("Chrome" vs "Google Chrome")</li>
</ul>
<h3 id="combine-with-velocity-mappings"><a class="header" href="#combine-with-velocity-mappings">Combine with Velocity Mappings</a></h3>
<pre><code class="language-toml">[modes.mappings.velocity_mapping]
type = "Curve"
curve_type = "Exponential"
intensity = 0.7

[modes.mappings.action]
type = "Conditional"
# Velocity mapping applies before condition evaluation
</code></pre>
<h3 id="global-vs-mode-specific"><a class="header" href="#global-vs-mode-specific">Global vs Mode-Specific</a></h3>
<ul>
<li><strong>Global mappings</strong>: Use ModeIs condition to adapt to current mode</li>
<li><strong>Mode mappings</strong>: Already scoped to mode, use other conditions</li>
</ul>
<h3 id="performance-2"><a class="header" href="#performance-2">Performance</a></h3>
<p>Conditions are evaluated each time the trigger fires. Keep deeply nested conditions reasonable (&lt;5 levels deep).</p>
<hr />
<h2 id="troubleshooting-9"><a class="header" href="#troubleshooting-9">Troubleshooting</a></h2>
<h3 id="condition-never-true"><a class="header" href="#condition-never-true">Condition Never True</a></h3>
<p><strong>Problem</strong>: Action never executes</p>
<p><strong>Solutions</strong>:</p>
<ol>
<li>Check condition type matches intended logic</li>
<li>Verify app name matches process name (<code>ps aux | grep &lt;app&gt;</code>)</li>
<li>Test time format (must be <code>HH:MM</code>, 24-hour)</li>
<li>Check day numbers (Monday=1, not 0)</li>
<li>Add debug <code>else_action</code> to confirm condition is evaluating</li>
</ol>
<h3 id="wrong-action-executes"><a class="header" href="#wrong-action-executes">Wrong Action Executes</a></h3>
<p><strong>Problem</strong>: else_action runs instead of then_action</p>
<p><strong>Solutions</strong>:</p>
<ol>
<li>Verify condition logic (And vs Or)</li>
<li>Check app name capitalization (case-sensitive on some platforms)</li>
<li>Test each sub-condition individually</li>
<li>Add <code>type = "Text"</code> debug actions to see which path executes</li>
</ol>
<h3 id="appfrontmost-not-working"><a class="header" href="#appfrontmost-not-working">AppFrontmost Not Working</a></h3>
<p><strong>Problem</strong>: Condition always false</p>
<p><strong>Solutions</strong>:</p>
<ol>
<li>Verify platform support (macOS only currently)</li>
<li>Check app name matches bundle name (use Activity Monitor)</li>
<li>Try partial name ("Safari" instead of "com.apple.Safari")</li>
</ol>
<hr />
<h2 id="related-documentation-1"><a class="header" href="#related-documentation-1">Related Documentation</a></h2>
<ul>
<li><a href="guides/../configuration/conditionals.html">Configuration: Conditionals</a> - Complete TOML reference</li>
<li><a href="guides/../tutorials/dynamic-workflows.html">Tutorial: Dynamic Workflows</a> - Step-by-step guide</li>
<li><a href="guides/velocity-curves.html">Guides: Velocity Curves</a> - Combine with velocity mappings</li>
<li><a href="guides/../configuration/actions.html">Configuration: Actions</a> - Action types reference</li>
</ul>
<hr />
<p><strong>Next</strong>: Try the <a href="guides/../tutorials/dynamic-workflows.html">Dynamic Workflows Tutorial</a> for a hands-on example combining conditionals and velocity curves.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="daw-control-with-midimon"><a class="header" href="#daw-control-with-midimon">DAW Control with MIDIMon</a></h1>
<p>Control your Digital Audio Workstation (DAW) directly from your MIDI controller using MIDIMon's SendMIDI action. Transform your Maschine Mikro MK3 or other MIDI controller into a custom control surface for transport control, mixer automation, and parameter manipulation.</p>
<hr />
<h2 id="overview-9"><a class="header" href="#overview-9">Overview</a></h2>
<p>MIDIMon can send MIDI messages to your DAW, allowing you to:</p>
<ul>
<li><strong>Transport Control</strong>: Play, Stop, Record, Rewind, Fast Forward</li>
<li><strong>Mixer Control</strong>: Volume faders (CC 7), Pan controls (CC 10), Mute/Solo</li>
<li><strong>Parameter Automation</strong>: Plugin parameters, effect sends, EQ controls</li>
<li><strong>MIDI Learn</strong>: Map any pad to any DAW parameter using MIDI Learn</li>
<li><strong>Scene/Clip Triggering</strong>: Launch clips, scenes, or patterns in Live/Bitwig</li>
</ul>
<p>This enables you to create custom control surfaces tailored to your workflow, without needing hardware-specific DAW integration.</p>
<hr />
<h2 id="how-it-works-1"><a class="header" href="#how-it-works-1">How It Works</a></h2>
<pre><code>[Your MIDI Controller]
        ‚Üì (MIDI Input to MIDIMon)
  [MIDIMon Daemon]
        ‚Üì (SendMIDI Action)
  [Virtual MIDI Port] (IAC Driver, loopMIDI, ALSA)
        ‚Üì (MIDI from MIDIMon)
    [Your DAW] (Logic Pro, Ableton Live, etc.)
</code></pre>
<p><strong>Key Components</strong>:</p>
<ol>
<li><strong>Input</strong>: MIDIMon receives MIDI from your controller (pads, encoders, buttons)</li>
<li><strong>Mapping</strong>: MIDIMon maps input events to SendMIDI actions</li>
<li><strong>Output</strong>: SendMIDI sends MIDI messages to a virtual MIDI port</li>
<li><strong>DAW</strong>: Your DAW receives MIDI from the virtual port and responds</li>
</ol>
<hr />
<h2 id="platform-setup"><a class="header" href="#platform-setup">Platform Setup</a></h2>
<p>Before using SendMIDI, you need a virtual MIDI port that MIDIMon can send to and your DAW can receive from.</p>
<h3 id="macos-iac-driver"><a class="header" href="#macos-iac-driver">macOS: IAC Driver</a></h3>
<p>macOS includes a built-in virtual MIDI driver called IAC (Inter-Application Communication).</p>
<p><strong>Setup Steps</strong>:</p>
<ol>
<li>
<p>Open <strong>Audio MIDI Setup</strong> application</p>
<ul>
<li>Found in <code>/Applications/Utilities/Audio MIDI Setup.app</code></li>
<li>Or press <code>Cmd+Space</code> and search "Audio MIDI Setup"</li>
</ul>
</li>
<li>
<p>Show MIDI Studio</p>
<ul>
<li>Go to <code>Window</code> ‚Üí <code>Show MIDI Studio</code> (or press <code>Cmd+2</code>)</li>
</ul>
</li>
<li>
<p>Double-click <strong>IAC Driver</strong> icon</p>
<ul>
<li>If you don't see it, create it: <code>Window</code> ‚Üí <code>Show MIDI Studio</code> ‚Üí click the globe icon</li>
</ul>
</li>
<li>
<p>Enable the driver</p>
<ul>
<li>Check <strong>"Device is online"</strong> checkbox</li>
<li>You should see at least one port named "IAC Driver Bus 1"</li>
</ul>
</li>
<li>
<p>(Optional) Add more ports</p>
<ul>
<li>Click the <strong>+</strong> button under "Ports" to create additional buses</li>
<li>Rename buses to something meaningful (e.g., "MIDIMon ‚Üí Logic Pro")</li>
</ul>
</li>
<li>
<p>Click <strong>Apply</strong></p>
</li>
</ol>
<p><strong>Verify IAC Driver is Working</strong>:</p>
<pre><code class="language-bash"># List MIDI output ports (MIDIMon should see IAC Driver)
./target/release/midimon-daemon --list-midi-outputs

# You should see:
# MIDI Output Ports:
# 0: IAC Driver Bus 1
</code></pre>
<p><strong>Troubleshooting</strong>:</p>
<ul>
<li>If IAC Driver doesn't appear: Restart Audio MIDI Setup or reboot macOS</li>
<li>If port disappears after reboot: Make sure "Device is online" was checked and saved</li>
</ul>
<hr />
<h3 id="windows-loopmidi"><a class="header" href="#windows-loopmidi">Windows: loopMIDI</a></h3>
<p>Windows doesn't include built-in virtual MIDI ports, so we use <strong>loopMIDI</strong> (free, open-source).</p>
<p><strong>Download &amp; Install</strong>:</p>
<ol>
<li>Visit <a href="https://www.tobias-erichsen.de/software/loopmidi.html">Tobias Erichsen's loopMIDI page</a></li>
<li>Download the installer (free, no registration required)</li>
<li>Run the installer (requires Administrator privileges)</li>
<li>Launch <strong>loopMIDI</strong> from Start Menu</li>
</ol>
<p><strong>Create Virtual Port</strong>:</p>
<ol>
<li>In loopMIDI window, enter a port name (e.g., "MIDIMon Virtual Out")</li>
<li>Click <strong>+</strong> (Plus button) to create the port</li>
<li>The port should appear in the list with status "Opened by 0 applications"</li>
</ol>
<p><strong>Keep loopMIDI Running</strong>:</p>
<ul>
<li>loopMIDI must be running for the virtual port to exist</li>
<li>To auto-start with Windows: Right-click loopMIDI in system tray ‚Üí "Start minimized with Windows"</li>
</ul>
<p><strong>Verify loopMIDI Port</strong>:</p>
<pre><code class="language-powershell"># List MIDI output ports
.\target\release\midimon-daemon.exe --list-midi-outputs

# You should see:
# MIDI Output Ports:
# 0: MIDIMon Virtual Out
</code></pre>
<p><strong>Troubleshooting</strong>:</p>
<ul>
<li>Port not found: Make sure loopMIDI is running and port is created</li>
<li>Port opens but no MIDI received in DAW: Check DAW MIDI input preferences</li>
<li>loopMIDI crashes: Try creating port with simpler name (no special characters)</li>
</ul>
<hr />
<h3 id="linux-alsa-virtual-port"><a class="header" href="#linux-alsa-virtual-port">Linux: ALSA Virtual Port</a></h3>
<p>Linux supports virtual MIDI ports through <strong>ALSA</strong> (Advanced Linux Sound Architecture).</p>
<p><strong>Create Virtual Port with <code>aconnect</code></strong>:</p>
<pre><code class="language-bash"># Method 1: Using MIDIMon's built-in virtual port creation (recommended)
# MIDIMon can create virtual ports automatically on Linux via midir

# Method 2: Manual ALSA virtual port (if needed)
# Install ALSA utilities
sudo apt-get install alsa-utils

# Create a virtual port named "MIDIMon Output"
# This command creates a port that stays active
aseqdump -p "MIDIMon Output" &amp;

# List ALSA MIDI ports
aconnect -l

# You should see something like:
# client 128: 'MIDIMon Output' [type=user]
#     0 'MIDIMon Output'
</code></pre>
<p><strong>Using JACK for MIDI (Alternative)</strong>:</p>
<p>If you use JACK for audio:</p>
<pre><code class="language-bash"># Install JACK MIDI tools
sudo apt-get install qjackctl

# Start JACK
qjackctl &amp;

# In QjackCtl:
# - Go to "Graph" or "Patchbay"
# - Create MIDI connections between MIDIMon and your DAW
</code></pre>
<p><strong>Verify ALSA Port</strong>:</p>
<pre><code class="language-bash"># List MIDI output ports
./target/release/midimon-daemon --list-midi-outputs

# You should see your created virtual port
</code></pre>
<p><strong>Troubleshooting</strong>:</p>
<ul>
<li>No ALSA ports: <code>sudo modprobe snd-seq</code> (load ALSA sequencer module)</li>
<li>Permission denied: Add user to <code>audio</code> group: <code>sudo usermod -a -G audio $USER</code> (logout/login after)</li>
<li>JACK vs ALSA confusion: Choose one system (ALSA is simpler for most users)</li>
</ul>
<hr />
<h2 id="midimon-configuration"><a class="header" href="#midimon-configuration">MIDIMon Configuration</a></h2>
<h3 id="basic-sendmidi-example"><a class="header" href="#basic-sendmidi-example">Basic SendMIDI Example</a></h3>
<p>Here's a minimal configuration that sends a MIDI Note On message when you press pad 1:</p>
<pre><code class="language-toml"># config.toml

[[modes]]
name = "Default"

# Send MIDI Note On (C4 / note 60) when pad 1 is pressed
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 1  # Pad 1 on Maschine Mikro MK3

[modes.mappings.action]
type = "SendMIDI"
port = "IAC Driver Bus 1"  # macOS (use your port name)
# port = "MIDIMon Virtual Out"  # Windows (loopMIDI)
# port = "MIDIMon Output"  # Linux (ALSA)

[modes.mappings.action.message]
type = "NoteOn"
note = 60  # MIDI note 60 = C4 (Middle C)
velocity = 100
channel = 0  # MIDI channel 1 (0-indexed)
</code></pre>
<p><strong>Test This Configuration</strong>:</p>
<ol>
<li>Save the config above to your <code>config.toml</code></li>
<li>Restart MIDIMon daemon: <code>midimonctl reload</code></li>
<li>Open your DAW and create a software instrument track</li>
<li>Set the track's MIDI input to your virtual port (IAC Driver/loopMIDI)</li>
<li>Enable MIDI input recording on the track</li>
<li>Press pad 1 on your controller</li>
<li>You should hear the instrument play note C4!</li>
</ol>
<hr />
<h2 id="midi-message-types"><a class="header" href="#midi-message-types">MIDI Message Types</a></h2>
<p>MIDIMon supports all common MIDI message types. Here's a reference for each:</p>
<h3 id="1-note-on--note-off"><a class="header" href="#1-note-on--note-off">1. Note On / Note Off</a></h3>
<p>Trigger notes in software instruments.</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

# Note On: Start playing a note
[modes.mappings.action.message]
type = "NoteOn"
note = 60        # MIDI note number (0-127, 60 = C4)
velocity = 100   # How hard the note is played (0-127)
channel = 0      # MIDI channel (0-15, displays as 1-16 in DAWs)
</code></pre>
<pre><code class="language-toml"># Note Off: Stop playing a note
[modes.mappings.action.message]
type = "NoteOff"
note = 60        # Same note number as the Note On
velocity = 64    # Release velocity (usually 0 or 64)
channel = 0
</code></pre>
<p><strong>Common Note Numbers</strong>:</p>
<ul>
<li>C3 (48), C4 (60), C5 (72) - Middle octaves</li>
<li>A0 (21) - Lowest note on 88-key piano</li>
<li>C8 (108) - Highest note on 88-key piano</li>
</ul>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Trigger drum samples in drum racks</li>
<li>Play melodies on virtual instruments</li>
<li>Trigger clips in Ableton Live's Session View</li>
</ul>
<hr />
<h3 id="2-control-change-cc"><a class="header" href="#2-control-change-cc">2. Control Change (CC)</a></h3>
<p>Control parameters like volume, pan, filters, and effects.</p>
<pre><code class="language-toml">[modes.mappings.action.message]
type = "CC"
controller = 7   # Controller number (0-127)
value = 100      # Controller value (0-127)
channel = 0
</code></pre>
<p><strong>Common CC Numbers</strong>:</p>
<div class="table-wrapper"><table><thead><tr><th>CC#</th><th>Name</th><th>Purpose</th><th>Range</th></tr></thead><tbody>
<tr><td>1</td><td>Modulation Wheel</td><td>Vibrato, tremolo</td><td>0-127</td></tr>
<tr><td>7</td><td>Volume</td><td>Track/channel volume</td><td>0-127 (100=max)</td></tr>
<tr><td>10</td><td>Pan</td><td>Left/right panning</td><td>0=left, 64=center, 127=right</td></tr>
<tr><td>11</td><td>Expression</td><td>Volume changes within a note</td><td>0-127</td></tr>
<tr><td>64</td><td>Sustain Pedal</td><td>Hold notes</td><td>0-63=off, 64-127=on</td></tr>
<tr><td>71</td><td>Filter Resonance</td><td>Synth filter resonance</td><td>0-127</td></tr>
<tr><td>74</td><td>Filter Cutoff</td><td>Synth filter cutoff freq</td><td>0-127</td></tr>
</tbody></table>
</div>
<p><strong>Example: Volume Control</strong></p>
<pre><code class="language-toml"># Soft velocity = low volume (CC 7 = 40)
[[modes.mappings]]
[modes.mappings.trigger]
type = "VelocityRange"
note = 1
min_velocity = 0
max_velocity = 40

[modes.mappings.action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.message]
type = "CC"
controller = 7
value = 40
channel = 0
</code></pre>
<hr />
<h3 id="3-program-change"><a class="header" href="#3-program-change">3. Program Change</a></h3>
<p>Switch between presets/patches in instruments or effects.</p>
<pre><code class="language-toml">[modes.mappings.action.message]
type = "ProgramChange"
program = 42     # Program number (0-127)
channel = 0
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Switch guitar amp presets</li>
<li>Change synthesizer patches</li>
<li>Load different drum kits</li>
</ul>
<p><strong>Note</strong>: Program Change numbers are 0-indexed in MIDI (0-127) but often displayed as 1-128 in DAWs.</p>
<hr />
<h3 id="4-pitch-bend"><a class="header" href="#4-pitch-bend">4. Pitch Bend</a></h3>
<p>Bend notes up or down (like a pitch wheel).</p>
<pre><code class="language-toml">[modes.mappings.action.message]
type = "PitchBend"
value = 0        # Pitch bend value (-8192 to +8191)
                 # 0 = center (no bend)
                 # +8191 = max up
                 # -8192 = max down
channel = 0
</code></pre>
<p><strong>Examples</strong>:</p>
<pre><code class="language-toml"># Pitch up (full bend up)
value = 8191

# Center position (no bend)
value = 0

# Pitch down (full bend down)
value = -8192
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Guitar bends in virtual guitars</li>
<li>Synth lead pitch slides</li>
<li>Trombone-style glissando effects</li>
</ul>
<hr />
<h3 id="5-aftertouch-channel-pressure"><a class="header" href="#5-aftertouch-channel-pressure">5. Aftertouch (Channel Pressure)</a></h3>
<p>Apply pressure-based modulation to all notes on a channel.</p>
<pre><code class="language-toml">[modes.mappings.action.message]
type = "Aftertouch"
pressure = 64    # Pressure amount (0-127)
channel = 0
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Vibrato after note starts</li>
<li>Filter modulation with sustained notes</li>
<li>Expressive synth control</li>
</ul>
<p><strong>Note</strong>: This is <em>Channel Aftertouch</em> (affects all notes). MIDI also supports <em>Polyphonic Aftertouch</em> (per-note), but it's rarely used and not currently supported by SendMIDI.</p>
<hr />
<h2 id="common-use-cases"><a class="header" href="#common-use-cases">Common Use Cases</a></h2>
<h3 id="transport-control"><a class="header" href="#transport-control">Transport Control</a></h3>
<p>Control DAW playback using MIDI CC messages. Most DAWs support MMC (MIDI Machine Control) or specific CC numbers for transport.</p>
<p><strong>Logic Pro Transport</strong> (using CC messages):</p>
<pre><code class="language-toml"># Play/Pause (CC 115)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 1

[modes.mappings.action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.message]
type = "CC"
controller = 115  # Play/Continue
value = 127
channel = 0

# Stop (CC 116)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 2

[modes.mappings.action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.message]
type = "CC"
controller = 116  # Stop
value = 127
channel = 0

# Record (CC 117)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 3

[modes.mappings.action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.message]
type = "CC"
controller = 117  # Record
value = 127
channel = 0
</code></pre>
<p><strong>Ableton Live Transport</strong> (using Note messages):</p>
<p>Ableton responds to specific MIDI notes for transport in some modes:</p>
<pre><code class="language-toml"># Play (Note 91 on Channel 1)
[modes.mappings.action.message]
type = "NoteOn"
note = 91
velocity = 127
channel = 0

# Stop (Note 93)
[modes.mappings.action.message]
type = "NoteOn"
note = 93
velocity = 127
channel = 0
</code></pre>
<p><em>Note: Actual values depend on your DAW's MIDI remote script. Check your DAW's documentation or use MIDI Learn.</em></p>
<hr />
<h3 id="mixer-control-volume--pan"><a class="header" href="#mixer-control-volume--pan">Mixer Control (Volume &amp; Pan)</a></h3>
<p>Control track volume and panning using CC 7 (Volume) and CC 10 (Pan).</p>
<p><strong>Volume Fader with Velocity</strong>:</p>
<pre><code class="language-toml"># Map pad velocity to track volume
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 1

[modes.mappings.action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.message]
type = "CC"
controller = 7    # Volume
value = 100       # Will be overridden by velocity mapping
channel = 0       # Track 1

# Use velocity mapping to scale velocity to volume
[modes.mappings.action.velocity_mapping]
type = "Linear"
min = 0           # Soft hit = volume 0
max = 127         # Hard hit = volume 127
</code></pre>
<p><strong>Pan Control</strong>:</p>
<pre><code class="language-toml"># Encoder left/right = pan left/right
[[modes.mappings]]
[modes.mappings.trigger]
type = "EncoderTurn"
encoder = 1
direction = "Clockwise"

[modes.mappings.action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.message]
type = "CC"
controller = 10   # Pan
value = 127       # Full right
channel = 0
</code></pre>
<hr />
<h3 id="midi-learn-in-your-daw"><a class="header" href="#midi-learn-in-your-daw">MIDI Learn in Your DAW</a></h3>
<p>Most DAWs support <strong>MIDI Learn</strong> - a feature that lets you map any incoming MIDI message to any parameter by clicking the parameter and moving your controller.</p>
<p><strong>General MIDI Learn Workflow</strong>:</p>
<ol>
<li>
<p><strong>Configure MIDIMon</strong> to send a MIDI message when you press a pad:</p>
<pre><code class="language-toml">[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 1

[modes.mappings.action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.message]
type = "CC"
controller = 20  # Arbitrary CC number
value = 127
channel = 0
</code></pre>
</li>
<li>
<p><strong>In your DAW</strong>:</p>
<ul>
<li>Enable MIDI Learn mode (varies by DAW)</li>
<li>Click the parameter you want to control (e.g., filter cutoff)</li>
<li>Press your mapped pad</li>
<li>DAW learns the association (CC 20 ‚Üí filter cutoff)</li>
<li>Exit MIDI Learn mode</li>
</ul>
</li>
<li>
<p><strong>Test</strong>: Press the pad again - the parameter should move!</p>
</li>
</ol>
<p><strong>DAW-Specific MIDI Learn</strong>:</p>
<ul>
<li><strong>Logic Pro</strong>: <code>Cmd+L</code> ‚Üí Click parameter ‚Üí Move controller ‚Üí <code>Cmd+L</code> to exit</li>
<li><strong>Ableton Live</strong>: Click "MIDI" button in top right ‚Üí Click parameter ‚Üí Move controller ‚Üí Click "MIDI" again</li>
<li><strong>Reaper</strong>: Right-click parameter ‚Üí "Learn" ‚Üí Move controller</li>
<li><strong>FL Studio</strong>: Right-click parameter ‚Üí "Link to controller" ‚Üí Move controller</li>
</ul>
<hr />
<h2 id="combining-with-conditionals"><a class="header" href="#combining-with-conditionals">Combining with Conditionals</a></h2>
<p>Use Conditional actions to send different MIDI messages based on context (time, active app, mode).</p>
<p><strong>Example: Different Transport Controls for Different DAWs</strong></p>
<pre><code class="language-toml">[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 1

[modes.mappings.action]
type = "Conditional"

# If Logic Pro is frontmost, send CC 115 (Play)
[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.apple.logic10"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"
message = { type = "CC", controller = 115, value = 127, channel = 0 }

# Otherwise (Ableton), send Note 91
[modes.mappings.action.else_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"
message = { type = "NoteOn", note = 91, velocity = 127, channel = 0 }
</code></pre>
<hr />
<h2 id="troubleshooting-10"><a class="header" href="#troubleshooting-10">Troubleshooting</a></h2>
<h3 id="midi-messages-not-received-in-daw"><a class="header" href="#midi-messages-not-received-in-daw">MIDI Messages Not Received in DAW</a></h3>
<p><strong>Check MIDIMon is sending</strong>:</p>
<pre><code class="language-bash"># Enable debug logging
DEBUG=1 midimonctl reload

# Press your mapped pad
# You should see: "Sending MIDI: [0x90, 0x3C, 0x64] to port 'IAC Driver Bus 1'"
</code></pre>
<p><strong>Check DAW MIDI input settings</strong>:</p>
<ol>
<li>Open DAW preferences/settings</li>
<li>Go to MIDI Input settings</li>
<li>Ensure your virtual port is enabled:
<ul>
<li>Logic Pro: <code>Preferences</code> ‚Üí <code>MIDI</code> ‚Üí <code>Inputs</code> ‚Üí Enable "IAC Driver Bus 1"</li>
<li>Ableton Live: <code>Preferences</code> ‚Üí <code>Link/Tempo/MIDI</code> ‚Üí <code>MIDI Ports</code> ‚Üí Enable "Track" and "Remote" for IAC Driver</li>
<li>Reaper: <code>Preferences</code> ‚Üí <code>MIDI Devices</code> ‚Üí Enable input for virtual port</li>
</ul>
</li>
</ol>
<p><strong>Check track MIDI input</strong>:</p>
<ul>
<li>Make sure the track is set to receive MIDI from your virtual port</li>
<li>Enable "Input Monitoring" or "Record Enable" on the track</li>
</ul>
<hr />
<h3 id="high-latency--delayed-response"><a class="header" href="#high-latency--delayed-response">High Latency / Delayed Response</a></h3>
<p><strong>Symptoms</strong>: MIDI messages arrive 50-500ms late</p>
<p><strong>Causes</strong>:</p>
<ol>
<li>
<p><strong>DAW Buffer Size</strong>: Larger audio buffers = more latency</p>
<ul>
<li>Solution: Reduce buffer size in DAW audio preferences (e.g., 128 or 256 samples)</li>
</ul>
</li>
<li>
<p><strong>MIDI Port Polling</strong>: Some virtual MIDI implementations poll slowly</p>
<ul>
<li>Solution: Restart DAW and MIDIMon daemon</li>
</ul>
</li>
<li>
<p><strong>System Load</strong>: High CPU usage delays MIDI processing</p>
<ul>
<li>Solution: Close unnecessary applications</li>
</ul>
</li>
</ol>
<p><strong>Test Latency</strong>:</p>
<pre><code class="language-bash"># Send test Note On and measure response time in DAW
./target/release/midimonctl send-test-midi
</code></pre>
<hr />
<h3 id="port-not-found"><a class="header" href="#port-not-found">Port Not Found</a></h3>
<p><strong>Error</strong>: <code>Port 'IAC Driver Bus 1' is not connected</code></p>
<p><strong>Solutions</strong>:</p>
<ol>
<li>
<p><strong>List available ports</strong>:</p>
<pre><code class="language-bash">midimonctl list-midi-outputs
</code></pre>
</li>
<li>
<p><strong>Check port name matches exactly</strong> (case-sensitive):</p>
<pre><code class="language-toml"># Wrong:
port = "iac driver bus 1"

# Correct:
port = "IAC Driver Bus 1"
</code></pre>
</li>
<li>
<p><strong>macOS</strong>: Verify IAC Driver is online in Audio MIDI Setup</p>
</li>
<li>
<p><strong>Windows</strong>: Ensure loopMIDI is running and port is created</p>
</li>
<li>
<p><strong>Linux</strong>: Check ALSA port exists with <code>aconnect -l</code></p>
</li>
</ol>
<hr />
<h3 id="wrong-midi-channel"><a class="header" href="#wrong-midi-channel">Wrong MIDI Channel</a></h3>
<p><strong>Symptom</strong>: MIDI messages sent but DAW doesn't respond, or wrong track responds</p>
<p><strong>Solution</strong>: Check MIDI channel configuration</p>
<pre><code class="language-toml"># MIDI channels are 0-indexed in MIDIMon config (0-15)
# But displayed as 1-16 in DAWs

# Channel 0 in MIDIMon = Channel 1 in DAW
[modes.mappings.action.message]
channel = 0  # This is MIDI channel 1

# Channel 15 in MIDIMon = Channel 16 in DAW
channel = 15  # This is MIDI channel 16
</code></pre>
<p><strong>Check DAW track MIDI input channel</strong>:</p>
<ul>
<li>Set track to receive from "All Channels" or specific channel that matches your config</li>
</ul>
<hr />
<h2 id="best-practices-4"><a class="header" href="#best-practices-4">Best Practices</a></h2>
<h3 id="1-use-descriptive-port-names"><a class="header" href="#1-use-descriptive-port-names">1. Use Descriptive Port Names</a></h3>
<pre><code class="language-toml"># Instead of generic names:
port = "IAC Driver Bus 1"

# Use descriptive names (rename in Audio MIDI Setup):
port = "MIDIMon ‚Üí Logic Pro"
port = "MIDIMon ‚Üí Ableton"
</code></pre>
<h3 id="2-organize-mappings-by-function"><a class="header" href="#2-organize-mappings-by-function">2. Organize Mappings by Function</a></h3>
<p>Group related controls together in your config:</p>
<pre><code class="language-toml"># Transport Controls
[[modes.mappings]]
# ... Play mapping ...

[[modes.mappings]]
# ... Stop mapping ...

# Mixer Controls
[[modes.mappings]]
# ... Volume mapping ...

[[modes.mappings]]
# ... Pan mapping ...
</code></pre>
<h3 id="3-document-your-cc-assignments"><a class="header" href="#3-document-your-cc-assignments">3. Document Your CC Assignments</a></h3>
<pre><code class="language-toml"># CC 20-29: Filter controls
[[modes.mappings]]
[modes.mappings.action.message]
type = "CC"
controller = 20  # Filter Cutoff
value = 64
channel = 0

# CC 30-39: Effect sends
[[modes.mappings]]
[modes.mappings.action.message]
type = "CC"
controller = 30  # Reverb Send
value = 50
channel = 0
</code></pre>
<h3 id="4-use-velocity-mapping-for-expressive-control"><a class="header" href="#4-use-velocity-mapping-for-expressive-control">4. Use Velocity Mapping for Expressive Control</a></h3>
<pre><code class="language-toml"># Map pad velocity to filter cutoff for expressive control
[modes.mappings.action.velocity_mapping]
type = "Curve"
curve_type = "Exponential"
intensity = 0.5  # Gentle curve for nuanced control
</code></pre>
<h3 id="5-test-incrementally"><a class="header" href="#5-test-incrementally">5. Test Incrementally</a></h3>
<ul>
<li>Add one mapping at a time</li>
<li>Test each mapping before adding more</li>
<li>Use <code>DEBUG=1</code> to verify MIDI messages are sent correctly</li>
</ul>
<hr />
<h2 id="next-steps-11"><a class="header" href="#next-steps-11">Next Steps</a></h2>
<ul>
<li><strong>Platform-Specific Guides</strong>: See detailed examples for <a href="guides/../examples/logic-pro.html">Logic Pro</a> and <a href="guides/../examples/ableton-live.html">Ableton Live</a></li>
<li><strong>Advanced Patterns</strong>: Learn about <a href="guides/context-aware.html">context-aware mappings</a> with conditionals</li>
<li><strong>Velocity Control</strong>: Explore <a href="guides/velocity-curves.html">velocity curves</a> for expressive MIDI control</li>
<li><strong>Troubleshooting</strong>: Check <a href="guides/../troubleshooting/midi-output.html">MIDI Output Troubleshooting</a> for common issues</li>
</ul>
<hr />
<p><strong>Ready to control your DAW?</strong> Start with the basic transport control example above, then customize to your workflow!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tutorial-building-dynamic-workflows"><a class="header" href="#tutorial-building-dynamic-workflows">Tutorial: Building Dynamic Workflows</a></h1>
<p>Step-by-step guide to combining velocity curves and conditional actions for powerful context-aware MIDI controller mappings.</p>
<hr />
<h2 id="overview-10"><a class="header" href="#overview-10">Overview</a></h2>
<p>This tutorial will teach you to create sophisticated, context-aware workflows that adapt to:</p>
<ul>
<li>Time of day (work hours vs evening)</li>
<li>Active application (DAW vs browser vs IDE)</li>
<li>Day of week (weekdays vs weekends)</li>
<li>Current mode</li>
<li>How hard you hit the pad</li>
</ul>
<p>By the end, you'll build a complete workflow that transforms your MIDI controller into an intelligent assistant.</p>
<hr />
<h2 id="prerequisites-3"><a class="header" href="#prerequisites-3">Prerequisites</a></h2>
<ul>
<li>MIDIMon installed and configured</li>
<li>Basic TOML editing skills (or use the GUI)</li>
<li>A MIDI controller connected</li>
<li>Understanding of basic triggers and actions</li>
</ul>
<p><strong>Estimated Time</strong>: 30-45 minutes</p>
<hr />
<h2 id="tutorial-structure"><a class="header" href="#tutorial-structure">Tutorial Structure</a></h2>
<p>We'll build three progressively complex workflows:</p>
<ol>
<li><strong>Beginner</strong>: Time-based app launcher</li>
<li><strong>Intermediate</strong>: Velocity-sensitive DAW control</li>
<li><strong>Advanced</strong>: Multi-condition workflow with nested logic</li>
</ol>
<hr />
<h2 id="workflow-1-time-based-app-launcher-beginner"><a class="header" href="#workflow-1-time-based-app-launcher-beginner">Workflow 1: Time-Based App Launcher (Beginner)</a></h2>
<p><strong>Goal</strong>: Launch Slack during work hours, Discord after hours.</p>
<h3 id="step-1-create-the-basic-mapping"><a class="header" href="#step-1-create-the-basic-mapping">Step 1: Create the Basic Mapping</a></h3>
<p>Open your <code>config.toml</code> and add a new global mapping:</p>
<pre><code class="language-toml">[[global_mappings]]
description = "Smart communication launcher"

[global_mappings.trigger]
type = "Note"
note = 8  # Choose your pad number
</code></pre>
<h3 id="step-2-add-the-conditional-action"><a class="header" href="#step-2-add-the-conditional-action">Step 2: Add the Conditional Action</a></h3>
<p>Add the conditional logic:</p>
<pre><code class="language-toml">[global_mappings.action]
type = "Conditional"

[global_mappings.action.condition]
type = "And"
conditions = [
  { type = "TimeRange", start = "09:00", end = "17:00" },
  { type = "DayOfWeek", days = [1, 2, 3, 4, 5] }
]

[global_mappings.action.then_action]
type = "Launch"
app = "Slack"

[global_mappings.action.else_action]
type = "Launch"
app = "Discord"
</code></pre>
<h3 id="step-3-test-the-workflow"><a class="header" href="#step-3-test-the-workflow">Step 3: Test the Workflow</a></h3>
<ol>
<li>Save <code>config.toml</code></li>
<li>Config will hot-reload automatically</li>
<li>Press your configured pad during work hours (Mon-Fri 9am-5pm)</li>
<li>Verify Slack launches</li>
<li>Press the same pad outside work hours</li>
<li>Verify Discord launches</li>
</ol>
<h3 id="understanding-the-logic"><a class="header" href="#understanding-the-logic">Understanding the Logic</a></h3>
<pre><code>IF (time is 9am-5pm AND day is Monday-Friday):
  Launch Slack
ELSE:
  Launch Discord
</code></pre>
<h3 id="gui-configuration-4"><a class="header" href="#gui-configuration-4">GUI Configuration</a></h3>
<p>If using the GUI:</p>
<ol>
<li>Open Mappings view</li>
<li>Click "Add Mapping"</li>
<li>Set trigger to Note 8</li>
<li>Select action type "Conditional"</li>
<li>Select condition type "And"</li>
<li>Add two sub-conditions:
<ul>
<li>TimeRange: 09:00 to 17:00</li>
<li>DayOfWeek: Select Mon-Fri</li>
</ul>
</li>
<li>Configure then_action: Launch ‚Üí Slack</li>
<li>Configure else_action: Launch ‚Üí Discord</li>
<li>Save</li>
</ol>
<hr />
<h2 id="workflow-2-velocity-sensitive-daw-control-intermediate"><a class="header" href="#workflow-2-velocity-sensitive-daw-control-intermediate">Workflow 2: Velocity-Sensitive DAW Control (Intermediate)</a></h2>
<p><strong>Goal</strong>: Control Logic Pro with velocity-sensitive MIDI notes, boosting soft hits for expressive playing.</p>
<h3 id="step-1-create-the-mapping"><a class="header" href="#step-1-create-the-mapping">Step 1: Create the Mapping</a></h3>
<pre><code class="language-toml">[[modes.mappings]]
description = "Expressive MIDI control"

[modes.mappings.trigger]
type = "Note"
note = 1
</code></pre>
<h3 id="step-2-add-velocity-curve"><a class="header" href="#step-2-add-velocity-curve">Step 2: Add Velocity Curve</a></h3>
<p>Make soft hits more audible:</p>
<pre><code class="language-toml">[modes.mappings.velocity_mapping]
type = "Curve"
curve_type = "Exponential"
intensity = 0.7  # Strong boost for soft notes
</code></pre>
<h3 id="step-3-add-conditional-daw-control"><a class="header" href="#step-3-add-conditional-daw-control">Step 3: Add Conditional DAW Control</a></h3>
<p>Only send MIDI if Logic Pro is running:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "AppRunning"
app_name = "Logic Pro"

[modes.mappings.action.then_action]
type = "SendMidi"
port = "IAC Driver Bus 1"
message_type = "NoteOn"
channel = 0
note = 60  # Middle C
# Velocity is derived from mapped input velocity

[modes.mappings.action.else_action]
type = "Sequence"
actions = [
  { type = "Launch", app = "Logic Pro" },
  { type = "Delay", ms = 2000 },
  { type = "Text", text = "Logic Pro launched, try again" }
]
</code></pre>
<h3 id="step-4-test-the-workflow"><a class="header" href="#step-4-test-the-workflow">Step 4: Test the Workflow</a></h3>
<ol>
<li>
<p><strong>With Logic Pro closed</strong>:</p>
<ul>
<li>Press pad ‚Üí Logic Pro launches</li>
<li>Wait 2 seconds ‚Üí See notification</li>
</ul>
</li>
<li>
<p><strong>With Logic Pro running</strong>:</p>
<ul>
<li>Press pad softly ‚Üí Sends MIDI note with boosted velocity</li>
<li>Press pad hard ‚Üí Sends MIDI note at full velocity</li>
<li>Notice soft notes are more audible due to exponential curve</li>
</ul>
</li>
</ol>
<h3 id="understanding-the-flow"><a class="header" href="#understanding-the-flow">Understanding the Flow</a></h3>
<pre><code>Input Velocity ‚Üí Exponential Curve (boost soft hits) ‚Üí Mapped Velocity

IF Logic Pro is running:
  Send MIDI with mapped velocity to IAC Driver
ELSE:
  Launch Logic Pro
  Wait 2 seconds
  Show notification
</code></pre>
<h3 id="velocity-curve-effect"><a class="header" href="#velocity-curve-effect">Velocity Curve Effect</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Input Velocity</th><th>Without Curve</th><th>With Exponential (0.7)</th></tr></thead><tbody>
<tr><td>20 (very soft)</td><td>20</td><td>~65 (much louder)</td></tr>
<tr><td>64 (medium)</td><td>64</td><td>~85 (slightly louder)</td></tr>
<tr><td>100 (hard)</td><td>100</td><td>~110 (barely affected)</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="workflow-3-multi-condition-smart-assistant-advanced"><a class="header" href="#workflow-3-multi-condition-smart-assistant-advanced">Workflow 3: Multi-Condition Smart Assistant (Advanced)</a></h2>
<p><strong>Goal</strong>: Create a single pad that adapts to time, app, and velocity for different actions.</p>
<h3 id="the-scenario"><a class="header" href="#the-scenario">The Scenario</a></h3>
<p>We want pad 10 to:</p>
<ul>
<li><strong>Work hours + Browser</strong>: Open new tab (velocity doesn't matter)</li>
<li><strong>Work hours + DAW</strong>: Send velocity-sensitive MIDI</li>
<li><strong>Evening + Any app</strong>: Launch entertainment app based on velocity
<ul>
<li>Soft hit: Launch Spotify</li>
<li>Hard hit: Launch Steam</li>
</ul>
</li>
</ul>
<h3 id="step-1-create-the-foundation"><a class="header" href="#step-1-create-the-foundation">Step 1: Create the Foundation</a></h3>
<pre><code class="language-toml">[[global_mappings]]
description = "Adaptive smart pad"

[global_mappings.trigger]
type = "Note"
note = 10
</code></pre>
<h3 id="step-2-configure-velocity-mapping"><a class="header" href="#step-2-configure-velocity-mapping">Step 2: Configure Velocity Mapping</a></h3>
<p>Use S-Curve for natural dynamics:</p>
<pre><code class="language-toml">[global_mappings.velocity_mapping]
type = "Curve"
curve_type = "SCurve"
intensity = 0.5
</code></pre>
<h3 id="step-3-build-the-conditional-logic"><a class="header" href="#step-3-build-the-conditional-logic">Step 3: Build the Conditional Logic</a></h3>
<p>First level: Check if work hours:</p>
<pre><code class="language-toml">[global_mappings.action]
type = "Conditional"

[global_mappings.action.condition]
type = "And"
conditions = [
  { type = "TimeRange", start = "09:00", end = "17:00" },
  { type = "DayOfWeek", days = [1, 2, 3, 4, 5] }
]
</code></pre>
<h3 id="step-4-work-hours-branch-then-action"><a class="header" href="#step-4-work-hours-branch-then-action">Step 4: Work Hours Branch (Then Action)</a></h3>
<p>During work hours, check which app is frontmost:</p>
<pre><code class="language-toml">[global_mappings.action.then_action]
type = "Conditional"

[global_mappings.action.then_action.condition]
type = "Or"
conditions = [
  { type = "AppFrontmost", app_name = "Safari" },
  { type = "AppFrontmost", app_name = "Chrome" },
  { type = "AppFrontmost", app_name = "Firefox" }
]

[global_mappings.action.then_action.then_action]
type = "Keystroke"
keys = "t"
modifiers = ["cmd"]  # New tab in browser

[global_mappings.action.then_action.else_action]
type = "Conditional"
condition = { type = "AppRunning", app_name = "Logic Pro" }
then_action = {
  type = "SendMidi",
  port = "IAC Driver Bus 1",
  message_type = "NoteOn",
  channel = 0,
  note = 60
}
else_action = { type = "Text", text = "Work mode: Use browser or DAW" }
</code></pre>
<h3 id="step-5-evening-branch-else-action"><a class="header" href="#step-5-evening-branch-else-action">Step 5: Evening Branch (Else Action)</a></h3>
<p>Outside work hours, use velocity to choose entertainment:</p>
<pre><code class="language-toml">[global_mappings.action.else_action]
type = "VelocityRange"
soft_max = 64
soft_action = { type = "Launch", app = "Spotify" }
hard_action = { type = "Launch", app = "Steam" }
</code></pre>
<h3 id="complete-workflow"><a class="header" href="#complete-workflow">Complete Workflow</a></h3>
<p>Here's the full configuration:</p>
<pre><code class="language-toml">[[global_mappings]]
description = "Adaptive smart pad: Browser/DAW at work, entertainment after hours"

[global_mappings.trigger]
type = "Note"
note = 10

[global_mappings.velocity_mapping]
type = "Curve"
curve_type = "SCurve"
intensity = 0.5

[global_mappings.action]
type = "Conditional"

[global_mappings.action.condition]
type = "And"
conditions = [
  { type = "TimeRange", start = "09:00", end = "17:00" },
  { type = "DayOfWeek", days = [1, 2, 3, 4, 5] }
]

# Work hours branch
[global_mappings.action.then_action]
type = "Conditional"

[global_mappings.action.then_action.condition]
type = "Or"
conditions = [
  { type = "AppFrontmost", app_name = "Safari" },
  { type = "AppFrontmost", app_name = "Chrome" },
  { type = "AppFrontmost", app_name = "Firefox" }
]

[global_mappings.action.then_action.then_action]
type = "Keystroke"
keys = "t"
modifiers = ["cmd"]

[global_mappings.action.then_action.else_action]
type = "Conditional"
condition = { type = "AppRunning", app_name = "Logic Pro" }
then_action = { type = "SendMidi", port = "IAC Driver Bus 1", message_type = "NoteOn", channel = 0, note = 60 }
else_action = { type = "Text", text = "Work mode: Use browser or DAW" }

# Evening branch
[global_mappings.action.else_action]
type = "VelocityRange"
soft_max = 64
soft_action = { type = "Launch", app = "Spotify" }
hard_action = { type = "Launch", app = "Steam" }
</code></pre>
<h3 id="testing-the-advanced-workflow"><a class="header" href="#testing-the-advanced-workflow">Testing the Advanced Workflow</a></h3>
<p><strong>Scenario 1</strong>: Monday 10am, Safari frontmost</p>
<ul>
<li>Press pad ‚Üí New tab in Safari</li>
</ul>
<p><strong>Scenario 2</strong>: Tuesday 2pm, Logic Pro running</p>
<ul>
<li>Press pad softly ‚Üí MIDI note with moderate velocity (S-curve mapped)</li>
<li>Press pad hard ‚Üí MIDI note with high velocity</li>
</ul>
<p><strong>Scenario 3</strong>: Friday 8pm</p>
<ul>
<li>Press pad softly ‚Üí Spotify launches</li>
<li>Press pad hard ‚Üí Steam launches</li>
</ul>
<p><strong>Scenario 4</strong>: Monday 10am, VS Code frontmost</p>
<ul>
<li>Press pad ‚Üí "Work mode: Use browser or DAW" notification</li>
</ul>
<h3 id="understanding-the-decision-tree"><a class="header" href="#understanding-the-decision-tree">Understanding the Decision Tree</a></h3>
<pre><code>Input Velocity ‚Üí S-Curve ‚Üí Mapped Velocity

IF (weekday AND 9am-5pm):
  IF (browser is frontmost):
    New tab (Cmd+T)
  ELSE IF (Logic Pro running):
    Send MIDI note (mapped velocity)
  ELSE:
    Show notification
ELSE (evening/weekend):
  IF (soft hit, velocity ‚â§ 64):
    Launch Spotify
  ELSE (hard hit, velocity &gt; 64):
    Launch Steam
</code></pre>
<hr />
<h2 id="best-practices-5"><a class="header" href="#best-practices-5">Best Practices</a></h2>
<h3 id="1-start-simple-build-complexity"><a class="header" href="#1-start-simple-build-complexity">1. Start Simple, Build Complexity</a></h3>
<p>Don't try to build the advanced workflow first. Start with:</p>
<ol>
<li>Single condition</li>
<li>Add second condition with And</li>
<li>Add nested conditional</li>
<li>Add velocity mapping</li>
</ol>
<h3 id="2-test-each-layer"><a class="header" href="#2-test-each-layer">2. Test Each Layer</a></h3>
<p>After adding each condition:</p>
<ol>
<li>Save config</li>
<li>Test the new behavior</li>
<li>Verify existing behavior still works</li>
<li>Add next layer</li>
</ol>
<h3 id="3-use-descriptive-mappings"><a class="header" href="#3-use-descriptive-mappings">3. Use Descriptive Mappings</a></h3>
<pre><code class="language-toml">description = "Work hours: Browser tab OR DAW MIDI | Evening: Spotify/Steam"
</code></pre>
<p>Clear descriptions help when debugging.</p>
<h3 id="4-debug-with-text-actions"><a class="header" href="#4-debug-with-text-actions">4. Debug with Text Actions</a></h3>
<p>If behavior is unexpected, temporarily replace actions with Text to see which path executes:</p>
<pre><code class="language-toml">then_action = { type = "Text", text = "THEN path executed" }
else_action = { type = "Text", text = "ELSE path executed" }
</code></pre>
<h3 id="5-gui-vs-toml"><a class="header" href="#5-gui-vs-toml">5. GUI vs TOML</a></h3>
<ul>
<li><strong>Simple conditionals</strong>: Use GUI for visual editing</li>
<li><strong>Nested logic</strong>: Use TOML for precision and readability</li>
<li><strong>Velocity curves</strong>: Use GUI for real-time preview graph</li>
</ul>
<hr />
<h2 id="common-patterns"><a class="header" href="#common-patterns">Common Patterns</a></h2>
<h3 id="pattern-1-app-specific-shortcuts"><a class="header" href="#pattern-1-app-specific-shortcuts">Pattern 1: App-Specific Shortcuts</a></h3>
<pre><code class="language-toml">condition = { type = "AppFrontmost", app_name = "MyApp" }
then_action = { type = "Keystroke", keys = "s", modifiers = ["cmd"] }
else_action = { type = "Text", text = "Not in MyApp" }
</code></pre>
<h3 id="pattern-2-time-based-behavior"><a class="header" href="#pattern-2-time-based-behavior">Pattern 2: Time-Based Behavior</a></h3>
<pre><code class="language-toml">condition = { type = "TimeRange", start = "22:00", end = "08:00" }
then_action = { type = "Text", text = "Quiet hours - action disabled" }
else_action = { /* normal action */ }
</code></pre>
<h3 id="pattern-3-launch-or-control"><a class="header" href="#pattern-3-launch-or-control">Pattern 3: Launch-or-Control</a></h3>
<pre><code class="language-toml">condition = { type = "AppRunning", app_name = "MyDAW" }
then_action = { /* control command */ }
else_action = { type = "Launch", app = "MyDAW" }
</code></pre>
<h3 id="pattern-4-velocity-gated-actions"><a class="header" href="#pattern-4-velocity-gated-actions">Pattern 4: Velocity-Gated Actions</a></h3>
<pre><code class="language-toml">[velocity_mapping]
type = "Linear"
min = 50
max = 110

[action]
type = "VelocityRange"
soft_max = 70
soft_action = { /* gentle action */ }
hard_action = { /* aggressive action */ }
</code></pre>
<hr />
<h2 id="troubleshooting-11"><a class="header" href="#troubleshooting-11">Troubleshooting</a></h2>
<h3 id="problem-condition-never-true"><a class="header" href="#problem-condition-never-true">Problem: Condition Never True</a></h3>
<p><strong>Check</strong>:</p>
<ol>
<li>Time format is <code>HH:MM</code> (24-hour)</li>
<li>App name matches exactly (check Activity Monitor on macOS)</li>
<li>Day numbers are correct (Monday=1, not 0)</li>
<li>Platform support (AppFrontmost is macOS-only)</li>
</ol>
<p><strong>Debug</strong>:</p>
<pre><code class="language-toml"># Add debug text to both branches
then_action = { type = "Text", text = "Condition TRUE" }
else_action = { type = "Text", text = "Condition FALSE" }
</code></pre>
<h3 id="problem-wrong-action-executes"><a class="header" href="#problem-wrong-action-executes">Problem: Wrong Action Executes</a></h3>
<p><strong>Check</strong>:</p>
<ol>
<li>Logical operator (And vs Or)</li>
<li>Nesting structure (use proper TOML indentation)</li>
<li>Short-circuit evaluation (And stops at first false, Or at first true)</li>
</ol>
<p><strong>Debug</strong>:</p>
<ul>
<li>Test each sub-condition individually</li>
<li>Simplify nested logic to isolate issue</li>
</ul>
<h3 id="problem-velocity-curve-doesnt-feel-right"><a class="header" href="#problem-velocity-curve-doesnt-feel-right">Problem: Velocity Curve Doesn't Feel Right</a></h3>
<p><strong>Solution</strong>:</p>
<ol>
<li>Open GUI velocity curve preview</li>
<li>Adjust intensity in 0.1 increments</li>
<li>Try different curve types:
<ul>
<li>Exponential: Boost soft hits</li>
<li>Logarithmic: Tame hard hits</li>
<li>S-Curve: Natural feel with sweet spot</li>
</ul>
</li>
</ol>
<hr />
<h2 id="next-steps-12"><a class="header" href="#next-steps-12">Next Steps</a></h2>
<h3 id="expand-your-workflows"><a class="header" href="#expand-your-workflows">Expand Your Workflows</a></h3>
<p>Now that you've mastered dynamic workflows, try:</p>
<ol>
<li><strong>Per-App Profiles</strong>: Different mappings for different apps</li>
<li><strong>Mode-Based Logic</strong>: Use ModeIs condition for mode-specific behavior</li>
<li><strong>Sequence Actions</strong>: Chain multiple actions with delays</li>
<li><strong>Advanced Velocity</strong>: Combine curves with VelocityRange triggers</li>
</ol>
<h3 id="share-your-workflows"><a class="header" href="#share-your-workflows">Share Your Workflows</a></h3>
<p>Export your <code>config.toml</code> and share with the community:</p>
<ul>
<li>GitHub discussions</li>
<li>Reddit r/midicontrollers</li>
<li>Discord servers</li>
</ul>
<h3 id="learn-more"><a class="header" href="#learn-more">Learn More</a></h3>
<ul>
<li><a href="tutorials/../guides/context-aware.html">Guide: Context-Aware Mappings</a> - Deep dive into conditionals</li>
<li><a href="tutorials/../guides/velocity-curves.html">Guide: Velocity Curves</a> - Master velocity mappings</li>
<li><a href="tutorials/../configuration/actions.html">Configuration: Actions</a> - All available actions</li>
<li><a href="tutorials/../configuration/triggers.html">Configuration: Triggers</a> - All available triggers</li>
</ul>
<hr />
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>You've learned to:</p>
<ul>
<li>‚úÖ Combine time and app conditions with And/Or logic</li>
<li>‚úÖ Use velocity curves for expressive control</li>
<li>‚úÖ Build nested conditional logic</li>
<li>‚úÖ Create context-aware workflows</li>
<li>‚úÖ Test and debug complex mappings</li>
<li>‚úÖ Follow best practices for maintainable configs</li>
</ul>
<p><strong>Your MIDI controller is now an intelligent, context-aware assistant that adapts to your workflow automatically.</strong></p>
<hr />
<p><strong>Example Configs</strong>: See <code>examples/</code> directory for complete workflow examples:</p>
<ul>
<li><code>work-productivity.toml</code> - Time-based work/personal split</li>
<li><code>daw-control.toml</code> - Velocity-sensitive music production</li>
<li><code>gaming-streams.toml</code> - Entertainment and streaming control</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="logic-pro-integration"><a class="header" href="#logic-pro-integration">Logic Pro Integration</a></h1>
<p>This guide shows you how to set up MIDIMon to control Logic Pro, Apple's professional digital audio workstation. We'll cover transport controls, mixer automation, and smart control integration.</p>
<h2 id="prerequisites-4"><a class="header" href="#prerequisites-4">Prerequisites</a></h2>
<ul>
<li>macOS (Logic Pro is macOS-only)</li>
<li>MIDIMon v2.1.0 or later</li>
<li>Logic Pro 10.5 or later</li>
<li>IAC Driver configured (see <a href="examples/../guides/daw-control.html#macos-iac-driver">DAW Control Guide</a>)</li>
</ul>
<h2 id="quick-start"><a class="header" href="#quick-start">Quick Start</a></h2>
<h3 id="1-enable-iac-driver"><a class="header" href="#1-enable-iac-driver">1. Enable IAC Driver</a></h3>
<p>First, ensure your IAC Driver is enabled:</p>
<ol>
<li>Open <strong>Audio MIDI Setup</strong> (Applications ‚Üí Utilities)</li>
<li>Show MIDI Studio (Window ‚Üí Show MIDI Studio)</li>
<li>Double-click <strong>IAC Driver</strong></li>
<li>Check <strong>"Device is online"</strong></li>
<li>Ensure at least one bus exists (default: "IAC Driver Bus 1")</li>
<li>Click <strong>Apply</strong></li>
</ol>
<h3 id="2-configure-logic-pro-midi-input"><a class="header" href="#2-configure-logic-pro-midi-input">2. Configure Logic Pro MIDI Input</a></h3>
<p>In Logic Pro:</p>
<ol>
<li>Open <strong>Logic Pro ‚Üí Settings ‚Üí MIDI ‚Üí Inputs</strong> (or press ‚åò,)</li>
<li>Locate <strong>IAC Driver Bus 1</strong> in the device list</li>
<li>Check the box to enable it</li>
<li>Close Settings</li>
</ol>
<h3 id="3-create-a-basic-transport-control-profile"><a class="header" href="#3-create-a-basic-transport-control-profile">3. Create a Basic Transport Control Profile</a></h3>
<p>Create or update your <code>~/.config/midimon/config.toml</code>:</p>
<pre><code class="language-toml">[[modes]]
name = "Logic Pro"
color = "purple"

# Play/Pause (Pad 1)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 1

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.apple.logic10"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 115  # Logic Pro Play/Pause CC
value = 127
channel = 0

# Stop (Pad 2)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 2

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.apple.logic10"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 116  # Logic Pro Stop CC
value = 127
channel = 0

# Record (Pad 3)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 3

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.apple.logic10"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 117  # Logic Pro Record CC
value = 127
channel = 0
</code></pre>
<h3 id="4-set-up-logic-pro-control-surface"><a class="header" href="#4-set-up-logic-pro-control-surface">4. Set Up Logic Pro Control Surface</a></h3>
<p>In Logic Pro:</p>
<ol>
<li>Open <strong>Logic Pro ‚Üí Control Surfaces ‚Üí Setup</strong></li>
<li>Click <strong>New ‚Üí Install...</strong> (or press ‚åòN)</li>
<li>Choose <strong>Mackie Control</strong> or <strong>Generic</strong> from the list</li>
<li>In the device settings:
<ul>
<li><strong>Input</strong>: Select <strong>IAC Driver Bus 1</strong></li>
<li><strong>Output</strong>: (Optional - for feedback)</li>
</ul>
</li>
<li>Click <strong>Apply</strong> or <strong>OK</strong></li>
</ol>
<h3 id="5-test-the-configuration"><a class="header" href="#5-test-the-configuration">5. Test the Configuration</a></h3>
<ol>
<li>Start the MIDIMon daemon: <code>midimon</code></li>
<li>Open a Logic Pro project</li>
<li>Press Pad 1 on your controller ‚Üí Logic should Play/Pause</li>
<li>Press Pad 2 ‚Üí Logic should Stop</li>
<li>Press Pad 3 ‚Üí Logic should start Recording</li>
</ol>
<h2 id="logic-pro-midi-cc-mapping-reference"><a class="header" href="#logic-pro-midi-cc-mapping-reference">Logic Pro MIDI CC Mapping Reference</a></h2>
<p>Logic Pro uses specific CC numbers for different transport and control functions:</p>
<div class="table-wrapper"><table><thead><tr><th>Function</th><th>CC Number</th><th>Value Range</th><th>Notes</th></tr></thead><tbody>
<tr><td>Play/Pause</td><td>115</td><td>127</td><td>Toggle transport</td></tr>
<tr><td>Stop</td><td>116</td><td>127</td><td>Stop playback</td></tr>
<tr><td>Record</td><td>117</td><td>127</td><td>Toggle record</td></tr>
<tr><td>Rewind</td><td>118</td><td>127</td><td>Skip backward</td></tr>
<tr><td>Fast Forward</td><td>119</td><td>127</td><td>Skip forward</td></tr>
<tr><td>Cycle</td><td>120</td><td>127</td><td>Toggle cycle mode</td></tr>
<tr><td>Volume (Track 1)</td><td>7</td><td>0-127</td><td>Channel 0</td></tr>
<tr><td>Pan (Track 1)</td><td>10</td><td>0-127</td><td>Channel 0</td></tr>
<tr><td>Volume (Track 2)</td><td>7</td><td>0-127</td><td>Channel 1</td></tr>
<tr><td>Pan (Track 2)</td><td>10</td><td>0-127</td><td>Channel 1</td></tr>
</tbody></table>
</div>
<p><strong>Note</strong>: Track-specific controls use different MIDI channels (Track 1 = Channel 0, Track 2 = Channel 1, etc.)</p>
<h2 id="complete-transport-control-profile"><a class="header" href="#complete-transport-control-profile">Complete Transport Control Profile</a></h2>
<p>Here's a full-featured transport control profile for Logic Pro:</p>
<pre><code class="language-toml">[[modes]]
name = "Logic Pro"
color = "purple"

# ===== Transport Controls =====

# Play/Pause (Pad 1)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 1

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.apple.logic10"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 115
value = 127
channel = 0

# Stop (Pad 2)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 2

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.apple.logic10"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 116
value = 127
channel = 0

# Record (Pad 3)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 3

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.apple.logic10"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 117
value = 127
channel = 0

# Rewind (Pad 4)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 4

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.apple.logic10"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 118
value = 127
channel = 0

# Fast Forward (Pad 5)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 5

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.apple.logic10"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 119
value = 127
channel = 0

# Cycle On/Off (Pad 6)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 6

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.apple.logic10"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 120
value = 127
channel = 0
</code></pre>
<h2 id="mixer-control-with-velocity-curves"><a class="header" href="#mixer-control-with-velocity-curves">Mixer Control with Velocity Curves</a></h2>
<p>Use velocity-sensitive pads to control track volume with smooth curves:</p>
<pre><code class="language-toml"># Track 1 Volume (Pad 9, velocity-sensitive)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 9

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.apple.logic10"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 7  # Volume
channel = 0     # Track 1

[modes.mappings.action.then_action.message.velocity_curve]
type = "Curve"
input_min = 0
input_max = 127
output_min = 0
output_max = 127
curve = 1.5  # Slightly exponential for better fader control

# Track 2 Volume (Pad 10)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 10

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.apple.logic10"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 7
channel = 1     # Track 2

[modes.mappings.action.then_action.message.velocity_curve]
type = "Curve"
input_min = 0
input_max = 127
output_min = 0
output_max = 127
curve = 1.5
</code></pre>
<h2 id="smart-controls-integration"><a class="header" href="#smart-controls-integration">Smart Controls Integration</a></h2>
<p>Logic Pro's Smart Controls can be MIDI-mapped for parameter automation:</p>
<h3 id="step-1-map-smart-controls-in-logic-pro"><a class="header" href="#step-1-map-smart-controls-in-logic-pro">Step 1: Map Smart Controls in Logic Pro</a></h3>
<ol>
<li>Open a Logic Pro project with a software instrument</li>
<li>Show <strong>Smart Controls</strong> (press B or View ‚Üí Show Smart Controls)</li>
<li>Click <strong>Learn</strong> button in Smart Controls header</li>
<li>Press a pad on your MIDI controller</li>
<li>Logic will assign that CC to the Smart Control knob</li>
<li>Repeat for up to 8 Smart Control parameters</li>
</ol>
<h3 id="step-2-configure-midimon-to-send-smart-control-ccs"><a class="header" href="#step-2-configure-midimon-to-send-smart-control-ccs">Step 2: Configure MIDIMon to Send Smart Control CCs</a></h3>
<pre><code class="language-toml"># Smart Control 1 (Pad 13, velocity controls CC value)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 13

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.apple.logic10"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 71  # Smart Control 1 (default)
channel = 0

[modes.mappings.action.then_action.message.velocity_curve]
type = "PassThrough"  # Direct velocity ‚Üí CC value mapping

# Smart Control 2 (Pad 14)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 14

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.apple.logic10"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 72  # Smart Control 2
channel = 0

[modes.mappings.action.then_action.message.velocity_curve]
type = "PassThrough"
</code></pre>
<p><strong>Default Smart Control CC Numbers</strong>:</p>
<ul>
<li>Smart Control 1: CC 71</li>
<li>Smart Control 2: CC 72</li>
<li>Smart Control 3: CC 73</li>
<li>Smart Control 4: CC 74</li>
<li>Smart Control 5: CC 75</li>
<li>Smart Control 6: CC 76</li>
<li>Smart Control 7: CC 77</li>
<li>Smart Control 8: CC 78</li>
</ul>
<h2 id="advanced-multi-function-pads-with-long-press"><a class="header" href="#advanced-multi-function-pads-with-long-press">Advanced: Multi-Function Pads with Long Press</a></h2>
<p>Use long press to access secondary functions on the same pad:</p>
<pre><code class="language-toml"># Pad 1: Play (short press) / Stop (long press)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 1

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.apple.logic10"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 115  # Play
value = 127
channel = 0

# Long press variant (Stop)
[[modes.mappings]]
[modes.mappings.trigger]
type = "LongPress"
note = 1
duration_ms = 800

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.apple.logic10"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 116  # Stop
value = 127
channel = 0
</code></pre>
<h2 id="using-midi-learn-in-logic-pro"><a class="header" href="#using-midi-learn-in-logic-pro">Using MIDI Learn in Logic Pro</a></h2>
<p>Logic Pro has a built-in MIDI Learn feature for custom mappings:</p>
<h3 id="step-1-enter-midi-learn-mode"><a class="header" href="#step-1-enter-midi-learn-mode">Step 1: Enter MIDI Learn Mode</a></h3>
<ol>
<li>In Logic Pro, go to <strong>Logic Pro ‚Üí Control Surfaces ‚Üí Learn Assignment</strong></li>
<li>Click the parameter you want to control (e.g., a plugin knob, fader, button)</li>
<li>Press the pad on your MIDI controller</li>
<li>Logic will map that CC to the parameter</li>
<li>Press <strong>Done</strong> when finished</li>
</ol>
<h3 id="step-2-configure-midimon"><a class="header" href="#step-2-configure-midimon">Step 2: Configure MIDIMon</a></h3>
<p>Once Logic has learned the CC mapping, configure MIDIMon to send that CC:</p>
<pre><code class="language-toml"># Example: Plugin parameter learned as CC 20
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 15

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.apple.logic10"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 20  # Whatever Logic learned
channel = 0

[modes.mappings.action.then_action.message.velocity_curve]
type = "PassThrough"
</code></pre>
<h2 id="troubleshooting-12"><a class="header" href="#troubleshooting-12">Troubleshooting</a></h2>
<h3 id="iac-driver-not-appearing-in-logic-pro"><a class="header" href="#iac-driver-not-appearing-in-logic-pro">IAC Driver Not Appearing in Logic Pro</a></h3>
<p><strong>Problem</strong>: IAC Driver doesn't show up in Logic Pro's MIDI Inputs.</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Verify IAC Driver is enabled in Audio MIDI Setup</li>
<li>Restart Logic Pro after enabling IAC Driver</li>
<li>Check <strong>Logic Pro ‚Üí Settings ‚Üí MIDI ‚Üí Reset MIDI Drivers</strong></li>
</ol>
<h3 id="messages-sent-but-no-response"><a class="header" href="#messages-sent-but-no-response">Messages Sent But No Response</a></h3>
<p><strong>Problem</strong>: MIDIMon sends MIDI but Logic doesn't respond.</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Verify the control surface is configured in <strong>Logic Pro ‚Üí Control Surfaces ‚Üí Setup</strong></li>
<li>Ensure the correct CC numbers for your Logic version (some changed in Logic Pro 10.5+)</li>
<li>Try using MIDI Learn to discover the correct CC numbers</li>
<li>Check MIDI channel (most Logic functions use Channel 0)</li>
</ol>
<h3 id="latency-issues"><a class="header" href="#latency-issues">Latency Issues</a></h3>
<p><strong>Problem</strong>: Noticeable delay between pad press and Logic response.</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Lower Logic Pro's I/O buffer size: <strong>Logic Pro ‚Üí Settings ‚Üí Audio ‚Üí I/O Buffer Size</strong></li>
<li>Use IAC Driver (lowest latency) instead of virtual MIDI apps</li>
<li>Reduce CPU load (freeze tracks, disable unused plugins)</li>
</ol>
<h3 id="control-surface-conflicts"><a class="header" href="#control-surface-conflicts">Control Surface Conflicts</a></h3>
<p><strong>Problem</strong>: Multiple control surfaces interfering with each other.</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>In <strong>Logic Pro ‚Üí Control Surfaces ‚Üí Setup</strong>, disable unused control surfaces</li>
<li>Ensure IAC Driver is assigned to only one control surface</li>
<li>Use unique MIDI channels for different control surfaces</li>
</ol>
<h2 id="complete-example-profile"><a class="header" href="#complete-example-profile">Complete Example Profile</a></h2>
<p>Here's a production-ready Logic Pro control profile with all features:</p>
<p>Download: <a href="examples/../downloads/logic-pro-complete.toml">logic-pro-complete.toml</a> (coming soon)</p>
<p><strong>Features</strong>:</p>
<ul>
<li>Transport controls (Play, Stop, Record, Rewind, FF, Cycle)</li>
<li>4-track mixer (Volume + Pan per track)</li>
<li>8 Smart Control parameters</li>
<li>Multi-function pads (short/long press)</li>
<li>Velocity-sensitive mixer control</li>
<li>AppFrontmost conditional (only works when Logic is active)</li>
</ul>
<h2 id="next-steps-13"><a class="header" href="#next-steps-13">Next Steps</a></h2>
<ul>
<li><strong><a href="examples/ableton-live.html">Ableton Live Integration</a></strong> - Control Ableton Live with MIDIMon</li>
<li><strong><a href="examples/../troubleshooting/midi-output.html">MIDI Output Troubleshooting</a></strong> - Advanced debugging</li>
<li><strong><a href="examples/../guides/daw-control.html">DAW Control Guide</a></strong> - General DAW control concepts</li>
</ul>
<h2 id="further-reading"><a class="header" href="#further-reading">Further Reading</a></h2>
<ul>
<li><a href="https://support.apple.com/guide/logicpro/welcome/mac">Logic Pro User Guide - MIDI</a></li>
<li><a href="https://support.apple.com/guide/logicpro/control-surfaces-overview-lgcp2d83e0e9/mac">Logic Pro Control Surfaces</a></li>
<li><a href="https://support.apple.com/guide/audio-midi-setup/transfer-midi-information-between-apps-ams1013/mac">IAC Driver Configuration</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ableton-live-integration"><a class="header" href="#ableton-live-integration">Ableton Live Integration</a></h1>
<p>This guide shows you how to set up MIDIMon to control Ableton Live, one of the most popular DAWs for electronic music production and live performance. We'll cover transport controls, clip launching, device parameter mapping, and session view integration.</p>
<h2 id="prerequisites-5"><a class="header" href="#prerequisites-5">Prerequisites</a></h2>
<ul>
<li>macOS, Windows, or Linux</li>
<li>MIDIMon v2.1.0 or later</li>
<li>Ableton Live 11 or later (Standard or Suite)</li>
<li>Virtual MIDI port configured:
<ul>
<li><strong>macOS</strong>: IAC Driver (see <a href="examples/../guides/daw-control.html#macos-iac-driver">DAW Control Guide</a>)</li>
<li><strong>Windows</strong>: loopMIDI (see <a href="examples/../guides/daw-control.html#windows-loopmidi">DAW Control Guide</a>)</li>
<li><strong>Linux</strong>: ALSA virtual port (see <a href="examples/../guides/daw-control.html#linux-alsa">DAW Control Guide</a>)</li>
</ul>
</li>
</ul>
<h2 id="quick-start-1"><a class="header" href="#quick-start-1">Quick Start</a></h2>
<h3 id="1-configure-virtual-midi-port"><a class="header" href="#1-configure-virtual-midi-port">1. Configure Virtual MIDI Port</a></h3>
<h4 id="macos-iac-driver-1"><a class="header" href="#macos-iac-driver-1">macOS (IAC Driver)</a></h4>
<ol>
<li>Open <strong>Audio MIDI Setup</strong> (Applications ‚Üí Utilities)</li>
<li>Show MIDI Studio (Window ‚Üí Show MIDI Studio)</li>
<li>Double-click <strong>IAC Driver</strong></li>
<li>Check <strong>"Device is online"</strong></li>
<li>Click <strong>Apply</strong></li>
</ol>
<h4 id="windows-loopmidi-1"><a class="header" href="#windows-loopmidi-1">Windows (loopMIDI)</a></h4>
<ol>
<li>Download and install <a href="https://www.tobias-erichsen.de/software/loopmidi.html">loopMIDI</a></li>
<li>Launch loopMIDI</li>
<li>Create a new port (e.g., "MIDIMon Virtual")</li>
<li>Leave loopMIDI running in the background</li>
</ol>
<h4 id="linux-alsa"><a class="header" href="#linux-alsa">Linux (ALSA)</a></h4>
<pre><code class="language-bash"># Create virtual MIDI port
sudo modprobe snd-virmidi

# Verify port created
aconnect -l
</code></pre>
<h3 id="2-configure-ableton-live-midi-input"><a class="header" href="#2-configure-ableton-live-midi-input">2. Configure Ableton Live MIDI Input</a></h3>
<p>In Ableton Live:</p>
<ol>
<li>Open <strong>Live ‚Üí Preferences</strong> (macOS) or <strong>Options ‚Üí Preferences</strong> (Windows/Linux)</li>
<li>Go to the <strong>Link, Tempo &amp; MIDI</strong> tab</li>
<li>In the <strong>MIDI Ports</strong> section, locate your virtual MIDI port:
<ul>
<li>macOS: <strong>IAC Driver (IAC Bus 1)</strong></li>
<li>Windows: <strong>loopMIDI Port</strong></li>
<li>Linux: <strong>Virtual Raw MIDI 1-0</strong></li>
</ul>
</li>
<li>Enable <strong>Track</strong> and <strong>Remote</strong> for the input port</li>
<li>Close Preferences</li>
</ol>
<h3 id="3-create-a-basic-transport-control-profile-1"><a class="header" href="#3-create-a-basic-transport-control-profile-1">3. Create a Basic Transport Control Profile</a></h3>
<p>Create or update your <code>~/.config/midimon/config.toml</code>:</p>
<pre><code class="language-toml">[[modes]]
name = "Ableton Live"
color = "orange"

# Play/Stop (Pad 1)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 1

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.ableton.live"  # macOS
# windows_title_regex = ".*Ableton Live.*"  # Windows/Linux alternative

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"  # Or "loopMIDI Port" on Windows

[modes.mappings.action.then_action.message]
type = "NoteOn"
note = 0  # Ableton Scene Launch (Scene 1)
velocity = 127
channel = 0

# Stop All Clips (Pad 2)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 2

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.ableton.live"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 1  # Custom mapped to "Stop All Clips"
value = 127
channel = 0
</code></pre>
<h3 id="4-test-the-configuration"><a class="header" href="#4-test-the-configuration">4. Test the Configuration</a></h3>
<ol>
<li>Start the MIDIMon daemon: <code>midimon</code></li>
<li>Open Ableton Live with a project containing clips</li>
<li>Press Pad 1 on your controller ‚Üí Scene 1 should launch</li>
<li>Press Pad 2 ‚Üí All clips should stop (if mapped)</li>
</ol>
<h2 id="ableton-live-midi-mapping"><a class="header" href="#ableton-live-midi-mapping">Ableton Live MIDI Mapping</a></h2>
<p>Ableton Live uses a flexible MIDI mapping system. Unlike Logic Pro's fixed CC assignments, you map each control manually using MIDI Learn.</p>
<h3 id="using-midi-map-mode"><a class="header" href="#using-midi-map-mode">Using MIDI Map Mode</a></h3>
<ol>
<li>In Ableton Live, click <strong>MIDI</strong> in the top-right corner (or press ‚åòM / Ctrl+M)</li>
<li>The interface will highlight in purple</li>
<li>Click the parameter you want to control (e.g., a volume fader, play button, device knob)</li>
<li>Press the pad on your MIDI controller</li>
<li>Ableton will map that MIDI message to the parameter</li>
<li>Click <strong>MIDI</strong> again to exit MIDI Map Mode</li>
</ol>
<p><strong>What Ableton Learns</strong>:</p>
<ul>
<li><strong>Note messages</strong> ‚Üí Note number, channel</li>
<li><strong>CC messages</strong> ‚Üí CC number, channel</li>
<li><strong>Velocity</strong> ‚Üí Mapped to 0-127 parameter range</li>
</ul>
<h2 id="clip-launching"><a class="header" href="#clip-launching">Clip Launching</a></h2>
<p>Ableton's Session View uses a grid of clips. Each clip can be triggered via MIDI notes.</p>
<h3 id="default-clip-launch-mapping"><a class="header" href="#default-clip-launch-mapping">Default Clip Launch Mapping</a></h3>
<p>By default, Ableton maps:</p>
<ul>
<li><strong>Track 1</strong>: Notes 0-127 (clip slots 1-128)</li>
<li><strong>Track 2</strong>: Same notes on MIDI Channel 1</li>
<li><strong>Track 3</strong>: Same notes on MIDI Channel 2</li>
<li>etc.</li>
</ul>
<p><strong>OR</strong> you can use MIDI Map Mode to assign specific notes to specific clips.</p>
<h3 id="example-launch-clips-in-track-1"><a class="header" href="#example-launch-clips-in-track-1">Example: Launch Clips in Track 1</a></h3>
<pre><code class="language-toml"># Launch Clip 1 in Track 1 (Pad 9)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 9

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.ableton.live"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "NoteOn"
note = 0  # Clip slot 1
velocity = 127
channel = 0  # Track 1

# Launch Clip 2 in Track 1 (Pad 10)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 10

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.ableton.live"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "NoteOn"
note = 1  # Clip slot 2
velocity = 127
channel = 0
</code></pre>
<h3 id="scene-launching"><a class="header" href="#scene-launching">Scene Launching</a></h3>
<p>Scenes launch all clips in a row simultaneously:</p>
<pre><code class="language-toml"># Launch Scene 1 (Pad 1)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 1

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.ableton.live"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "NoteOn"
note = 0  # Scene 1 (use MIDI Learn to discover exact note)
velocity = 127
channel = 0
</code></pre>
<p><strong>Note</strong>: Scene launch note numbers vary by Ableton version and configuration. Use MIDI Learn to discover the correct note numbers for your setup.</p>
<h2 id="device-parameter-control"><a class="header" href="#device-parameter-control">Device Parameter Control</a></h2>
<p>Ableton's devices (instruments, effects) have mappable parameters.</p>
<h3 id="step-1-map-device-parameters-in-ableton"><a class="header" href="#step-1-map-device-parameters-in-ableton">Step 1: Map Device Parameters in Ableton</a></h3>
<ol>
<li>Open a device (e.g., Filter, Reverb, Wavetable synth)</li>
<li>Enter <strong>MIDI Map Mode</strong> (click MIDI or press ‚åòM)</li>
<li>Click a device knob or parameter</li>
<li>Press a pad on your MIDI controller</li>
<li>Ableton maps that control</li>
</ol>
<p><strong>Pro Tip</strong>: Ableton learns CC messages from your controller. To use velocity instead, you'll need to map in Ableton using MIDI notes, not CCs.</p>
<h3 id="step-2-configure-midimon-for-velocity-controlled-parameters"><a class="header" href="#step-2-configure-midimon-for-velocity-controlled-parameters">Step 2: Configure MIDIMon for Velocity-Controlled Parameters</a></h3>
<p>Use velocity curves to control device parameters smoothly:</p>
<pre><code class="language-toml"># Control Filter Cutoff with Velocity (Pad 13)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 13

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.ableton.live"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 20  # Learned in Ableton MIDI Map Mode
channel = 0

[modes.mappings.action.then_action.message.velocity_curve]
type = "Curve"
input_min = 0
input_max = 127
output_min = 0
output_max = 127
curve = 1.2  # Slightly exponential for better control

# Control Reverb Decay (Pad 14)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 14

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.ableton.live"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 21  # Learned in Ableton
channel = 0

[modes.mappings.action.then_action.message.velocity_curve]
type = "Linear"
input_min = 0
input_max = 127
output_min = 20
output_max = 100  # Limited range (20-100% decay)
</code></pre>
<h2 id="complete-transport--mixer-control"><a class="header" href="#complete-transport--mixer-control">Complete Transport &amp; Mixer Control</a></h2>
<p>Here's a comprehensive Ableton Live control profile:</p>
<pre><code class="language-toml">[[modes]]
name = "Ableton Live"
color = "orange"

# ===== Transport Controls =====

# Play/Stop (Pad 1)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 1

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.ableton.live"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 10  # Mapped via MIDI Learn
value = 127
channel = 0

# Record (Pad 2)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 2

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.ableton.live"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 11  # Mapped via MIDI Learn
value = 127
channel = 0

# ===== Mixer Controls =====

# Track 1 Volume (Pad 9, velocity-sensitive)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 9

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.ableton.live"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 20  # Mapped via MIDI Learn to Track 1 Volume
channel = 0

[modes.mappings.action.then_action.message.velocity_curve]
type = "Curve"
input_min = 0
input_max = 127
output_min = 0
output_max = 127
curve = 1.5  # Exponential for fader feel

# Track 2 Volume (Pad 10)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 10

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.ableton.live"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "CC"
controller = 21  # Mapped to Track 2 Volume
channel = 0

[modes.mappings.action.then_action.message.velocity_curve]
type = "Curve"
input_min = 0
input_max = 127
output_min = 0
output_max = 127
curve = 1.5

# ===== Clip Launching =====

# Launch Clip Slot 1 (Pad 13)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 13

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.ableton.live"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "NoteOn"
note = 0  # Clip slot 1 in Track 1
velocity = 127
channel = 0

# Launch Clip Slot 2 (Pad 14)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 14

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.ableton.live"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "NoteOn"
note = 1  # Clip slot 2
velocity = 127
channel = 0
</code></pre>
<h2 id="advanced-drum-rack-control"><a class="header" href="#advanced-drum-rack-control">Advanced: Drum Rack Control</a></h2>
<p>Ableton's Drum Rack is a powerful sampler for drum sounds. Each pad in a Drum Rack can be triggered via MIDI notes.</p>
<h3 id="default-drum-rack-mapping"><a class="header" href="#default-drum-rack-mapping">Default Drum Rack Mapping</a></h3>
<p>Drum Racks use notes 36-99 (C1-D#7) for the 64 pads:</p>
<ul>
<li><strong>C1 (36)</strong>: Kick drum (top-left pad)</li>
<li><strong>C#1 (37)</strong>: Next pad</li>
<li><strong>D1 (38)</strong>: Snare drum (often)</li>
<li><strong>F#1 (42)</strong>: Closed hi-hat (often)</li>
<li><strong>A#1 (46)</strong>: Open hi-hat (often)</li>
</ul>
<h3 id="example-trigger-drum-rack-sounds"><a class="header" href="#example-trigger-drum-rack-sounds">Example: Trigger Drum Rack Sounds</a></h3>
<pre><code class="language-toml"># Kick Drum (Pad 9)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 9

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.ableton.live"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "NoteOn"
note = 36  # C1 - Kick
channel = 0  # Track with Drum Rack

[modes.mappings.action.then_action.message.velocity_curve]
type = "PassThrough"  # Use controller velocity

# Snare Drum (Pad 10)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 10

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.ableton.live"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "NoteOn"
note = 38  # D1 - Snare
channel = 0

[modes.mappings.action.then_action.message.velocity_curve]
type = "PassThrough"

# Closed Hi-Hat (Pad 11)
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 11

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.ableton.live"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "NoteOn"
note = 42  # F#1 - Closed Hi-Hat
channel = 0

[modes.mappings.action.then_action.message.velocity_curve]
type = "PassThrough"
</code></pre>
<h2 id="push-style-session-navigation-advanced"><a class="header" href="#push-style-session-navigation-advanced">Push-Style Session Navigation (Advanced)</a></h2>
<p>Ableton Push controllers use a grid layout for clips. You can replicate this with MIDIMon:</p>
<pre><code class="language-toml"># 4x4 Clip Grid (Pads 9-12, 13-16, 17-20, 21-24)
# Track 1, Clip Slots 1-4
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 9

[[modes.mappings.action.conditions]]
type = "AppFrontmost"
bundle_id = "com.ableton.live"

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"

[modes.mappings.action.then_action.message]
type = "NoteOn"
note = 0  # Track 1, Clip 1
velocity = 127
channel = 0

# Continue for all 16 pads...
# (Pad 10 ‚Üí Track 1 Clip 2, Pad 13 ‚Üí Track 2 Clip 1, etc.)
</code></pre>
<p><strong>Mapping Strategy</strong>:</p>
<ul>
<li>Row 1 (Pads 9-12): Track 1, Clips 1-4</li>
<li>Row 2 (Pads 13-16): Track 2, Clips 1-4</li>
<li>Row 3 (Pads 17-20): Track 3, Clips 1-4</li>
<li>Row 4 (Pads 21-24): Track 4, Clips 1-4</li>
</ul>
<h2 id="troubleshooting-13"><a class="header" href="#troubleshooting-13">Troubleshooting</a></h2>
<h3 id="midi-port-not-appearing-in-ableton"><a class="header" href="#midi-port-not-appearing-in-ableton">MIDI Port Not Appearing in Ableton</a></h3>
<p><strong>Problem</strong>: Virtual MIDI port doesn't show up in Ableton's Preferences.</p>
<p><strong>Solution</strong>:</p>
<ul>
<li><strong>macOS</strong>: Verify IAC Driver is enabled in Audio MIDI Setup</li>
<li><strong>Windows</strong>: Ensure loopMIDI is running in the background</li>
<li><strong>Linux</strong>: Check <code>aconnect -l</code> to verify virtual port exists</li>
<li>Restart Ableton Live after creating the virtual port</li>
</ul>
<h3 id="messages-sent-but-no-response-1"><a class="header" href="#messages-sent-but-no-response-1">Messages Sent But No Response</a></h3>
<p><strong>Problem</strong>: MIDIMon sends MIDI but Ableton doesn't respond.</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Verify <strong>Track</strong> and <strong>Remote</strong> are enabled for the MIDI port in Preferences</li>
<li>Ensure the correct MIDI channel is used (usually Channel 0)</li>
<li>Use <strong>MIDI Map Mode</strong> in Ableton to verify what MIDI messages are being received</li>
<li>Check MIDIMon logs: <code>midimon --verbose</code></li>
</ol>
<h3 id="clip-launch-notes-dont-match"><a class="header" href="#clip-launch-notes-dont-match">Clip Launch Notes Don't Match</a></h3>
<p><strong>Problem</strong>: Sending Note 0 doesn't launch the expected clip.</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Enter <strong>MIDI Map Mode</strong> in Ableton</li>
<li>Click the clip you want to trigger</li>
<li>Press the pad on your controller to learn the note</li>
<li>Update your MIDIMon config with the correct note number</li>
</ol>
<h3 id="windows-port-name-issues"><a class="header" href="#windows-port-name-issues">Windows: Port Name Issues</a></h3>
<p><strong>Problem</strong>: Port name "loopMIDI Port" not found.</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Check the exact port name in loopMIDI application</li>
<li>Update MIDIMon config to match the exact name (case-sensitive)</li>
<li>Ensure loopMIDI is running before starting MIDIMon daemon</li>
</ol>
<h3 id="latency-issues-1"><a class="header" href="#latency-issues-1">Latency Issues</a></h3>
<p><strong>Problem</strong>: Noticeable delay between pad press and Ableton response.</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Lower Ableton's audio buffer size: <strong>Preferences ‚Üí Audio ‚Üí Buffer Size</strong></li>
<li>Use native virtual MIDI drivers (IAC on macOS, ALSA on Linux) instead of third-party apps</li>
<li>Close unnecessary applications to reduce CPU load</li>
<li>On Windows, ensure loopMIDI is up to date</li>
</ol>
<h2 id="complete-example-profile-1"><a class="header" href="#complete-example-profile-1">Complete Example Profile</a></h2>
<p>Here's a production-ready Ableton Live control profile:</p>
<p>Download: <a href="examples/../downloads/ableton-live-complete.toml">ableton-live-complete.toml</a> (coming soon)</p>
<p><strong>Features</strong>:</p>
<ul>
<li>Transport controls (Play, Stop, Record)</li>
<li>8 clip launchers (2 tracks √ó 4 clips)</li>
<li>4 device parameter controls (velocity-sensitive)</li>
<li>Drum Rack triggering (4 sounds with velocity)</li>
<li>AppFrontmost conditional (only works when Ableton is active)</li>
<li>Velocity curves for expressive control</li>
</ul>
<h2 id="next-steps-14"><a class="header" href="#next-steps-14">Next Steps</a></h2>
<ul>
<li><strong><a href="examples/logic-pro.html">Logic Pro Integration</a></strong> - Control Logic Pro with MIDIMon</li>
<li><strong><a href="examples/../troubleshooting/midi-output.html">MIDI Output Troubleshooting</a></strong> - Advanced debugging</li>
<li><strong><a href="examples/../guides/daw-control.html">DAW Control Guide</a></strong> - General DAW control concepts</li>
</ul>
<h2 id="further-reading-1"><a class="header" href="#further-reading-1">Further Reading</a></h2>
<ul>
<li><a href="https://www.ableton.com/en/manual/midi-and-key-remote-control/">Ableton Live Manual - MIDI</a></li>
<li><a href="https://www.ableton.com/en/manual/midi-and-key-remote-control/#midi-mapping">Ableton Live MIDI Mapping</a></li>
<li><a href="https://help.ableton.com/hc/en-us/articles/209072409-Creating-custom-control-surfaces">Creating Custom Control Surfaces</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration-overview"><a class="header" href="#configuration-overview">Configuration Overview</a></h1>
<h2 id="introduction-1"><a class="header" href="#introduction-1">Introduction</a></h2>
<p>MIDIMon uses a single <code>config.toml</code> file to define all device settings, modes, mappings, and advanced behavior. This file uses TOML (Tom's Obvious, Minimal Language) - a human-friendly configuration format that's easy to read and edit.</p>
<p>This guide provides a comprehensive overview of the configuration structure, required sections, validation, and best practices.</p>
<h2 id="configuration-file-location"><a class="header" href="#configuration-file-location">Configuration File Location</a></h2>
<p>By default, MIDIMon looks for <code>config.toml</code> in the current working directory:</p>
<pre><code class="language-bash"># Current directory
./config.toml

# Or specify a custom location
midimon --config /path/to/my-config.toml
</code></pre>
<p><strong>Tip</strong>: Keep your <code>config.toml</code> in the project root directory for simplicity.</p>
<h2 id="toml-syntax-basics"><a class="header" href="#toml-syntax-basics">TOML Syntax Basics</a></h2>
<p>If you're new to TOML, here are the essentials:</p>
<pre><code class="language-toml"># Comments start with #

# Simple key-value pairs
name = "My Device"
port = 2

# Booleans
auto_connect = true
debug = false

# Numbers
velocity = 127
timeout_ms = 300

# Strings (use quotes)
description = "This is a description"

# Arrays
notes = [12, 13, 14, 15]
modifiers = ["cmd", "shift"]

# Tables (sections)
[section_name]
key = "value"

# Array of tables (repeated sections)
[[modes]]
name = "Mode 1"

[[modes]]
name = "Mode 2"
</code></pre>
<p><strong>Key Points</strong>:</p>
<ul>
<li>Use <code>=</code> for assignment</li>
<li>Use <code>[]</code> for sections (tables)</li>
<li>Use <code>[[]]</code> for repeating sections (arrays of tables)</li>
<li>Strings must be in quotes</li>
<li>Comments use <code>#</code></li>
</ul>
<h2 id="configuration-structure-diagram"><a class="header" href="#configuration-structure-diagram">Configuration Structure Diagram</a></h2>
<pre><code>config.toml
‚îú‚îÄ‚îÄ [device]                    # Device identification (optional)
‚îÇ   ‚îú‚îÄ‚îÄ name
‚îÇ   ‚îî‚îÄ‚îÄ auto_connect
‚îÇ
‚îú‚îÄ‚îÄ [advanced_settings]         # Timing thresholds (optional)
‚îÇ   ‚îú‚îÄ‚îÄ chord_timeout_ms
‚îÇ   ‚îú‚îÄ‚îÄ double_tap_timeout_ms
‚îÇ   ‚îî‚îÄ‚îÄ hold_threshold_ms
‚îÇ
‚îú‚îÄ‚îÄ [[modes]]                   # Mode definitions (required, 1+)
‚îÇ   ‚îú‚îÄ‚îÄ name
‚îÇ   ‚îú‚îÄ‚îÄ color
‚îÇ   ‚îî‚îÄ‚îÄ [[modes.mappings]]      # Mode-specific mappings
‚îÇ       ‚îú‚îÄ‚îÄ description
‚îÇ       ‚îú‚îÄ‚îÄ [trigger]
‚îÇ       ‚îî‚îÄ‚îÄ [action]
‚îÇ
‚îî‚îÄ‚îÄ [[global_mappings]]         # Global mappings (optional)
    ‚îú‚îÄ‚îÄ description
    ‚îú‚îÄ‚îÄ [trigger]
    ‚îî‚îÄ‚îÄ [action]
</code></pre>
<h2 id="required-vs-optional-sections"><a class="header" href="#required-vs-optional-sections">Required vs Optional Sections</a></h2>
<h3 id="required-sections"><a class="header" href="#required-sections">Required Sections</a></h3>
<p><strong>Minimum viable config</strong>:</p>
<pre><code class="language-toml"># At least one mode is REQUIRED
[[modes]]
name = "Default"

# At least one mapping (either in modes or global) is REQUIRED
[[modes.mappings]]
description = "Example mapping"
[modes.mappings.trigger]
type = "Note"
note = 12
[modes.mappings.action]
type = "Keystroke"
keys = "a"
modifiers = []
</code></pre>
<p>Without these, MIDIMon will start but won't do anything useful.</p>
<h3 id="optional-sections"><a class="header" href="#optional-sections">Optional Sections</a></h3>
<p>These enhance functionality but aren't required:</p>
<pre><code class="language-toml"># Optional: Device identification
[device]
name = "Mikro"
auto_connect = true

# Optional: Timing customization
[advanced_settings]
chord_timeout_ms = 100
double_tap_timeout_ms = 300
hold_threshold_ms = 2000

# Optional: Global mappings (work in all modes)
[[global_mappings]]
description = "Volume control"
[global_mappings.trigger]
type = "EncoderTurn"
direction = "Clockwise"
[global_mappings.action]
type = "VolumeControl"
operation = "Up"
</code></pre>
<h2 id="section-breakdown"><a class="header" href="#section-breakdown">Section Breakdown</a></h2>
<h3 id="device-section"><a class="header" href="#device-section">[device] Section</a></h3>
<p>Optional section for device identification:</p>
<pre><code class="language-toml">[device]
name = "Mikro"           # Friendly name (used in logs)
auto_connect = true      # Automatically connect to device on startup
</code></pre>
<p><strong>Parameters</strong>:</p>
<ul>
<li><code>name</code> (string): Device name for logging/display</li>
<li><code>auto_connect</code> (boolean): If true, auto-connect to first available MIDI device</li>
</ul>
<p><strong>Default behavior</strong> (if omitted): No auto-connect, manual port selection required.</p>
<h3 id="advanced_settings-section"><a class="header" href="#advanced_settings-section">[advanced_settings] Section</a></h3>
<p>Optional timing customization:</p>
<pre><code class="language-toml">[advanced_settings]
chord_timeout_ms = 100          # Max time between notes in a chord
double_tap_timeout_ms = 300     # Max time between taps for double-tap
hold_threshold_ms = 2000        # Min hold time for long press
</code></pre>
<p><strong>Parameters</strong>:</p>
<ul>
<li><code>chord_timeout_ms</code> (u64): Milliseconds to wait for additional notes in a chord (default: 100)</li>
<li><code>double_tap_timeout_ms</code> (u64): Maximum time between two taps to count as double-tap (default: 300)</li>
<li><code>hold_threshold_ms</code> (u64): Minimum hold duration for long press trigger (default: 2000)</li>
</ul>
<p><strong>Defaults</strong> (if omitted):</p>
<pre><code class="language-toml">chord_timeout_ms = 100
double_tap_timeout_ms = 300
hold_threshold_ms = 2000
</code></pre>
<p><strong>Use cases</strong>:</p>
<ul>
<li>Increase <code>chord_timeout_ms</code> for slower chord playing (e.g., 200-300ms)</li>
<li>Decrease <code>double_tap_timeout_ms</code> for faster double-tap detection (e.g., 200ms)</li>
<li>Adjust <code>hold_threshold_ms</code> for longer/shorter long-press (e.g., 1000-3000ms)</li>
</ul>
<h3 id="modes-section"><a class="header" href="#modes-section">[[modes]] Section</a></h3>
<p>Defines a mode with its mappings. <strong>At least one mode is required.</strong></p>
<pre><code class="language-toml">[[modes]]
name = "Default"              # Mode name (required, unique)
color = "blue"                # LED color theme (optional)

[[modes.mappings]]            # Mode-specific mappings (array)
description = "Copy"          # Human-readable description (optional)
[modes.mappings.trigger]      # Trigger definition (required)
type = "Note"
note = 12
[modes.mappings.action]       # Action definition (required)
type = "Keystroke"
keys = "c"
modifiers = ["cmd"]
</code></pre>
<p><strong>Mode Parameters</strong>:</p>
<ul>
<li><code>name</code> (string, required): Unique mode identifier</li>
<li><code>color</code> (string, optional): LED theme color (blue, green, purple, red, yellow, white)</li>
</ul>
<p><strong>Mapping Parameters</strong>:</p>
<ul>
<li><code>description</code> (string, optional): Human-readable description (useful for documentation)</li>
<li><code>trigger</code> (table, required): Defines what event triggers this mapping</li>
<li><code>action</code> (table, required): Defines what happens when triggered</li>
</ul>
<p><strong>Multiple modes</strong>:</p>
<pre><code class="language-toml">[[modes]]
name = "Default"
# ... mappings ...

[[modes]]
name = "Developer"
# ... mappings ...

[[modes]]
name = "Media"
# ... mappings ...
</code></pre>
<h3 id="global_mappings-section"><a class="header" href="#global_mappings-section">[[global_mappings]] Section</a></h3>
<p>Optional mappings that work in ALL modes:</p>
<pre><code class="language-toml">[[global_mappings]]
description = "Emergency exit"
[global_mappings.trigger]
type = "LongPress"
note = 0
hold_duration_ms = 3000
[global_mappings.action]
type = "Shell"
command = "killall midimon"

[[global_mappings]]
description = "Volume up"
[global_mappings.trigger]
type = "EncoderTurn"
direction = "Clockwise"
[global_mappings.action]
type = "VolumeControl"
operation = "Up"
</code></pre>
<p><strong>Use cases</strong>:</p>
<ul>
<li>Emergency shutdown</li>
<li>Mode switching</li>
<li>Volume control</li>
<li>System-wide shortcuts (screenshot, lock screen)</li>
</ul>
<p><strong>Priority</strong>: Global mappings are checked after mode-specific mappings. If a mode-specific mapping matches the same trigger, it takes precedence.</p>
<h2 id="triggers-and-actions"><a class="header" href="#triggers-and-actions">Triggers and Actions</a></h2>
<p>Every mapping consists of a <strong>trigger</strong> (what event to detect) and an <strong>action</strong> (what to do when triggered).</p>
<h3 id="common-trigger-types"><a class="header" href="#common-trigger-types">Common Trigger Types</a></h3>
<pre><code class="language-toml"># Basic note on/off
[trigger]
type = "Note"
note = 12

# Velocity-sensitive
[trigger]
type = "VelocityRange"
note = 12
min_velocity = 0
max_velocity = 40

# Long press
[trigger]
type = "LongPress"
note = 12
hold_duration_ms = 2000

# Double-tap
[trigger]
type = "DoubleTap"
note = 12
double_tap_timeout_ms = 300

# Chord (multiple notes together)
[trigger]
type = "NoteChord"
notes = [12, 13, 14]
chord_timeout_ms = 100

# Encoder rotation
[trigger]
type = "EncoderTurn"
direction = "Clockwise"  # or "CounterClockwise"

# Control change
[trigger]
type = "CC"
cc_number = 1
</code></pre>
<p>See <a href="configuration/../reference/triggers.html">Triggers Reference</a> for complete list.</p>
<h3 id="common-action-types"><a class="header" href="#common-action-types">Common Action Types</a></h3>
<pre><code class="language-toml"># Keyboard shortcut
[action]
type = "Keystroke"
keys = "c"
modifiers = ["cmd"]

# Type text
[action]
type = "Text"
text = "Hello, world!"

# Open application
[action]
type = "Launch"
app = "Terminal"

# Run shell command
[action]
type = "Shell"
command = "cargo test"

# Volume control
[action]
type = "VolumeControl"
operation = "Up"  # Up, Down, Mute, Set

# Change mode
[action]
type = "ModeChange"
mode = "next"  # next, previous, or mode name

# Sequence of actions
[action]
type = "Sequence"
actions = [
    { type = "Launch", app = "Spotify" },
    { type = "Delay", duration_ms = 1000 },
    { type = "Keystroke", keys = "space", modifiers = [] }
]
</code></pre>
<p>See <a href="configuration/../reference/actions.html">Actions Reference</a> for complete list.</p>
<h2 id="minimal-configuration-example"><a class="header" href="#minimal-configuration-example">Minimal Configuration Example</a></h2>
<p>The simplest possible working config:</p>
<pre><code class="language-toml">[[modes]]
name = "Default"

[[modes.mappings]]
description = "Test"
[modes.mappings.trigger]
type = "Note"
note = 12
[modes.mappings.action]
type = "Keystroke"
keys = "a"
modifiers = []
</code></pre>
<p><strong>What this does</strong>:</p>
<ul>
<li>Creates one mode called "Default"</li>
<li>Pressing pad 12 types "A"</li>
</ul>
<h2 id="full-configuration-example"><a class="header" href="#full-configuration-example">Full Configuration Example</a></h2>
<p>A complete, production-ready config:</p>
<pre><code class="language-toml"># Device configuration
[device]
name = "Mikro"
auto_connect = true

# Advanced timing settings
[advanced_settings]
chord_timeout_ms = 100
double_tap_timeout_ms = 300
hold_threshold_ms = 2000

# Mode 1: General productivity
[[modes]]
name = "Default"
color = "blue"

[[modes.mappings]]
description = "Copy"
[modes.mappings.trigger]
type = "Note"
note = 12
[modes.mappings.action]
type = "Keystroke"
keys = "c"
modifiers = ["cmd"]

[[modes.mappings]]
description = "Paste"
[modes.mappings.trigger]
type = "Note"
note = 13
[modes.mappings.action]
type = "Keystroke"
keys = "v"
modifiers = ["cmd"]

[[modes.mappings]]
description = "Switch app"
[modes.mappings.trigger]
type = "Note"
note = 14
[modes.mappings.action]
type = "Keystroke"
keys = "tab"
modifiers = ["cmd"]

# Mode 2: Development
[[modes]]
name = "Developer"
color = "green"

[[modes.mappings]]
description = "Run tests"
[modes.mappings.trigger]
type = "Note"
note = 12
[modes.mappings.action]
type = "Shell"
command = "cargo test"

[[modes.mappings]]
description = "Build release"
[modes.mappings.trigger]
type = "Note"
note = 13
[modes.mappings.action]
type = "Shell"
command = "cargo build --release"

# Mode 3: Media control
[[modes]]
name = "Media"
color = "purple"

[[modes.mappings]]
description = "Play/Pause"
[modes.mappings.trigger]
type = "Note"
note = 12
[modes.mappings.action]
type = "Keystroke"
keys = "space"
modifiers = []

[[modes.mappings]]
description = "Next track"
[modes.mappings.trigger]
type = "Note"
note = 13
[modes.mappings.action]
type = "Keystroke"
keys = "right"
modifiers = ["cmd"]

# Global mappings (work in all modes)
[[global_mappings]]
description = "Emergency exit (hold 3 seconds)"
[global_mappings.trigger]
type = "LongPress"
note = 0
hold_duration_ms = 3000
[global_mappings.action]
type = "Shell"
command = "killall midimon"

[[global_mappings]]
description = "Next mode"
[global_mappings.trigger]
type = "EncoderTurn"
direction = "Clockwise"
[global_mappings.action]
type = "ModeChange"
mode = "next"

[[global_mappings]]
description = "Previous mode"
[global_mappings.trigger]
type = "EncoderTurn"
direction = "CounterClockwise"
[global_mappings.action]
type = "ModeChange"
mode = "previous"

[[global_mappings]]
description = "Volume up"
[global_mappings.trigger]
type = "Note"
note = 15
[global_mappings.action]
type = "VolumeControl"
operation = "Up"

[[global_mappings]]
description = "Volume down"
[global_mappings.trigger]
type = "Note"
note = 11
[global_mappings.action]
type = "VolumeControl"
operation = "Down"
</code></pre>
<h2 id="configuration-validation"><a class="header" href="#configuration-validation">Configuration Validation</a></h2>
<h3 id="loading-process"><a class="header" href="#loading-process">Loading Process</a></h3>
<p>When MIDIMon starts, it:</p>
<ol>
<li><strong>Locates</strong> <code>config.toml</code></li>
<li><strong>Parses</strong> TOML syntax</li>
<li><strong>Validates</strong> structure and values</li>
<li><strong>Compiles</strong> triggers and actions</li>
<li><strong>Initializes</strong> mapping engine</li>
</ol>
<h3 id="common-validation-errors"><a class="header" href="#common-validation-errors">Common Validation Errors</a></h3>
<h4 id="syntax-error"><a class="header" href="#syntax-error">Syntax Error</a></h4>
<p><strong>Error</strong>:</p>
<pre><code>TOML parse error: expected `=`, but found `:`
</code></pre>
<p><strong>Cause</strong>: Invalid TOML syntax (e.g., using <code>:</code> instead of <code>=</code>)</p>
<p><strong>Fix</strong>: Check TOML syntax rules, ensure proper formatting</p>
<hr />
<h4 id="missing-required-field"><a class="header" href="#missing-required-field">Missing Required Field</a></h4>
<p><strong>Error</strong>:</p>
<pre><code>Missing field `type` in trigger definition
</code></pre>
<p><strong>Cause</strong>: Trigger or action missing required <code>type</code> field</p>
<p><strong>Fix</strong>: Add required fields:</p>
<pre><code class="language-toml">[trigger]
type = "Note"  # Required
note = 12      # Required for Note trigger
</code></pre>
<hr />
<h4 id="invalid-field-value"><a class="header" href="#invalid-field-value">Invalid Field Value</a></h4>
<p><strong>Error</strong>:</p>
<pre><code>Invalid trigger type: 'NotePress' (expected: Note, VelocityRange, LongPress, ...)
</code></pre>
<p><strong>Cause</strong>: Typo or unsupported value</p>
<p><strong>Fix</strong>: Check spelling, refer to <a href="configuration/../reference/triggers.html">Triggers Reference</a></p>
<hr />
<h4 id="mode-name-conflict"><a class="header" href="#mode-name-conflict">Mode Name Conflict</a></h4>
<p><strong>Error</strong>:</p>
<pre><code>Duplicate mode name: 'Default'
</code></pre>
<p><strong>Cause</strong>: Two modes with the same name</p>
<p><strong>Fix</strong>: Ensure each mode has a unique name</p>
<hr />
<h4 id="no-mappings-defined"><a class="header" href="#no-mappings-defined">No Mappings Defined</a></h4>
<p><strong>Warning</strong> (not an error, but MIDIMon won't do anything):</p>
<pre><code>Warning: No mappings defined. Controller won't trigger any actions.
</code></pre>
<p><strong>Fix</strong>: Add at least one mapping in a mode or global_mappings</p>
<h3 id="validation-checklist"><a class="header" href="#validation-checklist">Validation Checklist</a></h3>
<p>Before running MIDIMon, verify:</p>
<ul>
<li><input disabled="" type="checkbox"/>
TOML syntax is valid (use <code>cargo check</code> or online TOML validator)</li>
<li><input disabled="" type="checkbox"/>
At least one <code>[[modes]]</code> section exists</li>
<li><input disabled="" type="checkbox"/>
Each mode has a unique <code>name</code></li>
<li><input disabled="" type="checkbox"/>
At least one mapping exists (in modes or global)</li>
<li><input disabled="" type="checkbox"/>
Every mapping has both <code>trigger</code> and <code>action</code></li>
<li><input disabled="" type="checkbox"/>
All trigger/action types are spelled correctly</li>
<li><input disabled="" type="checkbox"/>
Note numbers match your device (use <code>pad_mapper</code> to verify)</li>
<li><input disabled="" type="checkbox"/>
File is saved as UTF-8 (not UTF-16 or other encoding)</li>
</ul>
<h2 id="configuration-tips-and-best-practices"><a class="header" href="#configuration-tips-and-best-practices">Configuration Tips and Best Practices</a></h2>
<h3 id="1-use-comments-liberally"><a class="header" href="#1-use-comments-liberally">1. Use Comments Liberally</a></h3>
<pre><code class="language-toml"># ===================================
# MODE 1: General Productivity
# ===================================
[[modes]]
name = "Default"
color = "blue"

# Pad layout:
# 12=Copy  13=Paste  14=Undo  15=Redo
# 8=Save   9=Open    10=Find  11=App Switch
# 4=Cut    5=Select  6=Delete 7=Screenshot
# 0=Escape 1=Enter   2=Tab    3=Space

[[modes.mappings]]
description = "Copy (Pad 12)"
# ... trigger and action ...
</code></pre>
<h3 id="2-group-related-mappings"><a class="header" href="#2-group-related-mappings">2. Group Related Mappings</a></h3>
<pre><code class="language-toml"># Clipboard operations
[[modes.mappings]]
description = "Copy"
# ... copy mapping ...

[[modes.mappings]]
description = "Cut"
# ... cut mapping ...

[[modes.mappings]]
description = "Paste"
# ... paste mapping ...

# Navigation
[[modes.mappings]]
description = "Next tab"
# ... next tab ...
</code></pre>
<h3 id="3-use-descriptive-names"><a class="header" href="#3-use-descriptive-names">3. Use Descriptive Names</a></h3>
<pre><code class="language-toml"># Good: Clear and specific
[[modes]]
name = "Development-Rust"

# Bad: Ambiguous
[[modes]]
name = "Mode2"
</code></pre>
<h3 id="4-test-incrementally"><a class="header" href="#4-test-incrementally">4. Test Incrementally</a></h3>
<p>When building a complex config:</p>
<ol>
<li>Start with one mode and one mapping</li>
<li>Test it works</li>
<li>Add more mappings one at a time</li>
<li>Test after each addition</li>
</ol>
<h3 id="5-keep-a-backup"><a class="header" href="#5-keep-a-backup">5. Keep a Backup</a></h3>
<pre><code class="language-bash"># Before major changes
cp config.toml config.toml.backup

# Or use version control
git add config.toml
git commit -m "Add media mode mappings"
</code></pre>
<h3 id="6-use-variables-for-consistency"><a class="header" href="#6-use-variables-for-consistency">6. Use Variables (for consistency)</a></h3>
<p>While TOML doesn't have variables, you can use comments to document repeated values:</p>
<pre><code class="language-toml"># Standard velocity ranges (document once, use everywhere):
# Soft: 0-40
# Medium: 41-80
# Hard: 81-127

[[modes.mappings]]
description = "Soft press"
[modes.mappings.trigger]
type = "VelocityRange"
note = 12
min_velocity = 0    # Soft range
max_velocity = 40
# ... action ...

[[modes.mappings]]
description = "Hard press"
[modes.mappings.trigger]
type = "VelocityRange"
note = 12
min_velocity = 81   # Hard range
max_velocity = 127
# ... action ...
</code></pre>
<h2 id="configuration-hot-reloading-future-feature"><a class="header" href="#configuration-hot-reloading-future-feature">Configuration Hot-Reloading (Future Feature)</a></h2>
<p><strong>Note</strong>: Config hot-reloading is not yet implemented in the current version. To reload config changes:</p>
<pre><code class="language-bash"># Current workaround: Restart MIDIMon
killall midimon
./target/release/midimon 2
</code></pre>
<p><strong>Planned feature</strong> (Phase 2):</p>
<ul>
<li>Watch <code>config.toml</code> for changes</li>
<li>Automatically reload without restarting</li>
<li>Validate before applying (no downtime on errors)</li>
</ul>
<h2 id="see-also-2"><a class="header" href="#see-also-2">See Also</a></h2>
<ul>
<li><a href="configuration/../getting-started/modes.html">Modes Guide</a> - Deep dive into modes</li>
<li><a href="configuration/../reference/triggers.html">Triggers Reference</a> - All trigger types</li>
<li><a href="configuration/../reference/actions.html">Actions Reference</a> - All action types</li>
<li><a href="configuration/../getting-started/first-mapping.html">First Mapping Tutorial</a> - Step-by-step guide</li>
<li><a href="https://toml.io/">TOML Specification</a> - Official TOML documentation</li>
</ul>
<h2 id="troubleshooting-14"><a class="header" href="#troubleshooting-14">Troubleshooting</a></h2>
<h3 id="config-not-loading"><a class="header" href="#config-not-loading">Config Not Loading</a></h3>
<p><strong>Problem</strong>: MIDIMon says "Config file not found"</p>
<p><strong>Solutions</strong>:</p>
<pre><code class="language-bash"># Check file exists
ls -la config.toml

# Check current directory
pwd

# Specify full path
./midimon --config /full/path/to/config.toml
</code></pre>
<hr />
<h3 id="syntax-errors"><a class="header" href="#syntax-errors">Syntax Errors</a></h3>
<p><strong>Problem</strong>: "TOML parse error"</p>
<p><strong>Solutions</strong>:</p>
<ol>
<li>Validate TOML syntax online: https://www.toml-lint.com/</li>
<li>Check quotes, brackets, and indentation</li>
<li>Look for typos in section names</li>
</ol>
<hr />
<h3 id="mappings-not-working"><a class="header" href="#mappings-not-working">Mappings Not Working</a></h3>
<p><strong>Problem</strong>: Config loads but pads don't trigger actions</p>
<p><strong>Debug steps</strong>:</p>
<pre><code class="language-bash"># 1. Verify note numbers
cargo run --bin pad_mapper

# 2. Enable debug logging
DEBUG=1 cargo run --release 2

# 3. Check MIDI events
cargo run --bin midi_diagnostic 2
</code></pre>
<p>See <a href="configuration/../troubleshooting/common-issues.html">Common Issues</a> for more troubleshooting.</p>
<hr />
<p><strong>Last Updated</strong>: November 11, 2025
<strong>Config Version</strong>: 0.1 (current implementation)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="triggers-reference"><a class="header" href="#triggers-reference">Triggers Reference</a></h1>
<blockquote>
<p><strong>Note</strong>: This section is under development and will be completed in Phase 1 (Q1 2025).</p>
<p>For now, please refer to:</p>
<ul>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/README.md">README.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/CLAUDE.md">CLAUDE.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/discussions">GitHub Discussions</a></li>
</ul>
</blockquote>
<h2 id="coming-soon-2"><a class="header" href="#coming-soon-2">Coming Soon</a></h2>
<p>This page will cover:</p>
<ul>
<li>TBD</li>
</ul>
<hr />
<p><strong>Help Wanted</strong>: We're looking for contributors to help write documentation. See <a href="configuration/../development/contributing.html">Contributing Guide</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="actions-reference"><a class="header" href="#actions-reference">Actions Reference</a></h1>
<p>Actions define what happens when a trigger condition is met. MIDIMon supports a rich set of action types that can be composed in powerful ways.</p>
<h2 id="quick-reference"><a class="header" href="#quick-reference">Quick Reference</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Action Type</th><th>Description</th><th>Complexity</th></tr></thead><tbody>
<tr><td><a href="configuration/actions.html#keystroke">Keystroke</a></td><td>Send keyboard shortcuts</td><td>Simple</td></tr>
<tr><td><a href="configuration/actions.html#text">Text</a></td><td>Type text strings</td><td>Simple</td></tr>
<tr><td><a href="configuration/actions.html#launch">Launch</a></td><td>Open applications</td><td>Simple</td></tr>
<tr><td><a href="configuration/actions.html#shell">Shell</a></td><td>Execute shell commands</td><td>Simple</td></tr>
<tr><td><a href="configuration/actions.html#sequence">Sequence</a></td><td>Chain multiple actions</td><td>Moderate</td></tr>
<tr><td><a href="configuration/actions.html#delay">Delay</a></td><td>Add timing control</td><td>Simple</td></tr>
<tr><td><a href="configuration/actions.html#mouseclick">MouseClick</a></td><td>Simulate mouse clicks</td><td>Simple</td></tr>
<tr><td><a href="configuration/actions.html#repeat">Repeat</a></td><td>Repeat actions N times</td><td>Moderate</td></tr>
<tr><td><a href="configuration/actions.html#volumecontrol">VolumeControl</a></td><td>System volume control</td><td>Simple</td></tr>
<tr><td><a href="configuration/actions.html#modechange">ModeChange</a></td><td>Switch mapping modes</td><td>Simple</td></tr>
<tr><td><a href="configuration/actions.html#sendmidi">SendMidi</a></td><td>Send MIDI messages</td><td>Moderate</td></tr>
<tr><td><a href="configuration/actions.html#conditional">Conditional</a></td><td>Context-aware execution</td><td>Advanced</td></tr>
</tbody></table>
</div>
<h2 id="simple-actions"><a class="header" href="#simple-actions">Simple Actions</a></h2>
<h3 id="keystroke"><a class="header" href="#keystroke">Keystroke</a></h3>
<p>Send keyboard shortcuts with modifiers. The most common action type for productivity workflows.</p>
<pre><code class="language-toml"># Single key
[modes.mappings.action]
type = "Keystroke"
keys = "space"

# With modifiers
[modes.mappings.action]
type = "Keystroke"
keys = "c"
modifiers = ["cmd"]  # Cmd+C

# Multiple modifiers
[modes.mappings.action]
type = "Keystroke"
keys = "t"
modifiers = ["cmd", "shift"]  # Cmd+Shift+T
</code></pre>
<p><strong>Available Modifiers</strong>:</p>
<ul>
<li><code>cmd</code> / <code>command</code> / <code>meta</code> - Command key (macOS) / Windows key</li>
<li><code>ctrl</code> / <code>control</code> - Control key</li>
<li><code>alt</code> / <code>option</code> - Alt/Option key</li>
<li><code>shift</code> - Shift key</li>
</ul>
<p><strong>Special Keys</strong>:</p>
<ul>
<li>Navigation: <code>up</code>, <code>down</code>, <code>left</code>, <code>right</code>, <code>home</code>, <code>end</code>, <code>pageup</code>, <code>pagedown</code></li>
<li>Editing: <code>backspace</code>, <code>delete</code>, <code>tab</code>, <code>return</code>, <code>enter</code>, <code>escape</code>, <code>esc</code></li>
<li>Function: <code>f1</code> through <code>f12</code></li>
<li>Other: <code>space</code></li>
</ul>
<h3 id="text"><a class="header" href="#text">Text</a></h3>
<p>Type arbitrary text strings with full Unicode support. Uses keyboard simulation to type character-by-character, making it reliable for Unicode and complex text.</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Text"
text = "Hello, World!"
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Email signatures and contact information</li>
<li>Code snippets and boilerplate</li>
<li>Commonly used phrases and templates</li>
<li>Form auto-fill with saved data</li>
<li>Multi-language text input</li>
<li>Text expansion (abbreviation ‚Üí full text)</li>
</ul>
<p><strong>Advanced Examples</strong>:</p>
<p><strong>Multi-line Code Snippet</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Text"
text = """
fn main() {
    println!(\"Hello, World!\");
}
"""
</code></pre>
<p><strong>Email Signature</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Text"
text = """
Best regards,
John Doe
Senior Developer
john@example.com
"""
</code></pre>
<p><strong>Unicode and Emoji</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Text"
text = "‚úÖ Task completed! üéâ"
</code></pre>
<p><strong>Special Characters</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Text"
text = "!@#$%^&amp;*()_+-=[]{}|;':\",./&lt;&gt;?"
</code></pre>
<p><strong>Slow Typing for Laggy UIs</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Sequence"
actions = [
    { type = "Text", text = "user" },
    { type = "Delay", ms = 100 },
    { type = "Text", text = "name" },
    { type = "Delay", ms = 100 },
    { type = "Text", text = "123" }
]
</code></pre>
<p><strong>TOML String Escaping Tips</strong>:</p>
<ul>
<li>Escape quotes: <code>"He said \"hello\""</code></li>
<li>Multiline strings: <code>"""Line 1\nLine 2"""</code></li>
<li>Literal strings (no escaping): <code>'C:\Users\file.txt'</code></li>
<li>Backslashes: Double them <code>\\</code> or use literal strings</li>
</ul>
<p><strong>Platform Behavior</strong>:</p>
<ul>
<li>Does NOT use clipboard (leaves clipboard unchanged)</li>
<li>Types character-by-character via keyboard simulation</li>
<li>Respects active keyboard layout</li>
<li>Requires text input focus in target app</li>
</ul>
<p><strong>Troubleshooting</strong>:</p>
<ul>
<li>If text doesn't type: Ensure app has input focus</li>
<li>If Unicode fails: Check app supports UTF-8</li>
<li>If too fast: Use Sequence with Delay actions</li>
<li>If wrong characters: Check keyboard layout or escape TOML strings</li>
</ul>
<h3 id="launch"><a class="header" href="#launch">Launch</a></h3>
<p>Open applications by name or path. Simple, cross-platform application launcher.</p>
<p><strong>Basic Usage</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Launch"
app = "Terminal"  # macOS application name
</code></pre>
<p><strong>Full Path</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Launch"
app = "/Applications/Utilities/Terminal.app"
</code></pre>
<p><strong>Script Execution</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Launch"
app = "/Users/username/scripts/backup.sh"  # Must have execute permissions (chmod +x)
</code></pre>
<p><strong>Multiple Apps (Streaming Setup)</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Sequence"
actions = [
    { type = "Launch", app = "OBS" },
    { type = "Delay", ms = 2000 },  # Wait for OBS to load
    { type = "Launch", app = "Discord" },
    { type = "Delay", ms = 1000 },
    { type = "Launch", app = "Spotify" }
]
</code></pre>
<p><strong>Development Environment</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Sequence"
actions = [
    { type = "Launch", app = "Visual Studio Code" },
    { type = "Delay", ms = 1500 },
    { type = "Launch", app = "Terminal" },
    { type = "Delay", ms = 500 },
    { type = "Launch", app = "Safari" }
]
</code></pre>
<p><strong>Platform Behavior</strong>:</p>
<ul>
<li><strong>macOS</strong>: Uses <code>open -a</code> command
<ul>
<li>App names: "Safari", "Visual Studio Code", "Logic Pro"</li>
<li>Full paths: "/Applications/Safari.app"</li>
<li>If running, brings to front (doesn't launch duplicate)</li>
</ul>
</li>
<li><strong>Linux</strong>: Direct executable launch
<ul>
<li>Requires full path or executable in $PATH</li>
<li>Typically launches new instance even if running</li>
</ul>
</li>
<li><strong>Windows</strong>: Uses <code>cmd /C start</code> command
<ul>
<li>Accepts app names or paths</li>
<li>Uses file associations</li>
</ul>
</li>
</ul>
<p><strong>Troubleshooting</strong>:</p>
<ul>
<li>Test manually: <code>open -a "App Name"</code> (macOS) or <code>which app-name</code> (Linux)</li>
<li>Enable debug logging: <code>DEBUG=1 cargo run --release 2</code></li>
<li>Use full paths if app names don't work</li>
<li>Ensure scripts have execute permissions: <code>chmod +x script.sh</code></li>
</ul>
<h3 id="shell"><a class="header" href="#shell">Shell</a></h3>
<p>Execute system commands directly without shell interpreter (secure execution).</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Shell"
command = "git status"
</code></pre>
<p><strong>Security Design</strong>: Commands are executed directly via <code>Command::new(program).args(args)</code> without using shell interpreters (<code>sh</code>, <code>bash</code>, <code>cmd</code>). This prevents command injection attacks while supporting common use cases.</p>
<p><strong>Supported Examples</strong>:</p>
<pre><code class="language-toml"># Simple commands
command = "git status"
command = "ls -la /tmp"

# File operations
command = "open ~/Downloads"

# System info
command = "system_profiler SPUSBDataType"

# AppleScript (macOS)
command = "osascript -e 'set volume 50'"
command = "osascript -e 'display notification \"MIDI triggered!\"'"
</code></pre>
<p><strong>Shell Features NOT Supported</strong> (for security):</p>
<ul>
<li>Command chaining: <code>&amp;&amp;</code>, <code>||</code>, <code>;</code></li>
<li>Piping: <code>|</code></li>
<li>Redirection: <code>&gt;</code>, <code>&lt;</code>, <code>&gt;&gt;</code></li>
<li>Command substitution: <code>$(...)</code>, <code>`...`</code></li>
<li>Variable expansion: <code>$HOME</code>, <code>${VAR}</code></li>
</ul>
<p><strong>Alternative</strong>: Use <code>Sequence</code> action to chain multiple commands:</p>
<pre><code class="language-toml"># Instead of: "git add . &amp;&amp; git commit -m 'save'"
type = "Sequence"
actions = [
    { type = "Shell", command = "git add ." },
    { type = "Shell", command = "git commit -m 'save'" }
]
</code></pre>
<h2 id="timing--flow-control"><a class="header" href="#timing--flow-control">Timing &amp; Flow Control</a></h2>
<h3 id="delay"><a class="header" href="#delay">Delay</a></h3>
<p>Add pauses between actions in sequences.</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Delay"
ms = 500  # 500 milliseconds
</code></pre>
<p><strong>Typical Uses</strong>:</p>
<ul>
<li>Wait for UI to load</li>
<li>Slow down rapid automation</li>
<li>Add deliberate pacing to sequences</li>
</ul>
<h3 id="sequence"><a class="header" href="#sequence">Sequence</a></h3>
<p>Execute multiple actions in order. Automatic 50ms delay between actions.</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Sequence"
actions = [
    { type = "Keystroke", keys = "space", modifiers = ["cmd"] },  # Spotlight
    { type = "Delay", ms = 200 },  # Wait for Spotlight
    { type = "Text", text = "Terminal" },
    { type = "Keystroke", keys = "return" }  # Launch
]
</code></pre>
<p><strong>Design Patterns</strong>:</p>
<p><strong>1. Application Launcher</strong>:</p>
<pre><code class="language-toml">type = "Sequence"
actions = [
    { type = "Keystroke", keys = "space", modifiers = ["cmd"] },
    { type = "Delay", ms = 100 },
    { type = "Text", text = "VS Code" },
    { type = "Keystroke", keys = "return" }
]
</code></pre>
<p><strong>2. File Workflow</strong>:</p>
<pre><code class="language-toml">type = "Sequence"
actions = [
    { type = "Keystroke", keys = "s", modifiers = ["cmd"] },  # Save
    { type = "Delay", ms = 100 },
    { type = "Keystroke", keys = "w", modifiers = ["cmd"] },  # Close
    { type = "Delay", ms = 50 },
    { type = "Keystroke", keys = "down" },  # Next file
    { type = "Keystroke", keys = "return" }  # Open
]
</code></pre>
<p><strong>3. Git Workflow</strong>:</p>
<pre><code class="language-toml">type = "Sequence"
actions = [
    { type = "Shell", command = "git add -A" },
    { type = "Delay", ms = 100 },
    { type = "Shell", command = "git commit -m 'quick save'" },
    { type = "Delay", ms = 100 },
    { type = "Shell", command = "git push" }
]
</code></pre>
<h3 id="repeat"><a class="header" href="#repeat">Repeat</a></h3>
<p>Repeat an action (or sequence) multiple times.</p>
<pre><code class="language-toml"># Simple repeat: scroll down 10 times
[modes.mappings.action]
type = "Repeat"
count = 10
action = { type = "Keystroke", keys = "down" }
</code></pre>
<p><strong>With Delay Between Iterations</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Repeat"
count = 5
delay_ms = 200  # 200ms between each press
action = { type = "Keystroke", keys = "down" }
</code></pre>
<p><strong>Repeat a Sequence</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Repeat"
count = 3
delay_ms = 1000
action = {
    type = "Sequence",
    actions = [
        { type = "Keystroke", keys = "down" },  # Select next item
        { type = "Delay", ms = 100 },
        { type = "Keystroke", keys = "return" },  # Open
        { type = "Delay", ms = 500 },
        { type = "Keystroke", keys = "w", modifiers = ["cmd"] }  # Close
    ]
}
</code></pre>
<p><strong>Error Handling</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Repeat"
count = 3
delay_ms = 2000
action = { type = "Launch", app = "Xcode" }
</code></pre>
<p><strong>Parameters</strong>:</p>
<ul>
<li><code>count</code> (required): Number of repetitions (0 = no-op, 1 = run once)</li>
<li><code>action</code> (required): Action to repeat</li>
<li><code>delay_ms</code> (optional): Delay in milliseconds between iterations (not applied after last iteration)</li>
</ul>
<p><strong>Edge Cases</strong>:</p>
<ul>
<li><code>count = 0</code> is valid (no-op)</li>
<li><code>count = 1</code> executes once with no delay</li>
<li>Nested repeats multiply: 10 outer √ó 5 inner = 50 total</li>
<li>Large counts (&gt;1000) may appear as hang</li>
<li>Blocking operation - cannot interrupt</li>
</ul>
<p><strong>Use Cases</strong>:</p>
<ol>
<li><strong>Pagination</strong>: Scroll through long lists</li>
<li><strong>Batch Processing</strong>: Repeat workflow on multiple items</li>
<li><strong>Velocity Mapping</strong>: Different repeat counts for soft/medium/hard presses</li>
<li><strong>Retry Logic</strong>: Try launching app multiple times</li>
</ol>
<h2 id="mouse-actions"><a class="header" href="#mouse-actions">Mouse Actions</a></h2>
<h3 id="mouseclick"><a class="header" href="#mouseclick">MouseClick</a></h3>
<p>Simulate mouse clicks with optional positioning.</p>
<pre><code class="language-toml"># Click at current cursor position
[modes.mappings.action]
type = "MouseClick"
button = "Left"

# Click at specific coordinates
[modes.mappings.action]
type = "MouseClick"
button = "Right"
x = 500
y = 300
</code></pre>
<p><strong>Button Options</strong>: <code>Left</code>, <code>Right</code>, <code>Middle</code></p>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Click UI elements at fixed positions</li>
<li>Context menu automation</li>
<li>Drag-and-drop workflows (with sequences)</li>
</ul>
<h2 id="system-actions"><a class="header" href="#system-actions">System Actions</a></h2>
<h3 id="volumecontrol"><a class="header" href="#volumecontrol">VolumeControl</a></h3>
<p>Control system volume with platform-specific implementations.</p>
<p><strong>Platform Support</strong>:</p>
<ul>
<li><strong>macOS</strong>: AppleScript via <code>osascript</code> (full support)</li>
<li><strong>Linux/Windows</strong>: Not yet implemented</li>
</ul>
<pre><code class="language-toml"># Volume up (increment by 5)
[modes.mappings.action]
type = "VolumeControl"
operation = "Up"

# Volume down (decrement by 5)
[modes.mappings.action]
type = "VolumeControl"
operation = "Down"

# Mute
[modes.mappings.action]
type = "VolumeControl"
operation = "Mute"

# Unmute
[modes.mappings.action]
type = "VolumeControl"
operation = "Unmute"

# Set specific volume (0-100)
[modes.mappings.action]
type = "VolumeControl"
operation = "Set"
value = 50
</code></pre>
<p><strong>Operations</strong>:</p>
<ul>
<li><code>Up</code> - Increase volume by 5%</li>
<li><code>Down</code> - Decrease volume by 5%</li>
<li><code>Mute</code> - Mute audio output</li>
<li><code>Unmute</code> - Unmute audio output</li>
<li><code>Set</code> - Set volume to specific level (0-100), requires <code>value</code> parameter</li>
</ul>
<p><strong>Encoder Volume Control Example</strong>:</p>
<pre><code class="language-toml">[[global_mappings]]
description = "Encoder for volume control"
[global_mappings.trigger]
type = "EncoderTurn"
direction = "Clockwise"
[global_mappings.action]
type = "VolumeControl"
operation = "Up"

[[global_mappings]]
description = "Encoder for volume control"
[global_mappings.trigger]
type = "EncoderTurn"
direction = "CounterClockwise"
[global_mappings.action]
type = "VolumeControl"
operation = "Down"
</code></pre>
<p><strong>Performance</strong>: &lt;100ms response time on macOS</p>
<h3 id="modechange"><a class="header" href="#modechange">ModeChange</a></h3>
<p>Switch between mapping modes programmatically.</p>
<pre><code class="language-toml"># Switch to specific mode by name
[modes.mappings.action]
type = "ModeChange"
mode = "Media"
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li><strong>Context Switching</strong>: Switch to different mapping sets</li>
<li><strong>Workflow Modes</strong>: Development, Media, Gaming modes</li>
<li><strong>Scene Control</strong>: Different modes for streaming scenes</li>
</ul>
<p><strong>Example - Mode Switcher Pad</strong>:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Switch to Media mode"
[modes.mappings.trigger]
type = "Note"
note = 15
[modes.mappings.action]
type = "ModeChange"
mode = "Media"
</code></pre>
<p><strong>Note</strong>: Mode changes trigger LED color updates and mapping context switches. The mode name must match a defined mode in your configuration.</p>
<h2 id="midi-output-actions"><a class="header" href="#midi-output-actions">MIDI Output Actions</a></h2>
<h3 id="sendmidi"><a class="header" href="#sendmidi">SendMidi</a></h3>
<p>Send MIDI messages to physical or virtual MIDI output ports. Enables DAW control, external synth control, and MIDI routing.</p>
<p><strong>Platform Support</strong>: macOS, Linux, Windows (all platforms with MIDI output)</p>
<pre><code class="language-toml"># Send MIDI Note On
[modes.mappings.action]
type = "SendMidi"
port = "IAC Driver Bus 1"  # Virtual MIDI port name
message_type = "NoteOn"
channel = 0        # MIDI channel 0-15 (maps to channel 1-16)
note = 60          # Middle C (0-127)
velocity = 100     # Note velocity (0-127)
</code></pre>
<p><strong>Message Types</strong>:</p>
<p><strong>NoteOn</strong> - Note on with velocity:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "SendMidi"
port = "Virtual MIDI Port"
message_type = "NoteOn"
channel = 0    # MIDI channel 0-15
note = 60      # Note number (0-127)
velocity = 100 # Velocity (0-127)
</code></pre>
<p><strong>NoteOff</strong> - Note off:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "SendMidi"
port = "Virtual MIDI Port"
message_type = "NoteOff"
channel = 0
note = 60
velocity = 0  # Release velocity (usually 0)
</code></pre>
<p><strong>CC (Control Change)</strong> - MIDI control change:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "SendMidi"
port = "Virtual MIDI Port"
message_type = "CC"
channel = 0
controller = 7  # Controller number (0-127, e.g., 7=Volume, 1=Modulation)
value = 100     # Controller value (0-127)
</code></pre>
<p><strong>ProgramChange</strong> - Change program/preset:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "SendMidi"
port = "Virtual MIDI Port"
message_type = "ProgramChange"
channel = 0
program = 9  # Program number (0-127)
</code></pre>
<p><strong>PitchBend</strong> - Pitch bend wheel:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "SendMidi"
port = "Virtual MIDI Port"
message_type = "PitchBend"
channel = 0
value = 0  # Pitch bend value (-8192 to +8191, 0 = center)
</code></pre>
<p><strong>Aftertouch</strong> - Channel pressure:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "SendMidi"
port = "Virtual MIDI Port"
message_type = "Aftertouch"
channel = 0
pressure = 64  # Pressure value (0-127)
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li><strong>DAW Control</strong>: Send notes/CC to control Logic Pro, Ableton Live, FL Studio</li>
<li><strong>Virtual Instruments</strong>: Trigger software synths and samplers</li>
<li><strong>MIDI Routing</strong>: Route controller input to different destinations</li>
<li><strong>Hardware Synths</strong>: Control external synthesizers and drum machines</li>
<li><strong>Lighting Control</strong>: Send MIDI to DMX/lighting systems</li>
</ul>
<p><strong>Example - Velocity-Sensitive MIDI</strong>:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Expressive MIDI note with velocity curve"

[modes.mappings.trigger]
type = "Note"
note = 1

[modes.mappings.velocity_mapping]
type = "Curve"
curve_type = "Exponential"
intensity = 0.7  # Boost soft hits

[modes.mappings.action]
type = "SendMidi"
port = "IAC Driver Bus 1"
message_type = "NoteOn"
channel = 0
note = 60
# Velocity is derived from velocity_mapping transformation
</code></pre>
<p><strong>Example - Control DAW Volume</strong>:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Control track volume with CC"

[modes.mappings.trigger]
type = "Note"
note = 5

[modes.mappings.action]
type = "SendMidi"
port = "IAC Driver Bus 1"
message_type = "CC"
channel = 0
controller = 7   # Volume CC
value = 100
</code></pre>
<p><strong>Example - Note On/Off Sequence</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Sequence"
actions = [
  { type = "SendMidi", port = "IAC", message_type = "NoteOn", channel = 0, note = 60, velocity = 100 },
  { type = "Delay", ms = 500 },
  { type = "SendMidi", port = "IAC", message_type = "NoteOff", channel = 0, note = 60, velocity = 0 }
]
</code></pre>
<p><strong>Virtual MIDI Ports</strong>:</p>
<ul>
<li><strong>macOS</strong>: Use IAC Driver (Audio MIDI Setup ‚Üí Window ‚Üí Show MIDI Studio ‚Üí IAC Driver)</li>
<li><strong>Windows</strong>: Use loopMIDI or similar virtual MIDI port software</li>
<li><strong>Linux</strong>: Use ALSA virtual ports</li>
</ul>
<p><strong>Note</strong>: Virtual MIDI port creation is not yet automated. Use system tools to create virtual ports, then reference them by name in the <code>port</code> parameter.</p>
<h2 id="advanced-actions"><a class="header" href="#advanced-actions">Advanced Actions</a></h2>
<h3 id="conditional"><a class="header" href="#conditional">Conditional</a></h3>
<p>Execute different actions based on runtime conditions such as time, active app, current mode, or day of week. Enables context-aware, adaptive behavior.</p>
<p><strong>Complete Documentation</strong>: See <a href="configuration/conditionals.html">Configuration: Conditionals</a> for comprehensive reference.</p>
<p><strong>Basic Structure</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"
condition = { /* condition definition */ }
then_action = { /* action if true */ }
else_action = { /* optional action if false */ }
</code></pre>
<p><strong>Quick Examples</strong>:</p>
<p><strong>Time-Based Launcher</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "TimeRange"
start = "09:00"
end = "17:00"

[modes.mappings.action.then_action]
type = "Launch"
app = "Slack"  # Work hours

[modes.mappings.action.else_action]
type = "Launch"
app = "Discord"  # Off hours
</code></pre>
<p><strong>App-Aware Control</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "AppRunning"
app_name = "Logic Pro"

[modes.mappings.action.then_action]
type = "SendMidi"
port = "IAC Driver Bus 1"
message_type = "NoteOn"
channel = 0
note = 60
velocity = 100

[modes.mappings.action.else_action]
type = "Launch"
app = "Logic Pro"
</code></pre>
<p><strong>Multiple Conditions (AND)</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "And"
conditions = [
  { type = "TimeRange", start = "09:00", end = "17:00" },
  { type = "DayOfWeek", days = [1, 2, 3, 4, 5] },
  { type = "AppRunning", app_name = "Slack" }
]

[modes.mappings.action.then_action]
type = "Keystroke"
keys = "s"
modifiers = ["cmd", "shift"]
</code></pre>
<p><strong>Multiple Conditions (OR)</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "Or"
conditions = [
  { type = "AppFrontmost", app_name = "Safari" },
  { type = "AppFrontmost", app_name = "Chrome" },
  { type = "AppFrontmost", app_name = "Firefox" }
]

[modes.mappings.action.then_action]
type = "Keystroke"
keys = "t"
modifiers = ["cmd"]  # New tab in any browser
</code></pre>
<p><strong>Available Condition Types</strong>:</p>
<ul>
<li><code>Always</code> - Always true</li>
<li><code>Never</code> - Always false</li>
<li><code>TimeRange</code> - Time window (HH:MM format)</li>
<li><code>DayOfWeek</code> - Specific days (1=Monday through 7=Sunday)</li>
<li><code>AppRunning</code> - Process detection (macOS, Linux)</li>
<li><code>AppFrontmost</code> - Active window detection (macOS only)</li>
<li><code>ModeIs</code> - Current mode matching</li>
<li><code>And</code> - Logical AND of multiple conditions</li>
<li><code>Or</code> - Logical OR of multiple conditions</li>
<li><code>Not</code> - Logical negation</li>
</ul>
<p><strong>See Also</strong>:</p>
<ul>
<li><a href="configuration/conditionals.html">Configuration: Conditionals</a> - Complete TOML reference</li>
<li><a href="configuration/../guides/context-aware.html">Guide: Context-Aware Mappings</a> - User guide with examples</li>
<li><a href="configuration/../tutorials/dynamic-workflows.html">Tutorial: Dynamic Workflows</a> - Step-by-step tutorial</li>
</ul>
<h2 id="action-composition-patterns"><a class="header" href="#action-composition-patterns">Action Composition Patterns</a></h2>
<h3 id="1-velocity-based-repeat-count"><a class="header" href="#1-velocity-based-repeat-count">1. Velocity-Based Repeat Count</a></h3>
<p>Different repeat counts based on how hard you hit the pad:</p>
<pre><code class="language-toml">[modes.mappings.trigger]
type = "VelocityRange"
note = 10
ranges = [
    # Soft: repeat 3 times
    { min = 0, max = 40, action = {
        type = "Repeat",
        count = 3,
        action = { type = "Keystroke", keys = "down" }
    }},
    # Medium: repeat 5 times
    { min = 41, max = 80, action = {
        type = "Repeat",
        count = 5,
        action = { type = "Keystroke", keys = "down" }
    }},
    # Hard: repeat 10 times
    { min = 81, max = 127, action = {
        type = "Repeat",
        count = 10,
        action = { type = "Keystroke", keys = "down" }
    }}
]
</code></pre>
<h3 id="2-nested-repeats"><a class="header" href="#2-nested-repeats">2. Nested Repeats</a></h3>
<p>Multiply effect (use with caution!):</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Repeat"
count = 3  # Outer loop
action = {
    type = "Repeat",
    count = 5,  # Inner loop ‚Üí 3 √ó 5 = 15 total
    action = { type = "Keystroke", keys = "down" }
}
</code></pre>
<h3 id="3-complex-automation-workflow"><a class="header" href="#3-complex-automation-workflow">3. Complex Automation Workflow</a></h3>
<p>Combine sequences, repeats, and delays:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Sequence"
actions = [
    # Open file browser
    { type = "Keystroke", keys = "o", modifiers = ["cmd"] },
    { type = "Delay", ms = 500 },

    # Navigate to folder
    { type = "Keystroke", keys = "g", modifiers = ["cmd", "shift"] },
    { type = "Delay", ms = 200 },
    { type = "Text", text = "~/Downloads" },
    { type = "Keystroke", keys = "return" },
    { type = "Delay", ms = 500 },

    # Process first 3 files
    { type = "Repeat", count = 3, delay_between_ms = 1000, action = {
        type = "Sequence",
        actions = [
            { type = "Keystroke", keys = "return" },  # Open file
            { type = "Delay", ms = 800 },
            { type = "Keystroke", keys = "e", modifiers = ["cmd"] },  # Export
            { type = "Delay", ms = 500 },
            { type = "Keystroke", keys = "return" },  # Confirm
            { type = "Delay", ms = 1000 },
            { type = "Keystroke", keys = "w", modifiers = ["cmd"] },  # Close
            { type = "Delay", ms = 200 },
            { type = "Keystroke", keys = "down" }  # Next file
        ]
    }}
]
</code></pre>
<h2 id="performance--best-practices"><a class="header" href="#performance--best-practices">Performance &amp; Best Practices</a></h2>
<h3 id="timing-guidelines"><a class="header" href="#timing-guidelines">Timing Guidelines</a></h3>
<ul>
<li><strong>Keystroke</strong>: Instant (&lt;1ms)</li>
<li><strong>Text</strong>: ~10ms per character</li>
<li><strong>Launch</strong>: 100-2000ms (app dependent)</li>
<li><strong>Shell</strong>: Variable (command dependent)</li>
<li><strong>Sequence</strong>: 50ms auto-delay between actions</li>
<li><strong>Delay</strong>: As specified</li>
<li><strong>MouseClick</strong>: &lt;5ms</li>
<li><strong>Repeat</strong>: count √ó (action time + delay_between_ms)</li>
</ul>
<h3 id="optimization-tips"><a class="header" href="#optimization-tips">Optimization Tips</a></h3>
<ol>
<li><strong>Minimize Delays</strong>: Only add delays where needed (UI loading, animations)</li>
<li><strong>Batch Operations</strong>: Use Sequence instead of multiple mappings</li>
<li><strong>Avoid High-Frequency Repeats</strong>: Add <code>delay_between_ms</code> for rapid repeats</li>
<li><strong>Test Incrementally</strong>: Start with count=1, then increase</li>
<li><strong>Consider User Experience</strong>: Long-running actions should have feedback</li>
</ol>
<h3 id="common-pitfalls"><a class="header" href="#common-pitfalls">Common Pitfalls</a></h3>
<ol>
<li><strong>Blocking Operations</strong>: Repeats and sequences block - cannot interrupt</li>
<li><strong>Timing Fragility</strong>: UI timing varies by system load</li>
<li><strong>Nested Explosions</strong>: 10 √ó 10 nested repeat = 100 executions</li>
<li><strong>Error Swallowing</strong>: <code>stop_on_error = false</code> continues silently</li>
</ol>
<h3 id="debugging-actions"><a class="header" href="#debugging-actions">Debugging Actions</a></h3>
<p>Enable debug mode to see action execution:</p>
<pre><code class="language-bash">DEBUG=1 cargo run --release 2
</code></pre>
<p>Watch for:</p>
<ul>
<li>Action start/completion logs</li>
<li>Timing between actions</li>
<li>Error messages</li>
<li>Repeat iteration counts</li>
</ul>
<h2 id="see-also-3"><a class="header" href="#see-also-3">See Also</a></h2>
<ul>
<li><a href="configuration/../reference/action-types.html">Action Types Reference</a> - Complete technical specifications</li>
<li><a href="configuration/examples.html">Configuration Examples</a> - Real-world configuration patterns</li>
<li><a href="configuration/../reference/trigger-types.html">Trigger Types</a> - Trigger configuration reference</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="velocity-mapping-configuration"><a class="header" href="#velocity-mapping-configuration">Velocity Mapping Configuration</a></h1>
<p>Complete TOML reference for velocity mapping configuration.</p>
<hr />
<h2 id="overview-11"><a class="header" href="#overview-11">Overview</a></h2>
<p>Velocity mappings transform input velocity (0-127) into output velocity using configurable curves. This allows you to customize the relationship between how hard you hit a pad and what action is triggered.</p>
<hr />
<h2 id="configuration-location"><a class="header" href="#configuration-location">Configuration Location</a></h2>
<p>Velocity mappings are configured per-mapping in the <code>velocity_mapping</code> field:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "My mapping"

[modes.mappings.trigger]
type = "Note"
note = 5

[modes.mappings.velocity_mapping]
# Velocity mapping configuration goes here

[modes.mappings.action]
type = "SendMidi"
# ...
</code></pre>
<hr />
<h2 id="velocity-mapping-types-1"><a class="header" href="#velocity-mapping-types-1">Velocity Mapping Types</a></h2>
<h3 id="fixed"><a class="header" href="#fixed">Fixed</a></h3>
<p>Output is always the same velocity, regardless of input.</p>
<p><strong>Fields</strong>:</p>
<ul>
<li><code>type</code> (string, required): Must be <code>"Fixed"</code></li>
<li><code>velocity</code> (integer, required): Output velocity (0-127)</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">[velocity_mapping]
type = "Fixed"
velocity = 100
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Actions that don't need velocity variation</li>
<li>Ensure consistent behavior regardless of hit strength</li>
<li>Testing and debugging</li>
</ul>
<hr />
<h3 id="passthrough"><a class="header" href="#passthrough">PassThrough</a></h3>
<p>Output velocity equals input velocity (1:1 mapping). This is the default if no velocity mapping is specified.</p>
<p><strong>Fields</strong>:</p>
<ul>
<li>Can be specified as just the string <code>"PassThrough"</code> (no fields required)</li>
</ul>
<p><strong>Example (short form)</strong>:</p>
<pre><code class="language-toml">velocity_mapping = "PassThrough"
</code></pre>
<p><strong>Example (explicit form)</strong>:</p>
<pre><code class="language-toml">[velocity_mapping]
type = "PassThrough"
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Natural, unmodified velocity response</li>
<li>Direct MIDI pass-through</li>
<li>When you want no velocity transformation</li>
</ul>
<hr />
<h3 id="linear"><a class="header" href="#linear">Linear</a></h3>
<p>Maps full input range (0-127) to custom output range with linear scaling.</p>
<p><strong>Fields</strong>:</p>
<ul>
<li><code>type</code> (string, required): Must be <code>"Linear"</code></li>
<li><code>min</code> (integer, required): Minimum output velocity (0-127)</li>
<li><code>max</code> (integer, required): Maximum output velocity (0-127)</li>
</ul>
<p><strong>Behavior</strong>:</p>
<ul>
<li>Input 0 ‚Üí Output <code>min</code></li>
<li>Input 127 ‚Üí Output <code>max</code></li>
<li>Values between are scaled proportionally</li>
</ul>
<p><strong>Formula</strong>:</p>
<pre><code>output = min + (input / 127) √ó (max - min)
</code></pre>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">[velocity_mapping]
type = "Linear"
min = 40   # Softest hit = 40 (instead of 0)
max = 110  # Hardest hit = 110 (instead of 127)
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Compress dynamic range (e.g., 0-127 ‚Üí 60-100)</li>
<li>Expand subtle playing (e.g., 0-127 ‚Üí 20-127)</li>
<li>Shift velocity range up or down</li>
<li>Make soft hits louder while preventing loud spikes</li>
</ul>
<p><strong>Parameter Constraints</strong>:</p>
<ul>
<li><code>min</code> must be ‚â§ <code>max</code></li>
<li>Both must be in range 0-127</li>
<li>If <code>min</code> = <code>max</code>, acts like Fixed mapping</li>
</ul>
<hr />
<h3 id="curve"><a class="header" href="#curve">Curve</a></h3>
<p>Applies non-linear transformation with adjustable intensity.</p>
<p><strong>Fields</strong>:</p>
<ul>
<li><code>type</code> (string, required): Must be <code>"Curve"</code></li>
<li><code>curve_type</code> (string, required): One of <code>"Exponential"</code>, <code>"Logarithmic"</code>, or <code>"SCurve"</code></li>
<li><code>intensity</code> (float, required): Curve intensity (0.0 = linear, 1.0 = maximum effect)</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">[velocity_mapping]
type = "Curve"
curve_type = "Exponential"
intensity = 0.7
</code></pre>
<hr />
<h4 id="exponential-curve"><a class="header" href="#exponential-curve">Exponential Curve</a></h4>
<p>Makes soft hits louder while preserving hard hits.</p>
<p><strong>Formula</strong>:</p>
<pre><code>output = input^(1 - intensity)
</code></pre>
<p><strong>Behavior</strong>:</p>
<ul>
<li><code>intensity = 0.0</code>: Linear (no change)</li>
<li><code>intensity = 0.5</code>: Moderate compression of soft notes</li>
<li><code>intensity = 1.0</code>: Maximum compression (all inputs ‚Üí 127)</li>
</ul>
<p><strong>Effect</strong>:</p>
<ul>
<li>Low input velocities are boosted significantly</li>
<li>High input velocities remain relatively unchanged</li>
<li>Creates "compressed" feel that makes subtle playing more audible</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">[velocity_mapping]
type = "Curve"
curve_type = "Exponential"
intensity = 0.8  # Strong boost for soft hits
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Make soft playing more audible</li>
<li>Compensate for light touch</li>
<li>Reduce dynamic range while preserving expressiveness</li>
<li>MIDI output to DAWs where soft notes get lost</li>
</ul>
<hr />
<h4 id="logarithmic-curve"><a class="header" href="#logarithmic-curve">Logarithmic Curve</a></h4>
<p>Compresses dynamic range, making loud hits quieter relative to soft hits.</p>
<p><strong>Formula</strong>:</p>
<pre><code>normalized_input = input / 127
output = log(1 + intensity √ó normalized_input) / log(1 + intensity) √ó 127
</code></pre>
<p><strong>Behavior</strong>:</p>
<ul>
<li><code>intensity = 0.0</code>: Linear (no change)</li>
<li><code>intensity = 0.5</code>: Moderate compression</li>
<li><code>intensity = 1.0</code>: Maximum compression</li>
</ul>
<p><strong>Effect</strong>:</p>
<ul>
<li>High input velocities are attenuated</li>
<li>Low input velocities are relatively preserved</li>
<li>Creates "tamed" feel that prevents aggressive playing from being too loud</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">[velocity_mapping]
type = "Curve"
curve_type = "Logarithmic"
intensity = 0.6  # Moderate taming of loud hits
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Tame aggressive playing</li>
<li>Prevent ear-splitting volume spikes</li>
<li>Smooth out dynamic range for consistent mix</li>
<li>Volume control actions that need gentle adjustment</li>
</ul>
<hr />
<h4 id="s-curve-sigmoid"><a class="header" href="#s-curve-sigmoid">S-Curve (Sigmoid)</a></h4>
<p>Smooth acceleration in middle range with soft and hard extremes less affected.</p>
<p><strong>Formula</strong>:</p>
<pre><code>normalized_input = input / 127
k = intensity √ó 10 + 0.5
sigmoid = 1 / (1 + exp(-k √ó (normalized_input - 0.5)))
output = normalize(sigmoid) √ó 127
</code></pre>
<p><strong>Behavior</strong>:</p>
<ul>
<li><code>intensity = 0.0</code>: Nearly linear</li>
<li><code>intensity = 0.5</code>: Balanced S-curve with noticeable "sweet spot"</li>
<li><code>intensity = 1.0</code>: Sharp transition in midrange</li>
</ul>
<p><strong>Effect</strong>:</p>
<ul>
<li>Creates a "sweet spot" in the middle velocity range</li>
<li>Soft and hard extremes are less affected</li>
<li>Natural-feeling response with smooth acceleration</li>
<li>Provides more control in the middle range while preserving extremes</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">[velocity_mapping]
type = "Curve"
curve_type = "SCurve"
intensity = 0.5  # Balanced response with sweet spot
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Natural-feeling dynamics</li>
<li>Emphasis on mid-range control</li>
<li>Smooth transitions between soft and hard</li>
<li>Expressive MIDI control with gradual acceleration</li>
</ul>
<hr />
<h2 id="intensity-parameter-guide"><a class="header" href="#intensity-parameter-guide">Intensity Parameter Guide</a></h2>
<p>For Curve mappings, the <code>intensity</code> parameter controls how pronounced the curve effect is:</p>
<div class="table-wrapper"><table><thead><tr><th>Intensity</th><th>Effect</th><th>Typical Use Case</th></tr></thead><tbody>
<tr><td>0.0 - 0.2</td><td>Very subtle</td><td>Fine-tuning, slight adjustment</td></tr>
<tr><td>0.3 - 0.5</td><td>Moderate</td><td>Noticeable but natural feel</td></tr>
<tr><td>0.6 - 0.8</td><td>Strong</td><td>Significant transformation</td></tr>
<tr><td>0.9 - 1.0</td><td>Extreme</td><td>Dramatic effect, testing</td></tr>
</tbody></table>
</div>
<p><strong>Recommendation</strong>: Start with <code>0.5</code> and adjust in increments of 0.1 until you find the desired feel.</p>
<hr />
<h2 id="combining-with-actions"><a class="header" href="#combining-with-actions">Combining with Actions</a></h2>
<p>Velocity mappings apply <strong>before</strong> the action is executed. The transformed velocity is passed to the action.</p>
<h3 id="sendmidi-action"><a class="header" href="#sendmidi-action">SendMidi Action</a></h3>
<pre><code class="language-toml">[velocity_mapping]
type = "Curve"
curve_type = "Exponential"
intensity = 0.7

[action]
type = "SendMidi"
port = "Virtual MIDI Port"
message_type = "NoteOn"
channel = 0
note = 60
# Velocity is derived from the mapped input velocity
</code></pre>
<h3 id="velocityrange-action"><a class="header" href="#velocityrange-action">VelocityRange Action</a></h3>
<p>Velocity mapping transforms the input <strong>before</strong> VelocityRange thresholds are applied:</p>
<pre><code class="language-toml">[velocity_mapping]
type = "Linear"
min = 30
max = 120

[action]
type = "VelocityRange"
soft_max = 50    # Applied to mapped velocity (30-120 range)
medium_max = 90
soft_action = { type = "Text", text = "Soft" }
medium_action = { type = "Text", text = "Medium" }
hard_action = { type = "Text", text = "Hard" }
</code></pre>
<hr />
<h2 id="default-behavior"><a class="header" href="#default-behavior">Default Behavior</a></h2>
<p>If no <code>velocity_mapping</code> is specified, <strong>PassThrough</strong> is used by default:</p>
<pre><code class="language-toml">[[modes.mappings]]
# No velocity_mapping specified = PassThrough
[modes.mappings.action]
type = "SendMidi"
# Velocity is passed through unchanged
</code></pre>
<hr />
<h2 id="validation-rules"><a class="header" href="#validation-rules">Validation Rules</a></h2>
<p><strong>Type Validation</strong>:</p>
<ul>
<li><code>type</code> must be one of: <code>"Fixed"</code>, <code>"PassThrough"</code>, <code>"Linear"</code>, <code>"Curve"</code></li>
<li>Invalid type will cause config load error</li>
</ul>
<p><strong>Fixed Validation</strong>:</p>
<ul>
<li><code>velocity</code> must be 0-127</li>
<li>Missing <code>velocity</code> will cause error</li>
</ul>
<p><strong>Linear Validation</strong>:</p>
<ul>
<li><code>min</code> and <code>max</code> must be 0-127</li>
<li><code>min</code> should be ‚â§ <code>max</code> (not enforced, but illogical if reversed)</li>
<li>Missing <code>min</code> or <code>max</code> will cause error</li>
</ul>
<p><strong>Curve Validation</strong>:</p>
<ul>
<li><code>curve_type</code> must be one of: <code>"Exponential"</code>, <code>"Logarithmic"</code>, <code>"SCurve"</code></li>
<li><code>intensity</code> must be 0.0-1.0</li>
<li>Missing <code>curve_type</code> or <code>intensity</code> will cause error</li>
</ul>
<hr />
<h2 id="examples-1"><a class="header" href="#examples-1">Examples</a></h2>
<h3 id="example-1-consistent-launch-action"><a class="header" href="#example-1-consistent-launch-action">Example 1: Consistent Launch Action</a></h3>
<p>Ignore velocity variation for application launching:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Launch browser (any hit strength)"

[modes.mappings.trigger]
type = "Note"
note = 5

[modes.mappings.velocity_mapping]
type = "Fixed"
velocity = 100  # Doesn't actually matter for Launch

[modes.mappings.action]
type = "Launch"
app = "Safari"
</code></pre>
<hr />
<h3 id="example-2-gentle-volume-control-1"><a class="header" href="#example-2-gentle-volume-control-1">Example 2: Gentle Volume Control</a></h3>
<p>Compress volume adjustments for smoother control:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Volume up (gentle)"

[modes.mappings.trigger]
type = "Note"
note = 10

[modes.mappings.velocity_mapping]
type = "Linear"
min = 60   # Even soft tap has impact
max = 100  # Prevent ear-splitting jumps

[modes.mappings.action]
type = "VolumeControl"
operation = "Up"
</code></pre>
<hr />
<h3 id="example-3-expressive-midi-output"><a class="header" href="#example-3-expressive-midi-output">Example 3: Expressive MIDI Output</a></h3>
<p>Boost soft playing for DAW control:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "MIDI note with boosted soft hits"

[modes.mappings.trigger]
type = "Note"
note = 1

[modes.mappings.velocity_mapping]
type = "Curve"
curve_type = "Exponential"
intensity = 0.7

[modes.mappings.action]
type = "SendMidi"
port = "IAC Driver Bus 1"
message_type = "NoteOn"
channel = 0
note = 60
velocity = 100  # This is overridden by mapped velocity
</code></pre>
<hr />
<h3 id="example-4-natural-response-curve"><a class="header" href="#example-4-natural-response-curve">Example 4: Natural Response Curve</a></h3>
<p>S-Curve for smooth, natural feel:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Natural dynamics with sweet spot"

[modes.mappings.trigger]
type = "Note"
note = 3

[modes.mappings.velocity_mapping]
type = "Curve"
curve_type = "SCurve"
intensity = 0.5

[modes.mappings.action]
type = "SendMidi"
port = "Virtual MIDI Port"
message_type = "CC"
channel = 0
controller = 7  # Volume CC
value = 64      # Overridden by mapped velocity
</code></pre>
<hr />
<h2 id="related-documentation-2"><a class="header" href="#related-documentation-2">Related Documentation</a></h2>
<ul>
<li><a href="configuration/../guides/velocity-curves.html">Guide: Customizing Velocity Response</a> - User guide with tutorials</li>
<li><a href="configuration/actions.html">Configuration: Actions</a> - Action types that use velocity</li>
<li><a href="configuration/../guides/context-aware.html">Guide: Context-Aware Mappings</a> - Combine with conditionals</li>
</ul>
<hr />
<p><strong>See Also</strong>: The GUI provides a visual curve preview graph to help you dial in the perfect response curve. The graph updates in real-time as you adjust parameters.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="conditional-action-configuration"><a class="header" href="#conditional-action-configuration">Conditional Action Configuration</a></h1>
<p>Complete TOML reference for conditional action configuration.</p>
<hr />
<h2 id="overview-12"><a class="header" href="#overview-12">Overview</a></h2>
<p>Conditional actions allow mappings to execute different actions based on runtime conditions such as time of day, active application, current mode, or day of week. This enables context-aware behavior without manual profile switching.</p>
<hr />
<h2 id="configuration-structure"><a class="header" href="#configuration-structure">Configuration Structure</a></h2>
<p>Conditional actions use the <code>Conditional</code> action type with three components:</p>
<ol>
<li><strong>condition</strong>: The condition to evaluate</li>
<li><strong>then_action</strong>: Action to execute if condition is true</li>
<li><strong>else_action</strong>: Optional action to execute if condition is false</li>
</ol>
<pre><code class="language-toml">[[modes.mappings]]
description = "Context-aware mapping"

[modes.mappings.trigger]
type = "Note"
note = 5

[modes.mappings.action]
type = "Conditional"
condition = { /* condition definition */ }
then_action = { /* action if true */ }
else_action = { /* optional action if false */ }
</code></pre>
<hr />
<h2 id="condition-types-1"><a class="header" href="#condition-types-1">Condition Types</a></h2>
<h3 id="always"><a class="header" href="#always">Always</a></h3>
<p>Always evaluates to true (always executes <code>then_action</code>).</p>
<p><strong>Fields</strong>: None (just the string <code>"Always"</code>)</p>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"
condition = "Always"
then_action = { type = "Keystroke", keys = "space", modifiers = [] }
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Testing conditional logic</li>
<li>Default behavior wrapper</li>
<li>Placeholder for future condition</li>
</ul>
<hr />
<h3 id="never"><a class="header" href="#never">Never</a></h3>
<p>Always evaluates to false (never executes <code>then_action</code>, always uses <code>else_action</code> if present).</p>
<p><strong>Fields</strong>: None (just the string <code>"Never"</code>)</p>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"
condition = "Never"
then_action = { type = "Launch", app = "Disabled App" }
else_action = { type = "Text", text = "This action is disabled" }
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Temporarily disable a mapping without deleting it</li>
<li>Testing else_action logic</li>
<li>Documented disabled features</li>
</ul>
<hr />
<h3 id="timerange"><a class="header" href="#timerange">TimeRange</a></h3>
<p>Evaluates to true if current time falls within specified range (24-hour format).</p>
<p><strong>Fields</strong>:</p>
<ul>
<li><code>type</code> (string, required): Must be <code>"TimeRange"</code></li>
<li><code>start</code> (string, required): Start time in <code>"HH:MM"</code> format (24-hour)</li>
<li><code>end</code> (string, required): End time in <code>"HH:MM"</code> format (24-hour)</li>
</ul>
<p><strong>Behavior</strong>:</p>
<ul>
<li>Automatically handles ranges that cross midnight (e.g., <code>22:00</code> to <code>06:00</code>)</li>
<li>Time is evaluated when the action is triggered (not when config is loaded)</li>
<li>Timezone is system local time</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "TimeRange"
start = "09:00"
end = "17:00"

[modes.mappings.action.then_action]
type = "Launch"
app = "Slack"

[modes.mappings.action.else_action]
type = "Text"
text = "Outside work hours"
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Work mode (9am-5pm): Launch productivity apps</li>
<li>Evening mode (5pm-11pm): Launch entertainment apps</li>
<li>Night mode (11pm-9am): Disable noisy actions</li>
</ul>
<p><strong>Validation</strong>:</p>
<ul>
<li>Format must be <code>HH:MM</code> (e.g., <code>"09:00"</code>, <code>"23:30"</code>)</li>
<li>Hour must be 00-23</li>
<li>Minute must be 00-59</li>
<li>Invalid format will cause config load error</li>
</ul>
<hr />
<h3 id="dayofweek"><a class="header" href="#dayofweek">DayOfWeek</a></h3>
<p>Evaluates to true if current day matches one of the specified days.</p>
<p><strong>Fields</strong>:</p>
<ul>
<li><code>type</code> (string, required): Must be <code>"DayOfWeek"</code></li>
<li><code>days</code> (array of integers, required): Day numbers (1=Monday through 7=Sunday)</li>
</ul>
<p><strong>Day Numbers</strong>:</p>
<ul>
<li>1 = Monday</li>
<li>2 = Tuesday</li>
<li>3 = Wednesday</li>
<li>4 = Thursday</li>
<li>5 = Friday</li>
<li>6 = Saturday</li>
<li>7 = Sunday</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "DayOfWeek"
days = [1, 2, 3, 4, 5]  # Monday through Friday

[modes.mappings.action.then_action]
type = "Shell"
command = "open ~/Work"

[modes.mappings.action.else_action]
type = "Shell"
command = "open ~/Personal"
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Weekday-only shortcuts (work apps)</li>
<li>Weekend-only shortcuts (gaming, hobbies)</li>
<li>Different behaviors for different days</li>
</ul>
<p><strong>Validation</strong>:</p>
<ul>
<li><code>days</code> array must not be empty</li>
<li>Each day must be 1-7</li>
<li>Invalid day number will cause config load error</li>
</ul>
<hr />
<h3 id="apprunning"><a class="header" href="#apprunning">AppRunning</a></h3>
<p>Evaluates to true if a specific application is currently running (process detection).</p>
<p><strong>Fields</strong>:</p>
<ul>
<li><code>type</code> (string, required): Must be <code>"AppRunning"</code></li>
<li><code>app_name</code> (string, required): Application name to check</li>
</ul>
<p><strong>Platform Support</strong>:</p>
<ul>
<li>‚úÖ macOS: Uses <code>pgrep</code> (case-insensitive partial match)</li>
<li>‚úÖ Linux: Uses <code>pgrep</code> (case-insensitive partial match)</li>
<li>‚ùå Windows: Not yet supported</li>
</ul>
<p><strong>Matching Behavior</strong>:</p>
<ul>
<li>Uses partial string matching</li>
<li>Case-insensitive</li>
<li><code>"Chrome"</code> matches <code>"Google Chrome Helper"</code></li>
<li><code>"Logic"</code> matches <code>"Logic Pro"</code>, <code>"Logic Pro Helper"</code>, etc.</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "AppRunning"
app_name = "Logic Pro"

[modes.mappings.action.then_action]
type = "Keystroke"
keys = "space"
modifiers = []  # Play/pause in Logic

[modes.mappings.action.else_action]
type = "Launch"
app = "Logic Pro"
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Smart play/pause (launch DAW if not running, else control it)</li>
<li>Toggle between apps</li>
<li>Conditional workflows based on running processes</li>
</ul>
<p><strong>Performance</strong>:</p>
<ul>
<li>Executes <code>pgrep</code> subprocess on each trigger</li>
<li>Minimal overhead (&lt;10ms typically)</li>
<li>Cached briefly by system</li>
</ul>
<hr />
<h3 id="appfrontmost"><a class="header" href="#appfrontmost">AppFrontmost</a></h3>
<p>Evaluates to true if a specific application has focus (active window).</p>
<p><strong>Fields</strong>:</p>
<ul>
<li><code>type</code> (string, required): Must be <code>"AppFrontmost"</code></li>
<li><code>app_name</code> (string, required): Application name to check</li>
</ul>
<p><strong>Platform Support</strong>:</p>
<ul>
<li>‚úÖ macOS: Uses NSWorkspace API (exact match)</li>
<li>‚ùå Linux: Not yet supported</li>
<li>‚ùå Windows: Not yet supported</li>
</ul>
<p><strong>Matching Behavior</strong>:</p>
<ul>
<li>Exact frontmost application name match</li>
<li>Case-sensitive on macOS</li>
<li>Checks the actual active window, not just if app is running</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "AppFrontmost"
app_name = "Safari"

[modes.mappings.action.then_action]
type = "Keystroke"
keys = "t"
modifiers = ["cmd"]  # New tab in Safari

[modes.mappings.action.else_action]
type = "Text"
text = "Not in Safari"
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>App-specific shortcuts (browser shortcuts vs IDE shortcuts)</li>
<li>Context-switching workflows</li>
<li>Smart key remapping based on frontmost app</li>
</ul>
<p><strong>Performance</strong>:</p>
<ul>
<li>Native API call (very fast, &lt;1ms)</li>
<li>No subprocess overhead</li>
</ul>
<hr />
<h3 id="modeis"><a class="header" href="#modeis">ModeIs</a></h3>
<p>Evaluates to true if current mode matches the specified mode name.</p>
<p><strong>Fields</strong>:</p>
<ul>
<li><code>type</code> (string, required): Must be <code>"ModeIs"</code></li>
<li><code>mode</code> (string, required): Mode name to check (exact match, case-sensitive)</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "ModeIs"
mode = "Development"

[modes.mappings.action.then_action]
type = "Shell"
command = "git status"

[modes.mappings.action.else_action]
type = "Text"
text = "Switch to Development mode first"
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Mode-specific behaviors within global mappings</li>
<li>Validate mode before executing sensitive commands</li>
<li>Different actions for different modes on same pad</li>
</ul>
<p><strong>Note</strong>: Mode name must match exactly (case-sensitive). Use mode names as defined in your <code>[[modes]]</code> configuration.</p>
<hr />
<h3 id="and-logical-and"><a class="header" href="#and-logical-and">And (Logical AND)</a></h3>
<p>Evaluates to true if <strong>all</strong> sub-conditions are true.</p>
<p><strong>Fields</strong>:</p>
<ul>
<li><code>type</code> (string, required): Must be <code>"And"</code></li>
<li><code>conditions</code> (array, required): Array of condition objects</li>
</ul>
<p><strong>Behavior</strong>:</p>
<ul>
<li>Short-circuits (stops evaluating as soon as one condition is false)</li>
<li>Empty array always evaluates to true</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "And"
conditions = [
  { type = "TimeRange", start = "09:00", end = "17:00" },
  { type = "DayOfWeek", days = [1, 2, 3, 4, 5] },
  { type = "AppRunning", app_name = "Slack" }
]

[modes.mappings.action.then_action]
type = "Keystroke"
keys = "s"
modifiers = ["cmd", "shift"]  # Search in Slack during work hours
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Work mode: weekdays AND business hours AND specific app</li>
<li>Complex conditions requiring multiple criteria</li>
</ul>
<p><strong>Validation</strong>:</p>
<ul>
<li><code>conditions</code> array must not be empty</li>
<li>Each element must be a valid condition</li>
</ul>
<hr />
<h3 id="or-logical-or"><a class="header" href="#or-logical-or">Or (Logical OR)</a></h3>
<p>Evaluates to true if <strong>at least one</strong> sub-condition is true.</p>
<p><strong>Fields</strong>:</p>
<ul>
<li><code>type</code> (string, required): Must be <code>"Or"</code></li>
<li><code>conditions</code> (array, required): Array of condition objects</li>
</ul>
<p><strong>Behavior</strong>:</p>
<ul>
<li>Short-circuits (stops evaluating as soon as one condition is true)</li>
<li>Empty array always evaluates to false</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "Or"
conditions = [
  { type = "AppFrontmost", app_name = "Safari" },
  { type = "AppFrontmost", app_name = "Chrome" },
  { type = "AppFrontmost", app_name = "Firefox" }
]

[modes.mappings.action.then_action]
type = "Keystroke"
keys = "t"
modifiers = ["cmd"]  # New tab in any browser
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Action applies to multiple apps</li>
<li>Alternative conditions (weekend OR evening)</li>
</ul>
<p><strong>Validation</strong>:</p>
<ul>
<li><code>conditions</code> array must not be empty</li>
<li>Each element must be a valid condition</li>
</ul>
<hr />
<h3 id="not-logical-not"><a class="header" href="#not-logical-not">Not (Logical NOT)</a></h3>
<p>Inverts the result of a condition (true becomes false, false becomes true).</p>
<p><strong>Fields</strong>:</p>
<ul>
<li><code>type</code> (string, required): Must be <code>"Not"</code></li>
<li><code>condition</code> (object, required): Condition to invert</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "Not"
condition = { type = "AppRunning", app_name = "Music" }

[modes.mappings.action.then_action]
type = "Launch"
app = "Music"

[modes.mappings.action.else_action]
type = "Text"
text = "Music already running"
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>"If NOT running, launch"</li>
<li>"If NOT work hours, disable"</li>
<li>Invert any condition logic</li>
</ul>
<p><strong>Validation</strong>:</p>
<ul>
<li><code>condition</code> must be a valid condition object</li>
</ul>
<hr />
<h2 id="nested-conditions"><a class="header" href="#nested-conditions">Nested Conditions</a></h2>
<p>Conditions can be nested to arbitrary depth using And/Or/Not operators.</p>
<h3 id="example-complex-work-mode"><a class="header" href="#example-complex-work-mode">Example: Complex Work Mode</a></h3>
<pre><code class="language-toml">[[modes.mappings]]
description = "(Weekday AND work hours) OR (Weekend AND Xcode running)"

[modes.mappings.trigger]
type = "Note"
note = 10

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "Or"
conditions = [
  {
    type = "And"
    conditions = [
      { type = "DayOfWeek", days = [1, 2, 3, 4, 5] },
      { type = "TimeRange", start = "09:00", end = "17:00" }
    ]
  },
  {
    type = "And"
    conditions = [
      { type = "DayOfWeek", days = [6, 7] },
      { type = "AppRunning", app_name = "Xcode" }
    ]
  }
]

[modes.mappings.action.then_action]
type = "Shell"
command = "open ~/Code"
</code></pre>
<p><strong>Translation</strong>: Open code folder if:</p>
<ul>
<li>(Monday-Friday AND 9am-5pm) OR</li>
<li>(Saturday-Sunday AND Xcode is running)</li>
</ul>
<hr />
<h2 id="thenelse-actions"><a class="header" href="#thenelse-actions">Then/Else Actions</a></h2>
<h3 id="then-action-required"><a class="header" href="#then-action-required">Then Action (Required)</a></h3>
<p>Executed when condition evaluates to true. Can be any action type.</p>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action.then_action]
type = "Keystroke"
keys = "space"
modifiers = []
</code></pre>
<h3 id="else-action-optional"><a class="header" href="#else-action-optional">Else Action (Optional)</a></h3>
<p>Executed when condition evaluates to false. If omitted, no action is taken when condition is false.</p>
<p><strong>Example</strong>:</p>
<pre><code class="language-toml">[modes.mappings.action.else_action]
type = "Text"
text = "Condition was false"
</code></pre>
<h3 id="nested-conditionals"><a class="header" href="#nested-conditionals">Nested Conditionals</a></h3>
<p>Both then_action and else_action can themselves be Conditional actions:</p>
<pre><code class="language-toml">[modes.mappings.action]
type = "Conditional"
condition = { type = "AppFrontmost", app_name = "Spotify" }

[modes.mappings.action.then_action]
type = "Keystroke"
keys = "space"
modifiers = []

[modes.mappings.action.else_action]
type = "Conditional"
condition = { type = "AppFrontmost", app_name = "Logic Pro" }
then_action = { type = "Keystroke", keys = "Return", modifiers = [] }
else_action = { type = "VolumeControl", operation = "Mute" }
</code></pre>
<p><strong>Translation</strong>:</p>
<ul>
<li>If Spotify is frontmost: Press space</li>
<li>Else if Logic Pro is frontmost: Press Return</li>
<li>Else: Mute volume</li>
</ul>
<hr />
<h2 id="validation-rules-1"><a class="header" href="#validation-rules-1">Validation Rules</a></h2>
<p><strong>General</strong>:</p>
<ul>
<li><code>type</code> field is required for all conditions (except Always/Never which can be just strings)</li>
<li>Invalid condition type will cause config load error</li>
</ul>
<p><strong>TimeRange</strong>:</p>
<ul>
<li><code>start</code> and <code>end</code> must be in <code>HH:MM</code> format</li>
<li>Hour must be 00-23, minute must be 00-59</li>
</ul>
<p><strong>DayOfWeek</strong>:</p>
<ul>
<li><code>days</code> array must contain at least one day</li>
<li>Each day must be 1-7</li>
</ul>
<p><strong>AppRunning/AppFrontmost</strong>:</p>
<ul>
<li><code>app_name</code> must be a non-empty string</li>
</ul>
<p><strong>ModeIs</strong>:</p>
<ul>
<li><code>mode</code> must be a non-empty string</li>
<li>Mode name is not validated against actual modes (runtime check)</li>
</ul>
<p><strong>And/Or</strong>:</p>
<ul>
<li><code>conditions</code> array must contain at least one condition</li>
<li>Each element must be a valid condition</li>
</ul>
<p><strong>Not</strong>:</p>
<ul>
<li><code>condition</code> must be a valid condition object</li>
</ul>
<hr />
<h2 id="performance-considerations"><a class="header" href="#performance-considerations">Performance Considerations</a></h2>
<ul>
<li><strong>TimeRange/DayOfWeek</strong>: Very fast (system time lookup)</li>
<li><strong>ModeIs</strong>: Very fast (string comparison)</li>
<li><strong>AppRunning</strong>: Moderate (~10ms, subprocess call to <code>pgrep</code>)</li>
<li><strong>AppFrontmost</strong>: Very fast (&lt;1ms, native API)</li>
<li><strong>And/Or</strong>: Short-circuit evaluation (stops as soon as result is known)</li>
<li><strong>Nested conditions</strong>: Evaluated depth-first</li>
</ul>
<p><strong>Recommendation</strong>: Keep deeply nested conditions reasonable (&lt;5 levels) to maintain readability and predictable performance.</p>
<hr />
<h2 id="examples-2"><a class="header" href="#examples-2">Examples</a></h2>
<h3 id="example-1-work-hours-profile-1"><a class="header" href="#example-1-work-hours-profile-1">Example 1: Work Hours Profile</a></h3>
<p>Different behavior during work vs personal time:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Slack at work, Discord after hours"

[modes.mappings.trigger]
type = "Note"
note = 8

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "And"
conditions = [
  { type = "TimeRange", start = "09:00", end = "17:00" },
  { type = "DayOfWeek", days = [1, 2, 3, 4, 5] }
]

[modes.mappings.action.then_action]
type = "Launch"
app = "Slack"

[modes.mappings.action.else_action]
type = "Launch"
app = "Discord"
</code></pre>
<hr />
<h3 id="example-2-universal-playpause"><a class="header" href="#example-2-universal-playpause">Example 2: Universal Play/Pause</a></h3>
<p>Different shortcuts for different media apps:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Universal play/pause"

[modes.mappings.trigger]
type = "Note"
note = 1

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "Or"
conditions = [
  { type = "AppFrontmost", app_name = "Spotify" },
  { type = "AppFrontmost", app_name = "Music" }
]

[modes.mappings.action.then_action]
type = "Keystroke"
keys = "space"
modifiers = []

[modes.mappings.action.else_action]
type = "Conditional"
condition = { type = "AppFrontmost", app_name = "Logic Pro" }
then_action = { type = "Keystroke", keys = "Return", modifiers = [] }
else_action = { type = "VolumeControl", operation = "Mute" }
</code></pre>
<hr />
<h3 id="example-3-smart-daw-control"><a class="header" href="#example-3-smart-daw-control">Example 3: Smart DAW Control</a></h3>
<p>Launch DAW if not running, otherwise send MIDI:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Launch or control Logic Pro"

[modes.mappings.trigger]
type = "Note"
note = 5

[modes.mappings.action]
type = "Conditional"

[modes.mappings.action.condition]
type = "AppRunning"
app_name = "Logic Pro"

[modes.mappings.action.then_action]
type = "SendMidi"
port = "IAC Driver Bus 1"
message_type = "NoteOn"
channel = 0
note = 60
velocity = 100

[modes.mappings.action.else_action]
type = "Launch"
app = "Logic Pro"
</code></pre>
<hr />
<h2 id="related-documentation-3"><a class="header" href="#related-documentation-3">Related Documentation</a></h2>
<ul>
<li><a href="configuration/../guides/context-aware.html">Guide: Context-Aware Mappings</a> - User guide with tutorials</li>
<li><a href="configuration/actions.html">Configuration: Actions</a> - Action types reference</li>
<li><a href="configuration/../guides/velocity-curves.html">Guide: Velocity Curves</a> - Combine with velocity mappings</li>
</ul>
<hr />
<p><strong>See Also</strong>: The GUI provides a Conditional Action Editor with visual condition type selector, time pickers, day toggles, and support for simple And/Or/Not operators. Complex nested logic can be configured via TOML editing.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="modes-system"><a class="header" href="#modes-system">Modes System</a></h1>
<blockquote>
<p><strong>Note</strong>: This section is under development and will be completed in Phase 1 (Q1 2025).</p>
<p>For now, please refer to:</p>
<ul>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/README.md">README.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/CLAUDE.md">CLAUDE.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/discussions">GitHub Discussions</a></li>
</ul>
</blockquote>
<h2 id="coming-soon-3"><a class="header" href="#coming-soon-3">Coming Soon</a></h2>
<p>This page will cover:</p>
<ul>
<li>TBD</li>
</ul>
<hr />
<p><strong>Help Wanted</strong>: We're looking for contributors to help write documentation. See <a href="configuration/../development/contributing.html">Contributing Guide</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="led-feedback-configuration"><a class="header" href="#led-feedback-configuration">LED Feedback Configuration</a></h1>
<p>MIDIMon provides rich LED feedback for MIDI controllers with comprehensive support for RGB control (HID devices) and basic on/off control (MIDI devices).</p>
<h2 id="quick-start-2"><a class="header" href="#quick-start-2">Quick Start</a></h2>
<h3 id="command-line-usage"><a class="header" href="#command-line-usage">Command-Line Usage</a></h3>
<p>The fastest way to enable LED feedback is via command-line flags:</p>
<pre><code class="language-bash"># Start with reactive velocity feedback (recommended)
cargo run --release 2 --led reactive

# Try different schemes
cargo run --release 2 --led rainbow
cargo run --release 2 --led static
cargo run --release 2 --led off
</code></pre>
<h3 id="available-schemes"><a class="header" href="#available-schemes">Available Schemes</a></h3>
<p>Choose from 10 built-in lighting schemes:</p>
<ul>
<li><strong>off</strong> - All LEDs disabled</li>
<li><strong>static</strong> - Solid color based on current mode</li>
<li><strong>breathing</strong> - Slow 2-second breathing effect</li>
<li><strong>pulse</strong> - Fast 500ms pulse</li>
<li><strong>rainbow</strong> - Rainbow cycle across pads</li>
<li><strong>wave</strong> - Wave pattern animation</li>
<li><strong>sparkle</strong> - Random sparkles</li>
<li><strong>reactive</strong> - Velocity-based colors (green/yellow/red)</li>
<li><strong>vumeter</strong> - VU meter style (bottom-up)</li>
<li><strong>spiral</strong> - Spiral pattern animation</li>
</ul>
<h2 id="configuration-file-1"><a class="header" href="#configuration-file-1">Configuration File</a></h2>
<h3 id="basic-setup"><a class="header" href="#basic-setup">Basic Setup</a></h3>
<p>Add LED settings to your <code>config.toml</code>:</p>
<pre><code class="language-toml">[device]
name = "Mikro"
led_feedback = true  # Enable LED control

[led_settings]
scheme = "reactive"  # Default scheme
brightness = 255     # Full brightness (0-255)
</code></pre>
<h3 id="reactive-scheme-velocity-feedback"><a class="header" href="#reactive-scheme-velocity-feedback">Reactive Scheme (Velocity Feedback)</a></h3>
<p>The most commonly used scheme, providing color-coded velocity feedback:</p>
<pre><code class="language-toml">[led_settings]
scheme = "reactive"

[led_settings.reactive]
# Velocity ranges and colors
soft_color = { r = 0, g = 255, b = 0 }      # Green (0-40)
medium_color = { r = 255, g = 255, b = 0 }  # Yellow (41-80)
hard_color = { r = 255, g = 0, b = 0 }      # Red (81-127)

# Fade behavior
fade_duration_ms = 1000  # Wait 1s before fading
fade_steps = 10          # Number of fade steps (smoother = more steps)
</code></pre>
<p><strong>Visual Example:</strong></p>
<ul>
<li>Soft tap ‚Üí üü¢ Green LED</li>
<li>Medium tap ‚Üí üü° Yellow LED</li>
<li>Hard hit ‚Üí üî¥ Red LED</li>
<li>After 1 second ‚Üí Smooth fade to mode color</li>
</ul>
<h3 id="mode-based-colors"><a class="header" href="#mode-based-colors">Mode-Based Colors</a></h3>
<p>Each mode can have its own color scheme:</p>
<pre><code class="language-toml">[[modes]]
name = "Default"
color = "blue"
led_idle_brightness = 20      # Dim when idle
led_active_brightness = 255   # Full when pressed

[[modes]]
name = "Development"
color = "green"
led_idle_brightness = 30
led_active_brightness = 255

[[modes]]
name = "Media"
color = "purple"
led_idle_brightness = 15
led_active_brightness = 200
</code></pre>
<p><strong>Supported Colors:</strong></p>
<ul>
<li><code>"blue"</code> - (0, 100, 255)</li>
<li><code>"green"</code> - (0, 255, 0)</li>
<li><code>"red"</code> - (255, 0, 0)</li>
<li><code>"purple"</code> - (200, 0, 255)</li>
<li><code>"yellow"</code> - (255, 255, 0)</li>
<li><code>"cyan"</code> - (0, 255, 255)</li>
<li><code>"white"</code> - (255, 255, 255)</li>
<li>Custom: <code>{ r = 128, g = 64, b = 200 }</code></li>
</ul>
<h3 id="mode-transition-effects-1"><a class="header" href="#mode-transition-effects-1">Mode Transition Effects</a></h3>
<p>Add visual effects when switching modes:</p>
<pre><code class="language-toml">[[global_mappings]]
description = "Next Mode with Sweep Effect"
[global_mappings.trigger]
type = "EncoderTurn"
cc = 1
direction = "Clockwise"
[global_mappings.action]
type = "ModeChange"
mode = 1
relative = true
transition_effect = "Sweep"
</code></pre>
<p><strong>Transition Effects:</strong></p>
<pre><code class="language-toml">[led_settings.transitions]
enable_effects = true
flash_duration_ms = 150   # Flash effect (white ‚Üí off ‚Üí new color)
sweep_delay_ms = 30       # Sweep effect (left-to-right wave)
fadeout_steps = 10        # FadeOut effect (smooth color transition)
spiral_delay_ms = 15      # Spiral effect (center-outward)
</code></pre>
<p><strong>Available Effects:</strong></p>
<ul>
<li><strong>Flash</strong> - Quick white flash (150ms) - fast mode switching</li>
<li><strong>Sweep</strong> - Left-to-right wave (120ms) - smooth sweep</li>
<li><strong>FadeOut</strong> - Fade old to new color (200ms) - smooth transition</li>
<li><strong>Spiral</strong> - Center-outward spiral (240ms) - artistic</li>
<li><strong>None</strong> - Instant change (0ms) - no animation</li>
</ul>
<h3 id="mode-indicator-pads"><a class="header" href="#mode-indicator-pads">Mode Indicator Pads</a></h3>
<p>Dedicate specific pads to show the current mode:</p>
<pre><code class="language-toml">[led_settings]
mode_indicator_pads = [13, 14, 15, 16]  # Bottom row
# Pad 13 = Mode 0 indicator
# Pad 14 = Mode 1 indicator
# Pad 15 = Mode 2 indicator
# Pad 16 = Mode 3 indicator
</code></pre>
<p>When in Mode 1, pad 14 will light up in green while others remain dim.</p>
<h2 id="advanced-configuration-1"><a class="header" href="#advanced-configuration-1">Advanced Configuration</a></h2>
<h3 id="animation-settings"><a class="header" href="#animation-settings">Animation Settings</a></h3>
<p>Fine-tune animation parameters for each scheme:</p>
<pre><code class="language-toml">[led_settings.breathing]
cycle_duration_ms = 2000  # 2-second breathing cycle
min_brightness = 0        # Fully off at minimum
max_brightness = 255      # Full brightness at peak

[led_settings.rainbow]
speed = 60           # Degrees per second
saturation = 255     # Full saturation
brightness = 255     # Full brightness
hue_spacing = 22.5   # Degrees between pads

[led_settings.sparkle]
spawn_rate_ms = 100  # New sparkle every 100ms
fade_duration_ms = 200  # Sparkle fades in 200ms
max_active = 4       # Max 4 sparkles at once
</code></pre>
<h3 id="hid-specific-settings-mikro-mk3"><a class="header" href="#hid-specific-settings-mikro-mk3">HID-Specific Settings (Mikro MK3)</a></h3>
<pre><code class="language-toml">[device]
name = "Mikro"
led_feedback = true
use_hid = true  # Force HID mode

[led_settings.hid]
shared_device = true  # Allow NI Controller Editor access
vendor_id = 0x17cc    # Native Instruments
product_id = 0x1700   # Maschine Mikro MK3
</code></pre>
<h3 id="midi-feedback-settings"><a class="header" href="#midi-feedback-settings">MIDI Feedback Settings</a></h3>
<p>For standard MIDI controllers:</p>
<pre><code class="language-toml">[device]
name = "Launchpad Mini"
led_feedback = true

[led_settings.midi]
note_offset = 36  # C1 (MIDI note 36) = Pad 1
channel = 0       # MIDI channel 0-15
on_velocity = 127 # Velocity for "LED on"
off_velocity = 0  # Velocity for "LED off"
</code></pre>
<h2 id="platform-specific-notes-1"><a class="header" href="#platform-specific-notes-1">Platform-Specific Notes</a></h2>
<h3 id="macos-2"><a class="header" href="#macos-2">macOS</a></h3>
<p><strong>HID devices require Input Monitoring permission:</strong></p>
<ol>
<li>Open System Settings ‚Üí Privacy &amp; Security</li>
<li>Select "Input Monitoring"</li>
<li>Enable permission for Terminal or your IDE</li>
</ol>
<p><strong>Shared device mode:</strong></p>
<pre><code class="language-toml">[led_settings.hid]
shared_device = true  # Works alongside NI Controller Editor
</code></pre>
<h3 id="linux-1"><a class="header" href="#linux-1">Linux</a></h3>
<p><strong>HID devices may require udev rules:</strong></p>
<pre><code class="language-bash"># Create udev rule for Mikro MK3
sudo nano /etc/udev/rules.d/99-maschine-mikro-mk3.rules

# Add this line:
SUBSYSTEM=="usb", ATTRS{idVendor}=="17cc", ATTRS{idProduct}=="1700", MODE="0666"

# Reload rules
sudo udevadm control --reload-rules
sudo udevadm trigger
</code></pre>
<h3 id="windows-1"><a class="header" href="#windows-1">Windows</a></h3>
<p><strong>HID devices work out of the box, but may require:</strong></p>
<ul>
<li>Native Instruments drivers installed</li>
<li>USB device permissions (Windows 10+)</li>
</ul>
<h2 id="use-cases-2"><a class="header" href="#use-cases-2">Use Cases</a></h2>
<h3 id="performancelive-use"><a class="header" href="#performancelive-use">Performance/Live Use</a></h3>
<pre><code class="language-toml">[led_settings]
scheme = "reactive"  # Immediate velocity feedback
brightness = 255     # Full brightness for stage visibility
</code></pre>
<h3 id="studioproduction"><a class="header" href="#studioproduction">Studio/Production</a></h3>
<pre><code class="language-toml">[led_settings]
scheme = "static"    # Subtle, non-distracting
brightness = 50      # Dim for low-light studio
</code></pre>
<h3 id="creativevisual"><a class="header" href="#creativevisual">Creative/Visual</a></h3>
<pre><code class="language-toml">[led_settings]
scheme = "rainbow"   # Eye-catching animations
brightness = 200     # Bright but not overwhelming
</code></pre>
<h3 id="focused-work"><a class="header" href="#focused-work">Focused Work</a></h3>
<pre><code class="language-toml">[led_settings]
scheme = "off"       # No distractions
</code></pre>
<h2 id="troubleshooting-15"><a class="header" href="#troubleshooting-15">Troubleshooting</a></h2>
<h3 id="leds-not-responding-1"><a class="header" href="#leds-not-responding-1">LEDs Not Responding</a></h3>
<ol>
<li>
<p><strong>Check device connection:</strong></p>
<pre><code class="language-bash">DEBUG=1 cargo run --release 2 --led reactive
# Look for: "‚úì Connected to Mikro MK3 LED interface"
</code></pre>
</li>
<li>
<p><strong>Verify permissions</strong> (macOS HID):</p>
<ul>
<li>System Settings ‚Üí Privacy ‚Üí Input Monitoring</li>
</ul>
</li>
<li>
<p><strong>Try MIDI fallback:</strong></p>
<pre><code class="language-toml">[device]
led_feedback = true
use_hid = false  # Force MIDI mode
</code></pre>
</li>
</ol>
<h3 id="wrong-colors-1"><a class="header" href="#wrong-colors-1">Wrong Colors</a></h3>
<ul>
<li><strong>Issue</strong>: Colors don't match expected RGB values</li>
<li><strong>Cause</strong>: LED manufacturing variance (¬±10%)</li>
<li><strong>Solution</strong>: Normal behavior, slight color variations expected</li>
</ul>
<h3 id="flickering"><a class="header" href="#flickering">Flickering</a></h3>
<ul>
<li><strong>Issue</strong>: LEDs flicker or strobe</li>
<li><strong>Cause</strong>: Update rate too high or USB bandwidth saturation</li>
<li><strong>Solution</strong>: Use simpler scheme (<code>reactive</code> or <code>static</code>)</li>
</ul>
<h3 id="mode-colors-not-showing"><a class="header" href="#mode-colors-not-showing">Mode Colors Not Showing</a></h3>
<ul>
<li><strong>Issue</strong>: All pads same color regardless of mode</li>
<li><strong>Cause</strong>: Using non-mode-aware scheme</li>
<li><strong>Solution</strong>: Use <code>static</code> or <code>reactive</code> scheme</li>
</ul>
<h3 id="performance-impact"><a class="header" href="#performance-impact">Performance Impact</a></h3>
<ul>
<li><strong>Issue</strong>: High CPU usage</li>
<li><strong>Cause</strong>: Complex animation scheme</li>
<li><strong>Solution</strong>: Switch to <code>reactive</code> or <code>static</code> (&lt;1% CPU)</li>
</ul>
<h2 id="examples-3"><a class="header" href="#examples-3">Examples</a></h2>
<h3 id="example-1-simple-reactive-setup"><a class="header" href="#example-1-simple-reactive-setup">Example 1: Simple Reactive Setup</a></h3>
<pre><code class="language-toml">[device]
name = "Mikro"
led_feedback = true

[led_settings]
scheme = "reactive"

[[modes]]
name = "Default"
color = "blue"

[[modes]]
name = "Development"
color = "green"
</code></pre>
<h3 id="example-2-advanced-multi-mode-with-transitions"><a class="header" href="#example-2-advanced-multi-mode-with-transitions">Example 2: Advanced Multi-Mode with Transitions</a></h3>
<pre><code class="language-toml">[device]
name = "Mikro"
led_feedback = true

[led_settings]
scheme = "reactive"
brightness = 255

[led_settings.transitions]
enable_effects = true
flash_duration_ms = 150

[[modes]]
name = "Default"
color = "blue"
led_idle_brightness = 20
led_active_brightness = 255

[[modes]]
name = "Development"
color = "green"
led_idle_brightness = 30
led_active_brightness = 255

[[modes]]
name = "Media"
color = "purple"
led_idle_brightness = 15
led_active_brightness = 200

[[global_mappings]]
description = "Next Mode with Flash"
[global_mappings.trigger]
type = "EncoderTurn"
cc = 1
direction = "Clockwise"
[global_mappings.action]
type = "ModeChange"
mode = 1
relative = true
transition_effect = "Flash"
</code></pre>
<h3 id="example-3-studio-mode-with-indicators"><a class="header" href="#example-3-studio-mode-with-indicators">Example 3: Studio Mode with Indicators</a></h3>
<pre><code class="language-toml">[device]
name = "Mikro"
led_feedback = true

[led_settings]
scheme = "static"
brightness = 50
mode_indicator_pads = [13, 14, 15, 16]

[[modes]]
name = "Recording"
color = "red"
led_idle_brightness = 10

[[modes]]
name = "Editing"
color = "green"
led_idle_brightness = 10

[[modes]]
name = "Mixing"
color = "blue"
led_idle_brightness = 10
</code></pre>
<h2 id="performance-3"><a class="header" href="#performance-3">Performance</a></h2>
<h3 id="cpu-usage-by-scheme"><a class="header" href="#cpu-usage-by-scheme">CPU Usage by Scheme</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Scheme</th><th>CPU (Idle)</th><th>CPU (Active)</th></tr></thead><tbody>
<tr><td>off</td><td>0%</td><td>0%</td></tr>
<tr><td>static</td><td>&lt;1%</td><td>&lt;1%</td></tr>
<tr><td>reactive</td><td>&lt;1%</td><td>~1%</td></tr>
<tr><td>breathing</td><td>~1%</td><td>~1%</td></tr>
<tr><td>rainbow</td><td>~2%</td><td>~2%</td></tr>
<tr><td>sparkle</td><td>~3%</td><td>~3%</td></tr>
</tbody></table>
</div>
<h3 id="memory"><a class="header" href="#memory">Memory</a></h3>
<ul>
<li><strong>Static schemes</strong>: &lt;1MB</li>
<li><strong>Animated schemes</strong>: &lt;1MB</li>
<li><strong>Per-pad state</strong>: ~50 bytes per pad</li>
</ul>
<h3 id="update-rate"><a class="header" href="#update-rate">Update Rate</a></h3>
<ul>
<li><strong>HID devices</strong>: 10fps (100ms per frame)</li>
<li><strong>MIDI devices</strong>: Event-driven (no polling)</li>
</ul>
<h2 id="see-also-4"><a class="header" href="#see-also-4">See Also</a></h2>
<ul>
<li><a href="configuration/../reference/led-system.html">Reference ‚Üí LED System</a> - Complete LED feature reference</li>
<li><a href="configuration/../reference/action-types.html">Reference ‚Üí Action Types</a> - ModeChange action</li>
<li><a href="configuration/../devices/mikro-mk3.html">Device Support ‚Üí Maschine Mikro MK3</a> - HID device details</li>
<li><a href="configuration/modes.html">Configuration ‚Üí Modes</a> - Mode system configuration</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="device-profiles"><a class="header" href="#device-profiles">Device Profiles</a></h1>
<blockquote>
<p><strong>Note</strong>: This section is under development and will be completed in Phase 1 (Q1 2025).</p>
<p>For now, please refer to:</p>
<ul>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/README.md">README.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/CLAUDE.md">CLAUDE.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/discussions">GitHub Discussions</a></li>
</ul>
</blockquote>
<h2 id="coming-soon-4"><a class="header" href="#coming-soon-4">Coming Soon</a></h2>
<p>This page will cover:</p>
<ul>
<li>TBD</li>
</ul>
<hr />
<p><strong>Help Wanted</strong>: We're looking for contributors to help write documentation. See <a href="configuration/../development/contributing.html">Contributing Guide</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration-examples"><a class="header" href="#configuration-examples">Configuration Examples</a></h1>
<p>Real-world configuration patterns for common use cases. Each example is production-ready and can be adapted to your workflow.</p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ol>
<li><a href="configuration/examples.html#basic-workflows">Basic Workflows</a></li>
<li><a href="configuration/examples.html#developer-productivity">Developer Productivity</a></li>
<li><a href="configuration/examples.html#content-creation">Content Creation</a></li>
<li><a href="configuration/examples.html#repetition--automation">Repetition &amp; Automation</a></li>
<li><a href="configuration/examples.html#advanced-patterns">Advanced Patterns</a></li>
</ol>
<h2 id="basic-workflows"><a class="header" href="#basic-workflows">Basic Workflows</a></h2>
<h3 id="application-launcher"><a class="header" href="#application-launcher">Application Launcher</a></h3>
<p>Quick launch frequently used applications:</p>
<pre><code class="language-toml">[[modes]]
name = "Launcher"
color = "blue"

[[modes.mappings]]
description = "Open Terminal"
[modes.mappings.trigger]
type = "Note"
note = 60
[modes.mappings.action]
type = "Launch"
app = "Terminal"

[[modes.mappings]]
description = "Open VS Code"
[modes.mappings.trigger]
type = "Note"
note = 61
[modes.mappings.action]
type = "Launch"
app = "Visual Studio Code"

[[modes.mappings]]
description = "Open Browser"
[modes.mappings.trigger]
type = "Note"
note = 62
[modes.mappings.action]
type = "Launch"
app = "Google Chrome"
</code></pre>
<h3 id="text-snippets"><a class="header" href="#text-snippets">Text Snippets</a></h3>
<p>Common text expansions for email and documentation:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Email signature"
[modes.mappings.trigger]
type = "Note"
note = 70
[modes.mappings.action]
type = "Text"
text = """
Best regards,
Chris Joseph
Software Engineer
chris@amiable.dev
"""

[[modes.mappings]]
description = "Code review template"
[modes.mappings.trigger]
type = "Note"
note = 71
[modes.mappings.action]
type = "Text"
text = """
## Review Checklist
- [ ] Code follows style guide
- [ ] Tests are passing
- [ ] Documentation updated
- [ ] No obvious security issues
"""
</code></pre>
<h2 id="developer-productivity"><a class="header" href="#developer-productivity">Developer Productivity</a></h2>
<h3 id="git-workflow"><a class="header" href="#git-workflow">Git Workflow</a></h3>
<p>Common git operations on a single pad:</p>
<pre><code class="language-toml">[[modes]]
name = "Git"
color = "green"

# Soft press: git status
[[modes.mappings]]
description = "Git status (soft)"
[modes.mappings.trigger]
type = "VelocityRange"
note = 60
ranges = [{ min = 0, max = 40 }]
[modes.mappings.action]
type = "Shell"
command = "git status"

# Medium press: git add &amp; commit
[[modes.mappings]]
description = "Quick commit (medium)"
[modes.mappings.trigger]
type = "VelocityRange"
note = 60
ranges = [{ min = 41, max = 80 }]
[modes.mappings.action]
type = "Sequence"
actions = [
    { type = "Shell", command = "git add -A" },
    { type = "Delay", ms = 100 },
    { type = "Shell", command = "git commit -m 'quick save'" }
]

# Hard press: commit and push
[[modes.mappings]]
description = "Commit and push (hard)"
[modes.mappings.trigger]
type = "VelocityRange"
note = 60
ranges = [{ min = 81, max = 127 }]
[modes.mappings.action]
type = "Sequence"
actions = [
    { type = "Shell", command = "git add -A" },
    { type = "Delay", ms = 100 },
    { type = "Shell", command = "git commit -m 'quick save'" },
    { type = "Delay", ms = 100 },
    { type = "Shell", command = "git push" }
]
</code></pre>
<h3 id="code-navigation"><a class="header" href="#code-navigation">Code Navigation</a></h3>
<p>Navigate code with velocity-based jumps:</p>
<pre><code class="language-toml"># Jump lines based on velocity
[[modes.mappings]]
description = "Jump down (velocity-based)"
[modes.mappings.trigger]
type = "VelocityRange"
note = 65
ranges = [
    { min = 0, max = 40, action = { type = "Keystroke", keys = "down" } },
    { min = 41, max = 80, action = { type = "Repeat", count = 5, action = { type = "Keystroke", keys = "down" } } },
    { min = 81, max = 127, action = { type = "Repeat", count = 10, action = { type = "Keystroke", keys = "down" } } }
]

# Navigate between functions
[[modes.mappings]]
description = "Next function"
[modes.mappings.trigger]
type = "Note"
note = 66
[modes.mappings.action]
type = "Keystroke"
keys = "down"
modifiers = ["cmd", "shift"]
</code></pre>
<h2 id="content-creation"><a class="header" href="#content-creation">Content Creation</a></h2>
<h3 id="video-editing-1"><a class="header" href="#video-editing-1">Video Editing</a></h3>
<p>Timeline navigation and editing:</p>
<pre><code class="language-toml">[[modes]]
name = "Video"
color = "purple"

# Play/Pause
[[modes.mappings]]
description = "Play/Pause"
[modes.mappings.trigger]
type = "Note"
note = 60
[modes.mappings.action]
type = "Keystroke"
keys = "space"

# Frame-by-frame navigation
[[modes.mappings]]
description = "Previous frame"
[modes.mappings.trigger]
type = "Note"
note = 61
[modes.mappings.action]
type = "Keystroke"
keys = "left"

[[modes.mappings]]
description = "Next frame"
[modes.mappings.trigger]
type = "Note"
note = 62
[modes.mappings.action]
type = "Keystroke"
keys = "right"

# Jump 10 frames
[[modes.mappings]]
description = "Jump forward 10 frames"
[modes.mappings.trigger]
type = "Note"
note = 63
[modes.mappings.action]
type = "Repeat"
count = 10
action = { type = "Keystroke", keys = "right" }
</code></pre>
<h3 id="document-formatting"><a class="header" href="#document-formatting">Document Formatting</a></h3>
<p>Batch formatting operations:</p>
<pre><code class="language-toml"># Apply heading and next line
[[modes.mappings]]
description = "Apply heading 2"
[modes.mappings.trigger]
type = "Note"
note = 70
[modes.mappings.action]
type = "Sequence"
actions = [
    { type = "Keystroke", keys = "home" },  # Start of line
    { type = "Text", text = "## " },
    { type = "Keystroke", keys = "end" },  # End of line
    { type = "Keystroke", keys = "return" },  # New line
]
</code></pre>
<h2 id="repetition--automation"><a class="header" href="#repetition--automation">Repetition &amp; Automation</a></h2>
<h3 id="simple-repeats"><a class="header" href="#simple-repeats">Simple Repeats</a></h3>
<p>Scroll through long lists or documents:</p>
<pre><code class="language-toml"># Scroll down 10 lines
[[modes.mappings]]
description = "Scroll down 10 lines"
[modes.mappings.trigger]
type = "Note"
note = 80
[modes.mappings.action]
type = "Repeat"
count = 10
action = { type = "Keystroke", keys = "down" }

# Slow scroll (with delay)
[[modes.mappings]]
description = "Slow scroll down"
[modes.mappings.trigger]
type = "Note"
note = 81
[modes.mappings.action]
type = "Repeat"
count = 5
delay_between_ms = 200
action = { type = "Keystroke", keys = "down" }

# Page down 5 times
[[modes.mappings]]
description = "Jump 5 pages down"
[modes.mappings.trigger]
type = "Note"
note = 82
[modes.mappings.action]
type = "Repeat"
count = 5
delay_between_ms = 300
action = { type = "Keystroke", keys = "pagedown" }
</code></pre>
<h3 id="batch-file-processing"><a class="header" href="#batch-file-processing">Batch File Processing</a></h3>
<p>Process multiple files with a repeated sequence:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Batch process 3 files"
[modes.mappings.trigger]
type = "LongPress"
note = 85
hold_duration_ms = 1500
[modes.mappings.action]
type = "Repeat"
count = 3
delay_between_ms = 1000
action = {
    type = "Sequence",
    actions = [
        { type = "Keystroke", keys = "return" },  # Open file
        { type = "Delay", ms = 800 },  # Wait for file to load
        { type = "Keystroke", keys = "e", modifiers = ["cmd"] },  # Export
        { type = "Delay", ms = 500 },
        { type = "Keystroke", keys = "return" },  # Confirm export
        { type = "Delay", ms = 1000 },  # Wait for export
        { type = "Keystroke", keys = "w", modifiers = ["cmd"] },  # Close file
        { type = "Delay", ms = 200 },
        { type = "Keystroke", keys = "down" }  # Next file
    ]
}
</code></pre>
<h3 id="velocity-based-repeats"><a class="header" href="#velocity-based-repeats">Velocity-Based Repeats</a></h3>
<p>Different repeat counts based on pad pressure:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Variable repeat based on velocity"
[modes.mappings.trigger]
type = "VelocityRange"
note = 90
ranges = [
    # Soft: repeat 3 times
    { min = 0, max = 40, action = {
        type = "Repeat",
        count = 3,
        action = { type = "Keystroke", keys = "down" }
    }},
    # Medium: repeat 5 times
    { min = 41, max = 80, action = {
        type = "Repeat",
        count = 5,
        delay_between_ms = 100,
        action = { type = "Keystroke", keys = "down" }
    }},
    # Hard: repeat 10 times
    { min = 81, max = 127, action = {
        type = "Repeat",
        count = 10,
        delay_between_ms = 50,
        action = { type = "Keystroke", keys = "down" }
    }}
]
</code></pre>
<h3 id="nested-repeats"><a class="header" href="#nested-repeats">Nested Repeats</a></h3>
<p>Multiply effect for grid or matrix operations:</p>
<pre><code class="language-toml"># Navigate a 3x5 grid (15 total moves)
[[modes.mappings]]
description = "Navigate 3x5 grid"
[modes.mappings.trigger]
type = "DoubleTap"
note = 95
max_interval_ms = 300
[modes.mappings.action]
type = "Repeat"
count = 3  # 3 rows
delay_between_ms = 500
action = {
    type = "Sequence",
    actions = [
        # Move right 5 times
        { type = "Repeat", count = 5, delay_between_ms = 100, action = { type = "Keystroke", keys = "right" } },
        # Move down 1
        { type = "Delay", ms = 200 },
        { type = "Keystroke", keys = "down" },
        # Return to start of row
        { type = "Repeat", count = 5, action = { type = "Keystroke", keys = "left" } }
    ]
}
</code></pre>
<h3 id="retry-logic"><a class="header" href="#retry-logic">Retry Logic</a></h3>
<p>Attempt operations with error tolerance:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Launch Xcode (retry 3 times)"
[modes.mappings.trigger]
type = "Note"
note = 100
[modes.mappings.action]
type = "Repeat"
count = 3
delay_between_ms = 2000
stop_on_error = false  # Continue even if already running
action = { type = "Launch", app = "Xcode" }

[[modes.mappings]]
description = "Network test (stop on first failure)"
[modes.mappings.trigger]
type = "Note"
note = 101
[modes.mappings.action]
type = "Repeat"
count = 5
delay_between_ms = 1000
stop_on_error = true  # Stop if ping fails
action = { type = "Shell", command = "ping -c 1 8.8.8.8" }
</code></pre>
<h2 id="advanced-patterns"><a class="header" href="#advanced-patterns">Advanced Patterns</a></h2>
<h3 id="spotlight-launcher"><a class="header" href="#spotlight-launcher">Spotlight Launcher</a></h3>
<p>Use Spotlight for precise app launching:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Spotlight launcher for Terminal"
[modes.mappings.trigger]
type = "Note"
note = 110
[modes.mappings.action]
type = "Sequence"
actions = [
    { type = "Keystroke", keys = "space", modifiers = ["cmd"] },  # Open Spotlight
    { type = "Delay", ms = 200 },  # Wait for Spotlight
    { type = "Text", text = "Terminal" },
    { type = "Delay", ms = 100 },
    { type = "Keystroke", keys = "return" }
]
</code></pre>
<h3 id="form-automation"><a class="header" href="#form-automation">Form Automation</a></h3>
<p>Fill complex forms with timing:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Fill registration form"
[modes.mappings.trigger]
type = "LongPress"
note = 115
hold_duration_ms = 2000
[modes.mappings.action]
type = "Sequence"
actions = [
    # First name
    { type = "Text", text = "Chris" },
    { type = "Delay", ms = 100 },
    { type = "Keystroke", keys = "tab" },
    { type = "Delay", ms = 100 },

    # Last name
    { type = "Text", text = "Joseph" },
    { type = "Delay", ms = 100 },
    { type = "Keystroke", keys = "tab" },
    { type = "Delay", ms = 100 },

    # Email
    { type = "Text", text = "chris@amiable.dev" },
    { type = "Delay", ms = 100 },
    { type = "Keystroke", keys = "tab" },
    { type = "Delay", ms = 100 },

    # Phone
    { type = "Text", text = "+1-555-123-4567" },
    { type = "Delay", ms = 200 },

    # Submit
    { type = "Keystroke", keys = "return" }
]
</code></pre>
<h3 id="multi-click-automation"><a class="header" href="#multi-click-automation">Multi-Click Automation</a></h3>
<p>Repeat mouse clicks at intervals:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Click button 5 times"
[modes.mappings.trigger]
type = "DoubleTap"
note = 120
max_interval_ms = 300
[modes.mappings.action]
type = "Repeat"
count = 5
delay_between_ms = 500
action = { type = "MouseClick", button = "Left" }

# Click at specific location repeatedly
[[modes.mappings]]
description = "Click refresh button"
[modes.mappings.trigger]
type = "Note"
note = 121
[modes.mappings.action]
type = "Repeat"
count = 3
delay_between_ms = 2000
action = { type = "MouseClick", button = "Left", x = 1200, y = 100 }
</code></pre>
<h3 id="macro-pad-layout"><a class="header" href="#macro-pad-layout">Macro Pad Layout</a></h3>
<p>Complete 16-pad layout for development:</p>
<pre><code class="language-toml">[device]
name = "Mikro"
auto_connect = true

[[modes]]
name = "Development"
color = "green"

# Row 1: Git operations
[[modes.mappings]]
description = "Git status"
[modes.mappings.trigger]
type = "Note"
note = 60
[modes.mappings.action]
type = "Shell"
command = "git status"

[[modes.mappings]]
description = "Git diff"
[modes.mappings.trigger]
type = "Note"
note = 61
[modes.mappings.action]
type = "Shell"
command = "git diff"

[[modes.mappings]]
description = "Quick commit"
[modes.mappings.trigger]
type = "Note"
note = 62
[modes.mappings.action]
type = "Sequence"
actions = [
    { type = "Shell", command = "git add -A" },
    { type = "Delay", ms = 100 },
    { type = "Shell", command = "git commit -m 'quick save'" }
]

[[modes.mappings]]
description = "Git push"
[modes.mappings.trigger]
type = "Note"
note = 63
[modes.mappings.action]
type = "Shell"
command = "git push"

# Row 2: Build &amp; test
[[modes.mappings]]
description = "Build project"
[modes.mappings.trigger]
type = "Note"
note = 64
[modes.mappings.action]
type = "Shell"
command = "cargo build"

[[modes.mappings]]
description = "Run tests"
[modes.mappings.trigger]
type = "Note"
note = 65
[modes.mappings.action]
type = "Shell"
command = "cargo test"

[[modes.mappings]]
description = "Run app"
[modes.mappings.trigger]
type = "Note"
note = 66
[modes.mappings.action]
type = "Shell"
command = "cargo run"

[[modes.mappings]]
description = "Format code"
[modes.mappings.trigger]
type = "Note"
note = 67
[modes.mappings.action]
type = "Shell"
command = "cargo fmt"

# Row 3: Navigation
[[modes.mappings]]
description = "Jump down (velocity)"
[modes.mappings.trigger]
type = "VelocityRange"
note = 68
ranges = [
    { min = 0, max = 40, action = { type = "Keystroke", keys = "down" } },
    { min = 41, max = 80, action = { type = "Repeat", count = 5, action = { type = "Keystroke", keys = "down" } } },
    { min = 81, max = 127, action = { type = "Repeat", count = 10, action = { type = "Keystroke", keys = "down" } } }
]

[[modes.mappings]]
description = "Jump up (velocity)"
[modes.mappings.trigger]
type = "VelocityRange"
note = 69
ranges = [
    { min = 0, max = 40, action = { type = "Keystroke", keys = "up" } },
    { min = 41, max = 80, action = { type = "Repeat", count = 5, action = { type = "Keystroke", keys = "up" } } },
    { min = 81, max = 127, action = { type = "Repeat", count = 10, action = { type = "Keystroke", keys = "up" } } }
]

# Row 4: Utilities
[[modes.mappings]]
description = "Open Terminal"
[modes.mappings.trigger]
type = "Note"
note = 72
[modes.mappings.action]
type = "Launch"
app = "Terminal"

[[modes.mappings]]
description = "Open VS Code"
[modes.mappings.trigger]
type = "Note"
note = 73
[modes.mappings.action]
type = "Launch"
app = "Visual Studio Code"

[[modes.mappings]]
description = "Open Browser"
[modes.mappings.trigger]
type = "Note"
note = 74
[modes.mappings.action]
type = "Launch"
app = "Google Chrome"
</code></pre>
<h3 id="context-aware-actions-conditional"><a class="header" href="#context-aware-actions-conditional">Context-Aware Actions (Conditional)</a></h3>
<p>Execute different actions based on runtime conditions like active app, time of day, or system state.</p>
<h4 id="app-based-conditional"><a class="header" href="#app-based-conditional">App-Based Conditional</a></h4>
<p>Different behavior when specific apps are running:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Context-aware play/pause"
[modes.mappings.trigger]
type = "Note"
note = 130
[modes.mappings.action]
type = "Conditional"
conditions = [
    { type = "AppRunning", bundle_id = "com.apple.Logic" }
]
then_action = { type = "Keystroke", keys = "space" }  # Logic: Space to play/pause
else_action = { type = "Keystroke", keys = "space", modifiers = ["cmd"] }  # System: Media play/pause
</code></pre>
<h4 id="time-based-automation"><a class="header" href="#time-based-automation">Time-Based Automation</a></h4>
<p>Launch different apps based on work hours:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Time-aware launcher"
[modes.mappings.trigger]
type = "Note"
note = 131
[modes.mappings.action]
type = "Conditional"
conditions = [
    { type = "TimeRange", start = "09:00", end = "17:00" },
    { type = "DayOfWeek", days = ["Mon", "Tue", "Wed", "Thu", "Fri"] }
]
operator = "And"
then_action = { type = "Launch", app = "Slack" }  # Work app during work hours
else_action = { type = "Launch", app = "Discord" }  # Personal app otherwise
</code></pre>
<h4 id="multiple-conditions-or-logic"><a class="header" href="#multiple-conditions-or-logic">Multiple Conditions (OR Logic)</a></h4>
<p>Launch file if any IDE is running:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Open project in active IDE"
[modes.mappings.trigger]
type = "Note"
note = 132
[modes.mappings.action]
type = "Conditional"
conditions = [
    { type = "AppRunning", bundle_id = "com.microsoft.VSCode" },
    { type = "AppRunning", bundle_id = "com.jetbrains.IntelliJ" },
    { type = "AppRunning", bundle_id = "com.sublimetext.4" }
]
operator = "Or"  # Any one IDE is enough
then_action = { type = "Keystroke", keys = "o", modifiers = ["cmd"] }  # Cmd+O to open file
else_action = { type = "Launch", app = "Visual Studio Code" }  # Launch IDE if none running
</code></pre>
<h4 id="modifier-based-conditional"><a class="header" href="#modifier-based-conditional">Modifier-Based Conditional</a></h4>
<p>Hold Shift for alternative behavior:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Delete or force-delete"
[modes.mappings.trigger]
type = "Note"
note = 133
[modes.mappings.action]
type = "Conditional"
conditions = [
    { type = "ModifierPressed", modifier = "Shift" }
]
then_action = { type = "Keystroke", keys = "delete", modifiers = ["cmd", "option"] }  # Force delete
else_action = { type = "Keystroke", keys = "delete", modifiers = ["cmd"] }  # Normal delete
</code></pre>
<h4 id="nested-conditionals-1"><a class="header" href="#nested-conditionals-1">Nested Conditionals</a></h4>
<p>Complex decision trees with multiple levels:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Smart launcher with time and app detection"
[modes.mappings.trigger]
type = "LongPress"
note = 135
hold_duration_ms = 1000
[modes.mappings.action]
type = "Conditional"
conditions = [
    { type = "TimeRange", start = "09:00", end = "17:00" }
]
then_action = {
    type = "Conditional",
    conditions = [
        { type = "AppRunning", bundle_id = "com.apple.Logic" }
    ],
    then_action = { type = "Keystroke", keys = "n", modifiers = ["cmd"] },  # New Logic project
    else_action = { type = "Launch", app = "Logic Pro" }  # Launch Logic
}
else_action = {
    type = "Conditional",
    conditions = [
        { type = "DayOfWeek", days = ["Sat", "Sun"] }
    ],
    then_action = { type = "Launch", app = "Spotify" },  # Weekend music
    else_action = { type = "Launch", app = "Safari" }  # Evening browsing
}
</code></pre>
<h4 id="launch-only-if-not-running"><a class="header" href="#launch-only-if-not-running">Launch Only if Not Running</a></h4>
<p>Avoid duplicate app launches:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Launch Spotify or play/pause if running"
[modes.mappings.trigger]
type = "Note"
note = 136
[modes.mappings.action]
type = "Conditional"
conditions = [
    { type = "AppNotRunning", bundle_id = "com.spotify.client" }
]
then_action = { type = "Launch", app = "Spotify" }
else_action = { type = "Keystroke", keys = "space" }  # Already running, just play/pause
</code></pre>
<h4 id="mode-aware-shortcuts"><a class="header" href="#mode-aware-shortcuts">Mode-Aware Shortcuts</a></h4>
<p>Different actions per mode using global mappings:</p>
<pre><code class="language-toml">[[global_mappings]]
description = "Mode-aware F5 key"
[global_mappings.trigger]
type = "Note"
note = 137
[global_mappings.action]
type = "Conditional"
conditions = [
    { type = "ModeActive", mode = 1 }  # Development mode
]
then_action = { type = "Shell", command = "npm test" }  # Run tests in dev mode
else_action = { type = "Keystroke", keys = "f5" }  # Refresh in other modes
</code></pre>
<h4 id="weekend-vs-weekday-behavior"><a class="header" href="#weekend-vs-weekday-behavior">Weekend vs Weekday Behavior</a></h4>
<p>Different workflows based on day of week:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Morning routine launcher"
[modes.mappings.trigger]
type = "Note"
note = 138
[modes.mappings.action]
type = "Conditional"
conditions = [
    { type = "DayOfWeek", days = ["Sat", "Sun"] },
    { type = "TimeRange", start = "08:00", end = "12:00" }
]
operator = "And"
then_action = {
    type = "Sequence",
    actions = [
        { type = "Launch", app = "Apple Music" },
        { type = "Delay", ms = 1000 },
        { type = "Launch", app = "Mail" }
    ]
}
else_action = {
    type = "Sequence",
    actions = [
        { type = "Launch", app = "Slack" },
        { type = "Delay", ms = 1000 },
        { type = "Launch", app = "Calendar" },
        { type = "Delay", ms = 500 },
        { type = "Launch", app = "Visual Studio Code" }
    ]
}
</code></pre>
<h2 id="performance-tips"><a class="header" href="#performance-tips">Performance Tips</a></h2>
<h3 id="timing-best-practices"><a class="header" href="#timing-best-practices">Timing Best Practices</a></h3>
<ol>
<li><strong>Application Launch</strong>: Wait 1000-2000ms after launching apps</li>
<li><strong>UI Navigation</strong>: Use 100-200ms between UI interactions</li>
<li><strong>Form Fills</strong>: 100ms delay between field navigation</li>
<li><strong>File Operations</strong>: 500-1000ms for save/load operations</li>
<li><strong>Network Operations</strong>: 2000ms+ for remote operations</li>
</ol>
<h3 id="repeat-guidelines"><a class="header" href="#repeat-guidelines">Repeat Guidelines</a></h3>
<ol>
<li><strong>Start Small</strong>: Begin with count=1, increase gradually</li>
<li><strong>Add Delays</strong>: Use <code>delay_between_ms</code> for counts &gt;5</li>
<li><strong>Test Incrementally</strong>: Verify each step before combining</li>
<li><strong>Consider UX</strong>: Counts &gt;100 may appear as hang</li>
<li><strong>Monitor Performance</strong>: Watch CPU/memory with large counts</li>
</ol>
<h3 id="debugging"><a class="header" href="#debugging">Debugging</a></h3>
<p>Enable debug mode to see action execution:</p>
<pre><code class="language-bash">DEBUG=1 cargo run --release 2
</code></pre>
<p>Common issues:</p>
<ul>
<li><strong>Timing too tight</strong>: Increase <code>delay_between_ms</code></li>
<li><strong>Actions not executing</strong>: Check application focus</li>
<li><strong>Repeats stopping early</strong>: Check <code>stop_on_error</code> setting</li>
<li><strong>Slow performance</strong>: Reduce repeat counts or add delays</li>
</ul>
<h2 id="see-also-5"><a class="header" href="#see-also-5">See Also</a></h2>
<ul>
<li><a href="configuration/actions.html">Actions Reference</a> - Complete action type documentation</li>
<li><a href="configuration/../reference/action-types.html">Action Types Reference</a> - Technical specifications</li>
<li><a href="configuration/../reference/trigger-types.html">Trigger Types</a> - Trigger configuration</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="trigger-types-1"><a class="header" href="#trigger-types-1">Trigger Types</a></h1>
<p>Triggers define when an action should execute. MIDIMon supports a wide range of trigger types from simple note presses to complex patterns like chords and long presses.</p>
<h2 id="core-triggers"><a class="header" href="#core-triggers">Core Triggers</a></h2>
<h3 id="note"><a class="header" href="#note">Note</a></h3>
<p>Basic MIDI note on/off detection.</p>
<pre><code class="language-toml">[trigger]
type = "Note"
note = 60  # Middle C
velocity_min = 1  # Optional: minimum velocity (default 1)
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>note</code> (integer): MIDI note number (0-127)</li>
<li><code>velocity_min</code> (integer, optional): Minimum velocity to trigger (default 1)</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Simple pad presses</li>
<li>Piano key detection</li>
<li>Basic button mapping</li>
</ul>
<h3 id="velocityrange"><a class="header" href="#velocityrange">VelocityRange</a></h3>
<p>Different actions based on how hard you press.</p>
<pre><code class="language-toml">[trigger]
type = "VelocityRange"
note = 60
min_velocity = 80
max_velocity = 127
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>note</code> (integer): MIDI note number</li>
<li><code>min_velocity</code> (integer): Minimum velocity (0-127)</li>
<li><code>max_velocity</code> (integer): Maximum velocity (0-127)</li>
</ul>
<p><strong>Velocity Levels:</strong></p>
<ul>
<li><strong>Soft</strong>: 0-40</li>
<li><strong>Medium</strong>: 41-80</li>
<li><strong>Hard</strong>: 81-127</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Soft press for play, hard press for stop</li>
<li>Different shortcuts based on press intensity</li>
<li>Expressive control mappings</li>
</ul>
<h3 id="longpress"><a class="header" href="#longpress">LongPress</a></h3>
<p>Detect when a pad is held for a duration.</p>
<pre><code class="language-toml">[trigger]
type = "LongPress"
note = 60
min_duration_ms = 1000  # Hold for 1 second
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>note</code> (integer): MIDI note number</li>
<li><code>min_duration_ms</code> (integer): Minimum hold duration in milliseconds (default 2000)</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Hold for 2s to quit app (prevent accidental quits)</li>
<li>Short tap for screenshot, long press for screen recording</li>
<li>Confirmation for destructive actions</li>
</ul>
<h3 id="doubletap"><a class="header" href="#doubletap">DoubleTap</a></h3>
<p>Detect quick double presses.</p>
<pre><code class="language-toml">[trigger]
type = "DoubleTap"
note = 60
max_interval_ms = 300  # Optional: max time between taps
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>note</code> (integer): MIDI note number</li>
<li><code>max_interval_ms</code> (integer, optional): Maximum interval between taps (default 300ms)</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Double-tap to toggle fullscreen</li>
<li>Quick double-tap for emergency actions</li>
<li>Gesture-based shortcuts</li>
</ul>
<h3 id="notechord"><a class="header" href="#notechord">NoteChord</a></h3>
<p>Multiple notes pressed simultaneously.</p>
<pre><code class="language-toml">[trigger]
type = "NoteChord"
notes = [60, 64, 67]  # C major chord
max_interval_ms = 100  # Optional
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>notes</code> (array): List of MIDI note numbers</li>
<li><code>max_interval_ms</code> (integer, optional): Maximum time between first and last note (default 100ms)</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Emergency exit (press 3 corners simultaneously)</li>
<li>Complex shortcuts requiring multiple pads</li>
<li>Safety mechanisms for important actions</li>
</ul>
<h3 id="cc-control-change"><a class="header" href="#cc-control-change">CC (Control Change)</a></h3>
<p>Continuous controller messages.</p>
<pre><code class="language-toml">[trigger]
type = "CC"
cc = 1  # Modulation wheel
value_min = 64  # Optional: trigger only when value &gt;= 64
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>cc</code> (integer): Control change number (0-127)</li>
<li><code>value_min</code> (integer, optional): Minimum value to trigger</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Button presses sending CC messages</li>
<li>Threshold-based triggers</li>
<li>Binary on/off switches</li>
</ul>
<h3 id="encoderturn"><a class="header" href="#encoderturn">EncoderTurn</a></h3>
<p>Encoder rotation with direction detection.</p>
<pre><code class="language-toml">[trigger]
type = "EncoderTurn"
cc = 2
direction = "Clockwise"  # or "CounterClockwise"
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>cc</code> (integer): Control change number</li>
<li><code>direction</code> (string): "Clockwise" or "CounterClockwise"</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Volume control with encoder</li>
<li>Mode switching (clockwise = next, counter-clockwise = previous)</li>
<li>Parameter adjustment</li>
</ul>
<h2 id="advanced-triggers"><a class="header" href="#advanced-triggers">Advanced Triggers</a></h2>
<h3 id="aftertouch-1"><a class="header" href="#aftertouch-1">Aftertouch</a></h3>
<p>Channel pressure sensitivity (pressure after initial press).</p>
<pre><code class="language-toml">[trigger]
type = "Aftertouch"
note = 1  # Optional: specific pad (omit for channel aftertouch)
min_pressure = 64  # Optional: minimum pressure
max_pressure = 127  # Optional: maximum pressure
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>note</code> (integer, optional): Specific pad for polyphonic aftertouch (omit for channel aftertouch)</li>
<li><code>min_pressure</code> (integer, optional): Minimum pressure value (0-127)</li>
<li><code>max_pressure</code> (integer, optional): Maximum pressure value (0-127)</li>
</ul>
<p><strong>Aftertouch Types:</strong></p>
<ul>
<li><strong>Polyphonic (0xA0)</strong>: Per-pad pressure (Maschine Mikro MK3, Launchpad Pro)</li>
<li><strong>Channel (0xD0)</strong>: Global pressure for entire device (most MIDI keyboards)</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Apply pressure to modulate effects</li>
<li>Pressure-sensitive volume control</li>
<li>Expression control without additional hardware</li>
</ul>
<p><strong>Device Compatibility:</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Device</th><th>Support</th><th>Type</th><th>Notes</th></tr></thead><tbody>
<tr><td>Maschine Mikro MK3</td><td>‚úÖ</td><td>Polyphonic</td><td>Excellent sensitivity</td></tr>
<tr><td>Akai MPD Series</td><td>‚úÖ</td><td>Polyphonic</td><td>Requires firmware 1.5+</td></tr>
<tr><td>Novation Launchpad Pro</td><td>‚úÖ</td><td>Polyphonic</td><td>Excellent sensitivity</td></tr>
<tr><td>Launchpad Mini</td><td>‚ùå</td><td>None</td><td>No aftertouch</td></tr>
<tr><td>Generic MIDI Keyboard</td><td>‚ö†Ô∏è</td><td>Channel</td><td>Global only</td></tr>
</tbody></table>
</div>
<p><strong>Configuration Examples:</strong></p>
<pre><code class="language-toml"># Basic aftertouch trigger
[[modes.mappings]]
description = "Effect intensity via pressure"
[modes.mappings.trigger]
type = "Aftertouch"
note = 1
min_pressure = 64
[modes.mappings.action]
type = "Shell"
command = "osascript -e 'set volume 50'"

# Pressure ranges for different actions
[[modes.mappings]]
description = "Soft pressure"
[modes.mappings.trigger]
type = "Aftertouch"
note = 2
min_pressure = 1
max_pressure = 64
[modes.mappings.action]
type = "Keystroke"
keys = "1"

[[modes.mappings]]
description = "Hard pressure"
[modes.mappings.trigger]
type = "Aftertouch"
note = 2
min_pressure = 65
max_pressure = 127
[modes.mappings.action]
type = "Keystroke"
keys = "2"
</code></pre>
<p><strong>Throttling Options:</strong></p>
<p>Aftertouch generates continuous messages. Use throttling to control message rate:</p>
<pre><code class="language-toml">[advanced_settings.aftertouch]
throttle_ms = 50        # Max 20 messages/sec
delta_threshold = 5     # Only trigger on ¬±5 pressure change
hysteresis_gap = 10     # Prevent zone oscillation
</code></pre>
<h3 id="pitchbend"><a class="header" href="#pitchbend">PitchBend</a></h3>
<p>Touch strip or pitch wheel control (14-bit precision).</p>
<pre><code class="language-toml">[trigger]
type = "PitchBend"
min_value = 8192   # Center
max_value = 16383  # Max up
center_deadzone = 100  # Optional: ignore small movements near center
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>min_value</code> (integer): Minimum bend value (0-16383)</li>
<li><code>max_value</code> (integer): Maximum bend value (0-16383)</li>
<li><code>center_deadzone</code> (integer, optional): Deadzone size around center (8192)</li>
</ul>
<p><strong>Value Range:</strong></p>
<ul>
<li><strong>Full Range</strong>: 0-16383 (14-bit resolution)</li>
<li><strong>Center</strong>: 8192</li>
<li><strong>Down</strong>: 0-8191</li>
<li><strong>Up</strong>: 8193-16383</li>
<li><strong>Normalized</strong>: -1.0 to +1.0</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Touch strip for volume control</li>
<li>Timeline scrubbing in DAWs</li>
<li>Smooth parameter sweeps</li>
<li>Multi-zone selection (divide strip into regions)</li>
</ul>
<p><strong>Configuration Examples:</strong></p>
<pre><code class="language-toml"># Volume control with touch strip
[[global_mappings]]
description = "Volume up via touch strip"
[global_mappings.trigger]
type = "PitchBend"
min_value = 8192  # Center
max_value = 16383  # Max up
center_deadzone = 100
[global_mappings.action]
type = "VolumeControl"
operation = "Up"

# Multi-zone mapping (divide strip into 5 zones)
[[modes.mappings]]
description = "Zone 1: Far Left"
[modes.mappings.trigger]
type = "PitchBend"
min_value = 0
max_value = 3276  # 20% of range
[modes.mappings.action]
type = "Keystroke"
keys = "1"

[[modes.mappings]]
description = "Zone 2: Left"
[modes.mappings.trigger]
type = "PitchBend"
min_value = 3277
max_value = 6553  # 40% of range
[modes.mappings.action]
type = "Keystroke"
keys = "2"

# Center detection
[[modes.mappings]]
description = "Reset on center touch"
[modes.mappings.trigger]
type = "PitchBend"
min_value = 8092  # Center - 100
max_value = 8292  # Center + 100
[modes.mappings.action]
type = "Keystroke"
keys = "r"
modifiers = ["cmd"]
</code></pre>
<p><strong>Throttling Options:</strong></p>
<p>Pitch bend generates 100-1000+ messages/sec. Use throttling:</p>
<pre><code class="language-toml">[advanced_settings.pitch_bend]
throttle_ms = 50         # Max 20 messages/sec
delta_threshold = 100    # Trigger only on ¬±100 change
use_zones = true         # Zone-based triggering
num_zones = 16           # 16 discrete zones
</code></pre>
<p><strong>Spring-Back Behavior:</strong></p>
<p>Many controllers (Maschine Mikro MK3, MIDI keyboards) auto-return to center:</p>
<ul>
<li>Returns to 8192 when released</li>
<li>Not suitable for persistent state/toggles</li>
<li>Use for momentary effects only</li>
<li>Spring-back generates message flood on release</li>
</ul>
<p><strong>Platform Notes:</strong></p>
<ul>
<li><strong>macOS</strong>: Full 14-bit support, no special handling</li>
<li><strong>Linux</strong>: Some ALSA drivers may reverse MSB/LSB byte order</li>
<li><strong>Windows</strong>: Supported, but some USB MIDI drivers have 10-50ms latency</li>
</ul>
<h2 id="trigger-composition"><a class="header" href="#trigger-composition">Trigger Composition</a></h2>
<p>Triggers can work together for complex behaviors:</p>
<p><strong>Example: Conditional Trigger</strong></p>
<pre><code class="language-toml"># Only trigger during specific time range
[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 60
[modes.mappings.action]
type = "Conditional"
conditions = [{ type = "TimeRange", start = "09:00", end = "17:00" }]
then_action = { type = "Shell", command = "work-task" }
else_action = { type = "Shell", command = "personal-task" }
</code></pre>
<h2 id="performance-notes"><a class="header" href="#performance-notes">Performance Notes</a></h2>
<ul>
<li><strong>Note/CC</strong>: &lt;0.1ms detection latency</li>
<li><strong>LongPress</strong>: Checked every 50ms</li>
<li><strong>DoubleTap</strong>: 300ms window (configurable)</li>
<li><strong>Chord</strong>: 100ms window (configurable)</li>
<li><strong>Aftertouch</strong>: Continuous messages, use throttling</li>
<li><strong>PitchBend</strong>: Continuous messages, 14-bit precision</li>
</ul>
<h2 id="troubleshooting-16"><a class="header" href="#troubleshooting-16">Troubleshooting</a></h2>
<h3 id="trigger-not-firing"><a class="header" href="#trigger-not-firing">Trigger Not Firing</a></h3>
<ul>
<li>Use <code>midi_diagnostic</code> tool to verify MIDI messages:
<pre><code class="language-bash">cargo run --bin midi_diagnostic 2
</code></pre>
</li>
<li>Check note numbers match MIDI output</li>
<li>Verify velocity thresholds</li>
<li>Enable debug logging: <code>DEBUG=1 cargo run</code></li>
</ul>
<h3 id="aftertouch-not-working"><a class="header" href="#aftertouch-not-working">Aftertouch Not Working</a></h3>
<ul>
<li>Check device compatibility (not all controllers support aftertouch)</li>
<li>Verify polyphonic vs channel aftertouch</li>
<li>Test with <code>midi_diagnostic</code> tool</li>
<li>Adjust pressure thresholds</li>
</ul>
<h3 id="pitchbend-jittery"><a class="header" href="#pitchbend-jittery">PitchBend Jittery</a></h3>
<ul>
<li>Increase <code>center_deadzone</code> value</li>
<li>Enable throttling in <code>advanced_settings</code></li>
<li>Use <code>delta_threshold</code> for change-based triggering</li>
<li>Consider zone-based triggering instead of continuous</li>
</ul>
<h3 id="chord-not-detected"><a class="header" href="#chord-not-detected">Chord Not Detected</a></h3>
<ul>
<li>Increase <code>max_interval_ms</code> (default 100ms)</li>
<li>Press pads more simultaneously</li>
<li>Check with <code>midi_diagnostic</code> for timing</li>
<li>Verify all note numbers correct</li>
</ul>
<h2 id="see-also-6"><a class="header" href="#see-also-6">See Also</a></h2>
<ul>
<li><a href="reference/action-types.html">Action Types</a></li>
<li><a href="reference/../configuration/examples.html">Configuration Examples</a></li>
<li><a href="reference/../configuration/modes.html">Modes and Mappings</a></li>
<li><a href="reference/../configuration/overview.html">Advanced Settings</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="action-types-1"><a class="header" href="#action-types-1">Action Types</a></h1>
<p>Actions are what MIDIMon executes when a trigger is detected. This page documents all available action types and their configuration.</p>
<h2 id="core-actions"><a class="header" href="#core-actions">Core Actions</a></h2>
<h3 id="keystroke-1"><a class="header" href="#keystroke-1">Keystroke</a></h3>
<p>Simulates keyboard input with optional modifiers.</p>
<pre><code class="language-toml">[action]
type = "Keystroke"
keys = "c"
modifiers = ["cmd"]
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>keys</code> (string): Key(s) to press (e.g., "space", "return", "f1")</li>
<li><code>modifiers</code> (array): Optional modifiers: "cmd", "ctrl", "alt", "shift"</li>
</ul>
<p><strong>Supported Keys:</strong></p>
<ul>
<li>Letters: <code>a-z</code></li>
<li>Numbers: <code>0-9</code></li>
<li>Special: <code>space</code>, <code>return</code>, <code>tab</code>, <code>escape</code>, <code>backspace</code>, <code>delete</code></li>
<li>Arrows: <code>up</code>, <code>down</code>, <code>left</code>, <code>right</code></li>
<li>Function: <code>f1</code> through <code>f12</code></li>
<li>Navigation: <code>home</code>, <code>end</code>, <code>pageup</code>, <code>pagedown</code></li>
</ul>
<h3 id="text-1"><a class="header" href="#text-1">Text</a></h3>
<p>Types arbitrary text strings with full Unicode support. Uses keyboard simulation to type character-by-character.</p>
<pre><code class="language-toml">[action]
type = "Text"
text = "Hello, World!"
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>text</code> (string): Text to type (supports Unicode, emoji, multi-line)</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Text snippets and templates</li>
<li>Email signatures and contact information</li>
<li>Code boilerplate and common patterns</li>
<li>Form auto-fill</li>
<li>Multi-language text input</li>
</ul>
<p><strong>Configuration Examples:</strong></p>
<p><strong>Simple Text:</strong></p>
<pre><code class="language-toml">[action]
type = "Text"
text = "user@example.com"
</code></pre>
<p><strong>Multi-line Code Snippet:</strong></p>
<pre><code class="language-toml">[action]
type = "Text"
text = """
fn main() {
    println!(\"Hello, World!\");
}
"""
</code></pre>
<p><strong>Unicode and Emoji:</strong></p>
<pre><code class="language-toml">[action]
type = "Text"
text = "‚úÖ Task completed! üéâ"
</code></pre>
<p><strong>Special Characters:</strong></p>
<pre><code class="language-toml">[action]
type = "Text"
text = "!@#$%^&amp;*()_+-=[]{}|;':\",./&lt;&gt;?"
</code></pre>
<p><strong>Text with Delay (using Sequence):</strong></p>
<pre><code class="language-toml">[action]
type = "Sequence"
actions = [
    { type = "Text", text = "username" },
    { type = "Delay", ms = 100 },
    { type = "Text", text = "@company.com" }
]
</code></pre>
<p><strong>TOML String Escaping:</strong></p>
<pre><code class="language-toml"># Escape quotes in basic strings
text = "He said \"hello\""

# Use multiline strings for complex text
text = """
Line 1
Line 2 with "quotes"
"""

# Use literal strings to avoid escaping backslashes
text = 'C:\Users\Documents\file.txt'
</code></pre>
<p><strong>Platform Support:</strong></p>
<ul>
<li>macOS: Accessibility APIs</li>
<li>Linux: X11/Wayland</li>
<li>Windows: Windows API</li>
</ul>
<p><strong>Behavior:</strong></p>
<ul>
<li>Types character-by-character (no clipboard)</li>
<li>Respects active keyboard layout</li>
<li>Typing speed controlled by OS</li>
<li>Requires text input focus</li>
</ul>
<p><strong>Troubleshooting:</strong></p>
<ul>
<li>Ensure target app has input focus</li>
<li>Check Input Monitoring permissions (macOS)</li>
<li>For slow UIs, use Sequence with Delay actions</li>
<li>For special keys (Enter, Tab, Ctrl), use Keystroke action instead</li>
</ul>
<h3 id="launch-1"><a class="header" href="#launch-1">Launch</a></h3>
<p>Opens an application by name or path using platform-specific system commands.</p>
<pre><code class="language-toml">[action]
type = "Launch"
app = "Safari"
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>app</code> (string): Application name or full path to executable/bundle</li>
</ul>
<p><strong>Platform Behavior:</strong></p>
<p><strong>macOS:</strong></p>
<ul>
<li>Uses <code>open -a</code> command</li>
<li>Accepts app names: "Safari", "Visual Studio Code", "Logic Pro"</li>
<li>Accepts full paths: "/Applications/Safari.app"</li>
<li>If app already running, brings to front</li>
<li>Searches standard paths: /Applications, ~/Applications, /System/Applications</li>
</ul>
<p><strong>Linux:</strong></p>
<ul>
<li>Direct executable launch via <code>Command::spawn()</code></li>
<li>Requires full path or executable in $PATH</li>
<li>No automatic .desktop file resolution</li>
<li>Typically launches new instance even if already running</li>
</ul>
<p><strong>Windows:</strong></p>
<ul>
<li>Uses <code>cmd /C start</code> command</li>
<li>Accepts app names or paths</li>
<li>Uses Windows file associations</li>
<li>Behavior varies by app's single-instance implementation</li>
</ul>
<p><strong>Examples:</strong></p>
<pre><code class="language-toml"># Launch by app name (macOS)
[action]
type = "Launch"
app = "Terminal"

# Launch by full path
[action]
type = "Launch"
app = "/Applications/Utilities/Terminal.app"

# Launch script with full path
[action]
type = "Launch"
app = "/Users/username/scripts/backup.sh"

# Launch multiple apps in sequence
[action]
type = "Sequence"
actions = [
    { type = "Launch", app = "VS Code" },
    { type = "Delay", ms = 1000 },
    { type = "Launch", app = "Terminal" }
]
</code></pre>
<p><strong>Troubleshooting:</strong></p>
<ul>
<li><strong>App not found</strong>: Use full path instead of app name</li>
<li><strong>macOS test</strong>: Run <code>open -a "App Name"</code> in Terminal</li>
<li><strong>Linux test</strong>: Run <code>which app-name</code> or use full path</li>
<li><strong>Silent failures</strong>: Enable debug mode with <code>DEBUG=1</code></li>
<li><strong>Permissions</strong>: Ensure execute permissions on scripts (<code>chmod +x</code>)</li>
</ul>
<p><strong>Notes:</strong></p>
<ul>
<li>Launch is non-blocking (returns immediately)</li>
<li>No validation that app exists before launch attempt</li>
<li>Errors fail silently (check debug logs)</li>
<li>App names with spaces are automatically handled</li>
<li>Launch time varies: 100ms (small apps) to 10s (large IDEs/DAWs)</li>
</ul>
<h3 id="shell-1"><a class="header" href="#shell-1">Shell</a></h3>
<p>Executes a shell command.</p>
<pre><code class="language-toml">[action]
type = "Shell"
command = "npm test"
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>command</code> (string): Shell command to execute</li>
</ul>
<p><strong>Platform Notes:</strong></p>
<ul>
<li>Unix/macOS: Uses <code>sh -c</code></li>
<li>Windows: Uses <code>cmd /C</code></li>
</ul>
<p><strong>Security Warning:</strong> Be cautious with user input in shell commands.</p>
<h2 id="system-actions-1"><a class="header" href="#system-actions-1">System Actions</a></h2>
<h3 id="volumecontrol-1"><a class="header" href="#volumecontrol-1">VolumeControl</a></h3>
<p>Controls system volume with cross-platform support for increase, decrease, mute/unmute, and absolute level setting.</p>
<pre><code class="language-toml">[action]
type = "VolumeControl"
operation = "Up"
amount = 5  # Optional: volume increment (default 5)
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>operation</code> (string): Volume operation to perform</li>
<li><code>amount</code> (integer, optional):
<ul>
<li>For <code>Up</code>/<code>Down</code>: Increment amount 0-100 (default 5)</li>
<li>For <code>Set</code>: Absolute level 0-100</li>
</ul>
</li>
</ul>
<p><strong>Operations:</strong></p>
<ul>
<li><code>Up</code>: Increase volume by amount</li>
<li><code>Down</code>: Decrease volume by amount</li>
<li><code>Mute</code>: Mute audio output</li>
<li><code>Unmute</code>: Unmute audio output</li>
<li><code>Toggle</code>: Toggle mute state</li>
<li><code>Set</code>: Set to specific level (requires <code>amount</code> parameter)</li>
</ul>
<p><strong>Platform Support:</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Platform</th><th>Method</th><th>Latency</th><th>Dependencies</th></tr></thead><tbody>
<tr><td>macOS</td><td>AppleScript</td><td>50-100ms</td><td>None (built-in)</td></tr>
<tr><td>Linux (PulseAudio)</td><td>pactl</td><td>10-30ms</td><td>pulseaudio-utils</td></tr>
<tr><td>Linux (Pipewire)</td><td>wpctl</td><td>5-15ms</td><td>wireplumber</td></tr>
<tr><td>Linux (ALSA)</td><td>amixer</td><td>15-40ms</td><td>alsa-utils</td></tr>
<tr><td>Windows</td><td>nircmd</td><td>20-50ms</td><td>nircmd.exe</td></tr>
<tr><td>Windows</td><td>COM API</td><td>5-10ms</td><td>None (built-in)</td></tr>
</tbody></table>
</div>
<p><strong>Configuration Examples:</strong></p>
<pre><code class="language-toml"># Encoder volume control
[[global_mappings]]
description = "Volume Up"
[global_mappings.trigger]
type = "EncoderTurn"
cc = 2
direction = "Clockwise"
[global_mappings.action]
type = "VolumeControl"
operation = "Up"
amount = 2  # Small increments for smooth control

[[global_mappings]]
description = "Volume Down"
[global_mappings.trigger]
type = "EncoderTurn"
cc = 2
direction = "CounterClockwise"
[global_mappings.action]
type = "VolumeControl"
operation = "Down"
amount = 2

# Mute toggle
[[global_mappings]]
description = "Mute/Unmute"
[global_mappings.trigger]
type = "Note"
note = 16
[global_mappings.action]
type = "VolumeControl"
operation = "Toggle"

# Set to specific level
[[modes.mappings]]
description = "Set volume to 50%"
[modes.mappings.trigger]
type = "Note"
note = 8
[modes.mappings.action]
type = "VolumeControl"
operation = "Set"
amount = 50

# Velocity-based volume (multiple mappings)
[[modes.mappings]]
description = "Soft press = 25%"
[modes.mappings.trigger]
type = "VelocityRange"
note = 9
min_velocity = 0
max_velocity = 40
[modes.mappings.action]
type = "VolumeControl"
operation = "Set"
amount = 25

[[modes.mappings]]
description = "Medium press = 50%"
[modes.mappings.trigger]
type = "VelocityRange"
note = 9
min_velocity = 41
max_velocity = 80
[modes.mappings.action]
type = "VolumeControl"
operation = "Set"
amount = 50

[[modes.mappings]]
description = "Hard press = 75%"
[modes.mappings.trigger]
type = "VelocityRange"
note = 9
min_velocity = 81
max_velocity = 127
[modes.mappings.action]
type = "VolumeControl"
operation = "Set"
amount = 75
</code></pre>
<p><strong>Use Cases:</strong></p>
<ul>
<li><strong>Producer</strong>: Encoder for smooth volume adjustment while mixing</li>
<li><strong>Developer</strong>: Quick mute during video calls, volume presets for different activities</li>
<li><strong>Streamer</strong>: Real-time volume balancing during streams, emergency mute</li>
<li><strong>Presenter</strong>: Volume control without touching laptop during presentations</li>
</ul>
<p><strong>Troubleshooting:</strong></p>
<p><em><strong>macOS:</strong></em></p>
<ul>
<li>No dependencies required</li>
<li>AppleScript latency ~50-100ms is normal</li>
<li>Requires no special permissions</li>
</ul>
<p><em><strong>Linux:</strong></em></p>
<ul>
<li>Install dependencies:
<pre><code class="language-bash"># PulseAudio (most common)
sudo apt install pulseaudio-utils

# Pipewire (modern, fastest)
sudo apt install pipewire wireplumber

# ALSA (minimal systems)
sudo apt install alsa-utils
</code></pre>
</li>
<li>MIDIMon auto-detects available backend</li>
<li>User must be in <code>audio</code> group</li>
</ul>
<p><em><strong>Windows:</strong></em></p>
<ul>
<li>Download nircmd.exe from https://www.nirsoft.net/utils/nircmd.html</li>
<li>Add to PATH or place in MIDIMon directory</li>
<li>COM API fallback requires no dependencies</li>
</ul>
<p><strong>Performance Notes:</strong></p>
<ul>
<li>Volume commands are non-blocking</li>
<li>State changes typically take 5-100ms depending on platform</li>
<li>Multiple rapid commands may queue on slower platforms (macOS AppleScript)</li>
</ul>
<h3 id="modechange-1"><a class="header" href="#modechange-1">ModeChange</a></h3>
<p>Switches between different mapping modes with optional LED transition effects and relative navigation.</p>
<pre><code class="language-toml">[action]
type = "ModeChange"
mode = 1  # Switch to mode index 1
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>mode</code> (integer): Zero-based mode index or offset (if <code>relative = true</code>)</li>
<li><code>relative</code> (boolean, optional): If true, <code>mode</code> is offset from current mode (default false)</li>
<li><code>transition_effect</code> (string, optional): Visual transition effect: "Flash", "Sweep", "FadeOut", "Spiral", "None"</li>
</ul>
<p><strong>Mode Indexing:</strong></p>
<ul>
<li>Modes are zero-based: Mode 0, Mode 1, Mode 2, etc.</li>
<li>Mode 0 is typically the default mode on startup</li>
<li>Invalid mode indices are clamped to valid range</li>
</ul>
<p><strong>Absolute vs Relative Mode Changes:</strong></p>
<p><em><strong>Absolute (direct jump):</strong></em></p>
<pre><code class="language-toml">[action]
type = "ModeChange"
mode = 2  # Jump directly to Mode 2
transition_effect = "Flash"
</code></pre>
<p><em><strong>Relative (navigation):</strong></em></p>
<pre><code class="language-toml"># Next mode (with wrapping)
[action]
type = "ModeChange"
mode = 1  # +1 offset
relative = true
transition_effect = "Sweep"

# Previous mode (with wrapping)
[action]
type = "ModeChange"
mode = -1  # -1 offset
relative = true
</code></pre>
<p><strong>Transition Effects:</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Effect</th><th>Duration</th><th>Description</th></tr></thead><tbody>
<tr><td>Flash</td><td>150ms</td><td>Quick white flash</td></tr>
<tr><td>Sweep</td><td>120ms</td><td>Left-to-right wave</td></tr>
<tr><td>FadeOut</td><td>200ms</td><td>Fade out old, fade in new</td></tr>
<tr><td>Spiral</td><td>240ms</td><td>Center-outward spiral</td></tr>
<tr><td>None</td><td>0ms</td><td>Instant switch</td></tr>
</tbody></table>
</div>
<p><strong>Configuration Examples:</strong></p>
<pre><code class="language-toml"># Encoder for mode cycling
[[global_mappings]]
description = "Next Mode"
[global_mappings.trigger]
type = "EncoderTurn"
cc = 1
direction = "Clockwise"
[global_mappings.action]
type = "ModeChange"
mode = 1  # +1 offset
relative = true
transition_effect = "Sweep"

[[global_mappings]]
description = "Previous Mode"
[global_mappings.trigger]
type = "EncoderTurn"
cc = 1
direction = "CounterClockwise"
[global_mappings.action]
type = "ModeChange"
mode = -1  # -1 offset (wraps backward)
relative = true
transition_effect = "Sweep"

# Direct mode selection with chords
[[global_mappings]]
description = "Jump to Default Mode"
[global_mappings.trigger]
type = "NoteChord"
notes = [1, 9]  # Top-left corners
[global_mappings.action]
type = "ModeChange"
mode = 0
transition_effect = "Flash"

[[global_mappings]]
description = "Jump to Development Mode"
[global_mappings.trigger]
type = "NoteChord"
notes = [2, 10]
[global_mappings.action]
type = "ModeChange"
mode = 1
transition_effect = "Flash"

[[global_mappings]]
description = "Jump to Media Mode"
[global_mappings.trigger]
type = "NoteChord"
notes = [3, 11]
[global_mappings.action]
type = "ModeChange"
mode = 2
transition_effect = "FadeOut"

# Conditional mode change
[[modes.mappings]]
description = "Switch to Media mode if Spotify running"
[modes.mappings.trigger]
type = "Note"
note = 8
[modes.mappings.action]
type = "Conditional"
conditions = [{ type = "AppRunning", bundle_id = "com.spotify.client" }]
then_action = { type = "ModeChange", mode = 2, transition_effect = "FadeOut" }
else_action = { type = "Launch", app = "Spotify" }
</code></pre>
<p><strong>Mode Configuration:</strong></p>
<p>Modes are defined in your config.toml with names and LED colors:</p>
<pre><code class="language-toml">[[modes]]
name = "Default"
color = "blue"             # LED color for this mode
led_idle_brightness = 20   # Brightness when pad not pressed
led_active_brightness = 255 # Brightness when pad pressed
mappings = [...]

[[modes]]
name = "Development"
color = "green"
led_idle_brightness = 30
led_active_brightness = 255
mappings = [...]

[[modes]]
name = "Media"
color = "purple"
led_idle_brightness = 15
led_active_brightness = 200
mappings = [...]
</code></pre>
<p><strong>LED Feedback Integration:</strong></p>
<ul>
<li>Mode colors automatically update LEDs on mode change</li>
<li>Transition effects provide visual feedback</li>
<li>Optional mode indicator pads (e.g., bottom row shows active mode)</li>
<li>Idle/active brightness levels per mode</li>
</ul>
<p><strong>Use Cases:</strong></p>
<p><em><strong>Developer (Sam) - Context Switching:</strong></em></p>
<ul>
<li><strong>Mode 0</strong>: General productivity shortcuts</li>
<li><strong>Mode 1</strong>: IDE shortcuts (build, test, debug)</li>
<li><strong>Mode 2</strong>: Media controls</li>
<li>Encoder rotation for quick mode cycling</li>
</ul>
<p><em><strong>Producer (Alex) - Production Workflow:</strong></em></p>
<ul>
<li><strong>Mode 0</strong>: Recording (transport, record arm)</li>
<li><strong>Mode 1</strong>: Mixing (volume, mute/solo, effects)</li>
<li><strong>Mode 2</strong>: Mastering (compressor, EQ, limiter)</li>
<li>Chord combinations for instant mode jumps</li>
</ul>
<p><em><strong>Streamer (Jordan) - Live Streaming:</strong></em></p>
<ul>
<li><strong>Mode 0</strong>: Pre-Stream (setup checks, app launching)</li>
<li><strong>Mode 1</strong>: Live (scene switching, alerts)</li>
<li><strong>Mode 2</strong>: BRB (limited controls, auto-mute)</li>
<li><strong>Mode 3</strong>: Post-Stream (save, shutdown sequence)</li>
</ul>
<p><em><strong>Designer (Taylor) - Creative Workflows:</strong></em></p>
<ul>
<li><strong>Mode 0</strong>: Sketch (drawing tools, layers)</li>
<li><strong>Mode 1</strong>: Edit (selection, transform, filters)</li>
<li><strong>Mode 2</strong>: Export (save presets, formats)</li>
<li>Visual LED feedback shows current mode</li>
</ul>
<p><strong>Circular Mode Navigation:</strong></p>
<p>With <code>relative = true</code>, modes wrap around:</p>
<ul>
<li>Mode 0 ‚Üí +1 ‚Üí Mode 1</li>
<li>Mode 1 ‚Üí +1 ‚Üí Mode 2</li>
<li>Mode 2 ‚Üí +1 ‚Üí Mode 0 (wraps to beginning)</li>
<li>Mode 0 ‚Üí -1 ‚Üí Mode 2 (wraps to end)</li>
</ul>
<p><strong>Troubleshooting:</strong></p>
<p><em><strong>Mode Not Switching:</strong></em></p>
<ul>
<li>Verify mode index is within range (0 to num_modes-1)</li>
<li>Check that modes are defined in config.toml</li>
<li>Enable debug logging: <code>DEBUG=1 cargo run</code></li>
<li>Ensure mode change mapping is in <code>global_mappings</code> to work from all modes</li>
</ul>
<p><em><strong>LEDs Not Updating:</strong></em></p>
<ul>
<li>Verify <code>color</code> is set for each mode</li>
<li>Check device supports RGB LED feedback</li>
<li>Ensure LED feedback is enabled</li>
<li>Test with different transition effects</li>
</ul>
<p><em><strong>Transition Effects Not Working:</strong></em></p>
<ul>
<li>Only works with devices supporting RGB LEDs (Maschine Mikro MK3, etc.)</li>
<li>MIDI-only devices show instant switches</li>
<li>Check transition timing isn't too fast to notice</li>
</ul>
<p><strong>Performance Notes:</strong></p>
<ul>
<li>Mode switches are near-instant (&lt;1ms)</li>
<li>Transition effects add 0-240ms visual delay</li>
<li>LED updates are non-blocking</li>
<li>Rapid mode changes are queued and handled gracefully</li>
</ul>
<h2 id="advanced-actions-1"><a class="header" href="#advanced-actions-1">Advanced Actions</a></h2>
<h3 id="sequence-1"><a class="header" href="#sequence-1">Sequence</a></h3>
<p>Executes multiple actions in order.</p>
<pre><code class="language-toml">[action]
type = "Sequence"
actions = [
    { type = "Keystroke", keys = "n", modifiers = ["cmd"] },
    { type = "Delay", ms = 500 },
    { type = "Text", text = "New Document" }
]
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>actions</code> (array): Array of action configurations</li>
</ul>
<p><strong>Notes:</strong></p>
<ul>
<li>Actions execute sequentially</li>
<li>Default 50ms delay between actions</li>
<li>Use <code>Delay</code> action for longer pauses</li>
</ul>
<h3 id="delay-1"><a class="header" href="#delay-1">Delay</a></h3>
<p>Pauses execution.</p>
<pre><code class="language-toml">[action]
type = "Delay"
ms = 1000  # Wait 1 second
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>ms</code> (integer): Milliseconds to wait</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Wait for app to launch</li>
<li>Timing between keystrokes</li>
<li>Synchronization in sequences</li>
</ul>
<h3 id="repeat-1"><a class="header" href="#repeat-1">Repeat</a></h3>
<p>Repeats an action multiple times.</p>
<pre><code class="language-toml">[action]
type = "Repeat"
count = 10
delay_between_ms = 100
action = { type = "Keystroke", keys = "right" }
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>action</code> (object): Action to repeat</li>
<li><code>count</code> (integer): Number of repetitions</li>
<li><code>delay_between_ms</code> (integer, optional): Delay between repetitions in milliseconds</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Navigate through items</li>
<li>Rapid-fire actions</li>
<li>Automation tasks</li>
</ul>
<h3 id="mouseclick-1"><a class="header" href="#mouseclick-1">MouseClick</a></h3>
<p>Simulates mouse clicks.</p>
<pre><code class="language-toml">[action]
type = "MouseClick"
button = "left"
x = 100
y = 200
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>button</code> (string): "left", "right", or "middle"</li>
<li><code>x</code> (integer, optional): X coordinate (absolute)</li>
<li><code>y</code> (integer, optional): Y coordinate (absolute)</li>
</ul>
<p><strong>Notes:</strong></p>
<ul>
<li>If <code>x</code> and <code>y</code> are omitted, clicks at current cursor position</li>
<li>Coordinates are screen-absolute</li>
</ul>
<h3 id="conditional-1"><a class="header" href="#conditional-1">Conditional</a></h3>
<p>Executes actions based on conditions.</p>
<pre><code class="language-toml">[action]
type = "Conditional"
conditions = [
    { type = "AppRunning", bundle_id = "com.apple.Logic" }
]
operator = "And"
then_action = { type = "Keystroke", keys = "space" }
else_action = { type = "Launch", app = "Logic Pro" }
</code></pre>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>conditions</code> (array): Array of condition objects</li>
<li><code>operator</code> (string, optional): "And" or "Or" (default: "And")</li>
<li><code>then_action</code> (object): Action when conditions are true</li>
<li><code>else_action</code> (object, optional): Action when conditions are false</li>
</ul>
<p><strong>Condition Types:</strong></p>
<h4 id="apprunning-1"><a class="header" href="#apprunning-1">AppRunning</a></h4>
<p>Check if an application is running.</p>
<pre><code class="language-toml">{ type = "AppRunning", bundle_id = "com.spotify.client" }
</code></pre>
<h4 id="appnotrunning"><a class="header" href="#appnotrunning">AppNotRunning</a></h4>
<p>Check if an application is not running.</p>
<pre><code class="language-toml">{ type = "AppNotRunning", bundle_id = "com.spotify.client" }
</code></pre>
<h4 id="timerange-1"><a class="header" href="#timerange-1">TimeRange</a></h4>
<p>Check if current time is within a range.</p>
<pre><code class="language-toml">{ type = "TimeRange", start = "09:00", end = "17:00" }
</code></pre>
<p><strong>Format:</strong> HH:MM in 24-hour format
<strong>Note:</strong> Uses local system time</p>
<h4 id="dayofweek-1"><a class="header" href="#dayofweek-1">DayOfWeek</a></h4>
<p>Check if today matches specified days.</p>
<pre><code class="language-toml">{ type = "DayOfWeek", days = ["Mon", "Tue", "Wed", "Thu", "Fri"] }
</code></pre>
<p><strong>Valid Days:</strong> "Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"</p>
<h4 id="modifierpressed"><a class="header" href="#modifierpressed">ModifierPressed</a></h4>
<p>Check if a modifier key is held.</p>
<pre><code class="language-toml">{ type = "ModifierPressed", modifier = "Shift" }
</code></pre>
<p><strong>Valid Modifiers:</strong> "Shift", "Ctrl", "Cmd", "Alt", "Option"</p>
<h4 id="modeactive"><a class="header" href="#modeactive">ModeActive</a></h4>
<p>Check if a specific mode is active.</p>
<pre><code class="language-toml">{ type = "ModeActive", mode = 1 }
</code></pre>
<p><strong>Parameter:</strong> <code>mode</code> (integer): Zero-based mode index</p>
<p><strong>Operators:</strong></p>
<ul>
<li><code>And</code>: All conditions must be true</li>
<li><code>Or</code>: At least one condition must be true</li>
</ul>
<p><strong>Nested Conditionals:</strong>
You can nest conditionals for complex decision trees:</p>
<pre><code class="language-toml">[action]
type = "Conditional"
conditions = [{ type = "TimeRange", start = "09:00", end = "17:00" }]
then_action = {
    type = "Conditional",
    conditions = [{ type = "AppRunning", bundle_id = "com.microsoft.VSCode" }],
    then_action = { type = "Keystroke", keys = "b", modifiers = ["cmd", "shift"] },
    else_action = { type = "Launch", app = "Visual Studio Code" }
}
else_action = { type = "Launch", app = "Spotify" }
</code></pre>
<h2 id="action-composition"><a class="header" href="#action-composition">Action Composition</a></h2>
<p>Actions can be combined in powerful ways:</p>
<p><strong>Example: Complex Workflow</strong></p>
<pre><code class="language-toml">[action]
type = "Sequence"
actions = [
    { type = "Launch", app = "Terminal" },
    { type = "Delay", ms = 1000 },
    { type = "Text", text = "cd ~/projects &amp;&amp; npm test" },
    { type = "Keystroke", keys = "return" }
]
</code></pre>
<p><strong>Example: Conditional with Repeat</strong></p>
<pre><code class="language-toml">[action]
type = "Conditional"
conditions = [{ type = "ModifierPressed", modifier = "Shift" }]
then_action = {
    type = "Repeat",
    count = 5,
    delay_between_ms = 200,
    action = { type = "Keystroke", keys = "right" }
}
else_action = { type = "Keystroke", keys = "right" }
</code></pre>
<h2 id="performance-notes-1"><a class="header" href="#performance-notes-1">Performance Notes</a></h2>
<ul>
<li><strong>Keystroke</strong>: &lt;1ms execution time</li>
<li><strong>Shell</strong>: Asynchronous, non-blocking</li>
<li><strong>Launch</strong>: Platform-dependent, typically 100-500ms</li>
<li><strong>Conditional</strong>: 10-50ms per condition evaluation</li>
<li><strong>Sequence</strong>: Sum of individual action times + delays</li>
</ul>
<h2 id="troubleshooting-17"><a class="header" href="#troubleshooting-17">Troubleshooting</a></h2>
<h3 id="keystroke-not-working"><a class="header" href="#keystroke-not-working">Keystroke Not Working</a></h3>
<ul>
<li>Verify key name spelling</li>
<li>Check modifier syntax</li>
<li>Ensure app has input focus</li>
</ul>
<h3 id="shell-command-fails-silently"><a class="header" href="#shell-command-fails-silently">Shell Command Fails Silently</a></h3>
<ul>
<li>Test command in terminal first</li>
<li>Check environment variables</li>
<li>Enable debug logging: <code>DEBUG=1 cargo run</code></li>
</ul>
<h3 id="conditional-not-triggering"><a class="header" href="#conditional-not-triggering">Conditional Not Triggering</a></h3>
<ul>
<li>Verify bundle ID format (macOS): <code>osascript -e 'id of app "AppName"'</code></li>
<li>Check time format (24-hour: "09:00", not "9:00 AM")</li>
<li>Verify day names match exactly</li>
</ul>
<h3 id="launch-app-not-found"><a class="header" href="#launch-app-not-found">Launch App Not Found</a></h3>
<ul>
<li>Use exact app name as it appears in Applications folder</li>
<li>On Linux, use full executable path if not in PATH</li>
<li>Check permissions for app execution</li>
</ul>
<h2 id="see-also-7"><a class="header" href="#see-also-7">See Also</a></h2>
<ul>
<li><a href="reference/../configuration/examples.html">Configuration Examples</a></li>
<li><a href="reference/trigger-types.html">Trigger Types</a></li>
<li><a href="reference/../configuration/modes.html">Modes and Mappings</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="led-system-reference"><a class="header" href="#led-system-reference">LED System Reference</a></h1>
<p>MIDIMon provides comprehensive LED feedback for supported MIDI controllers, with full RGB control for HID devices (Native Instruments Maschine Mikro MK3) and basic on/off control for standard MIDI devices.</p>
<h2 id="overview-13"><a class="header" href="#overview-13">Overview</a></h2>
<p>The LED system consists of four main features:</p>
<ol>
<li><strong>F23: LED Lighting Schemes</strong> - 10 pre-defined animation patterns</li>
<li><strong>F24: LED Velocity Feedback</strong> - Color-coded response based on pad velocity</li>
<li><strong>F25: LED Mode Indicators</strong> - Visual feedback for active mode</li>
<li><strong>F26: LED Fade Effects</strong> - Smooth transitions and fade-out animations</li>
</ol>
<h2 id="feature-f23-led-lighting-schemes"><a class="header" href="#feature-f23-led-lighting-schemes">Feature F23: LED Lighting Schemes</a></h2>
<p>MIDIMon supports 10 distinct lighting schemes that can be selected at startup or configured in your config file.</p>
<h3 id="available-schemes-1"><a class="header" href="#available-schemes-1">Available Schemes</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Scheme</th><th>Description</th><th>Use Case</th><th>CPU Impact</th></tr></thead><tbody>
<tr><td><code>off</code></td><td>All LEDs disabled</td><td>Power saving, minimal distraction</td><td>0%</td></tr>
<tr><td><code>static</code></td><td>Solid color based on current mode</td><td>Clear mode indication</td><td>&lt;1%</td></tr>
<tr><td><code>breathing</code></td><td>Slow 2-second breathing effect</td><td>Ambient, relaxed workflow</td><td>~1%</td></tr>
<tr><td><code>pulse</code></td><td>Fast 500ms pulse</td><td>High-energy, performance</td><td>~1%</td></tr>
<tr><td><code>rainbow</code></td><td>Rainbow cycle across pads</td><td>Creative sessions, visual appeal</td><td>~2%</td></tr>
<tr><td><code>wave</code></td><td>Wave animation pattern</td><td>Dynamic feedback</td><td>~2%</td></tr>
<tr><td><code>sparkle</code></td><td>Random sparkles</td><td>Playful, attention-grabbing</td><td>~3%</td></tr>
<tr><td><code>reactive</code></td><td>Velocity-based colors (most common)</td><td>Precise feedback, performance</td><td>~1%</td></tr>
<tr><td><code>vumeter</code></td><td>VU meter style (bottom-up)</td><td>Audio visualization</td><td>~2%</td></tr>
<tr><td><code>spiral</code></td><td>Spiral pattern animation</td><td>Artistic, mesmerizing</td><td>~2%</td></tr>
</tbody></table>
</div>
<h3 id="command-line-usage-1"><a class="header" href="#command-line-usage-1">Command-Line Usage</a></h3>
<pre><code class="language-bash"># Start with reactive scheme (recommended)
cargo run --release 2 --led reactive

# Rainbow animation
cargo run --release 2 --led rainbow

# Disable LEDs
cargo run --release 2 --led off

# Static mode colors
cargo run --release 2 --led static
</code></pre>
<h3 id="configuration-1"><a class="header" href="#configuration-1">Configuration</a></h3>
<pre><code class="language-toml">[led_settings]
scheme = "reactive"  # Default scheme on startup
</code></pre>
<h3 id="implementation-details"><a class="header" href="#implementation-details">Implementation Details</a></h3>
<ul>
<li><strong>Update Rate</strong>: 10fps (100ms per frame) to maintain low CPU usage</li>
<li><strong>HID Devices</strong>: Full RGB control with 16.7 million colors</li>
<li><strong>MIDI Devices</strong>: Schemes degrade gracefully to on/off</li>
<li><strong>Performance</strong>: All schemes designed for &lt;3% CPU usage</li>
</ul>
<hr />
<h2 id="feature-f24-led-velocity-feedback"><a class="header" href="#feature-f24-led-velocity-feedback">Feature F24: LED Velocity Feedback</a></h2>
<p>Reactive LED feedback provides immediate visual confirmation of pad velocity, using color-coded responses.</p>
<h3 id="velocity-color-mapping"><a class="header" href="#velocity-color-mapping">Velocity Color Mapping</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Velocity Range</th><th>Color</th><th>Visual</th><th>Meaning</th></tr></thead><tbody>
<tr><td>0-40</td><td>Green</td><td>üü¢</td><td>Soft press</td></tr>
<tr><td>41-80</td><td>Yellow</td><td>üü°</td><td>Medium press</td></tr>
<tr><td>81-127</td><td>Red</td><td>üî¥</td><td>Hard press</td></tr>
</tbody></table>
</div>
<h3 id="behavior"><a class="header" href="#behavior">Behavior</a></h3>
<p><strong>On Press:</strong></p>
<ul>
<li>Pad immediately lights up in velocity-appropriate color</li>
<li>Brightness scales with velocity (40% base + 60% velocity-based)</li>
<li>Color change happens within &lt;1ms for responsive feedback</li>
</ul>
<p><strong>On Release:</strong></p>
<ul>
<li>Fade-out begins after 1 second</li>
<li>Fade duration: 200ms (configurable in future versions)</li>
<li>Pad returns to mode color or off state</li>
</ul>
<h3 id="configuration-example"><a class="header" href="#configuration-example">Configuration Example</a></h3>
<pre><code class="language-toml">[led_settings]
scheme = "reactive"

# Future: Velocity threshold customization
[led_settings.reactive]
soft_color = { r = 0, g = 255, b = 0 }      # Green
medium_color = { r = 255, g = 255, b = 0 }  # Yellow
hard_color = { r = 255, g = 0, b = 0 }      # Red
fade_duration_ms = 1000
</code></pre>
<h3 id="use-cases-3"><a class="header" href="#use-cases-3">Use Cases</a></h3>
<ul>
<li><strong>Performance</strong>: Immediate feedback on hit strength for drum pads</li>
<li><strong>Practice</strong>: Visual metronome or timing reference</li>
<li><strong>Recording</strong>: Confirm input without audio monitoring</li>
<li><strong>Accessibility</strong>: Visual alternative to audio feedback</li>
</ul>
<hr />
<h2 id="feature-f25-led-mode-indicators"><a class="header" href="#feature-f25-led-mode-indicators">Feature F25: LED Mode Indicators</a></h2>
<p>Visual feedback showing the currently active mode, helping users stay oriented when switching contexts.</p>
<h3 id="mode-color-scheme"><a class="header" href="#mode-color-scheme">Mode Color Scheme</a></h3>
<p>Each mode has an associated color that LEDs display when using <code>static</code> or <code>reactive</code> schemes:</p>
<div class="table-wrapper"><table><thead><tr><th>Mode</th><th>Default Color</th><th>RGB Values</th><th>Visual</th></tr></thead><tbody>
<tr><td>Mode 0 (Default)</td><td>Blue</td><td>(0, 100, 255)</td><td>üîµ</td></tr>
<tr><td>Mode 1 (Development)</td><td>Green</td><td>(0, 255, 0)</td><td>üü¢</td></tr>
<tr><td>Mode 2 (Media)</td><td>Purple</td><td>(200, 0, 255)</td><td>üü£</td></tr>
</tbody></table>
</div>
<h3 id="configuration-2"><a class="header" href="#configuration-2">Configuration</a></h3>
<pre><code class="language-toml">[[modes]]
name = "Default"
color = "blue"
led_idle_brightness = 20      # Brightness when idle (0-255)
led_active_brightness = 255   # Brightness when pressed

[[modes]]
name = "Development"
color = "green"
led_idle_brightness = 30
led_active_brightness = 255

[[modes]]
name = "Media"
color = "purple"
led_idle_brightness = 15
led_active_brightness = 200
</code></pre>
<h3 id="mode-transition-effects-2"><a class="header" href="#mode-transition-effects-2">Mode Transition Effects</a></h3>
<p>When switching modes, you can apply visual transition effects:</p>
<pre><code class="language-toml">[[global_mappings]]
description = "Next Mode with Flash"
[global_mappings.trigger]
type = "EncoderTurn"
cc = 1
direction = "Clockwise"
[global_mappings.action]
type = "ModeChange"
mode = 1
relative = true
transition_effect = "Flash"  # Options: Flash, Sweep, FadeOut, Spiral, None
</code></pre>
<p><strong>Transition Effects:</strong></p>
<ul>
<li><strong>Flash</strong>: Quick white flash (150ms) - best for rapid mode switching</li>
<li><strong>Sweep</strong>: Left-to-right wave (120ms) - smooth visual sweep</li>
<li><strong>FadeOut</strong>: Fade old color to new (200ms) - smooth transition</li>
<li><strong>Spiral</strong>: Center-outward spiral (240ms) - artistic transition</li>
</ul>
<h3 id="optional-mode-indicator-pads"><a class="header" href="#optional-mode-indicator-pads">Optional Mode Indicator Pads</a></h3>
<p>You can dedicate specific pads to always show the current mode:</p>
<pre><code class="language-toml">[led_settings]
mode_indicator_pads = [13, 14, 15, 16]  # Bottom row shows mode
# Pad 13 lights up for Mode 0
# Pad 14 lights up for Mode 1
# Pad 15 lights up for Mode 2
# Pad 16 lights up for Mode 3
</code></pre>
<hr />
<h2 id="feature-f26-led-fade-effects"><a class="header" href="#feature-f26-led-fade-effects">Feature F26: LED Fade Effects</a></h2>
<p>Smooth transitions and fade animations provide polished visual feedback.</p>
<h3 id="fade-out-on-release"><a class="header" href="#fade-out-on-release">Fade-Out on Release</a></h3>
<p>After pressing a pad, the LED fades out gracefully instead of turning off instantly:</p>
<p><strong>Default Behavior:</strong></p>
<ol>
<li>Pad pressed ‚Üí Immediate color change (velocity-based)</li>
<li>Pad released ‚Üí Wait 1 second</li>
<li>Fade begins ‚Üí 200ms smooth fade to mode color or off</li>
</ol>
<p><strong>Timeline:</strong></p>
<pre><code>Press    Release            Fade Start         Complete
  |---------|-------------------|-----------------|
  0ms    Variable            +1000ms          +1200ms
  ‚Üë                              ‚Üë                 ‚Üë
  Full brightness          Start fade         Dark/Mode color
</code></pre>
<h3 id="configurable-fade-parameters"><a class="header" href="#configurable-fade-parameters">Configurable Fade Parameters</a></h3>
<pre><code class="language-toml">[led_settings.fade]
delay_after_release_ms = 1000  # How long to wait before fading
fade_duration_ms = 200         # How long the fade takes
steps = 10                     # Number of discrete fade steps
</code></pre>
<h3 id="fade-applications"><a class="header" href="#fade-applications">Fade Applications</a></h3>
<p><strong>Reactive Scheme:</strong></p>
<pre><code class="language-rust">// Pseudo-code for reactive fade
on_pad_press(pad, velocity) {
    color = velocity_to_color(velocity)
    set_pad_color(pad, color)
    schedule_fade(pad, delay=1000ms, duration=200ms)
}</code></pre>
<p><strong>Mode Transition:</strong></p>
<pre><code class="language-rust">// Pseudo-code for mode transition fade
on_mode_change(old_mode, new_mode) {
    // FadeOut transition effect
    for brightness in (100% down_to 0%).step_by(10%) {
        set_all_pads(old_mode_color * brightness)
        wait(10ms)
    }
    for brightness in (0% up_to 100%).step_by(10%) {
        set_all_pads(new_mode_color * brightness)
        wait(10ms)
    }
}</code></pre>
<hr />
<h2 id="device-support"><a class="header" href="#device-support">Device Support</a></h2>
<h3 id="hid-devices-full-rgb-control"><a class="header" href="#hid-devices-full-rgb-control">HID Devices (Full RGB Control)</a></h3>
<p><strong>Native Instruments Maschine Mikro MK3:</strong></p>
<ul>
<li>‚úÖ All 10 lighting schemes</li>
<li>‚úÖ Full RGB color spectrum (16.7M colors)</li>
<li>‚úÖ Velocity-based colors</li>
<li>‚úÖ Smooth fades and transitions</li>
<li>‚úÖ Shared device mode (works alongside NI Controller Editor)</li>
</ul>
<p><strong>Requirements:</strong></p>
<ul>
<li>macOS: Input Monitoring permission</li>
<li>USB connection: Direct HID communication</li>
<li>Drivers: Native Instruments drivers installed</li>
</ul>
<h3 id="midi-devices-onoff-only"><a class="header" href="#midi-devices-onoff-only">MIDI Devices (On/Off Only)</a></h3>
<p><strong>Supported Controllers:</strong></p>
<ul>
<li>Novation Launchpad Mini/Pro</li>
<li>Akai APC Mini/40</li>
<li>Generic MIDI pad controllers</li>
</ul>
<p><strong>Limitations:</strong></p>
<ul>
<li>‚ùå RGB colors (on/off only)</li>
<li>‚ùå Smooth fades (instant on/off)</li>
<li>‚úÖ Reactive feedback (on when pressed, off after delay)</li>
<li>‚úÖ Mode indicators (basic)</li>
</ul>
<p><strong>Note Range:</strong> MIDI LEDs typically respond to notes C1-D#2 (36-51) for 16 pads</p>
<hr />
<h2 id="configuration-examples-1"><a class="header" href="#configuration-examples-1">Configuration Examples</a></h2>
<h3 id="minimal-configuration"><a class="header" href="#minimal-configuration">Minimal Configuration</a></h3>
<pre><code class="language-toml">[device]
name = "Mikro"
led_feedback = true

[led_settings]
scheme = "reactive"
</code></pre>
<h3 id="advanced-configuration-2"><a class="header" href="#advanced-configuration-2">Advanced Configuration</a></h3>
<pre><code class="language-toml">[device]
name = "Mikro"
led_feedback = true

[led_settings]
scheme = "reactive"
brightness = 255

[led_settings.reactive]
soft_color = { r = 0, g = 255, b = 0 }
medium_color = { r = 255, g = 255, b = 0 }
hard_color = { r = 255, g = 0, b = 0 }
fade_duration_ms = 1000

[led_settings.transitions]
enable_effects = true
flash_duration_ms = 150
sweep_delay_ms = 30
fadeout_steps = 10
spiral_delay_ms = 15

[[modes]]
name = "Default"
color = "blue"
led_idle_brightness = 20
led_active_brightness = 255

[[modes]]
name = "Development"
color = "green"
led_idle_brightness = 30
led_active_brightness = 255
</code></pre>
<hr />
<h2 id="troubleshooting-18"><a class="header" href="#troubleshooting-18">Troubleshooting</a></h2>
<h3 id="leds-not-working-mikro-mk3"><a class="header" href="#leds-not-working-mikro-mk3">LEDs Not Working (Mikro MK3)</a></h3>
<ol>
<li>
<p><strong>Check permissions</strong> (macOS):</p>
<ul>
<li>System Settings ‚Üí Privacy &amp; Security ‚Üí Input Monitoring</li>
<li>Enable permission for Terminal or your IDE</li>
</ul>
</li>
<li>
<p><strong>Verify HID connection</strong>:</p>
<pre><code class="language-bash">DEBUG=1 cargo run --release 2 --led reactive
# Look for "‚úì Connected to Mikro MK3 LED interface"
</code></pre>
</li>
<li>
<p><strong>Check for conflicts</strong>:</p>
<ul>
<li>Close Native Instruments Controller Editor</li>
<li>Unplug and replug USB cable</li>
<li>Try different USB port</li>
</ul>
</li>
</ol>
<h3 id="wrong-colors-2"><a class="header" href="#wrong-colors-2">Wrong Colors</a></h3>
<ul>
<li><strong>Issue</strong>: Colors don't match expected values</li>
<li><strong>Cause</strong>: LED manufacturing variance (¬±10% color accuracy)</li>
<li><strong>Solution</strong>: This is normal, colors may vary slightly between units</li>
</ul>
<h3 id="flickering-leds-1"><a class="header" href="#flickering-leds-1">Flickering LEDs</a></h3>
<ul>
<li><strong>Issue</strong>: LEDs flicker or strobe</li>
<li><strong>Cause</strong>: Update rate too high or USB bandwidth saturation</li>
<li><strong>Solution</strong>: Use simpler scheme (reactive or static) instead of complex animations</li>
</ul>
<h3 id="mode-colors-not-showing-1"><a class="header" href="#mode-colors-not-showing-1">Mode Colors Not Showing</a></h3>
<ul>
<li><strong>Issue</strong>: All pads same color regardless of mode</li>
<li><strong>Cause</strong>: Using non-mode-aware scheme</li>
<li><strong>Solution</strong>: Use <code>static</code> or <code>reactive</code> scheme, not <code>rainbow</code> or <code>sparkle</code></li>
</ul>
<hr />
<h2 id="performance-considerations-1"><a class="header" href="#performance-considerations-1">Performance Considerations</a></h2>
<h3 id="cpu-usage-by-scheme-1"><a class="header" href="#cpu-usage-by-scheme-1">CPU Usage by Scheme</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Scheme</th><th>CPU (Idle)</th><th>CPU (Active)</th><th>Memory</th></tr></thead><tbody>
<tr><td>off</td><td>0%</td><td>0%</td><td>Minimal</td></tr>
<tr><td>static</td><td>&lt;1%</td><td>&lt;1%</td><td>&lt;1MB</td></tr>
<tr><td>reactive</td><td>&lt;1%</td><td>~1%</td><td>&lt;1MB</td></tr>
<tr><td>breathing</td><td>~1%</td><td>~1%</td><td>&lt;1MB</td></tr>
<tr><td>rainbow</td><td>~2%</td><td>~2%</td><td>&lt;1MB</td></tr>
<tr><td>sparkle</td><td>~3%</td><td>~3%</td><td>~1MB</td></tr>
</tbody></table>
</div>
<h3 id="usb-bandwidth"><a class="header" href="#usb-bandwidth">USB Bandwidth</a></h3>
<ul>
<li><strong>Update Rate</strong>: 10fps (100ms per frame)</li>
<li><strong>Data per Update</strong>: 51 bytes (1 byte report ID + 50 bytes RGB data)</li>
<li><strong>Bandwidth</strong>: 510 bytes/sec (~0.004 Mbps)</li>
<li><strong>Impact</strong>: Negligible on USB 2.0 (480 Mbps)</li>
</ul>
<h3 id="recommendations"><a class="header" href="#recommendations">Recommendations</a></h3>
<ul>
<li><strong>Performance Mode</strong>: Use <code>reactive</code> or <code>static</code> for lowest CPU usage</li>
<li><strong>Visual Appeal</strong>: Use <code>rainbow</code> or <code>spiral</code> for presentations/demos</li>
<li><strong>Battery (USB-powered hubs)</strong>: Use <code>off</code> or <code>static</code> to reduce power draw</li>
</ul>
<hr />
<h2 id="api-reference"><a class="header" href="#api-reference">API Reference</a></h2>
<h3 id="trait-interface"><a class="header" href="#trait-interface">Trait Interface</a></h3>
<pre><code class="language-rust">pub trait PadFeedback: Send {
    fn connect(&amp;mut self) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt;;
    fn set_pad_color(&amp;mut self, pad: u8, color: RGB) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt;;
    fn set_pad_velocity(&amp;mut self, pad: u8, velocity: u8) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt;;
    fn set_mode_colors(&amp;mut self, mode: u8) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt;;
    fn show_velocity_feedback(&amp;mut self, pad: u8, velocity: u8) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt;;
    fn flash_pad(&amp;mut self, pad: u8, color: RGB, duration_ms: u64) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt;;
    fn ripple_effect(&amp;mut self, start_pad: u8, color: RGB) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt;;
    fn clear_all(&amp;mut self) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt;;
    fn show_long_press_feedback(&amp;mut self, pad: u8, elapsed_ms: u128) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt;;
    fn run_scheme(&amp;mut self, scheme: &amp;LightingScheme) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt;;
}</code></pre>
<h3 id="rgb-color-structure"><a class="header" href="#rgb-color-structure">RGB Color Structure</a></h3>
<pre><code class="language-rust">pub struct RGB {
    pub r: u8,  // Red: 0-255
    pub g: u8,  // Green: 0-255
    pub b: u8,  // Blue: 0-255
}

impl RGB {
    pub const OFF: RGB = RGB { r: 0, g: 0, b: 0 };
    pub const RED: RGB = RGB { r: 255, g: 0, b: 0 };
    pub const GREEN: RGB = RGB { r: 0, g: 255, b: 0 };
    pub const BLUE: RGB = RGB { r: 0, g: 0, b: 255 };
    pub const YELLOW: RGB = RGB { r: 255, g: 255, b: 0 };
    pub const PURPLE: RGB = RGB { r: 255, g: 0, b: 255 };
}</code></pre>
<hr />
<h2 id="see-also-8"><a class="header" href="#see-also-8">See Also</a></h2>
<ul>
<li><a href="reference/../configuration/led-feedback.html">Configuration ‚Üí LED Feedback</a></li>
<li><a href="reference/../devices/mikro-mk3.html">Device Support ‚Üí Maschine Mikro MK3</a></li>
<li><a href="reference/action-types.html">Reference ‚Üí Action Types</a> (ModeChange action)</li>
<li><a href="reference/../troubleshooting/common-issues.html">Troubleshooting ‚Üí Common Issues</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cli-commands-reference"><a class="header" href="#cli-commands-reference">CLI Commands Reference</a></h1>
<h2 id="overview-14"><a class="header" href="#overview-14">Overview</a></h2>
<p>MIDIMon provides a daemon service, control utility, and several diagnostic tools, all accessible via the command line. This reference covers all available commands, their options, and usage examples.</p>
<p><strong>v1.0.0+</strong> introduces daemon architecture with background service and hot-reload capabilities.</p>
<h2 id="daemon-service-midimon"><a class="header" href="#daemon-service-midimon">Daemon Service: midimon</a></h2>
<p>The primary MIDIMon daemon service (v1.0.0+). Runs as a background process with config hot-reload.</p>
<h3 id="basic-syntax"><a class="header" href="#basic-syntax">Basic Syntax</a></h3>
<pre><code class="language-bash"># Start daemon (via cargo)
cargo run --release --bin midimon [PORT] [OPTIONS]

# Start daemon (release binary)
./target/release/midimon [PORT] [OPTIONS]

# Or use systemd/launchd (see Installation)
systemctl --user start midimon  # Linux
launchctl load ~/Library/LaunchAgents/com.amiable.midimon.plist  # macOS
</code></pre>
<h3 id="daemon-features-v100"><a class="header" href="#daemon-features-v100">Daemon Features (v1.0.0+)</a></h3>
<ul>
<li><strong>Background Service</strong>: Runs continuously in the background</li>
<li><strong>Config Hot-Reload</strong>: Reload configuration without restart (0-8ms latency)</li>
<li><strong>State Persistence</strong>: Saves state on shutdown, restores on startup</li>
<li><strong>IPC Control</strong>: Control via <code>midimonctl</code> utility</li>
<li><strong>Auto-Recovery</strong>: Graceful error handling and device reconnection</li>
</ul>
<h3 id="arguments"><a class="header" href="#arguments">Arguments</a></h3>
<h4 id="port-required-in-some-cases"><a class="header" href="#port-required-in-some-cases">PORT (Required in some cases)</a></h4>
<p>The MIDI input port number to connect to.</p>
<p><strong>Finding available ports</strong>:</p>
<pre><code class="language-bash"># List all MIDI ports
cargo run --release

# Or
./target/release/midimon
</code></pre>
<p>Output:</p>
<pre><code>Available MIDI input ports:
0: USB MIDI Device
1: IAC Driver Bus 1
2: Maschine Mikro MK3 - Input
3: Digital Keyboard
</code></pre>
<p><strong>Usage</strong>:</p>
<pre><code class="language-bash"># Connect to port 2 (Maschine Mikro MK3)
cargo run --release 2

# Connect to port 0
cargo run --release 0
</code></pre>
<p><strong>Note</strong>: If <code>auto_connect = true</code> in <code>config.toml</code>, the port argument is optional and MIDIMon will connect to the first available port.</p>
<h3 id="options"><a class="header" href="#options">Options</a></h3>
<h4 id="--led---lighting"><a class="header" href="#--led---lighting">--led, --lighting <SCHEME></a></h4>
<p>Select LED lighting scheme (for devices with LED support).</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">cargo run --release 2 --led &lt;SCHEME&gt;
# or
cargo run --release 2 --lighting &lt;SCHEME&gt;
</code></pre>
<p><strong>Available schemes</strong>:</p>
<ul>
<li><code>reactive</code> (default) - Velocity-based colors, fade out after release</li>
<li><code>rainbow</code> - Static rainbow gradient</li>
<li><code>breathing</code> - Breathing effect (all pads)</li>
<li><code>pulse</code> - Pulsing effect</li>
<li><code>wave</code> - Wave pattern with brightness gradient</li>
<li><code>sparkle</code> - Random twinkling LEDs</li>
<li><code>vumeter</code> - VU meter style gradient (green ‚Üí yellow ‚Üí red)</li>
<li><code>spiral</code> - Spiral/diagonal pattern</li>
<li><code>static</code> - Static single color</li>
<li><code>off</code> - LEDs disabled</li>
</ul>
<p><strong>Examples</strong>:</p>
<pre><code class="language-bash"># Reactive mode (velocity-sensitive)
cargo run --release 2 --led reactive

# Rainbow gradient
cargo run --release 2 --led rainbow

# Breathing effect
cargo run --release 2 --lighting breathing

# Turn off LEDs
cargo run --release 2 --led off
</code></pre>
<p><strong>LED Behavior by Scheme</strong>:</p>
<p><strong>reactive</strong>:</p>
<ul>
<li>Soft press (velocity &lt; 50): Green Dim</li>
<li>Medium press (50 ‚â§ velocity &lt; 100): Yellow Normal</li>
<li>Hard press (velocity ‚â• 100): Red Bright</li>
<li>Fades out 1 second after release</li>
</ul>
<p><strong>rainbow</strong>:</p>
<ul>
<li>Static rainbow gradient across all pads</li>
<li>No animation (constant colors)</li>
</ul>
<p><strong>sparkle</strong>:</p>
<ul>
<li>Random white LEDs</li>
<li>20% probability per pad per frame</li>
<li>Updates every 100ms</li>
</ul>
<p><strong>vumeter</strong>:</p>
<ul>
<li>Green (bottom rows)</li>
<li>Yellow/Orange (middle)</li>
<li>Red (top)</li>
</ul>
<p><strong>wave</strong>:</p>
<ul>
<li>Blue with varying brightness</li>
<li>Creates wave effect</li>
</ul>
<h4 id="--profile--p"><a class="header" href="#--profile--p">--profile, -p <PATH></a></h4>
<p>Load a Native Instruments Controller Editor profile (.ncmm3 file).</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">cargo run --release 2 --profile &lt;PATH&gt;
# or
cargo run --release 2 -p &lt;PATH&gt;
</code></pre>
<p><strong>Examples</strong>:</p>
<pre><code class="language-bash"># Relative path
cargo run --release 2 --profile my-profile.ncmm3

# Absolute path
cargo run --release 2 --profile ~/Downloads/base-template-ni-mikro-mk3.ncmm3

# macOS default location
cargo run --release 2 --profile "$HOME/Documents/Native Instruments/Controller Editor/Profiles/my-profile.ncmm3"
</code></pre>
<p><strong>What profiles do</strong>:</p>
<ul>
<li>Map physical pad positions to MIDI note numbers</li>
<li>Support 8 pad pages (A-H) per profile</li>
<li>Enable correct LED feedback for custom layouts</li>
<li>Allow seamless integration with NI Controller Editor</li>
</ul>
<p><strong>Creating profiles</strong>:</p>
<ol>
<li>Open Native Instruments Controller Editor</li>
<li>Select "Maschine Mikro MK3"</li>
<li>Edit pad pages (A-H)</li>
<li>Assign MIDI notes to each pad</li>
<li>Save as <code>.ncmm3</code> file</li>
<li>Use with <code>--profile</code> flag</li>
</ol>
<p>See <a href="reference/../DEVICE_PROFILES.html">Device Profiles Documentation</a> for complete guide.</p>
<h4 id="--pad-page"><a class="header" href="#--pad-page">--pad-page <PAGE></a></h4>
<p>Force a specific pad page when using a profile (instead of auto-detection).</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">cargo run --release 2 --profile &lt;PATH&gt; --pad-page &lt;PAGE&gt;
</code></pre>
<p><strong>Valid pages</strong>: A, B, C, D, E, F, G, H (case-insensitive)</p>
<p><strong>Examples</strong>:</p>
<pre><code class="language-bash"># Force page A
cargo run --release 2 --profile my-profile.ncmm3 --pad-page A

# Force page H
cargo run --release 2 --profile my-profile.ncmm3 --pad-page h
</code></pre>
<p><strong>When to use</strong>:</p>
<ul>
<li>Auto-detection not working correctly</li>
<li>Want to lock to a specific page</li>
<li>Testing specific page mappings</li>
<li>Profile has identical notes across multiple pages</li>
</ul>
<p><strong>Default behavior</strong> (without <code>--pad-page</code>):</p>
<ul>
<li>Auto-detect active page from incoming MIDI notes</li>
<li>Switch pages automatically when notes from different page detected</li>
</ul>
<h4 id="--config--c"><a class="header" href="#--config--c">--config, -c <PATH></a></h4>
<p>Specify custom configuration file location.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">cargo run --release 2 --config &lt;PATH&gt;
# or
cargo run --release 2 -c &lt;PATH&gt;
</code></pre>
<p><strong>Examples</strong>:</p>
<pre><code class="language-bash"># Use alternative config
cargo run --release 2 --config config-dev.toml

# Full path
cargo run --release 2 --config /etc/midimon/config.toml
</code></pre>
<p><strong>Default</strong>: <code>./config.toml</code> (current directory)</p>
<h4 id="--help--h"><a class="header" href="#--help--h">--help, -h</a></h4>
<p>Display help message with all available options.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">cargo run --release -- --help
# or
./target/release/midimon --help
</code></pre>
<p>Note the <code>--</code> separator when using <code>cargo run</code>.</p>
<h4 id="--version--v"><a class="header" href="#--version--v">--version, -v</a></h4>
<p>Display MIDIMon version.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">cargo run --release -- --version
# or
./target/release/midimon --version
</code></pre>
<h3 id="environment-variables"><a class="header" href="#environment-variables">Environment Variables</a></h3>
<h4 id="debug1"><a class="header" href="#debug1">DEBUG=1</a></h4>
<p>Enable verbose debug logging.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">DEBUG=1 cargo run --release 2
</code></pre>
<p><strong>Output includes</strong>:</p>
<ul>
<li>MIDI event details (note on/off, velocity, channel)</li>
<li>HID connection status</li>
<li>LED updates (buffer contents)</li>
<li>Event processing (velocity detection, long press, chords)</li>
<li>Mapping matches and action execution</li>
<li>Mode changes</li>
<li>Error details</li>
</ul>
<p><strong>Example debug output</strong>:</p>
<pre><code>[DEBUG] Connected to MIDI port 2: Maschine Mikro MK3 - Input
[DEBUG] HID device opened successfully
[DEBUG] LED controller initialized
[DEBUG] Loaded config with 3 modes, 24 mappings
[DEBUG] Starting in mode 0: Default

[MIDI] NoteOn ch:0 note:12 vel:87
[DEBUG] Processed: Note(12) with velocity Medium
[DEBUG] Matched mapping: "Copy text" (mode: Default)
[DEBUG] Executing action: Keystroke(keys: "c", modifiers: ["cmd"])
[DEBUG] LED update: pad 0 -&gt; color 7 (Green) brightness 2
[MIDI] NoteOff ch:0 note:12 vel:0
[DEBUG] LED fade: pad 0 cleared after 1000ms
</code></pre>
<p><strong>When to use</strong>:</p>
<ul>
<li>Troubleshooting mapping issues</li>
<li>Debugging note number mismatches</li>
<li>Verifying LED control</li>
<li>Understanding event processing</li>
<li>Investigating performance issues</li>
</ul>
<h4 id="rust_log"><a class="header" href="#rust_log">RUST_LOG</a></h4>
<p>Control Rust logging levels (for development).</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">RUST_LOG=debug cargo run --release 2
RUST_LOG=trace cargo run --release 2
RUST_LOG=info cargo run --release 2
</code></pre>
<p><strong>Levels</strong>:</p>
<ul>
<li><code>error</code> - Only errors</li>
<li><code>warn</code> - Warnings and errors</li>
<li><code>info</code> - General information (default)</li>
<li><code>debug</code> - Debug information</li>
<li><code>trace</code> - Very verbose</li>
</ul>
<p><strong>Filter by module</strong>:</p>
<pre><code class="language-bash"># Only log MIDI events
RUST_LOG=midimon::midi=debug cargo run --release 2

# Multiple modules
RUST_LOG=midimon::event_processor=debug,midimon::mappings=trace cargo run --release 2
</code></pre>
<h3 id="complete-usage-examples"><a class="header" href="#complete-usage-examples">Complete Usage Examples</a></h3>
<h4 id="example-1-basic-usage"><a class="header" href="#example-1-basic-usage">Example 1: Basic Usage</a></h4>
<pre><code class="language-bash"># List ports
cargo run --release

# Connect to port 2 with default settings
cargo run --release 2
</code></pre>
<h4 id="example-2-with-led-lighting"><a class="header" href="#example-2-with-led-lighting">Example 2: With LED Lighting</a></h4>
<pre><code class="language-bash"># Reactive mode (default)
cargo run --release 2 --led reactive

# Rainbow gradient
cargo run --release 2 --led rainbow

# Sparkle effect
cargo run --release 2 --led sparkle
</code></pre>
<h4 id="example-3-with-profile"><a class="header" href="#example-3-with-profile">Example 3: With Profile</a></h4>
<pre><code class="language-bash"># Auto-detect page
cargo run --release 2 --profile my-profile.ncmm3

# Force specific page
cargo run --release 2 --profile my-profile.ncmm3 --pad-page H

# With LED scheme
cargo run --release 2 --profile my-profile.ncmm3 --led reactive
</code></pre>
<h4 id="example-4-debug-mode"><a class="header" href="#example-4-debug-mode">Example 4: Debug Mode</a></h4>
<pre><code class="language-bash"># Enable debug output
DEBUG=1 cargo run --release 2

# With all options
DEBUG=1 cargo run --release 2 --profile my-profile.ncmm3 --led reactive
</code></pre>
<h4 id="example-5-custom-config"><a class="header" href="#example-5-custom-config">Example 5: Custom Config</a></h4>
<pre><code class="language-bash"># Use development config
cargo run --release 2 --config config-dev.toml

# Use config from different directory
cargo run --release 2 --config ~/midimon-configs/work.toml
</code></pre>
<h4 id="example-6-production-binary"><a class="header" href="#example-6-production-binary">Example 6: Production Binary</a></h4>
<pre><code class="language-bash"># Build release
cargo build --release

# Run with all options
./target/release/midimon 2 \
    --profile ~/Documents/NI/my-profile.ncmm3 \
    --led reactive \
    --config ~/midimon-configs/production.toml
</code></pre>
<h2 id="daemon-control-midimonctl"><a class="header" href="#daemon-control-midimonctl">Daemon Control: midimonctl</a></h2>
<p><strong>New in v1.0.0</strong> - Control and monitor the MIDIMon daemon service.</p>
<h3 id="basic-syntax-1"><a class="header" href="#basic-syntax-1">Basic Syntax</a></h3>
<pre><code class="language-bash"># Via cargo
cargo run --release --bin midimonctl &lt;COMMAND&gt; [OPTIONS]

# Release binary
./target/release/midimonctl &lt;COMMAND&gt; [OPTIONS]
</code></pre>
<h3 id="commands"><a class="header" href="#commands">Commands</a></h3>
<h4 id="status-1"><a class="header" href="#status-1">status</a></h4>
<p>Display daemon status, device info, and performance metrics.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">midimonctl status [--json]
</code></pre>
<p><strong>Output</strong> (human-readable):</p>
<pre><code>MIDIMon Daemon Status
=====================

Lifecycle State: Running
Uptime: 2h 34m 17s

Device
------
Connected: Yes
Name: Maschine Mikro MK3 - Input
Port: 2
Last Event: 3s ago

Configuration
------------
Modes: 3 (Default, Development, Media)
Global Mappings: 12
Mode Mappings: 24 (8 per mode)
Config File: /Users/you/.config/midimon/config.toml
Last Reload: 15m ago

Performance Metrics
------------------
Config Reloads: 7
Average Reload Time: 3ms
Last Reload Time: 2ms
Performance Grade: Excellent

IPC Latency: &lt;1ms
</code></pre>
<p><strong>JSON Output</strong> (<code>--json</code>):</p>
<pre><code class="language-bash">midimonctl status --json
</code></pre>
<pre><code class="language-json">{
  "success": true,
  "data": {
    "lifecycle_state": "Running",
    "uptime_secs": 9257,
    "device": {
      "connected": true,
      "name": "Maschine Mikro MK3 - Input",
      "port": 2,
      "last_event_at": 1699900000
    },
    "config": {
      "modes": 3,
      "global_mappings": 12,
      "mode_mappings": 24
    },
    "performance": {
      "reload_count": 7,
      "avg_reload_ms": 3,
      "last_reload_ms": 2,
      "grade": "Excellent"
    }
  }
}
</code></pre>
<h4 id="reload"><a class="header" href="#reload">reload</a></h4>
<p>Trigger configuration hot-reload without restarting the daemon.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">midimonctl reload [--json]
</code></pre>
<p><strong>Features</strong>:</p>
<ul>
<li><strong>Zero Downtime</strong>: No interruption to MIDI processing</li>
<li><strong>Fast</strong>: 0-8ms reload latency (typically &lt;3ms)</li>
<li><strong>Atomic</strong>: All-or-nothing config swap</li>
<li><strong>Validated</strong>: Config checked before reload</li>
</ul>
<p><strong>Output</strong>:</p>
<pre><code>‚úì Configuration reloaded successfully

Reload completed in 2ms
Modes: 3 (Default, Development, Media)
Global mappings: 12
Mode mappings: 24
</code></pre>
<p><strong>When to use</strong>:</p>
<ul>
<li>After editing <code>config.toml</code></li>
<li>Testing new mappings</li>
<li>Switching between config profiles</li>
<li>Live development workflow</li>
</ul>
<p><strong>Example workflow</strong>:</p>
<pre><code class="language-bash"># 1. Edit config
vim ~/.config/midimon/config.toml

# 2. Reload daemon
midimonctl reload

# 3. Test changes immediately (no restart needed!)
</code></pre>
<h4 id="validate"><a class="header" href="#validate">validate</a></h4>
<p>Validate configuration file syntax without reloading.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">midimonctl validate [--json]
</code></pre>
<p><strong>Output</strong> (valid config):</p>
<pre><code>‚úì Configuration is valid

Modes: 3
Global mappings: 12
Total mappings: 36
</code></pre>
<p><strong>Output</strong> (invalid config):</p>
<pre><code>‚úó Configuration validation failed

Error: Invalid trigger type 'NoteTap' at line 42
Expected one of: Note, VelocityRange, LongPress, DoubleTap,
                 NoteChord, EncoderTurn, Aftertouch, PitchBend, CC

Suggestion: Did you mean 'DoubleTap'?
</code></pre>
<p><strong>When to use</strong>:</p>
<ul>
<li>Before committing config changes</li>
<li>CI/CD validation</li>
<li>Debugging config syntax errors</li>
<li>Pre-flight checks</li>
</ul>
<h4 id="ping"><a class="header" href="#ping">ping</a></h4>
<p>Health check with latency measurement.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">midimonctl ping [--json]
</code></pre>
<p><strong>Output</strong>:</p>
<pre><code>‚úì Daemon is responsive
Latency: 0.4ms
</code></pre>
<p><strong>When to use</strong>:</p>
<ul>
<li>Verify daemon is running</li>
<li>Check IPC communication</li>
<li>Monitor system responsiveness</li>
<li>Health checks in scripts</li>
</ul>
<h4 id="shutdown"><a class="header" href="#shutdown">shutdown</a></h4>
<p>Gracefully shut down the <strong>running daemon process</strong> via IPC.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">midimonctl shutdown [--json]
</code></pre>
<p><strong>Output</strong>:</p>
<pre><code>‚úì Daemon stopped successfully

Uptime: 2h 34m 17s
State saved successfully
</code></pre>
<p><strong>What it does</strong>:</p>
<ul>
<li>Sends IPC <code>Stop</code> command to running daemon</li>
<li>Daemon saves state and exits gracefully</li>
<li>Closes MIDI/HID connections cleanly</li>
<li>Persists device state to disk</li>
</ul>
<p><strong>When to use</strong>:</p>
<ul>
<li><strong>Daemon is running</strong> and you want to stop it</li>
<li>Quick shutdown during development</li>
<li>When you know daemon is responsive</li>
</ul>
<p><strong>Requirements</strong>:</p>
<ul>
<li>Daemon must be running</li>
<li>IPC socket must be accessible</li>
<li>No LaunchAgent/systemd interaction</li>
</ul>
<h4 id="stop"><a class="header" href="#stop">stop</a></h4>
<p>Stop the <strong>LaunchAgent/systemd service</strong> (tries graceful shutdown first).</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">midimonctl stop [--json] [--force]
</code></pre>
<p><strong>Output</strong>:</p>
<pre><code>Stopping MIDIMon service...
  Attempting graceful shutdown via IPC...
‚úì Service stopped successfully
</code></pre>
<p><strong>What it does</strong>:</p>
<ol>
<li><strong>First</strong>: Attempts graceful IPC shutdown (same as <code>shutdown</code> command)</li>
<li><strong>Waits</strong>: 500ms for daemon to exit</li>
<li><strong>Then</strong>: Unloads LaunchAgent (macOS) or stops systemd service (Linux)</li>
</ol>
<p><strong>When to use</strong>:</p>
<ul>
<li><strong>Service is installed</strong> via <code>midimonctl install</code></li>
<li>Need to stop the background service</li>
<li>Daemon may or may not be responsive</li>
<li>Want to ensure service is fully stopped</li>
</ul>
<p><strong>Requirements</strong>:</p>
<ul>
<li>Service must be installed (via <code>midimonctl install</code>)</li>
<li>macOS: LaunchAgent plist exists</li>
<li>Linux: systemd unit exists</li>
</ul>
<p><strong>Options</strong>:</p>
<ul>
<li><code>--force</code>: Skip graceful shutdown, immediately unload service</li>
</ul>
<h3 id="choosing-between-shutdown-and-stop"><a class="header" href="#choosing-between-shutdown-and-stop">Choosing Between shutdown and stop</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Scenario</th><th>Use Command</th><th>Why</th></tr></thead><tbody>
<tr><td>Daemon running in foreground</td><td><code>shutdown</code></td><td>Faster, direct IPC</td></tr>
<tr><td>Daemon started manually (not service)</td><td><code>shutdown</code></td><td>No service to unload</td></tr>
<tr><td>Service installed and running</td><td><code>stop</code></td><td>Ensures service unloaded</td></tr>
<tr><td>Daemon not responding</td><td><code>stop --force</code></td><td>Bypasses IPC, forces unload</td></tr>
<tr><td>Development workflow</td><td><code>shutdown</code></td><td>Quick restarts</td></tr>
<tr><td>Production/installed service</td><td><code>stop</code></td><td>Proper service management</td></tr>
</tbody></table>
</div>
<p><strong>Decision tree</strong>:</p>
<pre><code>Is daemon installed as a service?
‚îú‚îÄ No ‚Üí Use `shutdown`
‚îî‚îÄ Yes
   ‚îú‚îÄ Is daemon responsive?
   ‚îÇ  ‚îú‚îÄ Yes ‚Üí Use `stop` (graceful)
   ‚îÇ  ‚îî‚îÄ No ‚Üí Use `stop --force`
   ‚îî‚îÄ Running in foreground for testing? ‚Üí Use `shutdown`
</code></pre>
<h3 id="device-management-commands"><a class="header" href="#device-management-commands">Device Management Commands</a></h3>
<h4 id="list-devices"><a class="header" href="#list-devices">list-devices</a></h4>
<p>List all available MIDI input devices.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">midimonctl list-devices [--json]
</code></pre>
<p><strong>Output</strong>:</p>
<pre><code>Available MIDI Devices
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  [0] USB MIDI Device
  [1] IAC Driver Bus 1 (connected)
  [2] Maschine Mikro MK3 - Input
</code></pre>
<p><strong>When to use</strong>:</p>
<ul>
<li>Find available MIDI ports</li>
<li>Check which device is currently connected</li>
<li>Troubleshoot device connectivity</li>
</ul>
<h4 id="set-device"><a class="header" href="#set-device">set-device</a></h4>
<p>Switch the daemon to a different MIDI device without restart.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">midimonctl set-device &lt;PORT&gt; [--json]
</code></pre>
<p><strong>Example</strong>:</p>
<pre><code class="language-bash"># Switch to port 2
midimonctl set-device 2
</code></pre>
<p><strong>Output</strong>:</p>
<pre><code>‚úì Switched to device at port 2
</code></pre>
<p><strong>When to use</strong>:</p>
<ul>
<li>Switch between MIDI devices on the fly</li>
<li>Test different controllers</li>
<li>Recover from device disconnection</li>
</ul>
<h4 id="get-device"><a class="header" href="#get-device">get-device</a></h4>
<p>Show information about the currently connected MIDI device.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">midimonctl get-device [--json]
</code></pre>
<p><strong>Output</strong>:</p>
<pre><code>Current MIDI Device
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Status:     Connected
Name:       Maschine Mikro MK3 - Input
Port:       2
Last Event: 3s ago
</code></pre>
<p><strong>When to use</strong>:</p>
<ul>
<li>Verify which device is active</li>
<li>Check connection status</li>
<li>Debug event reception issues</li>
</ul>
<h3 id="service-management-commands"><a class="header" href="#service-management-commands">Service Management Commands</a></h3>
<p><strong>Note</strong>: Service management commands are currently macOS-only (using LaunchAgent).</p>
<h4 id="understanding-launchagent-behavior"><a class="header" href="#understanding-launchagent-behavior">Understanding LaunchAgent Behavior</a></h4>
<p>The MIDIMon LaunchAgent plist has <code>RunAtLoad=true</code>, which affects command behavior:</p>
<p><strong>Key insight</strong>: <code>launchctl load</code> = load plist + start daemon immediately</p>
<div class="table-wrapper"><table><thead><tr><th>Command</th><th>launchctl operation</th><th>Starts daemon?</th><th>Auto-start on login?</th></tr></thead><tbody>
<tr><td><code>install</code></td><td><code>load</code></td><td>‚úì Yes</td><td>‚úó No</td></tr>
<tr><td><code>start</code></td><td><code>load</code></td><td>‚úì Yes</td><td>‚úó No</td></tr>
<tr><td><code>enable</code></td><td><code>load -w</code></td><td>‚úì Yes</td><td>‚úì Yes</td></tr>
<tr><td><code>stop</code></td><td><code>unload</code></td><td>‚úó Stops</td><td>‚úó No</td></tr>
<tr><td><code>disable</code></td><td><code>unload -w</code></td><td>‚úó Stops</td><td>‚úó No</td></tr>
</tbody></table>
</div>
<p><strong>Common patterns</strong>:</p>
<ul>
<li><strong>Quick setup</strong>: <code>install</code> ‚Üí daemon runs but won't auto-start on reboot</li>
<li><strong>Production setup</strong>: <code>install</code> then <code>enable</code> ‚Üí daemon runs now AND on every login</li>
<li><strong>One-step production</strong>: <code>enable</code> (if already installed) ‚Üí starts + enables auto-start</li>
<li><strong>Temporary disable</strong>: <code>stop</code> ‚Üí stops now but will auto-start on next login (if enabled)</li>
<li><strong>Complete disable</strong>: <code>disable</code> ‚Üí stops now AND prevents auto-start</li>
</ul>
<h4 id="install"><a class="header" href="#install">install</a></h4>
<p>Install MIDIMon as a LaunchAgent service that starts automatically on login.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">midimonctl install [--install-binary] [--force] [--json]
</code></pre>
<p><strong>Options</strong>:</p>
<ul>
<li><code>--install-binary</code>: Copy daemon binary to <code>/usr/local/bin/midimon</code></li>
<li><code>--force</code>: Reinstall even if already installed</li>
</ul>
<p><strong>What it does</strong>:</p>
<ol>
<li>Generates LaunchAgent plist from template</li>
<li>Copies plist to <code>~/Library/LaunchAgents/com.amiable.midimon.plist</code></li>
<li>Optionally installs binary to <code>/usr/local/bin</code> (requires sudo)</li>
<li>Loads service with <code>launchctl</code></li>
</ol>
<p><strong>Output</strong>:</p>
<pre><code>Installing MIDIMon service...
  ‚úì Generated plist
  ‚úì Installed to ~/Library/LaunchAgents/com.amiable.midimon.plist
  ‚úì Loaded service

‚úì MIDIMon service installed successfully

Next steps:
  ‚Ä¢ Start: midimonctl start
  ‚Ä¢ Enable auto-start: midimonctl enable
  ‚Ä¢ Check status: midimonctl service-status
</code></pre>
<p><strong>When to use</strong>:</p>
<ul>
<li>First-time setup for background service</li>
<li>Setting up production deployment</li>
<li>Enable auto-start on login</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-bash"># Basic install (daemon must already be built)
midimonctl install

# Install and copy binary to system location
sudo midimonctl install --install-binary

# Force reinstall
midimonctl install --force
</code></pre>
<h4 id="uninstall"><a class="header" href="#uninstall">uninstall</a></h4>
<p>Remove MIDIMon service from LaunchAgent.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">midimonctl uninstall [--remove-binary] [--remove-logs] [--json]
</code></pre>
<p><strong>Options</strong>:</p>
<ul>
<li><code>--remove-binary</code>: Also delete <code>/usr/local/bin/midimon</code></li>
<li><code>--remove-logs</code>: Delete log files</li>
</ul>
<p><strong>What it does</strong>:</p>
<ol>
<li>Stops service if running</li>
<li>Removes LaunchAgent plist</li>
<li>Optionally removes binary and logs</li>
</ol>
<p><strong>Output</strong>:</p>
<pre><code>Uninstalling MIDIMon service...
  ‚úì Stopped service
  ‚úì Removed plist: ~/Library/LaunchAgents/com.amiable.midimon.plist

‚úì MIDIMon service uninstalled successfully
</code></pre>
<p><strong>When to use</strong>:</p>
<ul>
<li>Removing MIDIMon completely</li>
<li>Clean uninstall before upgrade</li>
<li>Troubleshooting installation issues</li>
</ul>
<h4 id="start"><a class="header" href="#start">start</a></h4>
<p>Start the LaunchAgent service.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">midimonctl start [--wait &lt;SECONDS&gt;] [--json]
</code></pre>
<p><strong>Options</strong>:</p>
<ul>
<li><code>--wait &lt;SECONDS&gt;</code>: Wait up to N seconds for daemon to be ready (default: 5)</li>
</ul>
<p><strong>What it does</strong>:</p>
<ol>
<li>Loads service with <code>launchctl load</code></li>
<li>Waits for daemon to respond to IPC</li>
<li>Verifies daemon is running</li>
</ol>
<p><strong>Output</strong>:</p>
<pre><code>Starting MIDIMon service...
Waiting for daemon to be ready... ‚úì
‚úì Service started successfully
</code></pre>
<p><strong>When to use</strong>:</p>
<ul>
<li>Start service after install</li>
<li>Start service after stop</li>
<li>Verify service starts correctly</li>
</ul>
<p><strong>Example</strong>:</p>
<pre><code class="language-bash"># Start and wait up to 10 seconds
midimonctl start --wait 10
</code></pre>
<h4 id="restart"><a class="header" href="#restart">restart</a></h4>
<p>Restart the LaunchAgent service (stop + start).</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">midimonctl restart [--wait &lt;SECONDS&gt;] [--json]
</code></pre>
<p><strong>What it does</strong>:</p>
<ol>
<li>Gracefully stops service</li>
<li>Waits 500ms</li>
<li>Starts service</li>
<li>Waits for daemon to be ready</li>
</ol>
<p><strong>Output</strong>:</p>
<pre><code>Restarting MIDIMon service...
Stopping MIDIMon service...
‚úì Service stopped successfully
Starting MIDIMon service...
‚úì Service started successfully
</code></pre>
<p><strong>When to use</strong>:</p>
<ul>
<li>Apply config changes that need full restart</li>
<li>Recover from errors</li>
<li>Test service lifecycle</li>
</ul>
<h4 id="enable"><a class="header" href="#enable">enable</a></h4>
<p>Enable auto-start on login AND start the daemon immediately.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">midimonctl enable [--json]
</code></pre>
<p><strong>What it does</strong>:</p>
<ol>
<li><strong>Loads service</strong> with <code>launchctl load -w</code> flag</li>
<li><strong>Starts daemon immediately</strong> (because plist has <code>RunAtLoad=true</code>)</li>
<li><strong>Enables auto-start</strong> on next login (persists across reboots)</li>
</ol>
<p><strong>Output</strong>:</p>
<pre><code>‚úì Service enabled (will start on login)
</code></pre>
<p><strong>Note</strong>: This is equivalent to <code>start</code> + making it persistent across reboots.</p>
<p><strong>When to use</strong>:</p>
<ul>
<li><strong>One-step setup</strong>: Enable and start in single command</li>
<li>Production deployment (start now + auto-start on reboot)</li>
<li>After <code>disable</code> to re-enable everything</li>
</ul>
<p><strong>Alternative</strong>: If you only want to enable auto-start WITHOUT starting now, use <code>start</code> to load the service first, then the <code>-w</code> flag will be set.</p>
<h4 id="disable"><a class="header" href="#disable">disable</a></h4>
<p>Disable auto-start on login AND stop the daemon immediately.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">midimonctl disable [--json]
</code></pre>
<p><strong>What it does</strong>:</p>
<ol>
<li><strong>Unloads service</strong> with <code>launchctl unload -w</code> flag</li>
<li><strong>Stops daemon immediately</strong></li>
<li><strong>Disables auto-start</strong> on next login</li>
</ol>
<p><strong>Output</strong>:</p>
<pre><code>‚úì Service disabled (will not start on login)
</code></pre>
<p><strong>Note</strong>: This is equivalent to <code>stop</code> + preventing auto-start on reboot.</p>
<p><strong>When to use</strong>:</p>
<ul>
<li><strong>Complete shutdown</strong>: Stop now + prevent auto-start</li>
<li>Temporarily disable background service</li>
<li>Development workflow</li>
<li>Before uninstall</li>
</ul>
<h4 id="service-status"><a class="header" href="#service-status">service-status</a></h4>
<p>Show detailed service installation and runtime status.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">midimonctl service-status [--json]
</code></pre>
<p><strong>Output</strong>:</p>
<pre><code>MIDIMon Service Status
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Status:          Installed and Loaded
Service Label:   com.amiable.midimon
Plist:           ~/Library/LaunchAgents/com.amiable.midimon.plist ‚úì
Binary:          /usr/local/bin/midimon ‚úì

Service is loaded (enabled)
</code></pre>
<p><strong>When to use</strong>:</p>
<ul>
<li>Verify service is installed correctly</li>
<li>Check if auto-start is enabled</li>
<li>Troubleshoot service issues</li>
<li>Audit service configuration</li>
</ul>
<h3 id="global-options"><a class="header" href="#global-options">Global Options</a></h3>
<h4 id="--json"><a class="header" href="#--json">--json</a></h4>
<p>Output in JSON format (for scripting/automation).</p>
<p><strong>Available for</strong>: All commands</p>
<p><strong>Example</strong>:</p>
<pre><code class="language-bash"># Parse with jq
midimonctl status --json | jq '.data.device.connected'
# Output: true

# Check if reload succeeded
if midimonctl reload --json | jq -e '.success'; then
    echo "Reload successful"
fi
</code></pre>
<h3 id="usage-examples"><a class="header" href="#usage-examples">Usage Examples</a></h3>
<h4 id="example-1-first-time-service-setup-production"><a class="header" href="#example-1-first-time-service-setup-production">Example 1: First-Time Service Setup (Production)</a></h4>
<pre><code class="language-bash"># Build daemon
cargo build --release --bin midimon

# Install as LaunchAgent service (starts immediately)
midimonctl install

# Verify running
midimonctl status

# Enable auto-start on login (also starts if not running)
# Since install already started it, this just enables persistence
midimonctl enable

# Check service details
midimonctl service-status
</code></pre>
<p><strong>Alternative (simpler)</strong>:</p>
<pre><code class="language-bash"># Build daemon
cargo build --release --bin midimon

# One-step: Install service
midimonctl install

# One-step: Enable auto-start (if you want persistence across reboots)
midimonctl enable
</code></pre>
<p><strong>Simplest production setup</strong>:</p>
<pre><code class="language-bash">cargo build --release --bin midimon
midimonctl install --install-binary  # Copies to /usr/local/bin
midimonctl enable                     # Starts + enables auto-start
</code></pre>
<h4 id="example-2-development-workflow"><a class="header" href="#example-2-development-workflow">Example 2: Development Workflow</a></h4>
<pre><code class="language-bash"># Start daemon in foreground for testing
cargo run --release --bin midimon 2 --foreground

# In another terminal...

# Check status
midimonctl status

# Edit config
vim config.toml

# Hot-reload changes (zero downtime!)
midimonctl reload

# Test changes immediately

# Switch to different MIDI device
midimonctl list-devices
midimonctl set-device 1

# Stop when done
midimonctl shutdown
</code></pre>
<h4 id="example-3-service-management-workflow"><a class="header" href="#example-3-service-management-workflow">Example 3: Service Management Workflow</a></h4>
<pre><code class="language-bash"># Check if service is installed
midimonctl service-status

# Start service if not running
midimonctl start

# Check which MIDI device is active
midimonctl get-device

# Switch to different device without restart
midimonctl set-device 2

# Restart service (apply changes that need full restart)
midimonctl restart

# Disable auto-start temporarily
midimonctl disable

# Stop service
midimonctl stop
</code></pre>
<h4 id="example-4-production-monitoring"><a class="header" href="#example-4-production-monitoring">Example 4: Production Monitoring</a></h4>
<pre><code class="language-bash">#!/bin/bash
# monitor.sh - Health check script

# Check daemon health
if ! midimonctl ping --json | jq -e '.success'; then
    echo "Daemon not responding, restarting..."
    midimonctl restart
fi

# Get performance metrics
RELOAD_MS=$(midimonctl status --json | jq '.data.reload_stats.avg_reload_ms')
if [ "$RELOAD_MS" -gt 50 ]; then
    echo "Warning: Average reload time ${RELOAD_MS}ms (expected &lt;50ms)"
fi

# Check MIDI device connectivity
CONNECTED=$(midimonctl get-device --json | jq '.data.device.connected')
if [ "$CONNECTED" != "true" ]; then
    echo "MIDI device disconnected!"
    # Try to reconnect
    midimonctl list-devices
fi
</code></pre>
<h4 id="example-5-configuration-management"><a class="header" href="#example-5-configuration-management">Example 5: Configuration Management</a></h4>
<pre><code class="language-bash"># Validate before deploy
if ! midimonctl validate --json | jq -e '.success'; then
    echo "Config validation failed"
    exit 1
fi

# Backup current config
cp ~/.config/midimon/config.toml ~/.config/midimon/config.toml.backup

# Deploy new config
cp config-v2.toml ~/.config/midimon/config.toml

# Apply changes (hot reload)
midimonctl reload

# Verify successful reload
midimonctl status

# If issues, rollback
# cp ~/.config/midimon/config.toml.backup ~/.config/midimon/config.toml
# midimonctl reload
</code></pre>
<h4 id="example-6-automated-testing"><a class="header" href="#example-6-automated-testing">Example 6: Automated Testing</a></h4>
<pre><code class="language-bash">#!/bin/bash
# test-config.sh

# Validate syntax
if ! midimonctl validate --json | jq -e '.data.valid'; then
    echo "Config validation failed"
    exit 1
fi

# Reload daemon
if ! midimonctl reload --json | jq -e '.success'; then
    echo "Reload failed"
    exit 1
fi

# Check reload performance
LATENCY=$(midimonctl status --json | jq '.data.reload_stats.last_reload_ms')
if [ "$LATENCY" -gt 10 ]; then
    echo "Warning: Reload took ${LATENCY}ms (expected &lt;10ms)"
fi

# Verify device connection
CONNECTED=$(midimonctl get-device --json | jq '.data.device.connected')
if [ "$CONNECTED" != "true" ]; then
    echo "Error: MIDI device not connected"
    exit 1
fi

echo "‚úì All checks passed"
</code></pre>
<h4 id="example-7-complete-uninstall"><a class="header" href="#example-7-complete-uninstall">Example 7: Complete Uninstall</a></h4>
<pre><code class="language-bash"># Stop service
midimonctl stop

# Disable auto-start
midimonctl disable

# Uninstall service (with cleanup)
midimonctl uninstall --remove-binary --remove-logs

# Verify removal
midimonctl service-status
</code></pre>
<h2 id="diagnostic-tools"><a class="header" href="#diagnostic-tools">Diagnostic Tools</a></h2>
<p>MIDIMon includes several diagnostic utilities for debugging and configuration.</p>
<h3 id="midi_diagnostic"><a class="header" href="#midi_diagnostic">midi_diagnostic</a></h3>
<p>Visualize all incoming MIDI events in real-time.</p>
<p><strong>Purpose</strong>: Debug MIDI connectivity, view raw MIDI data, verify device is sending events.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">cargo run --bin midi_diagnostic [PORT]
</code></pre>
<p><strong>Example</strong>:</p>
<pre><code class="language-bash"># Connect to port 2
cargo run --bin midi_diagnostic 2
</code></pre>
<p><strong>Output</strong>:</p>
<pre><code>Connected to MIDI port 2: Maschine Mikro MK3 - Input
Listening for MIDI events... (Ctrl+C to exit)

[NoteOn]  ch:0 note:12 vel:87
[NoteOff] ch:0 note:12 vel:0
[NoteOn]  ch:0 note:13 vel:45
[NoteOff] ch:0 note:13 vel:0
[CC]      ch:0 cc:1 value:64
[PitchBend] ch:0 value:8192
</code></pre>
<p><strong>Event types shown</strong>:</p>
<ul>
<li><code>NoteOn</code> - Pad/key pressed</li>
<li><code>NoteOff</code> - Pad/key released</li>
<li><code>CC</code> - Control Change (knobs, sliders)</li>
<li><code>PitchBend</code> - Touch strip, pitch wheel</li>
<li><code>Aftertouch</code> - Pressure sensitivity</li>
<li><code>ProgramChange</code> - Program/patch change</li>
</ul>
<p><strong>When to use</strong>:</p>
<ul>
<li>Verify MIDI device is connected</li>
<li>Find note numbers for pads/keys</li>
<li>Debug why mappings aren't triggering</li>
<li>Check velocity ranges</li>
<li>Verify CC numbers for encoders/knobs</li>
</ul>
<p><strong>Press Ctrl+C to exit.</strong></p>
<h3 id="led_diagnostic"><a class="header" href="#led_diagnostic">led_diagnostic</a></h3>
<p>Test LED functionality and HID connection.</p>
<p><strong>Purpose</strong>: Verify HID access, test LED control, debug LED issues.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">cargo run --bin led_diagnostic
</code></pre>
<p><strong>What it does</strong>:</p>
<ol>
<li>Attempts to open HID device</li>
<li>Displays connection status</li>
<li>Tests individual LED control</li>
<li>Cycles through all pads with different colors</li>
</ol>
<p><strong>Output</strong>:</p>
<pre><code>LED Diagnostic Tool
==================

Searching for Maschine Mikro MK3...
‚úì Device found: Maschine Mikro MK3 (17cc:1600)
‚úì HID device opened successfully

Testing LED control...
- Lighting pad 0 (Red Bright)
- Lighting pad 1 (Green Bright)
- Lighting pad 2 (Blue Bright)
...
- Clearing all pads

‚úì LED diagnostic complete
</code></pre>
<p><strong>Error output</strong> (if HID not accessible):</p>
<pre><code>‚úó Failed to open HID device
  Possible causes:
  - Device not connected
  - Input Monitoring permission not granted
  - Native Instruments drivers not installed

  Solutions:
  1. Check USB connection
  2. Grant Input Monitoring permission (System Settings ‚Üí Privacy &amp; Security)
  3. Install NI drivers via Native Access
</code></pre>
<p><strong>When to use</strong>:</p>
<ul>
<li>LEDs not working in main application</li>
<li>Verify HID access before running midimon</li>
<li>Test after granting permissions</li>
<li>Debug LED coordinate mapping issues</li>
</ul>
<h3 id="led_tester"><a class="header" href="#led_tester">led_tester</a></h3>
<p>Interactive LED testing tool.</p>
<p><strong>Purpose</strong>: Manual control of individual LEDs for testing and debugging.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">cargo run --bin led_tester
</code></pre>
<p><strong>Interactive mode</strong>:</p>
<pre><code>LED Tester - Interactive Mode
==============================

Commands:
  on &lt;pad&gt; &lt;color&gt; &lt;brightness&gt;  - Turn on LED
  off &lt;pad&gt;                      - Turn off LED
  all &lt;color&gt; &lt;brightness&gt;       - Set all LEDs
  clear                          - Clear all LEDs
  rainbow                        - Show rainbow pattern
  test                           - Cycle through all pads
  quit                           - Exit

&gt; on 0 red 3
‚úì Pad 0: Red Bright

&gt; all blue 2
‚úì All pads: Blue Normal

&gt; rainbow
‚úì Rainbow pattern displayed

&gt; quit
</code></pre>
<p><strong>Colors</strong>: red, orange, yellow, green, blue, purple, magenta, white</p>
<p><strong>Brightness</strong>: 0 (off), 1 (dim), 2 (normal), 3 (bright)</p>
<p><strong>When to use</strong>:</p>
<ul>
<li>Test specific pad LEDs</li>
<li>Verify coordinate mapping</li>
<li>Experiment with colors and brightness</li>
<li>Debug LED patterns</li>
</ul>
<h3 id="pad_mapper"><a class="header" href="#pad_mapper">pad_mapper</a></h3>
<p>Find MIDI note numbers for physical pads.</p>
<p><strong>Purpose</strong>: Discover note numbers to use in <code>config.toml</code>.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">cargo run --bin pad_mapper [PORT]
</code></pre>
<p><strong>Example</strong>:</p>
<pre><code class="language-bash">cargo run --bin pad_mapper 2
</code></pre>
<p><strong>Usage</strong>:</p>
<ol>
<li>Run the tool</li>
<li>Press each pad on your controller</li>
<li>Write down the note number displayed</li>
<li>Use those numbers in your config</li>
</ol>
<p><strong>Output</strong>:</p>
<pre><code>Pad Mapper - Press pads to see note numbers
============================================
Connected to port 2: Maschine Mikro MK3 - Input

Press pads... (Ctrl+C to exit)

Pad pressed: Note 12 (velocity: 87)
Pad pressed: Note 13 (velocity: 64)
Pad pressed: Note 14 (velocity: 103)
Pad pressed: Note 15 (velocity: 52)
</code></pre>
<p><strong>Tips</strong>:</p>
<ul>
<li>Press pads in order (bottom-left to top-right)</li>
<li>Draw a grid on paper and write down note numbers</li>
<li>Use this data to update <code>config.toml</code></li>
</ul>
<p><strong>When to use</strong>:</p>
<ul>
<li>Setting up a new device</li>
<li>Creating initial config</li>
<li>Mapping custom devices</li>
<li>Verifying profile note numbers</li>
</ul>
<h3 id="test_midi"><a class="header" href="#test_midi">test_midi</a></h3>
<p>Test MIDI port connectivity and enumerate devices.</p>
<p><strong>Purpose</strong>: Quick MIDI connectivity test, list all available ports.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">cargo run --bin test_midi
</code></pre>
<p><strong>Output</strong>:</p>
<pre><code>MIDI Port Test
==============

Available input ports:
0: USB MIDI Device
1: IAC Driver Bus 1
2: Maschine Mikro MK3 - Input
3: Digital Keyboard

Available output ports:
0: USB MIDI Device
1: IAC Driver Bus 1
2: Maschine Mikro MK3 - Output

Testing port 2 (input)...
‚úì Successfully opened port: Maschine Mikro MK3 - Input

Press a pad to test... (5 second timeout)
‚úì Received MIDI event: NoteOn ch:0 note:12 vel:87

Connection test: PASSED
</code></pre>
<p><strong>When to use</strong>:</p>
<ul>
<li>Verify MIDI device detected</li>
<li>Check port numbers before running midimon</li>
<li>Debug connectivity issues</li>
<li>Confirm MIDI cable is working</li>
</ul>
<h2 id="command-quick-reference"><a class="header" href="#command-quick-reference">Command Quick Reference</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Command</th><th>Purpose</th><th>Example</th></tr></thead><tbody>
<tr><td><strong>Daemon Service (v1.0.0+)</strong></td><td></td><td></td></tr>
<tr><td><code>midimon [PORT]</code></td><td>Start daemon service</td><td><code>cargo run --release --bin midimon 2</code></td></tr>
<tr><td><code>--led &lt;SCHEME&gt;</code></td><td>Set LED scheme</td><td><code>midimon 2 --led rainbow</code></td></tr>
<tr><td><code>--profile &lt;PATH&gt;</code></td><td>Load profile</td><td><code>midimon 2 --profile my.ncmm3</code></td></tr>
<tr><td><code>--pad-page &lt;PAGE&gt;</code></td><td>Force pad page</td><td><code>midimon 2 --pad-page H</code></td></tr>
<tr><td><code>--config &lt;PATH&gt;</code></td><td>Custom config</td><td><code>midimon 2 --config dev.toml</code></td></tr>
<tr><td><strong>Daemon Control (v1.0.0+)</strong></td><td></td><td></td></tr>
<tr><td><code>midimonctl status</code></td><td>Show daemon status</td><td><code>midimonctl status</code></td></tr>
<tr><td><code>midimonctl reload</code></td><td>Hot-reload config</td><td><code>midimonctl reload</code></td></tr>
<tr><td><code>midimonctl validate</code></td><td>Validate config</td><td><code>midimonctl validate</code></td></tr>
<tr><td><code>midimonctl ping</code></td><td>Health check</td><td><code>midimonctl ping</code></td></tr>
<tr><td><code>midimonctl shutdown</code></td><td>Stop daemon (IPC)</td><td><code>midimonctl shutdown</code></td></tr>
<tr><td><code>midimonctl stop</code></td><td>Stop service (LaunchAgent)</td><td><code>midimonctl stop --force</code></td></tr>
<tr><td><strong>Device Management</strong></td><td></td><td></td></tr>
<tr><td><code>midimonctl list-devices</code></td><td>List MIDI devices</td><td><code>midimonctl list-devices</code></td></tr>
<tr><td><code>midimonctl set-device</code></td><td>Switch MIDI device</td><td><code>midimonctl set-device 2</code></td></tr>
<tr><td><code>midimonctl get-device</code></td><td>Show current device</td><td><code>midimonctl get-device</code></td></tr>
<tr><td><strong>Service Management (macOS)</strong></td><td></td><td></td></tr>
<tr><td><code>midimonctl install</code></td><td>Install LaunchAgent</td><td><code>midimonctl install --install-binary</code></td></tr>
<tr><td><code>midimonctl uninstall</code></td><td>Remove service</td><td><code>midimonctl uninstall --remove-logs</code></td></tr>
<tr><td><code>midimonctl start</code></td><td>Start service</td><td><code>midimonctl start --wait 10</code></td></tr>
<tr><td><code>midimonctl restart</code></td><td>Restart service</td><td><code>midimonctl restart</code></td></tr>
<tr><td><code>midimonctl enable</code></td><td>Enable auto-start</td><td><code>midimonctl enable</code></td></tr>
<tr><td><code>midimonctl disable</code></td><td>Disable auto-start</td><td><code>midimonctl disable</code></td></tr>
<tr><td><code>midimonctl service-status</code></td><td>Service status</td><td><code>midimonctl service-status</code></td></tr>
<tr><td><strong>Global Options</strong></td><td></td><td></td></tr>
<tr><td><code>--json</code></td><td>JSON output</td><td><code>midimonctl status --json</code></td></tr>
<tr><td><strong>Diagnostic Tools</strong></td><td></td><td></td></tr>
<tr><td><code>DEBUG=1</code></td><td>Enable debug log</td><td><code>DEBUG=1 midimon 2</code></td></tr>
<tr><td><code>midi_diagnostic</code></td><td>View MIDI events</td><td><code>cargo run --bin midi_diagnostic 2</code></td></tr>
<tr><td><code>led_diagnostic</code></td><td>Test LEDs</td><td><code>cargo run --bin led_diagnostic</code></td></tr>
<tr><td><code>led_tester</code></td><td>Interactive LED test</td><td><code>cargo run --bin led_tester</code></td></tr>
<tr><td><code>pad_mapper</code></td><td>Find note numbers</td><td><code>cargo run --bin pad_mapper 2</code></td></tr>
<tr><td><code>test_midi</code></td><td>Test MIDI ports</td><td><code>cargo run --bin test_midi</code></td></tr>
</tbody></table>
</div>
<h2 id="common-workflows"><a class="header" href="#common-workflows">Common Workflows</a></h2>
<h3 id="first-time-setup"><a class="header" href="#first-time-setup">First-Time Setup</a></h3>
<pre><code class="language-bash"># 1. List available ports
cargo run --release

# 2. Test connectivity
cargo run --bin test_midi

# 3. Map pads to note numbers
cargo run --bin pad_mapper 2

# 4. Run with basic settings
cargo run --release 2

# 5. Test LEDs
cargo run --release 2 --led rainbow
</code></pre>
<h3 id="troubleshooting-19"><a class="header" href="#troubleshooting-19">Troubleshooting</a></h3>
<pre><code class="language-bash"># 1. Check MIDI events are received
cargo run --bin midi_diagnostic 2

# 2. Enable debug logging
DEBUG=1 cargo run --release 2

# 3. Test LED control
cargo run --bin led_diagnostic

# 4. Verify port numbers
cargo run --bin test_midi
</code></pre>
<h3 id="production-use"><a class="header" href="#production-use">Production Use</a></h3>
<pre><code class="language-bash"># Build optimized binary
cargo build --release

# Run with all options
./target/release/midimon 2 \
    --profile ~/profiles/work.ncmm3 \
    --led reactive \
    --config ~/configs/production.toml

# Or use shell script
#!/bin/bash
DEBUG=0 ./target/release/midimon 2 \
    --profile "$HOME/Documents/NI/my-profile.ncmm3" \
    --led reactive \
    &gt; /tmp/midimon.log 2&gt;&amp;1 &amp;
</code></pre>
<h2 id="see-also-9"><a class="header" href="#see-also-9">See Also</a></h2>
<ul>
<li><a href="reference/../installation/macos.html">macOS Installation</a> - Platform-specific setup</li>
<li><a href="reference/../installation/building.html">Building Guide</a> - Build from source</li>
<li><a href="reference/../troubleshooting/diagnostics.html">Diagnostics Guide</a> - Detailed troubleshooting</li>
<li><a href="reference/../configuration/overview.html">Configuration Overview</a> - Config file structure</li>
</ul>
<hr />
<p><strong>Last Updated</strong>: November 14, 2025
<strong>Binary Version</strong>: 1.0.0</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="config-file-schema"><a class="header" href="#config-file-schema">Config File Schema</a></h1>
<blockquote>
<p><strong>Note</strong>: This section is under development and will be completed in Phase 1 (Q1 2025).</p>
<p>For now, please refer to:</p>
<ul>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/README.md">README.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/CLAUDE.md">CLAUDE.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/discussions">GitHub Discussions</a></li>
</ul>
</blockquote>
<h2 id="coming-soon-5"><a class="header" href="#coming-soon-5">Coming Soon</a></h2>
<p>This page will cover:</p>
<ul>
<li>TBD</li>
</ul>
<hr />
<p><strong>Help Wanted</strong>: We're looking for contributors to help write documentation. See <a href="reference/../development/contributing.html">Contributing Guide</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="environment-variables-1"><a class="header" href="#environment-variables-1">Environment Variables</a></h1>
<blockquote>
<p><strong>Note</strong>: This section is under development and will be completed in Phase 1 (Q1 2025).</p>
<p>For now, please refer to:</p>
<ul>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/README.md">README.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/CLAUDE.md">CLAUDE.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/discussions">GitHub Discussions</a></li>
</ul>
</blockquote>
<h2 id="coming-soon-6"><a class="header" href="#coming-soon-6">Coming Soon</a></h2>
<p>This page will cover:</p>
<ul>
<li>TBD</li>
</ul>
<hr />
<p><strong>Help Wanted</strong>: We're looking for contributors to help write documentation. See <a href="reference/../development/contributing.html">Contributing Guide</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="compatibility-matrix"><a class="header" href="#compatibility-matrix">Compatibility Matrix</a></h1>
<blockquote>
<p><strong>Note</strong>: This section is under development and will be completed in Phase 1 (Q1 2025).</p>
<p>For now, please refer to:</p>
<ul>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/README.md">README.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/CLAUDE.md">CLAUDE.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/discussions">GitHub Discussions</a></li>
</ul>
</blockquote>
<h2 id="coming-soon-7"><a class="header" href="#coming-soon-7">Coming Soon</a></h2>
<p>This page will cover:</p>
<ul>
<li>TBD</li>
</ul>
<hr />
<p><strong>Help Wanted</strong>: We're looking for contributors to help write documentation. See <a href="devices/../development/contributing.html">Contributing Guide</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="maschine-mikro-mk3"><a class="header" href="#maschine-mikro-mk3">Maschine Mikro MK3</a></h1>
<blockquote>
<p><strong>Note</strong>: This section is under development and will be completed in Phase 1 (Q1 2025).</p>
<p>For now, please refer to:</p>
<ul>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/README.md">README.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/CLAUDE.md">CLAUDE.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/discussions">GitHub Discussions</a></li>
</ul>
</blockquote>
<h2 id="coming-soon-8"><a class="header" href="#coming-soon-8">Coming Soon</a></h2>
<p>This page will cover:</p>
<ul>
<li>TBD</li>
</ul>
<hr />
<p><strong>Help Wanted</strong>: We're looking for contributors to help write documentation. See <a href="devices/../development/contributing.html">Contributing Guide</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="generic-midi-controllers"><a class="header" href="#generic-midi-controllers">Generic MIDI Controllers</a></h1>
<blockquote>
<p><strong>Note</strong>: This section is under development and will be completed in Phase 1 (Q1 2025).</p>
<p>For now, please refer to:</p>
<ul>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/README.md">README.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/CLAUDE.md">CLAUDE.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/discussions">GitHub Discussions</a></li>
</ul>
</blockquote>
<h2 id="coming-soon-9"><a class="header" href="#coming-soon-9">Coming Soon</a></h2>
<p>This page will cover:</p>
<ul>
<li>TBD</li>
</ul>
<hr />
<p><strong>Help Wanted</strong>: We're looking for contributors to help write documentation. See <a href="devices/../development/contributing.html">Contributing Guide</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-device-profiles"><a class="header" href="#creating-device-profiles">Creating Device Profiles</a></h1>
<blockquote>
<p><strong>Note</strong>: This section is under development and will be completed in Phase 1 (Q1 2025).</p>
<p>For now, please refer to:</p>
<ul>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/README.md">README.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/CLAUDE.md">CLAUDE.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/discussions">GitHub Discussions</a></li>
</ul>
</blockquote>
<h2 id="coming-soon-10"><a class="header" href="#coming-soon-10">Coming Soon</a></h2>
<p>This page will cover:</p>
<ul>
<li>TBD</li>
</ul>
<hr />
<p><strong>Help Wanted</strong>: We're looking for contributors to help write documentation. See <a href="devices/../development/contributing.html">Contributing Guide</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="development-setup"><a class="header" href="#development-setup">Development Setup</a></h1>
<blockquote>
<p><strong>Note</strong>: This section is under development and will be completed in Phase 1 (Q1 2025).</p>
<p>For now, please refer to:</p>
<ul>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/README.md">README.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/CLAUDE.md">CLAUDE.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/discussions">GitHub Discussions</a></li>
</ul>
</blockquote>
<h2 id="coming-soon-11"><a class="header" href="#coming-soon-11">Coming Soon</a></h2>
<p>This page will cover:</p>
<ul>
<li>TBD</li>
</ul>
<hr />
<p><strong>Help Wanted</strong>: We're looking for contributors to help write documentation. See <a href="development/../development/contributing.html">Contributing Guide</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="architecture-overview-1"><a class="header" href="#architecture-overview-1">Architecture Overview</a></h1>
<h2 id="current-architecture-v020---phase-2"><a class="header" href="#current-architecture-v020---phase-2">Current Architecture (v0.2.0 - Phase 2)</a></h2>
<p>MIDIMon uses a <strong>Cargo workspace architecture</strong> with three packages. Phase 2 migration completed successfully with zero breaking changes.</p>
<h3 id="workspace-packages"><a class="header" href="#workspace-packages">Workspace Packages</a></h3>
<ol>
<li><strong>midimon-core</strong>: Pure Rust engine library (zero UI dependencies)</li>
<li><strong>midimon-daemon</strong>: CLI daemon + 6 diagnostic tools</li>
<li><strong>midimon</strong>: Backward compatibility layer for existing tests</li>
</ol>
<h3 id="system-architecture"><a class="header" href="#system-architecture">System Architecture</a></h3>
<pre><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    midimon-daemon                           ‚îÇ
‚îÇ              (CLI Daemon + Diagnostic Tools)                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ   main.rs       6 diagnostic binaries                      ‚îÇ
‚îÇ   (daemon)      (tools for MIDI/LED testing)               ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ                      ‚ñº  imports                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    midimon-core                             ‚îÇ
‚îÇ              (Pure Rust Engine Library)                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   Config    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ    Mapping   ‚îÇ‚óÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Feedback    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   Loader    ‚îÇ    ‚îÇ    Engine    ‚îÇ    ‚îÇ   System     ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ         ‚îÇ                   ‚îÇ                    ‚îÇ         ‚îÇ
‚îÇ         ‚îÇ                   ‚îÇ                    ‚îÇ         ‚îÇ
‚îÇ         ‚ñº                   ‚ñº                    ‚ñº         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   Events    ‚îÇ    ‚îÇ    Event     ‚îÇ    ‚îÇ  HID/MIDI    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   Types     ‚îÇ    ‚îÇ  Processor   ‚îÇ    ‚îÇ   LEDs       ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ         ‚îÇ                   ‚îÇ                    ‚îÇ         ‚îÇ
‚îÇ         ‚îÇ                   ‚îÇ                    ‚îÇ         ‚îÇ
‚îÇ         ‚ñº                   ‚ñº                    ‚ñº         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   Actions   ‚îÇ    ‚îÇ    Device    ‚îÇ    ‚îÇ    Error     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Executor   ‚îÇ    ‚îÇ   Profiles   ‚îÇ    ‚îÇ    Types     ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  Zero UI dependencies ‚Ä¢ Public API ‚Ä¢ Reusable library      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚ñ≤
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      midimon (root)                         ‚îÇ
‚îÇ               (Backward Compatibility Layer)                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Re-exports midimon_core types for existing tests          ‚îÇ
‚îÇ  Maintains v0.1.0 import paths ‚Ä¢ Zero breaking changes     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre>
<h3 id="event-processing-pipeline"><a class="header" href="#event-processing-pipeline">Event Processing Pipeline</a></h3>
<p>The system uses a three-stage event processing architecture:</p>
<pre><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   MIDI Device    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ Raw bytes
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   MidiEvent      ‚îÇ  (Note On/Off, CC, Velocity)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Event Processor  ‚îÇ  (State Machine)
‚îÇ  - Velocity      ‚îÇ  - Soft/Med/Hard levels
‚îÇ  - Long Press    ‚îÇ  - Hold detection (2000ms)
‚îÇ  - Double-Tap    ‚îÇ  - Quick succession (300ms)
‚îÇ  - Chord         ‚îÇ  - Simultaneous notes (50ms)
‚îÇ  - Encoder       ‚îÇ  - Direction detection
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ ProcessedEvent
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Mapping Engine   ‚îÇ  (Mode-aware matching)
‚îÇ  - Global maps   ‚îÇ
‚îÇ  - Mode maps     ‚îÇ
‚îÇ  - Trigger match ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ Action
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Action Executor  ‚îÇ  (enigo for input simulation)
‚îÇ  - Keystroke     ‚îÇ
‚îÇ  - Shell         ‚îÇ
‚îÇ  - Launch        ‚îÇ
‚îÇ  - Volume        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre>
<h3 id="core-components"><a class="header" href="#core-components">Core Components</a></h3>
<h4 id="mainrs"><a class="header" href="#mainrs">main.rs</a></h4>
<ul>
<li><strong>Entry Point</strong>: CLI argument parsing, device enumeration</li>
<li><strong>MIDI Connection</strong>: Sets up <code>midir</code> input callbacks</li>
<li><strong>Event Loop</strong>: Coordinates event processing thread</li>
<li><strong>Mode Management</strong>: Tracks current mode via <code>AtomicU8</code></li>
<li><strong>Device Profiles</strong>: Loads <code>.ncmm3</code> profiles for pad mapping</li>
</ul>
<h4 id="configrs"><a class="header" href="#configrs">config.rs</a></h4>
<ul>
<li><strong>Configuration Types</strong>: <code>Config</code>, <code>Mode</code>, <code>Mapping</code>, <code>Trigger</code>, <code>ActionConfig</code></li>
<li><strong>TOML Parsing</strong>: Loads and validates <code>config.toml</code></li>
<li><strong>Serialization</strong>: Supports saving default configs</li>
</ul>
<h4 id="event_processorrs"><a class="header" href="#event_processorrs">event_processor.rs</a></h4>
<ul>
<li><strong>State Machine</strong>: Transforms raw MIDI ‚Üí ProcessedEvent</li>
<li><strong>Timing Detection</strong>: Long press, double-tap, hold threshold</li>
<li><strong>Velocity Ranges</strong>: Soft (0-40), Medium (41-80), Hard (81-127)</li>
<li><strong>Chord Detection</strong>: Buffers notes within 50ms window</li>
<li><strong>Encoder Direction</strong>: Detects clockwise/counterclockwise rotation</li>
</ul>
<h4 id="mappingsrs"><a class="header" href="#mappingsrs">mappings.rs</a></h4>
<ul>
<li><strong>Mapping Engine</strong>: Matches <code>ProcessedEvent</code> ‚Üí <code>Action</code></li>
<li><strong>Mode System</strong>: Global mappings + per-mode mappings</li>
<li><strong>Trigger Matching</strong>: Supports Note, CC, Chord, Velocity, LongPress, DoubleTap</li>
<li><strong>Compilation</strong>: Converts <code>Trigger</code> config ‚Üí <code>CompiledTrigger</code> for fast matching</li>
</ul>
<h4 id="actionsrs"><a class="header" href="#actionsrs">actions.rs</a></h4>
<ul>
<li><strong>Action Executor</strong>: Executes compiled actions via <code>enigo</code></li>
<li><strong>Keystroke Simulation</strong>: Key sequences with modifiers</li>
<li><strong>Application Launch</strong>: Platform-specific (macOS <code>open</code>, Linux <code>exec</code>, Windows <code>start</code>)</li>
<li><strong>Shell Execution</strong>: Runs arbitrary shell commands</li>
<li><strong>Sequences</strong>: Chains multiple actions with delays</li>
</ul>
<h4 id="feedbackrs"><a class="header" href="#feedbackrs">feedback.rs</a></h4>
<ul>
<li><strong>Trait Abstraction</strong>: <code>PadFeedback</code> trait for LED control</li>
<li><strong>Device Factory</strong>: Creates HID (Mikro MK3) or MIDI feedback</li>
<li><strong>Lighting Schemes</strong>: Off, Static, Breathing, Pulse, Rainbow, Wave, Sparkle, Reactive, VuMeter, Spiral</li>
</ul>
<h4 id="mikro_ledsrs"><a class="header" href="#mikro_ledsrs">mikro_leds.rs</a></h4>
<ul>
<li><strong>HID Control</strong>: Direct RGB LED control via <code>hidapi</code></li>
<li><strong>Maschine Mikro MK3</strong>: Full RGB control, 16 pads</li>
<li><strong>Shared Device Mode</strong>: macOS shared access (runs alongside NI Controller Editor)</li>
<li><strong>Effects</strong>: Velocity feedback, mode colors, reactive lighting</li>
</ul>
<h4 id="midi_feedbackrs"><a class="header" href="#midi_feedbackrs">midi_feedback.rs</a></h4>
<ul>
<li><strong>Standard MIDI</strong>: Fallback LED control via MIDI Note messages</li>
<li><strong>Generic Devices</strong>: Works with any MIDI device with LED support</li>
<li><strong>Limited Features</strong>: On/off only, no color control</li>
</ul>
<h4 id="device_profilers"><a class="header" href="#device_profilers">device_profile.rs</a></h4>
<ul>
<li><strong>NI Profile Parser</strong>: Parses <code>.ncmm3</code> XML from Controller Editor</li>
<li><strong>Pad Mapping</strong>: Maps physical pad positions ‚Üí MIDI notes</li>
<li><strong>Page Support</strong>: Handles pad pages (A-H) for multi-page controllers</li>
<li><strong>Auto-Detection</strong>: Detects active pad page from incoming MIDI</li>
</ul>
<h3 id="key-design-patterns"><a class="header" href="#key-design-patterns">Key Design Patterns</a></h3>
<h4 id="mode-system"><a class="header" href="#mode-system">Mode System</a></h4>
<p>Multiple modes (Default, Development, Media, etc.) allow different mapping sets. Each mode has:</p>
<ul>
<li>Distinct name and color theme</li>
<li>Mode-specific mappings</li>
<li>LED color scheme</li>
</ul>
<p>Mode changes triggered by:</p>
<ul>
<li>Encoder rotation (CC messages)</li>
<li>Specific pad combinations</li>
<li>Programmatic mode switching</li>
</ul>
<h4 id="global-vs-mode-mappings"><a class="header" href="#global-vs-mode-mappings">Global vs Mode Mappings</a></h4>
<ul>
<li><strong>Global Mappings</strong>: Active in all modes (e.g., emergency exit, encoder volume)</li>
<li><strong>Mode Mappings</strong>: Scoped to specific modes (e.g., dev tools in Development mode)</li>
</ul>
<h4 id="profile-based-note-mapping"><a class="header" href="#profile-based-note-mapping">Profile-Based Note Mapping</a></h4>
<p>Supports loading NI Controller Editor profiles (<code>.ncmm3</code>) to:</p>
<ul>
<li>Map physical pad positions to MIDI notes</li>
<li>Handle different pad pages (A-H)</li>
<li>Auto-detect active pad page from events</li>
<li>Support custom controller configurations</li>
</ul>
<h4 id="led-feedback-system"><a class="header" href="#led-feedback-system">LED Feedback System</a></h4>
<p>Trait-based abstraction (<code>PadFeedback</code>) supports:</p>
<ul>
<li><strong>HID Devices</strong>: Full RGB control (Maschine Mikro MK3)</li>
<li><strong>MIDI Devices</strong>: Basic on/off via MIDI Note messages</li>
</ul>
<p><strong>Reactive Mode</strong>: LEDs respond to velocity:</p>
<ul>
<li>Soft (green), Medium (yellow), Hard (red)</li>
<li>Fade-out 1 second after release</li>
</ul>
<p><strong>Mode Colors</strong>: Distinct color themes per mode</p>
<ul>
<li>Mode 0: Blue</li>
<li>Mode 1: Green</li>
<li>Mode 2: Purple</li>
</ul>
<h3 id="threading-and-concurrency"><a class="header" href="#threading-and-concurrency">Threading and Concurrency</a></h3>
<pre><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Main Thread       ‚îÇ
‚îÇ   - Config load     ‚îÇ
‚îÇ   - Device connect  ‚îÇ
‚îÇ   - Ctrl+C handler  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ                         ‚îÇ
           ‚ñº                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   MIDI Callback     ‚îÇ   ‚îÇ   LED Effect        ‚îÇ
‚îÇ   - Raw bytes       ‚îÇ   ‚îÇ   - Background      ‚îÇ
‚îÇ   - crossbeam send  ‚îÇ   ‚îÇ   - Lighting loop   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Event Thread      ‚îÇ
‚îÇ   - Process events  ‚îÇ
‚îÇ   - Match mappings  ‚îÇ
‚îÇ   - Execute actions ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre>
<p><strong>Current Threading Model</strong>:</p>
<ul>
<li><strong>Main Thread</strong>: Setup, config loading, signal handling</li>
<li><strong>MIDI Callbacks</strong>: Lock-free (via <code>crossbeam-channel</code>)</li>
<li><strong>Event Thread</strong>: Dedicated thread for event processing</li>
<li><strong>LED Effects</strong>: Optional background thread for lighting schemes</li>
</ul>
<p><strong>Atomic State</strong>:</p>
<ul>
<li><code>AtomicU8</code> for current mode (lock-free reads/writes)</li>
<li><code>AtomicBool</code> for running flag (graceful shutdown)</li>
</ul>
<h3 id="performance-characteristics"><a class="header" href="#performance-characteristics">Performance Characteristics</a></h3>
<ul>
<li><strong>Event Latency</strong>: &lt;1ms typical</li>
<li><strong>Memory Usage</strong>: 5-10MB</li>
<li><strong>CPU Usage</strong>: &lt;1% idle, &lt;5% active</li>
<li><strong>Binary Size</strong>: ~3-5MB (release with LTO)</li>
</ul>
<h3 id="dependencies"><a class="header" href="#dependencies">Dependencies</a></h3>
<p><strong>Core Dependencies</strong>:</p>
<ul>
<li><code>midir</code>: Cross-platform MIDI I/O</li>
<li><code>enigo</code>: Keyboard/mouse simulation</li>
<li><code>hidapi</code>: HID device access (with <code>macos-shared-device</code>)</li>
<li><code>serde</code>/<code>toml</code>: Config parsing</li>
<li><code>quick-xml</code>: XML profile parsing</li>
<li><code>crossbeam-channel</code>: Lock-free event channels</li>
</ul>
<p><strong>Platform-Specific</strong>:</p>
<ul>
<li>macOS: AppleScript for volume control</li>
<li>Linux: <code>xdotool</code> (optional, for input simulation)</li>
<li>Windows: Native Windows APIs</li>
</ul>
<h2 id="future-phases-phase-4-gui"><a class="header" href="#future-phases-phase-4-gui">Future Phases (Phase 4+: GUI)</a></h2>
<p>The roadmap includes migrating to a <strong>workspace structure</strong> with separate crates. See <a href="development/../../docs/workspace-structure.html">Workspace Structure Design</a> for complete details (AMI-124).</p>
<h3 id="target-structure"><a class="header" href="#target-structure">Target Structure</a></h3>
<pre><code>midimon/
‚îú‚îÄ‚îÄ Cargo.toml                      # Workspace root manifest
‚îú‚îÄ‚îÄ midimon-core/                   # Pure Rust engine (UI-free)
‚îÇ   ‚îú‚îÄ‚îÄ Cargo.toml
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ lib.rs                  # Public API
‚îÇ       ‚îú‚îÄ‚îÄ engine.rs               # MidiMonEngine
‚îÇ       ‚îú‚îÄ‚îÄ config.rs               # Config types
‚îÇ       ‚îú‚îÄ‚îÄ events.rs               # Event types
‚îÇ       ‚îú‚îÄ‚îÄ mappings.rs             # Mapping engine
‚îÇ       ‚îú‚îÄ‚îÄ actions.rs              # Action execution
‚îÇ       ‚îú‚îÄ‚îÄ feedback.rs             # LED feedback
‚îÇ       ‚îú‚îÄ‚îÄ device_profile.rs       # NI profile parser
‚îÇ       ‚îî‚îÄ‚îÄ error.rs                # Error types
‚îú‚îÄ‚îÄ midimon-daemon/                 # CLI binary (current main.rs)
‚îÇ   ‚îú‚îÄ‚îÄ Cargo.toml
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ main.rs                 # CLI entry point
‚îÇ       ‚îú‚îÄ‚îÄ cli.rs                  # Argument parsing
‚îÇ       ‚îú‚îÄ‚îÄ debug.rs                # Debug output
‚îÇ       ‚îî‚îÄ‚îÄ bin/                    # Diagnostic tools
‚îú‚îÄ‚îÄ midimon-gui/                    # Tauri UI (Phase 4)
‚îÇ   ‚îú‚îÄ‚îÄ Cargo.toml
‚îÇ   ‚îú‚îÄ‚îÄ src-tauri/
‚îÇ   ‚îî‚îÄ‚îÄ ui/
‚îî‚îÄ‚îÄ config/                         # Config templates
    ‚îú‚îÄ‚îÄ default.toml
    ‚îú‚îÄ‚îÄ examples/
    ‚îî‚îÄ‚îÄ device_templates/
</code></pre>
<h3 id="workspace-dependency-graph"><a class="header" href="#workspace-dependency-graph">Workspace Dependency Graph</a></h3>
<pre><code class="language-mermaid">graph TD
    A[midimon-gui&lt;br/&gt;Tauri UI] --&gt;|depends on| C[midimon-core&lt;br/&gt;Engine Library]
    B[midimon-daemon&lt;br/&gt;CLI Binary] --&gt;|depends on| C
    C --&gt;|no dependencies on| A
    C --&gt;|no dependencies on| B

    style C fill:#4a90e2,stroke:#2e5f8a,stroke-width:3px,color:#fff
    style A fill:#50c878,stroke:#2d7a4d,stroke-width:2px,color:#fff
    style B fill:#50c878,stroke:#2d7a4d,stroke-width:2px,color:#fff
</code></pre>
<h3 id="phase-2-core-library-extraction--complete-v020"><a class="header" href="#phase-2-core-library-extraction--complete-v020">Phase 2: Core Library Extraction ‚úÖ COMPLETE (v0.2.0)</a></h3>
<p><strong>Goal</strong>: Extract engine logic into reusable <code>midimon-core</code> crate (AMI-123, AMI-124).</p>
<p><strong>Public API</strong> (from <a href="development/../../docs/api-design.html">API Design</a>):</p>
<pre><code class="language-rust">pub struct MidiMonEngine;
impl MidiMonEngine {
    pub fn new(config: Config) -&gt; Result&lt;Self, EngineError&gt;;
    pub fn start(&amp;mut self) -&gt; Result&lt;(), EngineError&gt;;
    pub fn stop(&amp;mut self) -&gt; Result&lt;(), EngineError&gt;;
    pub fn reload_config(&amp;mut self, config: Config) -&gt; Result&lt;(), EngineError&gt;;
    pub fn current_mode(&amp;self) -&gt; u8;
    pub fn set_mode(&amp;mut self, mode: u8) -&gt; Result&lt;(), EngineError&gt;;
    pub fn config(&amp;self) -&gt; Config;
    pub fn stats(&amp;self) -&gt; EngineStats;

    // Callbacks for integration
    pub fn on_mode_change&lt;F&gt;(&amp;mut self, callback: F)
    where F: Fn(u8) + Send + 'static;

    pub fn on_action&lt;F&gt;(&amp;mut self, callback: F)
    where F: Fn(&amp;ProcessedEvent, &amp;Action) + Send + 'static;
}</code></pre>
<p><strong>Module Separation</strong>:</p>
<ul>
<li><strong>Public Modules</strong>: <code>config</code>, <code>engine</code>, <code>events</code>, <code>actions</code>, <code>feedback</code>, <code>device</code>, <code>error</code></li>
<li><strong>Private Modules</strong>: <code>event_processor</code>, <code>timing</code>, <code>chord</code>, <code>velocity</code></li>
</ul>
<p><strong>Benefits</strong>:</p>
<ul>
<li>Reusable engine for CLI, daemon, GUI</li>
<li>Zero UI dependencies in core (no <code>colored</code>, <code>chrono</code> for display)</li>
<li>Clean API boundaries with trait-based abstractions</li>
<li>Easier testing and integration</li>
<li>Thread-safe with Arc/RwLock for shared state</li>
</ul>
<p><strong>Build Commands</strong>:</p>
<pre><code class="language-bash"># Build core library only
cargo build -p midimon-core

# Build CLI daemon
cargo build -p midimon-daemon --release

# Run with new structure
cargo run -p midimon-daemon --release -- 2 --led reactive

# Test workspace
cargo test --workspace
</code></pre>
<h3 id="phase-3-daemon-and-menu-bar"><a class="header" href="#phase-3-daemon-and-menu-bar">Phase 3: Daemon and Menu Bar</a></h3>
<p><strong>Goal</strong>: Add <code>midimon-daemon</code> with macOS menu bar integration.</p>
<p><strong>Features</strong>:</p>
<ul>
<li>System tray icon with status</li>
<li>Quick actions (Pause, Reload, Open Config)</li>
<li>Config hot-reloading via <code>notify</code> crate</li>
<li>Auto-start via LaunchAgent or Tauri autostart plugin</li>
<li>Frontmost app detection for per-app profiles</li>
</ul>
<p><strong>Integration Pattern</strong>:</p>
<pre><code class="language-rust">use midimon_core::{Config, MidiMonEngine};

fn main() -&gt; Result&lt;()&gt; {
    let config = Config::load("config.toml")?;
    let mut engine = MidiMonEngine::new(config)?;

    // Register callbacks for UI updates
    engine.on_mode_change(|mode| {
        update_menu_bar_icon(mode);
    });

    engine.start()?;
    Ok(())
}</code></pre>
<h3 id="phase-4-gui-configuration"><a class="header" href="#phase-4-gui-configuration">Phase 4: GUI Configuration</a></h3>
<p><strong>Goal</strong>: Add <code>midimon-gui</code> with Tauri-based visual config editor.</p>
<p><strong>Features</strong>:</p>
<ul>
<li>Visual device mapping with SVG pad layouts</li>
<li>MIDI Learn mode (click ‚Üí press ‚Üí bind)</li>
<li>Profile management (import/export/share)</li>
<li>Live event console with filtering</li>
<li>Velocity curve editor</li>
<li>Test bindings without saving</li>
</ul>
<p><strong>UI Components</strong>:</p>
<ul>
<li>Device visualizer (16-pad grid for Maschine Mikro MK3)</li>
<li>Mapping editor (trigger ‚Üí action configuration)</li>
<li>Profile switcher (per-app profiles)</li>
<li>Event log (real-time MIDI/HID events)</li>
<li>Settings panel (advanced timing, thresholds)</li>
</ul>
<h2 id="configuration-backward-compatibility"><a class="header" href="#configuration-backward-compatibility">Configuration Backward Compatibility</a></h2>
<p><strong>Core Commitment</strong>: Configuration files created for v0.1.0 will work in all v1.x.x versions without modification.</p>
<h3 id="stability-guarantees"><a class="header" href="#stability-guarantees">Stability Guarantees</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Section</th><th>v0.1.0</th><th>v0.2.0</th><th>v1.0.0</th><th>Stability</th></tr></thead><tbody>
<tr><td><code>[device]</code></td><td>‚úÖ</td><td>‚úÖ</td><td>‚úÖ</td><td><strong>Stable</strong></td></tr>
<tr><td><code>[[modes]]</code></td><td>‚úÖ</td><td>‚úÖ</td><td>‚úÖ</td><td><strong>Stable</strong></td></tr>
<tr><td><code>[[global_mappings]]</code></td><td>‚úÖ</td><td>‚úÖ</td><td>‚úÖ</td><td><strong>Stable</strong> (optional, defaults to empty)</td></tr>
<tr><td><code>[advanced_settings]</code></td><td>‚ö†Ô∏è</td><td>‚úÖ</td><td>‚úÖ</td><td><strong>Optional</strong> (defaults provided)</td></tr>
</tbody></table>
</div>
<p><strong>Legend</strong>:</p>
<ul>
<li>‚úÖ <strong>Fully Supported</strong>: Section works identically across versions</li>
<li>‚ö†Ô∏è  <strong>Optional</strong>: Section is optional with sensible defaults</li>
</ul>
<h3 id="version-compatibility"><a class="header" href="#version-compatibility">Version Compatibility</a></h3>
<pre><code>v0.1.0 config ‚Üí v0.2.0 engine ‚úÖ (100% compatible)
v0.1.0 config ‚Üí v1.0.0 engine ‚úÖ (100% compatible)

v0.2.0 config ‚Üí v0.1.0 engine ‚ö†Ô∏è  (new features ignored with warnings)
v1.0.0 config ‚Üí v0.1.0 engine ‚ö†Ô∏è  (new features ignored with warnings)
</code></pre>
<h3 id="deprecation-policy"><a class="header" href="#deprecation-policy">Deprecation Policy</a></h3>
<p>MIDIMon follows <strong>semantic versioning</strong> (SemVer) for configuration:</p>
<ul>
<li><strong>Major version (x.0.0)</strong>: May introduce breaking changes with migration tools</li>
<li><strong>Minor version (0.x.0)</strong>: Adds features in backward-compatible manner</li>
<li><strong>Patch version (0.0.x)</strong>: Bug fixes only, no config changes</li>
</ul>
<p><strong>Breaking changes</strong> require:</p>
<ol>
<li>Deprecation notice (version N)</li>
<li>Deprecation period with warnings (version N+1)</li>
<li>Removal with migration tool (version N+2, major bump)</li>
</ol>
<h3 id="test-coverage"><a class="header" href="#test-coverage">Test Coverage</a></h3>
<p>All v0.1.0 configuration examples are validated in CI/CD via <code>tests/config_compatibility_test.rs</code>:</p>
<ul>
<li><strong>CFG-001</strong>: Basic config.toml loads without errors</li>
<li><strong>CFG-003</strong>: Minimal device-only configs use defaults</li>
<li><strong>CFG-004</strong>: All trigger types parse correctly</li>
<li><strong>CFG-005</strong>: All action types parse correctly</li>
<li><strong>CFG-006</strong>: Complex sequences work</li>
<li><strong>CFG-007</strong>: Multiple modes supported</li>
<li><strong>CFG-009</strong>: Legacy v0.1.0 syntax always works</li>
<li><strong>CFG-010</strong>: Invalid syntax produces clear error messages</li>
</ul>
<p><strong>Coverage Requirements</strong>:</p>
<ul>
<li>100% coverage for config parsing (<code>src/config.rs</code>)</li>
<li>All documentation examples must parse successfully</li>
<li>Regression tests for every released version</li>
</ul>
<p>For complete details, see: <strong><a href="development/../../docs/config-compatibility.html">Configuration Backward Compatibility Strategy</a></strong></p>
<hr />
<h2 id="api-design"><a class="header" href="#api-design">API Design</a></h2>
<p>For detailed public API design (Phase 2+), see:</p>
<ul>
<li><strong><a href="development/../../docs/api-design.html">API Design Document</a></strong> - Complete API specification (AMI-123)</li>
<li><strong><a href="development/../../docs/config-compatibility.html">Configuration Compatibility</a></strong> - Backward compatibility strategy (AMI-125)</li>
<li><strong><a href="development/../../.research/implementation-viewpoint-1.html">Implementation Viewpoint 1</a></strong> - Monorepo with Tauri</li>
<li><strong><a href="development/../../.research/implementation-viewpoint-2.html">Implementation Viewpoint 2</a></strong> - Alternative approach</li>
</ul>
<h2 id="related-documentation-4"><a class="header" href="#related-documentation-4">Related Documentation</a></h2>
<ul>
<li><a href="development/../configuration/overview.html">Configuration Overview</a></li>
<li><a href="development/../configuration/device-profiles.html">Device Profiles</a></li>
<li><a href="development/../configuration/led-feedback.html">LED Feedback System</a></li>
<li><a href="development/contributing.html">Contributing Guide</a></li>
<li><a href="development/testing.html">Testing Strategy</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="plugin-development"><a class="header" href="#plugin-development">Plugin Development</a></h1>
<p>MIDIMon v2.3 introduces a powerful plugin architecture that allows third-party developers to create custom actions through dynamically loaded shared libraries.</p>
<h2 id="overview-15"><a class="header" href="#overview-15">Overview</a></h2>
<p>Plugins extend MIDIMon's functionality by implementing the <code>ActionPlugin</code> trait. They can:</p>
<ul>
<li>Execute custom logic when MIDI events occur</li>
<li>Access event metadata (velocity, mode, timestamp)</li>
<li>Request specific capabilities (network, filesystem, etc.)</li>
<li>Be loaded/unloaded dynamically without restart</li>
<li>Be managed through the GUI Plugin Manager</li>
</ul>
<h2 id="quick-start-3"><a class="header" href="#quick-start-3">Quick Start</a></h2>
<h3 id="1-create-a-new-plugin-project"><a class="header" href="#1-create-a-new-plugin-project">1. Create a New Plugin Project</a></h3>
<pre><code class="language-bash">cargo new --lib my_plugin
cd my_plugin
</code></pre>
<h3 id="2-configure-cargotoml"><a class="header" href="#2-configure-cargotoml">2. Configure Cargo.toml</a></h3>
<pre><code class="language-toml">[package]
name = "midimon-my-plugin"
version = "1.0.0"
edition = "2021"

[lib]
crate-type = ["cdylib"]  # Required for dynamic loading

[dependencies]
midimon-core = { path = "../midimon-core", features = ["plugin"] }
serde_json = "1.0"
</code></pre>
<h3 id="3-implement-the-actionplugin-trait"><a class="header" href="#3-implement-the-actionplugin-trait">3. Implement the ActionPlugin Trait</a></h3>
<pre><code class="language-rust">use midimon_core::plugin::{ActionPlugin, Capability, TriggerContext};
use serde_json::Value;
use std::error::Error;

pub struct MyPlugin;

impl ActionPlugin for MyPlugin {
    fn name(&amp;self) -&gt; &amp;str {
        "my_plugin"
    }

    fn version(&amp;self) -&gt; &amp;str {
        "1.0.0"
    }

    fn description(&amp;self) -&gt; &amp;str {
        "My custom MIDIMon plugin"
    }

    fn author(&amp;self) -&gt; &amp;str {
        "Your Name"
    }

    fn license(&amp;self) -&gt; &amp;str {
        "MIT"
    }

    fn capabilities(&amp;self) -&gt; Vec&lt;Capability&gt; {
        vec![Capability::Network]  // Request network access
    }

    fn execute(&amp;mut self, params: Value, context: TriggerContext) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
        // Your plugin logic here
        let velocity = context.velocity.unwrap_or(0);
        eprintln!("Plugin executed with velocity: {}", velocity);
        Ok(())
    }
}

#[no_mangle]
pub extern "C" fn _create_plugin() -&gt; *mut dyn ActionPlugin {
    Box::into_raw(Box::new(MyPlugin))
}</code></pre>
<h3 id="4-create-plugin-manifest"><a class="header" href="#4-create-plugin-manifest">4. Create Plugin Manifest</a></h3>
<p>Create <code>plugin.toml</code> in your plugin directory:</p>
<pre><code class="language-toml">[plugin]
name = "my_plugin"
version = "1.0.0"
description = "My custom MIDIMon plugin"
author = "Your Name"
homepage = "https://github.com/yourname/midimon-my-plugin"
license = "MIT"
type = "action"
binary = "libmidimon_my_plugin.dylib"  # .so on Linux, .dll on Windows
checksum = ""  # Optional SHA256 checksum

[plugin.capabilities]
network = true
</code></pre>
<h3 id="5-build-and-install"><a class="header" href="#5-build-and-install">5. Build and Install</a></h3>
<pre><code class="language-bash"># Build the plugin
cargo build --release

# Install to MIDIMon plugins directory
mkdir -p ~/.midimon/plugins/my_plugin
cp target/release/libmidimon_my_plugin.dylib ~/.midimon/plugins/my_plugin/
cp plugin.toml ~/.midimon/plugins/my_plugin/
</code></pre>
<h3 id="6-use-in-configuration"><a class="header" href="#6-use-in-configuration">6. Use in Configuration</a></h3>
<pre><code class="language-toml">[[modes.mappings]]
trigger = { Note = { note = 60 } }
action = { Plugin = {
    plugin = "my_plugin",
    params = {
        "custom_param": "value"
    }
}}
</code></pre>
<h2 id="capability-system"><a class="header" href="#capability-system">Capability System</a></h2>
<p>Plugins request capabilities to access system resources. MIDIMon uses a risk-level based security model:</p>
<h3 id="capability-types"><a class="header" href="#capability-types">Capability Types</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Capability</th><th>Risk Level</th><th>Description</th></tr></thead><tbody>
<tr><td><code>Network</code></td><td>Low</td><td>HTTP requests, websockets</td></tr>
<tr><td><code>Audio</code></td><td>Low</td><td>Audio device access</td></tr>
<tr><td><code>Midi</code></td><td>Low</td><td>MIDI device access</td></tr>
<tr><td><code>Filesystem</code></td><td>Medium</td><td>File read/write</td></tr>
<tr><td><code>Subprocess</code></td><td>High</td><td>Execute shell commands</td></tr>
<tr><td><code>SystemControl</code></td><td>High</td><td>System-level control</td></tr>
</tbody></table>
</div>
<h3 id="risk-levels"><a class="header" href="#risk-levels">Risk Levels</a></h3>
<ul>
<li><strong>Low</strong> (üü¢): Auto-granted by default, considered safe</li>
<li><strong>Medium</strong> (üü°): Requires user approval</li>
<li><strong>High</strong> (üî¥): Requires explicit user approval with warning</li>
</ul>
<h3 id="requesting-capabilities"><a class="header" href="#requesting-capabilities">Requesting Capabilities</a></h3>
<pre><code class="language-rust">fn capabilities(&amp;self) -&gt; Vec&lt;Capability&gt; {
    vec![
        Capability::Network,      // Auto-granted
        Capability::Filesystem,   // Requires approval
    ]
}</code></pre>
<h2 id="plugin-lifecycle"><a class="header" href="#plugin-lifecycle">Plugin Lifecycle</a></h2>
<ol>
<li><strong>Discovery</strong>: MIDIMon scans <code>~/.midimon/plugins/</code> for <code>plugin.toml</code> files</li>
<li><strong>Load</strong>: Binary is loaded via <code>libloading</code>, plugin instance created</li>
<li><strong>Initialize</strong>: <code>initialize()</code> method called (if implemented)</li>
<li><strong>Execute</strong>: <code>execute()</code> called for each MIDI event</li>
<li><strong>Shutdown</strong>: <code>shutdown()</code> method called before unload (if implemented)</li>
<li><strong>Unload</strong>: Plugin removed from memory</li>
</ol>
<h2 id="advanced-features-2"><a class="header" href="#advanced-features-2">Advanced Features</a></h2>
<h3 id="initialization-and-shutdown"><a class="header" href="#initialization-and-shutdown">Initialization and Shutdown</a></h3>
<pre><code class="language-rust">impl ActionPlugin for MyPlugin {
    fn initialize(&amp;mut self) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
        eprintln!("Plugin initializing...");
        // Setup code here
        Ok(())
    }

    fn shutdown(&amp;mut self) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
        eprintln!("Plugin shutting down...");
        // Cleanup code here
        Ok(())
    }
}</code></pre>
<h3 id="accessing-context"><a class="header" href="#accessing-context">Accessing Context</a></h3>
<pre><code class="language-rust">fn execute(&amp;mut self, params: Value, context: TriggerContext) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
    let velocity = context.velocity.unwrap_or(0);
    let mode = context.current_mode.unwrap_or(0);
    let timestamp = context.timestamp;

    eprintln!("Velocity: {}, Mode: {}", velocity, mode);
    Ok(())
}</code></pre>
<h3 id="parameter-parsing"><a class="header" href="#parameter-parsing">Parameter Parsing</a></h3>
<pre><code class="language-rust">fn execute(&amp;mut self, params: Value, _context: TriggerContext) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
    let url = params["url"]
        .as_str()
        .ok_or("Missing 'url' parameter")?;

    let method = params["method"]
        .as_str()
        .unwrap_or("GET");

    // Use parameters...
    Ok(())
}</code></pre>
<h2 id="testing-plugins"><a class="header" href="#testing-plugins">Testing Plugins</a></h2>
<pre><code class="language-rust">#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_plugin_metadata() {
        let plugin = MyPlugin;
        assert_eq!(plugin.name(), "my_plugin");
        assert_eq!(plugin.version(), "1.0.0");
    }

    #[test]
    fn test_plugin_execute() {
        let mut plugin = MyPlugin;
        let params = serde_json::json!({
            "param1": "value1"
        });
        let context = TriggerContext {
            velocity: Some(127),
            current_mode: Some(0),
            timestamp: std::time::Instant::now(),
        };

        assert!(plugin.execute(params, context).is_ok());
    }
}</code></pre>
<h2 id="gui-plugin-manager"><a class="header" href="#gui-plugin-manager">GUI Plugin Manager</a></h2>
<p>Plugins can be managed through the GUI:</p>
<ol>
<li><strong>Discover</strong>: Scan for new plugins</li>
<li><strong>Load/Unload</strong>: Control plugin lifecycle</li>
<li><strong>Enable/Disable</strong>: Toggle plugin availability</li>
<li><strong>Grant/Revoke</strong>: Manage capabilities</li>
<li><strong>Statistics</strong>: View execution counts and latency</li>
</ol>
<h2 id="example-plugins"><a class="header" href="#example-plugins">Example Plugins</a></h2>
<h3 id="http-request-plugin"><a class="header" href="#http-request-plugin">HTTP Request Plugin</a></h3>
<p>See <code>examples/http-plugin/</code> for a complete example that demonstrates:</p>
<ul>
<li>Making HTTP requests (GET, POST, PUT, DELETE)</li>
<li>Custom headers</li>
<li>JSON body</li>
<li>Velocity substitution</li>
<li>Error handling</li>
</ul>
<h3 id="creating-a-simple-logger-plugin"><a class="header" href="#creating-a-simple-logger-plugin">Creating a Simple Logger Plugin</a></h3>
<pre><code class="language-rust">use std::fs::OpenOptions;
use std::io::Write;

pub struct LoggerPlugin {
    log_file: String,
}

impl LoggerPlugin {
    pub fn new() -&gt; Self {
        Self {
            log_file: "/tmp/midimon.log".to_string(),
        }
    }
}

impl ActionPlugin for LoggerPlugin {
    // ... metadata methods ...

    fn capabilities(&amp;self) -&gt; Vec&lt;Capability&gt; {
        vec![Capability::Filesystem]
    }

    fn execute(&amp;mut self, params: Value, context: TriggerContext) -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
        let message = params["message"].as_str().unwrap_or("Event triggered");
        let velocity = context.velocity.unwrap_or(0);

        let mut file = OpenOptions::new()
            .create(true)
            .append(true)
            .open(&amp;self.log_file)?;

        writeln!(file, "[v={}] {}", velocity, message)?;
        Ok(())
    }
}</code></pre>
<h2 id="best-practices-6"><a class="header" href="#best-practices-6">Best Practices</a></h2>
<ol>
<li><strong>Error Handling</strong>: Always return proper errors, never panic</li>
<li><strong>Performance</strong>: Keep <code>execute()</code> fast (&lt;10ms ideal)</li>
<li><strong>Resource Cleanup</strong>: Implement <code>shutdown()</code> for cleanup</li>
<li><strong>Documentation</strong>: Document all parameters in README</li>
<li><strong>Testing</strong>: Write tests for all functionality</li>
<li><strong>Security</strong>: Request minimum necessary capabilities</li>
<li><strong>Logging</strong>: Use <code>eprintln!()</code> for debug output</li>
</ol>
<h2 id="distribution-1"><a class="header" href="#distribution-1">Distribution</a></h2>
<h3 id="binary-naming"><a class="header" href="#binary-naming">Binary Naming</a></h3>
<ul>
<li>macOS: <code>libmyplugin.dylib</code></li>
<li>Linux: <code>libmyplugin.so</code></li>
<li>Windows: <code>myplugin.dll</code></li>
</ul>
<h3 id="directory-structure"><a class="header" href="#directory-structure">Directory Structure</a></h3>
<pre><code>~/.midimon/plugins/
  ‚îî‚îÄ‚îÄ my_plugin/
      ‚îú‚îÄ‚îÄ plugin.toml
      ‚îî‚îÄ‚îÄ libmidimon_my_plugin.dylib
</code></pre>
<h3 id="checksum-verification"><a class="header" href="#checksum-verification">Checksum Verification</a></h3>
<p>Generate SHA256 for security:</p>
<pre><code class="language-bash">shasum -a 256 target/release/libmidimon_my_plugin.dylib
</code></pre>
<p>Add to <code>plugin.toml</code>:</p>
<pre><code class="language-toml">[plugin]
checksum = "abc123..."
</code></pre>
<h2 id="troubleshooting-20"><a class="header" href="#troubleshooting-20">Troubleshooting</a></h2>
<h3 id="plugin-not-discovered"><a class="header" href="#plugin-not-discovered">Plugin Not Discovered</a></h3>
<ul>
<li>Check <code>plugin.toml</code> is valid TOML</li>
<li>Verify <code>~/.midimon/plugins/</code> directory exists</li>
<li>Ensure binary name matches in manifest</li>
</ul>
<h3 id="plugin-fails-to-load"><a class="header" href="#plugin-fails-to-load">Plugin Fails to Load</a></h3>
<ul>
<li>Check binary is compiled for correct platform</li>
<li>Verify <code>crate-type = ["cdylib"]</code> in Cargo.toml</li>
<li>Ensure <code>_create_plugin</code> symbol is exported</li>
</ul>
<h3 id="capability-denied"><a class="header" href="#capability-denied">Capability Denied</a></h3>
<ul>
<li>Check risk level in GUI Plugin Manager</li>
<li>Grant capability manually if needed</li>
<li>Consider using lower-risk alternatives</li>
</ul>
<h2 id="further-reading-2"><a class="header" href="#further-reading-2">Further Reading</a></h2>
<ul>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/docs/PLUGIN_DEVELOPMENT_GUIDE.md">PLUGIN_DEVELOPMENT_GUIDE.md</a> - Comprehensive guide</li>
<li><a href="https://github.com/amiable-dev/midimon/tree/main/examples/http-plugin">HTTP Plugin Example</a> - Reference implementation</li>
<li><a href="development/../reference/plugin-api.html">Plugin API Reference</a> - Complete API documentation</li>
</ul>
<h2 id="community-plugins"><a class="header" href="#community-plugins">Community Plugins</a></h2>
<p>Share your plugins with the community! Submit a PR to add your plugin to the <a href="https://github.com/amiable-dev/midimon-plugins">Plugin Registry</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="wasm-plugins"><a class="header" href="#wasm-plugins">WASM Plugins</a></h1>
<p><strong>Since:</strong> v2.5
<strong>Status:</strong> Production-ready</p>
<p>MIDIMon's WASM (WebAssembly) plugin system provides a secure, sandboxed environment for running third-party plugins with enterprise-grade safety guarantees.</p>
<h2 id="overview-16"><a class="header" href="#overview-16">Overview</a></h2>
<p>WASM plugins offer several advantages over native plugins:</p>
<ul>
<li><strong>Security</strong>: Sandboxed execution with no direct system access</li>
<li><strong>Portability</strong>: Write once, run anywhere (same binary on macOS/Linux/Windows)</li>
<li><strong>Safety</strong>: Memory-safe execution, no undefined behavior</li>
<li><strong>Isolation</strong>: Resource limits prevent runaway plugins</li>
<li><strong>Verification</strong>: Cryptographic signatures ensure plugin integrity</li>
</ul>
<h2 id="architecture"><a class="header" href="#architecture">Architecture</a></h2>
<pre><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  MIDIMon Core                                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  WASM Runtime (wasmtime)                      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Plugin Instance                        ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Fuel metering (CPU limits)           ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Memory limits (128 MB default)       ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - WASI filesystem sandboxing           ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Capability system (network, etc.)    ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  Signature Verification (v2.7)                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Ed25519 digital signatures                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - SHA-256 integrity checking                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Trust management                           ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre>
<h2 id="quick-comparison"><a class="header" href="#quick-comparison">Quick Comparison</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Feature</th><th>Native Plugins (v2.3)</th><th>WASM Plugins (v2.5+)</th></tr></thead><tbody>
<tr><td><strong>Platform</strong></td><td>Platform-specific (.dylib/.so/.dll)</td><td>Universal (.wasm)</td></tr>
<tr><td><strong>Security</strong></td><td>Full system access</td><td>Sandboxed</td></tr>
<tr><td><strong>Memory Safety</strong></td><td>Depends on language</td><td>Guaranteed</td></tr>
<tr><td><strong>Resource Limits</strong></td><td>None</td><td>CPU, memory, I/O</td></tr>
<tr><td><strong>Installation</strong></td><td>Manual copy</td><td>Single file</td></tr>
<tr><td><strong>Verification</strong></td><td>SHA256 checksum</td><td>Cryptographic signatures</td></tr>
<tr><td><strong>Languages</strong></td><td>Rust, C, C++</td><td>Rust, C, C++, Go, Swift, Zig</td></tr>
<tr><td><strong>Startup Time</strong></td><td>Fast (~1ms)</td><td>Fast (~10ms)</td></tr>
<tr><td><strong>Runtime Overhead</strong></td><td>None</td><td>Minimal (~5%)</td></tr>
</tbody></table>
</div>
<h2 id="plugin-lifecycle-1"><a class="header" href="#plugin-lifecycle-1">Plugin Lifecycle</a></h2>
<ol>
<li><strong>Load</strong> - WASM module loaded and validated</li>
<li><strong>Verify</strong> (v2.7) - Cryptographic signature checked</li>
<li><strong>Initialize</strong> - Plugin setup, capabilities granted</li>
<li><strong>Execute</strong> - Plugin called for MIDI events</li>
<li><strong>Shutdown</strong> - Cleanup and resource release</li>
<li><strong>Unload</strong> - Module removed from memory</li>
</ol>
<h2 id="security-features"><a class="header" href="#security-features">Security Features</a></h2>
<h3 id="resource-limiting-v27"><a class="header" href="#resource-limiting-v27">Resource Limiting (v2.7)</a></h3>
<p><strong>Fuel Metering:</strong></p>
<ul>
<li>CPU execution limited to prevent infinite loops</li>
<li>Default: 100 million instructions (~100ms)</li>
<li>Configurable per-plugin</li>
</ul>
<p><strong>Memory Limits:</strong></p>
<ul>
<li>Default: 128 MB</li>
<li>Prevents memory exhaustion</li>
<li>Enforced by WASM runtime</li>
</ul>
<p><strong>Table Growth Limits:</strong></p>
<ul>
<li>Prevents unbounded table allocation</li>
<li>Maximum elements configurable</li>
</ul>
<h3 id="filesystem-sandboxing-v27"><a class="header" href="#filesystem-sandboxing-v27">Filesystem Sandboxing (v2.7)</a></h3>
<p><strong>Directory Preopening:</strong></p>
<ul>
<li>WASI filesystem isolated to specific directories</li>
<li>Default: <code>~/.local/share/midimon/plugin-data/</code> (Linux)</li>
<li>Default: <code>~/Library/Application Support/midimon/plugin-data/</code> (macOS)</li>
<li>Plugins cannot access files outside sandbox</li>
</ul>
<h3 id="cryptographic-signatures-v27"><a class="header" href="#cryptographic-signatures-v27">Cryptographic Signatures (v2.7)</a></h3>
<p><strong>Ed25519 Digital Signatures:</strong></p>
<ul>
<li>Industry-standard cryptography</li>
<li>256-bit security level</li>
<li>Signature file: <code>&lt;plugin&gt;.wasm.sig</code></li>
</ul>
<p><strong>Three-Tier Trust Model:</strong></p>
<ol>
<li><strong>Unsigned</strong> - Development only (optional signatures)</li>
<li><strong>Self-Signed</strong> - Valid signature from any key</li>
<li><strong>Trusted Keys</strong> - Signature must match trusted key list</li>
</ol>
<h2 id="capability-system-1"><a class="header" href="#capability-system-1">Capability System</a></h2>
<p>Plugins request capabilities to access system resources:</p>
<div class="table-wrapper"><table><thead><tr><th>Capability</th><th>Risk</th><th>Description</th></tr></thead><tbody>
<tr><td><code>Network</code></td><td>üü¢ Low</td><td>HTTP requests, WebSocket</td></tr>
<tr><td><code>Filesystem</code></td><td>üü° Medium</td><td>Read/write files (sandboxed)</td></tr>
<tr><td><code>Subprocess</code></td><td>üî¥ High</td><td>Execute shell commands</td></tr>
<tr><td><code>SystemControl</code></td><td>üî¥ High</td><td>System-level operations</td></tr>
</tbody></table>
</div>
<p><strong>Risk Levels:</strong></p>
<ul>
<li>üü¢ <strong>Low</strong>: Auto-granted</li>
<li>üü° <strong>Medium</strong>: User approval required</li>
<li>üî¥ <strong>High</strong>: Explicit approval with warning</li>
</ul>
<h2 id="example-spotify-plugin"><a class="header" href="#example-spotify-plugin">Example: Spotify Plugin</a></h2>
<pre><code class="language-rust">use serde::{Deserialize, Serialize};

#[derive(Serialize, Deserialize)]
struct SpotifyParams {
    action: String,  // "play", "pause", "next", "previous"
}

#[no_mangle]
pub extern "C" fn init() {
    // Plugin initialization
}

#[no_mangle]
pub extern "C" fn execute(params_json: *const u8, params_len: usize) -&gt; i32 {
    // Parse parameters
    let params_bytes = unsafe {
        std::slice::from_raw_parts(params_json, params_len)
    };
    let params: SpotifyParams = serde_json::from_slice(params_bytes)
        .expect("Invalid params");

    // Control Spotify via Web API
    match params.action.as_str() {
        "play" =&gt; spotify_play(),
        "pause" =&gt; spotify_pause(),
        "next" =&gt; spotify_next(),
        "previous" =&gt; spotify_previous(),
        _ =&gt; return 1, // Error
    }

    0 // Success
}</code></pre>
<h2 id="building-wasm-plugins"><a class="header" href="#building-wasm-plugins">Building WASM Plugins</a></h2>
<h3 id="prerequisites-6"><a class="header" href="#prerequisites-6">Prerequisites</a></h3>
<pre><code class="language-bash"># Add WASM target
rustup target add wasm32-wasip1
</code></pre>
<h3 id="project-setup"><a class="header" href="#project-setup">Project Setup</a></h3>
<pre><code class="language-toml"># Cargo.toml
[package]
name = "my-wasm-plugin"
version = "1.0.0"
edition = "2021"

[lib]
crate-type = ["cdylib"]

[dependencies]
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
</code></pre>
<h3 id="build"><a class="header" href="#build">Build</a></h3>
<pre><code class="language-bash">cargo build --target wasm32-wasip1 --release
</code></pre>
<p>Output: <code>target/wasm32-wasip1/release/my_wasm_plugin.wasm</code></p>
<h2 id="plugin-distribution"><a class="header" href="#plugin-distribution">Plugin Distribution</a></h2>
<h3 id="recommended-structure"><a class="header" href="#recommended-structure">Recommended Structure</a></h3>
<pre><code>my-plugin/
‚îú‚îÄ‚îÄ my_plugin.wasm           # WASM binary
‚îú‚îÄ‚îÄ my_plugin.wasm.sig       # Cryptographic signature (v2.7)
‚îú‚îÄ‚îÄ README.md                # Documentation
‚îî‚îÄ‚îÄ LICENSE                  # License file
</code></pre>
<h3 id="signing-your-plugin-v27"><a class="header" href="#signing-your-plugin-v27">Signing Your Plugin (v2.7)</a></h3>
<pre><code class="language-bash"># Generate keypair (one-time)
midimon-sign generate-key ~/.midimon/my-plugin-key

# Sign plugin
midimon-sign sign my_plugin.wasm ~/.midimon/my-plugin-key \
  --name "Your Name" \
  --email "you@example.com"

# Verify signature
midimon-sign verify my_plugin.wasm
</code></pre>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<h3 id="user-installation"><a class="header" href="#user-installation">User Installation</a></h3>
<pre><code class="language-bash"># Copy plugin to MIDIMon directory
mkdir -p ~/.midimon/wasm-plugins/
cp my_plugin.wasm ~/.midimon/wasm-plugins/
cp my_plugin.wasm.sig ~/.midimon/wasm-plugins/  # v2.7
</code></pre>
<h3 id="configuration-3"><a class="header" href="#configuration-3">Configuration</a></h3>
<pre><code class="language-toml"># config.toml
[[modes.mappings]]
trigger = { Note = { note = 60 } }
action = { WasmPlugin = {
    path = "~/.midimon/wasm-plugins/my_plugin.wasm",
    params = {
        "action": "play"
    }
}}
</code></pre>
<h2 id="official-plugins"><a class="header" href="#official-plugins">Official Plugins</a></h2>
<p>MIDIMon provides several official WASM plugins:</p>
<h3 id="spotify-control"><a class="header" href="#spotify-control">Spotify Control</a></h3>
<p><strong>File:</strong> <code>midimon_wasm_spotify.wasm</code>
<strong>Capabilities:</strong> Network
<strong>Actions:</strong> play, pause, next, previous, volume, shuffle, repeat</p>
<h3 id="obs-studio-control"><a class="header" href="#obs-studio-control">OBS Studio Control</a></h3>
<p><strong>File:</strong> <code>midimon_wasm_obs_control.wasm</code>
<strong>Capabilities:</strong> Network
<strong>Actions:</strong> scene switching, recording, streaming, mute/unmute</p>
<h3 id="system-utilities"><a class="header" href="#system-utilities">System Utilities</a></h3>
<p><strong>File:</strong> <code>midimon_wasm_system_utils.wasm</code>
<strong>Capabilities:</strong> SystemControl
<strong>Actions:</strong> lock screen, sleep, notifications, brightness</p>
<h2 id="performance-4"><a class="header" href="#performance-4">Performance</a></h2>
<p><strong>Typical Execution Times:</strong></p>
<ul>
<li>Plugin load: ~10ms (one-time)</li>
<li>First execution: ~5ms (JIT compilation)</li>
<li>Subsequent executions: &lt;1ms</li>
<li>Memory overhead: ~2-5 MB per plugin</li>
</ul>
<p><strong>Optimization Tips:</strong></p>
<ul>
<li>Keep plugins small (&lt;1 MB ideal)</li>
<li>Minimize allocations in hot paths</li>
<li>Use <code>wasm-opt</code> for size/speed optimization</li>
<li>Profile with <code>wasmtime::Store::fuel_consumed()</code></li>
</ul>
<h2 id="troubleshooting-21"><a class="header" href="#troubleshooting-21">Troubleshooting</a></h2>
<h3 id="plugin-fails-to-load-1"><a class="header" href="#plugin-fails-to-load-1">Plugin Fails to Load</a></h3>
<p><strong>Check WASM target:</strong></p>
<pre><code class="language-bash">file my_plugin.wasm
# Should show: WebAssembly (wasm) binary module version 0x1
</code></pre>
<p><strong>Verify WASI compatibility:</strong></p>
<pre><code class="language-bash">wasm-objdump -x my_plugin.wasm | grep -A5 "Import"
# Should show WASI imports like wasi_snapshot_preview1
</code></pre>
<h3 id="out-of-fuel-error"><a class="header" href="#out-of-fuel-error">Out of Fuel Error</a></h3>
<p>Increase fuel limit in configuration:</p>
<pre><code class="language-rust">let mut config = WasmConfig::default();
config.max_fuel = 200_000_000;  // 200M instructions</code></pre>
<h3 id="memory-limit-exceeded"><a class="header" href="#memory-limit-exceeded">Memory Limit Exceeded</a></h3>
<p>Increase memory limit:</p>
<pre><code class="language-rust">config.max_memory_bytes = 256 * 1024 * 1024;  // 256 MB</code></pre>
<h3 id="signature-verification-failed"><a class="header" href="#signature-verification-failed">Signature Verification Failed</a></h3>
<pre><code class="language-bash"># Verify signature manually
midimon-sign verify my_plugin.wasm

# Check if key is trusted
midimon-sign trust list

# Add key to trusted list
midimon-sign trust add &lt;public-key-hex&gt; "Plugin Author"
</code></pre>
<h2 id="next-steps-15"><a class="header" href="#next-steps-15">Next Steps</a></h2>
<ul>
<li><a href="development/wasm-plugin-development.html">WASM Plugin Development Guide</a> - Complete development tutorial</li>
<li><a href="development/plugin-security.html">Plugin Security</a> - Signing and verification</li>
<li><a href="development/plugin-examples.html">Plugin Examples</a> - Real-world examples</li>
<li><a href="development/../reference/wasm-plugin-api.html">Plugin API Reference</a> - API documentation</li>
</ul>
<h2 id="version-history"><a class="header" href="#version-history">Version History</a></h2>
<ul>
<li><strong>v2.5</strong> - Initial WASM plugin runtime</li>
<li><strong>v2.6</strong> - Example plugins (Spotify, OBS, System Utils)</li>
<li><strong>v2.7</strong> - Security hardening:
<ul>
<li>Resource limiting (fuel, memory, tables)</li>
<li>Directory preopening (filesystem sandboxing)</li>
<li>Plugin signing/verification (Ed25519)</li>
</ul>
</li>
</ul>
<h2 id="further-reading-3"><a class="header" href="#further-reading-3">Further Reading</a></h2>
<ul>
<li><a href="https://webassembly.org/docs/security/">WebAssembly Security</a></li>
<li><a href="https://wasi.dev/">WASI Documentation</a></li>
<li><a href="https://docs.wasmtime.dev/">wasmtime Guide</a></li>
<li><a href="https://rustwasm.github.io/docs/book/">Rust and WebAssembly</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="wasm-plugin-development"><a class="header" href="#wasm-plugin-development">WASM Plugin Development</a></h1>
<p>This guide walks you through creating a WASM plugin for MIDIMon from scratch.</p>
<h2 id="prerequisites-7"><a class="header" href="#prerequisites-7">Prerequisites</a></h2>
<h3 id="install-rust-wasm-target"><a class="header" href="#install-rust-wasm-target">Install Rust WASM Target</a></h3>
<pre><code class="language-bash">rustup target add wasm32-wasip1
</code></pre>
<h3 id="verify-installation"><a class="header" href="#verify-installation">Verify Installation</a></h3>
<pre><code class="language-bash">rustup target list | grep wasm32-wasip1
# Should show: wasm32-wasip1 (installed)
</code></pre>
<h2 id="creating-your-first-plugin"><a class="header" href="#creating-your-first-plugin">Creating Your First Plugin</a></h2>
<h3 id="1-project-setup"><a class="header" href="#1-project-setup">1. Project Setup</a></h3>
<pre><code class="language-bash"># Create new library project
cargo new --lib my-midi-plugin
cd my-midi-plugin
</code></pre>
<h3 id="2-configure-cargotoml-1"><a class="header" href="#2-configure-cargotoml-1">2. Configure Cargo.toml</a></h3>
<pre><code class="language-toml">[package]
name = "my-midi-plugin"
version = "1.0.0"
edition = "2021"

[lib]
crate-type = ["cdylib"]  # Required for WASM

[dependencies]
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"

[profile.release]
opt-level = "z"     # Optimize for size
lto = true          # Link-time optimization
codegen-units = 1   # Better optimization
strip = true        # Remove debug symbols
</code></pre>
<h3 id="3-implement-plugin-logic"><a class="header" href="#3-implement-plugin-logic">3. Implement Plugin Logic</a></h3>
<pre><code class="language-rust">// src/lib.rs
use serde::{Deserialize, Serialize};

#[derive(Deserialize)]
struct PluginParams {
    message: String,
}

#[derive(Serialize)]
struct PluginResult {
    success: bool,
    output: String,
}

/// Initialize plugin (called once on load)
#[no_mangle]
pub extern "C" fn init() {
    eprintln!("Plugin initialized");
}

/// Execute plugin action
#[no_mangle]
pub extern "C" fn execute(params_ptr: *const u8, params_len: usize) -&gt; i32 {
    // Parse input parameters
    let params_bytes = unsafe {
        std::slice::from_raw_parts(params_ptr, params_len)
    };

    let params: PluginParams = match serde_json::from_slice(params_bytes) {
        Ok(p) =&gt; p,
        Err(e) =&gt; {
            eprintln!("Failed to parse params: {}", e);
            return 1;  // Error code
        }
    };

    // Plugin logic
    eprintln!("Received message: {}", params.message);

    // Return success
    0
}

/// Cleanup (called before unload)
#[no_mangle]
pub extern "C" fn shutdown() {
    eprintln!("Plugin shutting down");
}</code></pre>
<h3 id="4-build-the-plugin"><a class="header" href="#4-build-the-plugin">4. Build the Plugin</a></h3>
<pre><code class="language-bash">cargo build --target wasm32-wasip1 --release
</code></pre>
<p>Output file: <code>target/wasm32-wasip1/release/my_midi_plugin.wasm</code></p>
<h3 id="5-test-the-plugin"><a class="header" href="#5-test-the-plugin">5. Test the Plugin</a></h3>
<p>Create <code>test_config.toml</code>:</p>
<pre><code class="language-toml">[[modes]]
name = "Default"

[[modes.mappings]]
trigger = { Note = { note = 60 } }  # Middle C
action = { WasmPlugin = {
    path = "target/wasm32-wasip1/release/my_midi_plugin.wasm",
    params = {
        "message": "Hello from MIDI!"
    }
}}
</code></pre>
<h2 id="advanced-examples"><a class="header" href="#advanced-examples">Advanced Examples</a></h2>
<h3 id="example-1-http-request-plugin"><a class="header" href="#example-1-http-request-plugin">Example 1: HTTP Request Plugin</a></h3>
<pre><code class="language-rust">use serde::{Deserialize, Serialize};

#[derive(Deserialize)]
struct HttpParams {
    url: String,
    method: String,
}

#[no_mangle]
pub extern "C" fn execute(params_ptr: *const u8, params_len: usize) -&gt; i32 {
    let params_bytes = unsafe {
        std::slice::from_raw_parts(params_ptr, params_len)
    };

    let params: HttpParams = serde_json::from_slice(params_bytes)
        .expect("Invalid params");

    // Note: Requires Network capability
    // This is a simplified example - real implementation would use reqwest
    eprintln!("Making {} request to {}", params.method, params.url);

    0
}</code></pre>
<p><strong>Required Capability:</strong> <code>Network</code></p>
<h3 id="example-2-file-logger-plugin"><a class="header" href="#example-2-file-logger-plugin">Example 2: File Logger Plugin</a></h3>
<pre><code class="language-rust">use std::fs::OpenOptions;
use std::io::Write;

#[derive(Deserialize)]
struct LogParams {
    message: String,
    level: String,  // "info", "warn", "error"
}

#[no_mangle]
pub extern "C" fn execute(params_ptr: *const u8, params_len: usize) -&gt; i32 {
    let params_bytes = unsafe {
        std::slice::from_raw_parts(params_ptr, params_len)
    };

    let params: LogParams = serde_json::from_slice(params_bytes)
        .expect("Invalid params");

    // Write to sandboxed directory
    // Path: ~/Library/Application Support/midimon/plugin-data/
    let mut file = OpenOptions::new()
        .create(true)
        .append(true)
        .open("/plugin.log")  // Sandboxed path
        .expect("Failed to open log file");

    let timestamp = chrono::Utc::now().to_rfc3339();
    writeln!(file, "[{}] {}: {}",
        timestamp, params.level, params.message)
        .expect("Failed to write log");

    0
}</code></pre>
<p><strong>Required Capability:</strong> <code>Filesystem</code></p>
<h3 id="example-3-velocity-responsive-plugin"><a class="header" href="#example-3-velocity-responsive-plugin">Example 3: Velocity-Responsive Plugin</a></h3>
<pre><code class="language-rust">#[derive(Deserialize)]
struct VelocityParams {
    action: String,
}

#[derive(Deserialize)]
struct TriggerContext {
    velocity: Option&lt;u8&gt;,
    mode: Option&lt;u8&gt;,
}

#[no_mangle]
pub extern "C" fn execute_with_context(
    params_ptr: *const u8,
    params_len: usize,
    context_ptr: *const u8,
    context_len: usize,
) -&gt; i32 {
    let params_bytes = unsafe {
        std::slice::from_raw_parts(params_ptr, params_len)
    };
    let context_bytes = unsafe {
        std::slice::from_raw_parts(context_ptr, context_len)
    };

    let params: VelocityParams = serde_json::from_slice(params_bytes)
        .expect("Invalid params");
    let context: TriggerContext = serde_json::from_slice(context_bytes)
        .expect("Invalid context");

    let velocity = context.velocity.unwrap_or(0);

    // Adjust action based on velocity
    match velocity {
        0..=40 =&gt; eprintln!("Soft press: {}", params.action),
        41..=80 =&gt; eprintln!("Medium press: {}", params.action),
        81..=127 =&gt; eprintln!("Hard press: {}", params.action),
    }

    0
}</code></pre>
<h2 id="capability-declaration"><a class="header" href="#capability-declaration">Capability Declaration</a></h2>
<h3 id="declaring-capabilities"><a class="header" href="#declaring-capabilities">Declaring Capabilities</a></h3>
<p>Capabilities are declared via a metadata function:</p>
<pre><code class="language-rust">#[no_mangle]
pub extern "C" fn capabilities() -&gt; *const u8 {
    let caps = vec!["Network", "Filesystem"];
    let json = serde_json::to_string(&amp;caps).unwrap();
    let boxed = Box::new(json.into_bytes());
    Box::into_raw(boxed) as *const u8
}</code></pre>
<h3 id="available-capabilities"><a class="header" href="#available-capabilities">Available Capabilities</a></h3>
<pre><code class="language-rust">// Low risk - auto-granted
"Network"      // HTTP requests, WebSocket
"Audio"        // Audio device access
"Midi"         // MIDI device access

// Medium risk - user approval
"Filesystem"   // File read/write (sandboxed)

// High risk - explicit approval
"Subprocess"   // Shell command execution
"SystemControl" // System-level operations</code></pre>
<h2 id="resource-limits"><a class="header" href="#resource-limits">Resource Limits</a></h2>
<h3 id="fuel-cpu-limits"><a class="header" href="#fuel-cpu-limits">Fuel (CPU) Limits</a></h3>
<p>Plugins are limited by "fuel" (instruction count):</p>
<pre><code class="language-rust">// MIDIMon automatically limits plugins to 100M instructions
// This prevents infinite loops and excessive CPU usage

// Check remaining fuel (from plugin side):
#[no_mangle]
pub extern "C" fn execute(params_ptr: *const u8, params_len: usize) -&gt; i32 {
    // Your plugin code...

    // MIDIMon will automatically terminate if fuel runs out
    0
}</code></pre>
<p><strong>Default:</strong> 100,000,000 instructions (~100ms execution time)</p>
<h3 id="memory-limits"><a class="header" href="#memory-limits">Memory Limits</a></h3>
<p><strong>Default:</strong> 128 MB per plugin</p>
<pre><code class="language-rust">// MIDIMon enforces memory limits automatically
// Allocations beyond the limit will fail

#[no_mangle]
pub extern "C" fn execute(params_ptr: *const u8, params_len: usize) -&gt; i32 {
    // Be mindful of memory allocations
    let large_buffer = vec![0u8; 1024 * 1024];  // 1 MB - OK
    // let huge_buffer = vec![0u8; 200 * 1024 * 1024];  // 200 MB - Would fail

    0
}</code></pre>
<h3 id="filesystem-sandbox"><a class="header" href="#filesystem-sandbox">Filesystem Sandbox</a></h3>
<p>Plugins with <code>Filesystem</code> capability can only access:</p>
<p><strong>macOS:</strong> <code>~/Library/Application Support/midimon/plugin-data/</code>
<strong>Linux:</strong> <code>~/.local/share/midimon/plugin-data/</code>
<strong>Windows:</strong> <code>%APPDATA%\midimon\plugin-data\</code></p>
<pre><code class="language-rust">// These paths are relative to the sandbox root:
let ok_path = "/my-data.json";          // OK - sandboxed
let ok_path2 = "/subdir/file.txt";      // OK - sandboxed
// let bad_path = "/etc/passwd";         // BLOCKED - outside sandbox
// let bad_path2 = "../../../etc/passwd"; // BLOCKED - path traversal</code></pre>
<h2 id="optimization"><a class="header" href="#optimization">Optimization</a></h2>
<h3 id="size-optimization"><a class="header" href="#size-optimization">Size Optimization</a></h3>
<pre><code class="language-toml"># Cargo.toml
[profile.release]
opt-level = "z"     # Optimize for size
lto = true
codegen-units = 1
strip = true
panic = "abort"     # Smaller panic handling
</code></pre>
<h3 id="post-build-optimization"><a class="header" href="#post-build-optimization">Post-Build Optimization</a></h3>
<pre><code class="language-bash"># Install wasm-opt
cargo install wasm-opt

# Optimize WASM binary
wasm-opt -Oz \
  target/wasm32-wasip1/release/my_plugin.wasm \
  -o target/wasm32-wasip1/release/my_plugin_opt.wasm

# Check size reduction
ls -lh target/wasm32-wasip1/release/*.wasm
</code></pre>
<h3 id="performance-tips-1"><a class="header" href="#performance-tips-1">Performance Tips</a></h3>
<ol>
<li>
<p><strong>Minimize allocations in hot paths</strong></p>
<pre><code class="language-rust">// Bad: allocates on every call
fn process(data: &amp;str) -&gt; String {
    format!("Processed: {}", data)
}

// Good: reuse buffer
fn process(data: &amp;str, buffer: &amp;mut String) {
    buffer.clear();
    buffer.push_str("Processed: ");
    buffer.push_str(data);
}</code></pre>
</li>
<li>
<p><strong>Use static data when possible</strong></p>
<pre><code class="language-rust">// Bad: allocates vec on every call
fn get_options() -&gt; Vec&lt;String&gt; {
    vec!["option1".to_string(), "option2".to_string()]
}

// Good: static slice
const OPTIONS: &amp;[&amp;str] = &amp;["option1", "option2"];</code></pre>
</li>
<li>
<p><strong>Lazy initialization</strong></p>
<pre><code class="language-rust">use std::sync::OnceLock;

static HTTP_CLIENT: OnceLock&lt;reqwest::Client&gt; = OnceLock::new();

fn get_client() -&gt; &amp;'static reqwest::Client {
    HTTP_CLIENT.get_or_init(|| reqwest::Client::new())
}</code></pre>
</li>
</ol>
<h2 id="testing-1"><a class="header" href="#testing-1">Testing</a></h2>
<h3 id="unit-tests"><a class="header" href="#unit-tests">Unit Tests</a></h3>
<pre><code class="language-rust">#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_parse_params() {
        let params = r#"{"message": "test"}"#;
        let parsed: PluginParams = serde_json::from_str(params).unwrap();
        assert_eq!(parsed.message, "test");
    }
}</code></pre>
<h3 id="integration-testing"><a class="header" href="#integration-testing">Integration Testing</a></h3>
<pre><code class="language-bash"># Build plugin
cargo build --target wasm32-wasip1 --release

# Test with wasmtime
wasmtime target/wasm32-wasip1/release/my_plugin.wasm

# Or use MIDIMon directly
midimon --config test_config.toml 0
</code></pre>
<h2 id="debugging-1"><a class="header" href="#debugging-1">Debugging</a></h2>
<h3 id="enable-debug-logging"><a class="header" href="#enable-debug-logging">Enable Debug Logging</a></h3>
<pre><code class="language-rust">#[no_mangle]
pub extern "C" fn execute(params_ptr: *const u8, params_len: usize) -&gt; i32 {
    // Use eprintln! for debug output
    eprintln!("DEBUG: Received {} bytes", params_len);
    eprintln!("DEBUG: Params: {:?}", params);

    // This appears in MIDIMon's stderr
    0
}</code></pre>
<h3 id="run-with-debug-output"><a class="header" href="#run-with-debug-output">Run with Debug Output</a></h3>
<pre><code class="language-bash"># See plugin debug output
DEBUG=1 midimon --config test_config.toml 0 2&gt;&amp;1 | grep "DEBUG:"
</code></pre>
<h3 id="common-issues"><a class="header" href="#common-issues">Common Issues</a></h3>
<p><strong>Plugin not loading:</strong></p>
<pre><code class="language-bash"># Verify WASM format
file target/wasm32-wasip1/release/my_plugin.wasm
# Should show: WebAssembly (wasm) binary module

# Check for WASI imports
wasm-objdump -x target/wasm32-wasip1/release/my_plugin.wasm | grep wasi
</code></pre>
<p><strong>Out of fuel error:</strong></p>
<ul>
<li>Reduce computation in execute()</li>
<li>Move heavy work to init()</li>
<li>Use lazy initialization</li>
</ul>
<p><strong>Memory limit exceeded:</strong></p>
<ul>
<li>Reduce buffer sizes</li>
<li>Use streaming instead of loading entire data</li>
<li>Profile with <code>cargo-bloat</code></li>
</ul>
<h2 id="signing-your-plugin"><a class="header" href="#signing-your-plugin">Signing Your Plugin</a></h2>
<p><strong>See:</strong> <a href="development/plugin-security.html">Plugin Security Guide</a> for complete signing instructions.</p>
<p><strong>Quick reference:</strong></p>
<pre><code class="language-bash"># Generate keypair (one-time)
midimon-sign generate-key ~/.midimon/my-key

# Sign plugin
midimon-sign sign \
  target/wasm32-wasip1/release/my_plugin.wasm \
  ~/.midimon/my-key \
  --name "Your Name" \
  --email "you@example.com"

# Creates: my_plugin.wasm.sig
</code></pre>
<h2 id="distribution-2"><a class="header" href="#distribution-2">Distribution</a></h2>
<h3 id="package-structure-1"><a class="header" href="#package-structure-1">Package Structure</a></h3>
<pre><code>my-midi-plugin/
‚îú‚îÄ‚îÄ my_plugin.wasm           # Binary
‚îú‚îÄ‚îÄ my_plugin.wasm.sig       # Signature
‚îú‚îÄ‚îÄ README.md                # Documentation
‚îú‚îÄ‚îÄ LICENSE                  # License
‚îî‚îÄ‚îÄ examples/
    ‚îî‚îÄ‚îÄ config.toml          # Example configuration
</code></pre>
<h3 id="readme-template"><a class="header" href="#readme-template">README Template</a></h3>
<pre><code class="language-markdown"># My MIDI Plugin

Brief description of what your plugin does.

## Installation

1. Download `my_plugin.wasm` and `my_plugin.wasm.sig`
2. Copy to `~/.midimon/wasm-plugins/`
3. Add to configuration (see example)

## Configuration

\```toml
[[modes.mappings]]
trigger = { Note = { note = 60 } }
action = { WasmPlugin = {
    path = "~/.midimon/wasm-plugins/my_plugin.wasm",
    params = {
        "param1": "value1"
    }
}}
\```

## Parameters

- `param1`: Description
- `param2`: Description

## Capabilities

- Network: For HTTP requests
- Filesystem: For data persistence

## License

MIT
</code></pre>
<h2 id="next-steps-16"><a class="header" href="#next-steps-16">Next Steps</a></h2>
<ul>
<li><a href="development/plugin-security.html">Plugin Security</a> - Signing and verification</li>
<li><a href="development/plugin-examples.html">Plugin Examples</a> - Real-world examples</li>
<li><a href="development/wasm-plugins.html">WASM Plugins Overview</a> - Architecture and concepts</li>
</ul>
<h2 id="resources"><a class="header" href="#resources">Resources</a></h2>
<ul>
<li><a href="https://rustwasm.github.io/docs/book/">Rust and WebAssembly Book</a></li>
<li><a href="https://wasi.dev/">WASI Documentation</a></li>
<li><a href="https://docs.wasmtime.dev/">wasmtime Guide</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="plugin-security"><a class="header" href="#plugin-security">Plugin Security</a></h1>
<p><strong>Since:</strong> v2.7
<strong>Status:</strong> Production-ready</p>
<p>MIDIMon provides enterprise-grade security for WASM plugins through cryptographic signatures, resource limiting, and filesystem sandboxing.</p>
<h2 id="security-architecture"><a class="header" href="#security-architecture">Security Architecture</a></h2>
<pre><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Security Layers                                ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  Layer 1: Cryptographic Verification     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Ed25519 digital signatures             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - SHA-256 integrity checking             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Trust management                       ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  Layer 2: Resource Limiting               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - CPU fuel metering (100M instructions)  ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Memory limits (128 MB)                 ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Table growth limits                    ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  Layer 3: Filesystem Sandboxing           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Directory preopening (WASI)            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Path validation                        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - No escape from sandbox                 ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  Layer 4: Capability System               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Explicit permission model              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Risk-based approval                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  - Revocable grants                       ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre>
<h2 id="plugin-signing"><a class="header" href="#plugin-signing">Plugin Signing</a></h2>
<h3 id="overview-17"><a class="header" href="#overview-17">Overview</a></h3>
<p>Plugin signing uses <strong>Ed25519 digital signatures</strong> to ensure:</p>
<ul>
<li><strong>Authenticity</strong>: Plugin comes from claimed developer</li>
<li><strong>Integrity</strong>: Plugin hasn't been tampered with</li>
<li><strong>Non-repudiation</strong>: Developer cannot deny signing</li>
</ul>
<h3 id="cli-tool-midimon-sign"><a class="header" href="#cli-tool-midimon-sign">CLI Tool: midimon-sign</a></h3>
<h4 id="installation-1"><a class="header" href="#installation-1">Installation</a></h4>
<pre><code class="language-bash"># Build with signing support
cargo build --package midimon-daemon \
  --bin midimon-sign \
  --features plugin-signing \
  --release
</code></pre>
<p>Binary location: <code>target/release/midimon-sign</code></p>
<h3 id="signing-workflow"><a class="header" href="#signing-workflow">Signing Workflow</a></h3>
<h4 id="1-generate-keypair"><a class="header" href="#1-generate-keypair">1. Generate Keypair</a></h4>
<pre><code class="language-bash">midimon-sign generate-key ~/.midimon/my-plugin-key
</code></pre>
<p><strong>Output:</strong></p>
<ul>
<li><code>~/.midimon/my-plugin-key.private</code> (32 bytes, keep secure!)</li>
<li><code>~/.midimon/my-plugin-key.public</code> (hex-encoded)</li>
<li>Public key displayed in terminal</li>
</ul>
<p><strong>Example output:</strong></p>
<pre><code>Generating Ed25519 keypair...
‚úì Keypair generated successfully!

Private key: /Users/you/.midimon/my-plugin-key.private
Public key:  /Users/you/.midimon/my-plugin-key.public

Public key (hex): 3dab8dbfaeb804085e879791d395d6afabe268535a2bc98ea70afa1edd291cca

‚ö†Ô∏è  Keep your private key secure and never share it!
</code></pre>
<h4 id="2-sign-plugin"><a class="header" href="#2-sign-plugin">2. Sign Plugin</a></h4>
<pre><code class="language-bash">midimon-sign sign my_plugin.wasm ~/.midimon/my-plugin-key \
  --name "Your Name" \
  --email "you@example.com"
</code></pre>
<p><strong>Creates:</strong> <code>my_plugin.wasm.sig</code> (JSON signature metadata)</p>
<p><strong>Example signature file:</strong></p>
<pre><code class="language-json">{
  "version": 1,
  "algorithm": "Ed25519",
  "plugin_hash": "a1b2c3d4...",
  "plugin_size": 123456,
  "public_key": "3dab8dbf...",
  "signature": "9f8e7d6c...",
  "signed_at": "2025-11-19T08:59:12Z",
  "developer": {
    "name": "Your Name",
    "email": "you@example.com"
  }
}
</code></pre>
<h4 id="3-verify-signature"><a class="header" href="#3-verify-signature">3. Verify Signature</a></h4>
<pre><code class="language-bash">midimon-sign verify my_plugin.wasm
</code></pre>
<p><strong>Example output:</strong></p>
<pre><code>Verifying plugin: my_plugin.wasm
Signature file: "my_plugin.wasm.sig"
Trusted keys: 1

Signature Details:
  Version:     1
  Algorithm:   Ed25519
  Signed at:   2025-11-19T08:59:12Z
  Developer:   Your Name &lt;you@example.com&gt;
  Public key:  3dab8dbf...

‚úì Signature verified successfully!
‚úì Plugin signed by trusted key
</code></pre>
<h4 id="4-manage-trusted-keys"><a class="header" href="#4-manage-trusted-keys">4. Manage Trusted Keys</a></h4>
<p><strong>Add trusted key:</strong></p>
<pre><code class="language-bash">midimon-sign trust add 3dab8dbfaeb804085e879791d395d6afabe268535a2bc98ea70afa1edd291cca "Official Plugin"
</code></pre>
<p><strong>List trusted keys:</strong></p>
<pre><code class="language-bash">midimon-sign trust list
</code></pre>
<p><strong>Remove trusted key:</strong></p>
<pre><code class="language-bash">midimon-sign trust remove 3dab8dbf...
</code></pre>
<p><strong>Trusted keys file:</strong> <code>~/.config/midimon/trusted_keys.toml</code></p>
<h2 id="trust-models"><a class="header" href="#trust-models">Trust Models</a></h2>
<p>MIDIMon supports three trust levels:</p>
<h3 id="level-1-unsigned-development"><a class="header" href="#level-1-unsigned-development">Level 1: Unsigned (Development)</a></h3>
<p><strong>Use case:</strong> Development and testing</p>
<p><strong>Configuration:</strong></p>
<pre><code class="language-rust">let mut config = WasmConfig::default();
config.require_signature = false;  // Default</code></pre>
<p><strong>Behavior:</strong></p>
<ul>
<li>No signature required</li>
<li>Plugin loads without verification</li>
<li>Suitable for development only</li>
</ul>
<h3 id="level-2-self-signed"><a class="header" href="#level-2-self-signed">Level 2: Self-Signed</a></h3>
<p><strong>Use case:</strong> Personal plugins, one-off scripts</p>
<p><strong>Configuration:</strong></p>
<pre><code class="language-rust">let mut config = WasmConfig::default();
config.require_signature = true;
config.allow_self_signed = true;</code></pre>
<p><strong>Behavior:</strong></p>
<ul>
<li>Signature must be valid (cryptographic check)</li>
<li>Any key accepted (no trust check)</li>
<li>Ensures binary integrity</li>
<li>Good for personal use</li>
</ul>
<h3 id="level-3-trusted-keys-production"><a class="header" href="#level-3-trusted-keys-production">Level 3: Trusted Keys (Production)</a></h3>
<p><strong>Use case:</strong> Production deployments, marketplace plugins</p>
<p><strong>Configuration:</strong></p>
<pre><code class="language-rust">let mut config = WasmConfig::default();
config.require_signature = true;
config.allow_self_signed = false;  // Default</code></pre>
<p><strong>Behavior:</strong></p>
<ul>
<li>Signature must be valid</li>
<li>Public key must be in trusted list</li>
<li>Full security model</li>
<li>Recommended for production</li>
</ul>
<h2 id="security-best-practices"><a class="header" href="#security-best-practices">Security Best Practices</a></h2>
<h3 id="for-plugin-developers"><a class="header" href="#for-plugin-developers">For Plugin Developers</a></h3>
<ol>
<li>
<p><strong>Protect Private Keys</strong></p>
<pre><code class="language-bash"># Set secure permissions
chmod 600 ~/.midimon/my-plugin-key.private

# Never commit to version control
echo "*.private" &gt;&gt; .gitignore
</code></pre>
</li>
<li>
<p><strong>Sign Every Release</strong></p>
<pre><code class="language-bash"># Include signing in your release script
cargo build --target wasm32-wasip1 --release
midimon-sign sign \
  target/wasm32-wasip1/release/my_plugin.wasm \
  ~/.midimon/my-key \
  --name "Your Name" --email "you@example.com"
</code></pre>
</li>
<li>
<p><strong>Publish Public Key</strong></p>
<ul>
<li>Include in README</li>
<li>Post on official website</li>
<li>Add to plugin registry</li>
</ul>
</li>
<li>
<p><strong>Use Separate Keys per Project</strong></p>
<pre><code class="language-bash"># One key per plugin project
midimon-sign generate-key ~/.midimon/plugin-a-key
midimon-sign generate-key ~/.midimon/plugin-b-key
</code></pre>
</li>
</ol>
<h3 id="for-end-users"><a class="header" href="#for-end-users">For End Users</a></h3>
<ol>
<li>
<p><strong>Verify Before Trust</strong></p>
<pre><code class="language-bash"># Always verify signature first
midimon-sign verify downloaded_plugin.wasm

# Check developer information
# Only trust if matches expected developer
</code></pre>
</li>
<li>
<p><strong>Add Keys Carefully</strong></p>
<pre><code class="language-bash"># Only add keys from verified sources
# Check plugin author's website for official key
midimon-sign trust add &lt;key&gt; "Official Project Name"
</code></pre>
</li>
<li>
<p><strong>Audit Trusted Keys</strong></p>
<pre><code class="language-bash"># Regularly review trusted keys
midimon-sign trust list

# Remove unused keys
midimon-sign trust remove &lt;key&gt;
</code></pre>
</li>
<li>
<p><strong>Use Strict Mode in Production</strong></p>
<pre><code class="language-toml"># ~/.config/midimon/config.toml
[wasm]
require_signature = true
allow_self_signed = false  # Strict mode
</code></pre>
</li>
</ol>
<h2 id="resource-limiting"><a class="header" href="#resource-limiting">Resource Limiting</a></h2>
<h3 id="cpu-limits-fuel-metering"><a class="header" href="#cpu-limits-fuel-metering">CPU Limits (Fuel Metering)</a></h3>
<p><strong>Default:</strong> 100,000,000 instructions (~100ms)</p>
<p><strong>What it prevents:</strong></p>
<ul>
<li>Infinite loops</li>
<li>Excessive CPU usage</li>
<li>Denial of service</li>
</ul>
<p><strong>How it works:</strong></p>
<pre><code>Every WASM instruction consumes 1 unit of fuel
Plugin execution stops when fuel exhausted
</code></pre>
<p><strong>Configuration:</strong></p>
<pre><code class="language-rust">let mut config = WasmConfig::default();
config.max_fuel = 200_000_000;  // 200M instructions</code></pre>
<p><strong>Example:</strong></p>
<pre><code class="language-rust">// This would exceed fuel limit:
#[no_mangle]
pub extern "C" fn execute(...) -&gt; i32 {
    loop {
        // Infinite loop - blocked by fuel limit
        std::thread::sleep(Duration::from_millis(1));
    }
}
// MIDIMon automatically terminates after ~100ms</code></pre>
<h3 id="memory-limits-1"><a class="header" href="#memory-limits-1">Memory Limits</a></h3>
<p><strong>Default:</strong> 128 MB per plugin</p>
<p><strong>What it prevents:</strong></p>
<ul>
<li>Memory exhaustion</li>
<li>Out-of-memory crashes</li>
<li>Resource hogging</li>
</ul>
<p><strong>Configuration:</strong></p>
<pre><code class="language-rust">let mut config = WasmConfig::default();
config.max_memory_bytes = 256 * 1024 * 1024;  // 256 MB</code></pre>
<p><strong>Example:</strong></p>
<pre><code class="language-rust">#[no_mangle]
pub extern "C" fn execute(...) -&gt; i32 {
    // OK - 10 MB allocation
    let buffer = vec![0u8; 10 * 1024 * 1024];

    // BLOCKED - 200 MB exceeds limit
    // let huge = vec![0u8; 200 * 1024 * 1024];
    // ^ This allocation would fail

    0
}</code></pre>
<h3 id="table-growth-limits"><a class="header" href="#table-growth-limits">Table Growth Limits</a></h3>
<p><strong>Default:</strong> 10,000 elements</p>
<p><strong>What it prevents:</strong></p>
<ul>
<li>Unbounded table allocation</li>
<li>Memory exhaustion via tables</li>
<li>DoS attacks</li>
</ul>
<p><strong>Configuration:</strong></p>
<pre><code class="language-rust">let mut config = WasmConfig::default();
config.max_table_elements = 20_000;</code></pre>
<h2 id="filesystem-sandboxing"><a class="header" href="#filesystem-sandboxing">Filesystem Sandboxing</a></h2>
<h3 id="directory-preopening"><a class="header" href="#directory-preopening">Directory Preopening</a></h3>
<p>Plugins with <code>Filesystem</code> capability can only access a specific directory:</p>
<p><strong>macOS:</strong></p>
<pre><code>~/Library/Application Support/midimon/plugin-data/
</code></pre>
<p><strong>Linux:</strong></p>
<pre><code>~/.local/share/midimon/plugin-data/
</code></pre>
<p><strong>Windows:</strong></p>
<pre><code>%APPDATA%\midimon\plugin-data\
</code></pre>
<h3 id="whats-blocked"><a class="header" href="#whats-blocked">What's Blocked</a></h3>
<pre><code class="language-rust">// ‚úÖ ALLOWED - within sandbox
std::fs::write("/my-data.json", data)?;
std::fs::write("/subdir/file.txt", data)?;

// ‚ùå BLOCKED - path traversal
std::fs::write("/../../../etc/passwd", data)?;

// ‚ùå BLOCKED - absolute path outside sandbox
std::fs::write("/etc/passwd", data)?;

// ‚ùå BLOCKED - home directory escape
std::fs::write("~/other-file.txt", data)?;</code></pre>
<h3 id="how-it-works-2"><a class="header" href="#how-it-works-2">How It Works</a></h3>
<ol>
<li><strong>WASI Preopening</strong>: MIDIMon pre-opens the plugin data directory</li>
<li><strong>Path Mapping</strong>: All plugin paths mapped to sandbox root</li>
<li><strong>Validation</strong>: WASI runtime blocks access outside preopened directories</li>
<li><strong>No Escape</strong>: Path traversal attempts automatically blocked</li>
</ol>
<h2 id="capability-system-2"><a class="header" href="#capability-system-2">Capability System</a></h2>
<h3 id="permission-model"><a class="header" href="#permission-model">Permission Model</a></h3>
<p>Plugins must explicitly request capabilities:</p>
<pre><code class="language-rust">// In plugin code
#[no_mangle]
pub extern "C" fn capabilities() -&gt; *const u8 {
    let caps = vec!["Network", "Filesystem"];
    let json = serde_json::to_string(&amp;caps).unwrap();
    // ... return JSON
}</code></pre>
<h3 id="risk-levels-1"><a class="header" href="#risk-levels-1">Risk Levels</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Capability</th><th>Risk</th><th>Auto-Grant</th><th>Requires Approval</th></tr></thead><tbody>
<tr><td>Network</td><td>üü¢ Low</td><td>Yes</td><td>No</td></tr>
<tr><td>Audio</td><td>üü¢ Low</td><td>Yes</td><td>No</td></tr>
<tr><td>Midi</td><td>üü¢ Low</td><td>Yes</td><td>No</td></tr>
<tr><td>Filesystem</td><td>üü° Medium</td><td>No</td><td>Yes</td></tr>
<tr><td>Subprocess</td><td>üî¥ High</td><td>No</td><td>Yes + Warning</td></tr>
<tr><td>SystemControl</td><td>üî¥ High</td><td>No</td><td>Yes + Warning</td></tr>
</tbody></table>
</div>
<h3 id="granting-capabilities"><a class="header" href="#granting-capabilities">Granting Capabilities</a></h3>
<p><strong>Via GUI:</strong> Plugin Manager ‚Üí Select Plugin ‚Üí Grant Capability</p>
<p><strong>Via Config:</strong></p>
<pre><code class="language-toml">[plugins.my_plugin]
granted_capabilities = ["Network", "Filesystem"]
</code></pre>
<h2 id="threat-model"><a class="header" href="#threat-model">Threat Model</a></h2>
<h3 id="threats-mitigated"><a class="header" href="#threats-mitigated">Threats Mitigated</a></h3>
<p>‚úÖ <strong>Binary Tampering</strong></p>
<ul>
<li><strong>Mitigation:</strong> SHA-256 hash verification</li>
<li><strong>Detection:</strong> Signature validation fails if binary modified</li>
</ul>
<p>‚úÖ <strong>Malicious Plugin Injection</strong></p>
<ul>
<li><strong>Mitigation:</strong> Ed25519 signature verification</li>
<li><strong>Detection:</strong> Invalid signature rejected</li>
</ul>
<p>‚úÖ <strong>Man-in-the-Middle</strong></p>
<ul>
<li><strong>Mitigation:</strong> Cryptographic signatures</li>
<li><strong>Detection:</strong> Signature doesn't match binary</li>
</ul>
<p>‚úÖ <strong>Supply Chain Attacks</strong></p>
<ul>
<li><strong>Mitigation:</strong> Trusted key model</li>
<li><strong>Detection:</strong> Untrusted keys rejected</li>
</ul>
<p>‚úÖ <strong>Resource Exhaustion (DoS)</strong></p>
<ul>
<li><strong>Mitigation:</strong> Fuel metering, memory limits</li>
<li><strong>Detection:</strong> Automatic termination</li>
</ul>
<p>‚úÖ <strong>Filesystem Access</strong></p>
<ul>
<li><strong>Mitigation:</strong> Directory sandboxing</li>
<li><strong>Detection:</strong> WASI blocks access</li>
</ul>
<p>‚úÖ <strong>Privilege Escalation</strong></p>
<ul>
<li><strong>Mitigation:</strong> Capability system</li>
<li><strong>Detection:</strong> Capability checks</li>
</ul>
<h3 id="threats-not-mitigated"><a class="header" href="#threats-not-mitigated">Threats NOT Mitigated</a></h3>
<p>‚ö†Ô∏è <strong>Side-Channel Attacks</strong></p>
<ul>
<li>Timing attacks possible</li>
<li>Mitigation: Careful crypto implementation</li>
</ul>
<p>‚ö†Ô∏è <strong>Social Engineering</strong></p>
<ul>
<li>User could trust malicious key</li>
<li>Mitigation: User education</li>
</ul>
<p>‚ö†Ô∏è <strong>Key Compromise</strong></p>
<ul>
<li>Stolen private key can sign malicious plugins</li>
<li>Mitigation: Hardware security keys, key rotation</li>
</ul>
<h2 id="security-checklist"><a class="header" href="#security-checklist">Security Checklist</a></h2>
<h3 id="for-plugin-developers-1"><a class="header" href="#for-plugin-developers-1">For Plugin Developers</a></h3>
<ul>
<li><input disabled="" type="checkbox"/>
Generate unique keypair for project</li>
<li><input disabled="" type="checkbox"/>
Protect private key (chmod 600, never commit)</li>
<li><input disabled="" type="checkbox"/>
Sign every release</li>
<li><input disabled="" type="checkbox"/>
Publish public key on official channels</li>
<li><input disabled="" type="checkbox"/>
Request minimum necessary capabilities</li>
<li><input disabled="" type="checkbox"/>
Include security disclosure policy</li>
<li><input disabled="" type="checkbox"/>
Test with strict mode enabled</li>
<li><input disabled="" type="checkbox"/>
Document all security considerations</li>
</ul>
<h3 id="for-end-users-1"><a class="header" href="#for-end-users-1">For End Users</a></h3>
<ul>
<li><input disabled="" type="checkbox"/>
Only download plugins from trusted sources</li>
<li><input disabled="" type="checkbox"/>
Always verify signatures before use</li>
<li><input disabled="" type="checkbox"/>
Check developer information matches expected</li>
<li><input disabled="" type="checkbox"/>
Only add keys from verified sources</li>
<li><input disabled="" type="checkbox"/>
Enable strict mode in production</li>
<li><input disabled="" type="checkbox"/>
Regularly audit trusted keys</li>
<li><input disabled="" type="checkbox"/>
Review capability requests</li>
<li><input disabled="" type="checkbox"/>
Keep MIDIMon updated</li>
</ul>
<h2 id="troubleshooting-22"><a class="header" href="#troubleshooting-22">Troubleshooting</a></h2>
<h3 id="signature-verification-failed-1"><a class="header" href="#signature-verification-failed-1">Signature Verification Failed</a></h3>
<p><strong>Check signature exists:</strong></p>
<pre><code class="language-bash">ls -la my_plugin.wasm.sig
</code></pre>
<p><strong>Verify signature manually:</strong></p>
<pre><code class="language-bash">midimon-sign verify my_plugin.wasm
</code></pre>
<p><strong>Common causes:</strong></p>
<ul>
<li>Binary modified after signing</li>
<li>Signature file missing</li>
<li>Wrong public key used</li>
<li>Corrupted signature file</li>
</ul>
<h3 id="key-not-trusted"><a class="header" href="#key-not-trusted">Key Not Trusted</a></h3>
<p><strong>List trusted keys:</strong></p>
<pre><code class="language-bash">midimon-sign trust list
</code></pre>
<p><strong>Add key:</strong></p>
<pre><code class="language-bash">midimon-sign trust add &lt;public-key&gt; "Plugin Name"
</code></pre>
<p><strong>Verify key matches:</strong></p>
<pre><code class="language-bash"># Compare key in signature vs. expected
cat my_plugin.wasm.sig | jq '.public_key'
</code></pre>
<h3 id="out-of-fuel"><a class="header" href="#out-of-fuel">Out of Fuel</a></h3>
<p><strong>Symptoms:</strong></p>
<ul>
<li>Plugin terminates mid-execution</li>
<li>"fuel exhausted" error</li>
</ul>
<p><strong>Solutions:</strong></p>
<pre><code class="language-rust">// Increase fuel limit
let mut config = WasmConfig::default();
config.max_fuel = 200_000_000;

// Or optimize plugin code
// - Reduce loop iterations
// - Move heavy work to init()
// - Use lazy initialization</code></pre>
<h2 id="advanced-topics"><a class="header" href="#advanced-topics">Advanced Topics</a></h2>
<h3 id="hardware-security-keys"><a class="header" href="#hardware-security-keys">Hardware Security Keys</a></h3>
<p>For maximum security, use hardware keys (YubiKey, etc.):</p>
<pre><code class="language-bash"># Generate key on hardware device
# (Implementation depends on HSM/hardware)

# Sign using hardware key
midimon-sign sign my_plugin.wasm \
  --hardware-key /dev/yubikey \
  --name "Your Name" --email "you@example.com"
</code></pre>
<h3 id="key-rotation"><a class="header" href="#key-rotation">Key Rotation</a></h3>
<pre><code class="language-bash"># Generate new key
midimon-sign generate-key ~/.midimon/my-plugin-key-v2

# Sign with new key
midimon-sign sign my_plugin.wasm ~/.midimon/my-plugin-key-v2 \
  --name "Your Name" --email "you@example.com"

# Announce rotation to users
# Include both old and new public keys in transition period
</code></pre>
<h3 id="multi-signature"><a class="header" href="#multi-signature">Multi-Signature</a></h3>
<p>For critical plugins, require multiple signatures:</p>
<pre><code class="language-bash"># Sign with first key
midimon-sign sign my_plugin.wasm ~/.midimon/key1 \
  --name "Developer 1" --email "dev1@example.com"

# Co-sign with second key
midimon-sign cosign my_plugin.wasm ~/.midimon/key2 \
  --name "Developer 2" --email "dev2@example.com"

# Verify requires both signatures
</code></pre>
<h2 id="further-reading-4"><a class="header" href="#further-reading-4">Further Reading</a></h2>
<ul>
<li><a href="https://tools.ietf.org/html/rfc8032">Ed25519 Specification (RFC 8032)</a></li>
<li><a href="https://github.com/WebAssembly/WASI/blob/main/docs/WASI-security-model.md">WASI Security Model</a></li>
<li><a href="https://webassembly.org/docs/security/">WebAssembly Security</a></li>
<li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html">Cryptographic Signing Best Practices</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="plugin-examples"><a class="header" href="#plugin-examples">Plugin Examples</a></h1>
<p>MIDIMon includes three official WASM plugins that demonstrate real-world integration patterns. All plugins are signed with the official MIDIMon team key and include full source code.</p>
<h2 id="official-plugins-1"><a class="header" href="#official-plugins-1">Official Plugins</a></h2>
<h3 id="spotify-web-api-plugin"><a class="header" href="#spotify-web-api-plugin">Spotify Web API Plugin</a></h3>
<p><strong>File:</strong> <code>midimon_wasm_spotify.wasm</code>
<strong>Capabilities:</strong> Network
<strong>Status:</strong> Production-ready</p>
<p>Control Spotify playback directly from your MIDI controller.</p>
<h4 id="features-1"><a class="header" href="#features-1">Features</a></h4>
<ul>
<li>Play/Pause control</li>
<li>Track navigation (next/previous)</li>
<li>Volume control</li>
<li>Shuffle toggle</li>
<li>Repeat mode toggle</li>
<li>Get current playback state</li>
</ul>
<h4 id="setup"><a class="header" href="#setup">Setup</a></h4>
<ol>
<li>
<p><strong>Get Spotify API Credentials</strong></p>
<ul>
<li>Visit <a href="https://developer.spotify.com/dashboard">Spotify Developer Dashboard</a></li>
<li>Create an app</li>
<li>Note Client ID and Client Secret</li>
<li>Add redirect URI: <code>http://localhost:8888/callback</code></li>
</ul>
</li>
<li>
<p><strong>Authenticate</strong></p>
<pre><code class="language-bash"># First-time setup (opens browser for OAuth)
spotify-auth --client-id YOUR_ID --client-secret YOUR_SECRET
</code></pre>
</li>
<li>
<p><strong>Configuration</strong></p>
<pre><code class="language-toml"># Play/Pause
[[modes.mappings]]
trigger = { Note = { note = 60 } }
action = { WasmPlugin = {
    path = "~/.midimon/wasm-plugins/midimon_wasm_spotify.wasm",
    params = {
        "action": "play_pause"
    }
}}

# Next track
[[modes.mappings]]
trigger = { Note = { note = 61 } }
action = { WasmPlugin = {
    path = "~/.midimon/wasm-plugins/midimon_wasm_spotify.wasm",
    params = {
        "action": "next"
    }
}}

# Previous track
[[modes.mappings]]
trigger = { Note = { note = 59 } }
action = { WasmPlugin = {
    path = "~/.midimon/wasm-plugins/midimon_wasm_spotify.wasm",
    params = {
        "action": "previous"
    }
}}

# Volume control (velocity-sensitive)
[[modes.mappings]]
trigger = { Note = { note = 62 } }
action = { WasmPlugin = {
    path = "~/.midimon/wasm-plugins/midimon_wasm_spotify.wasm",
    params = {
        "action": "volume",
        "level": "{velocity}"  # 0-127 mapped to 0-100%
    }
}}
</code></pre>
</li>
</ol>
<h4 id="available-actions"><a class="header" href="#available-actions">Available Actions</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Action</th><th>Parameters</th><th>Description</th></tr></thead><tbody>
<tr><td><code>play</code></td><td>None</td><td>Resume playback</td></tr>
<tr><td><code>pause</code></td><td>None</td><td>Pause playback</td></tr>
<tr><td><code>play_pause</code></td><td>None</td><td>Toggle play/pause</td></tr>
<tr><td><code>next</code></td><td>None</td><td>Skip to next track</td></tr>
<tr><td><code>previous</code></td><td>None</td><td>Previous track</td></tr>
<tr><td><code>volume</code></td><td><code>level: 0-127</code></td><td>Set volume (maps to 0-100%)</td></tr>
<tr><td><code>shuffle</code></td><td>None</td><td>Toggle shuffle</td></tr>
<tr><td><code>repeat</code></td><td><code>mode: "off"|"track"|"context"</code></td><td>Set repeat mode</td></tr>
<tr><td><code>get_state</code></td><td>None</td><td>Get current playback state</td></tr>
</tbody></table>
</div>
<h4 id="advanced-velocity-sensitive-volume"><a class="header" href="#advanced-velocity-sensitive-volume">Advanced: Velocity-Sensitive Volume</a></h4>
<pre><code class="language-toml">[[modes.mappings]]
trigger = { VelocityRange = {
    note = 62,
    ranges = [
        { min = 0, max = 40, action_index = 0 },    # Soft: -10%
        { min = 41, max = 80, action_index = 1 },   # Medium: no change
        { min = 81, max = 127, action_index = 2 }   # Hard: +10%
    ]
}}
actions = [
    { WasmPlugin = {
        path = "~/.midimon/wasm-plugins/midimon_wasm_spotify.wasm",
        params = { "action": "volume", "delta": "-10" }
    }},
    { WasmPlugin = {
        path = "~/.midimon/wasm-plugins/midimon_wasm_spotify.wasm",
        params = { "action": "get_state" }
    }},
    { WasmPlugin = {
        path = "~/.midimon/wasm-plugins/midimon_wasm_spotify.wasm",
        params = { "action": "volume", "delta": "+10" }
    }}
]
</code></pre>
<hr />
<h3 id="obs-studio-control-plugin"><a class="header" href="#obs-studio-control-plugin">OBS Studio Control Plugin</a></h3>
<p><strong>File:</strong> <code>midimon_wasm_obs_control.wasm</code>
<strong>Capabilities:</strong> Network
<strong>Status:</strong> Production-ready</p>
<p>Control OBS Studio streaming/recording via WebSocket.</p>
<h4 id="features-2"><a class="header" href="#features-2">Features</a></h4>
<ul>
<li>Scene switching</li>
<li>Start/Stop streaming</li>
<li>Start/Stop recording</li>
<li>Source mute/unmute</li>
<li>Filter toggle</li>
<li>Transition control</li>
</ul>
<h4 id="setup-1"><a class="header" href="#setup-1">Setup</a></h4>
<ol>
<li>
<p><strong>Enable OBS WebSocket</strong></p>
<ul>
<li>OBS Studio ‚Üí Tools ‚Üí WebSocket Server Settings</li>
<li>Enable WebSocket server</li>
<li>Set password (optional but recommended)</li>
<li>Note port (default: 4455)</li>
</ul>
</li>
<li>
<p><strong>Configuration</strong></p>
<pre><code class="language-toml"># Scene switching
[[modes.mappings]]
trigger = { Note = { note = 48 } }
action = { WasmPlugin = {
    path = "~/.midimon/wasm-plugins/midimon_wasm_obs_control.wasm",
    params = {
        "action": "set_scene",
        "scene_name": "Gaming",
        "host": "localhost:4455",
        "password": "your_password"  # Optional
    }
}}

# Start streaming
[[modes.mappings]]
trigger = { Note = { note = 49 } }
action = { WasmPlugin = {
    path = "~/.midimon/wasm-plugins/midimon_wasm_obs_control.wasm",
    params = {
        "action": "start_streaming",
        "host": "localhost:4455"
    }
}}

# Stop streaming
[[modes.mappings]]
trigger = { Note = { note = 50 } }
action = { WasmPlugin = {
    path = "~/.midimon/wasm-plugins/midimon_wasm_obs_control.wasm",
    params = {
        "action": "stop_streaming",
        "host": "localhost:4455"
    }
}}

# Toggle mic mute
[[modes.mappings]]
trigger = { Note = { note = 51 } }
action = { WasmPlugin = {
    path = "~/.midimon/wasm-plugins/midimon_wasm_obs_control.wasm",
    params = {
        "action": "toggle_mute",
        "source_name": "Microphone",
        "host": "localhost:4455"
    }
}}
</code></pre>
</li>
</ol>
<h4 id="available-actions-1"><a class="header" href="#available-actions-1">Available Actions</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Action</th><th>Parameters</th><th>Description</th></tr></thead><tbody>
<tr><td><code>set_scene</code></td><td><code>scene_name</code></td><td>Switch to scene</td></tr>
<tr><td><code>get_current_scene</code></td><td>None</td><td>Get active scene</td></tr>
<tr><td><code>start_streaming</code></td><td>None</td><td>Start streaming</td></tr>
<tr><td><code>stop_streaming</code></td><td>None</td><td>Stop streaming</td></tr>
<tr><td><code>toggle_streaming</code></td><td>None</td><td>Toggle streaming</td></tr>
<tr><td><code>start_recording</code></td><td>None</td><td>Start recording</td></tr>
<tr><td><code>stop_recording</code></td><td>None</td><td>Stop recording</td></tr>
<tr><td><code>toggle_recording</code></td><td>None</td><td>Toggle recording</td></tr>
<tr><td><code>toggle_mute</code></td><td><code>source_name</code></td><td>Mute/unmute source</td></tr>
<tr><td><code>set_volume</code></td><td><code>source_name</code>, <code>volume: 0-1</code></td><td>Set source volume</td></tr>
<tr><td><code>toggle_filter</code></td><td><code>source_name</code>, <code>filter_name</code></td><td>Toggle filter</td></tr>
<tr><td><code>set_transition</code></td><td><code>transition_name</code>, <code>duration_ms</code></td><td>Set scene transition</td></tr>
</tbody></table>
</div>
<h4 id="advanced-scene-hotkeys"><a class="header" href="#advanced-scene-hotkeys">Advanced: Scene Hotkeys</a></h4>
<pre><code class="language-toml"># Map pads to scenes
[[modes]]
name = "OBS Control"

[[modes.mappings]]
trigger = { Note = { note = 36 } }  # Pad 1
action = { WasmPlugin = { path = "...", params = { "action": "set_scene", "scene_name": "Intro" }}}

[[modes.mappings]]
trigger = { Note = { note = 37 } }  # Pad 2
action = { WasmPlugin = { path = "...", params = { "action": "set_scene", "scene_name": "Gaming" }}}

[[modes.mappings]]
trigger = { Note = { note = 38 } }  # Pad 3
action = { WasmPlugin = { path = "...", params = { "action": "set_scene", "scene_name": "Chatting" }}}

[[modes.mappings]]
trigger = { Note = { note = 39 } }  # Pad 4
action = { WasmPlugin = { path = "...", params = { "action": "set_scene", "scene_name": "BRB" }}}
</code></pre>
<hr />
<h3 id="system-utilities-plugin"><a class="header" href="#system-utilities-plugin">System Utilities Plugin</a></h3>
<p><strong>File:</strong> <code>midimon_wasm_system_utils.wasm</code>
<strong>Capabilities:</strong> SystemControl
<strong>Status:</strong> Production-ready</p>
<p>System-level operations like screen lock, sleep, notifications.</p>
<h4 id="features-3"><a class="header" href="#features-3">Features</a></h4>
<ul>
<li>Lock screen</li>
<li>Sleep/shutdown</li>
<li>Brightness control</li>
<li>System notifications</li>
<li>Application launcher</li>
<li>Volume control (system-wide)</li>
</ul>
<h4 id="configuration-4"><a class="header" href="#configuration-4">Configuration</a></h4>
<pre><code class="language-toml"># Lock screen
[[modes.mappings]]
trigger = { LongPress = { note = 60, duration_ms = 2000 } }
action = { WasmPlugin = {
    path = "~/.midimon/wasm-plugins/midimon_wasm_system_utils.wasm",
    params = {
        "action": "lock_screen"
    }
}}

# Display notification
[[modes.mappings]]
trigger = { Note = { note = 61 } }
action = { WasmPlugin = {
    path = "~/.midimon/wasm-plugins/midimon_wasm_system_utils.wasm",
    params = {
        "action": "notify",
        "title": "Recording Started",
        "message": "Stream is now live!",
        "sound": true
    }
}}

# Brightness control (velocity-sensitive)
[[modes.mappings]]
trigger = { Note = { note = 62 } }
action = { WasmPlugin = {
    path = "~/.midimon/wasm-plugins/midimon_wasm_system_utils.wasm",
    params = {
        "action": "brightness",
        "level": "{velocity}"  # 0-127 mapped to 0-100%
    }
}}

# Launch application
[[modes.mappings]]
trigger = { Note = { note = 63 } }
action = { WasmPlugin = {
    path = "~/.midimon/wasm-plugins/midimon_wasm_system_utils.wasm",
    params = {
        "action": "launch",
        "app": "Spotify"
    }
}}
</code></pre>
<h4 id="available-actions-2"><a class="header" href="#available-actions-2">Available Actions</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Action</th><th>Parameters</th><th>Description</th></tr></thead><tbody>
<tr><td><code>lock_screen</code></td><td>None</td><td>Lock screen (macOS/Linux)</td></tr>
<tr><td><code>sleep</code></td><td>None</td><td>Put system to sleep</td></tr>
<tr><td><code>shutdown</code></td><td><code>force: bool</code></td><td>Shutdown system</td></tr>
<tr><td><code>notify</code></td><td><code>title</code>, <code>message</code>, <code>sound: bool</code></td><td>Show notification</td></tr>
<tr><td><code>brightness</code></td><td><code>level: 0-127</code></td><td>Set screen brightness</td></tr>
<tr><td><code>launch</code></td><td><code>app: string</code></td><td>Launch application</td></tr>
<tr><td><code>volume</code></td><td><code>level: 0-127</code></td><td>Set system volume</td></tr>
<tr><td><code>volume_up</code></td><td>None</td><td>Increase volume 10%</td></tr>
<tr><td><code>volume_down</code></td><td>None</td><td>Decrease volume 10%</td></tr>
<tr><td><code>mute</code></td><td>None</td><td>Toggle system mute</td></tr>
</tbody></table>
</div>
<h4 id="platform-specific-notes-2"><a class="header" href="#platform-specific-notes-2">Platform-Specific Notes</a></h4>
<p><strong>macOS:</strong></p>
<ul>
<li><code>lock_screen</code>: Uses <code>pmset</code> command</li>
<li><code>brightness</code>: Requires screen brightness permission</li>
<li><code>launch</code>: Uses <code>open -a</code></li>
</ul>
<p><strong>Linux:</strong></p>
<ul>
<li><code>lock_screen</code>: Uses <code>loginctl</code> or <code>xdg-screensaver</code></li>
<li><code>brightness</code>: Requires <code>/sys/class/backlight</code> access</li>
<li><code>launch</code>: Uses <code>xdg-open</code></li>
</ul>
<p><strong>Windows:</strong></p>
<ul>
<li><code>lock_screen</code>: Uses <code>rundll32.exe</code></li>
<li><code>brightness</code>: Uses WMI</li>
<li><code>launch</code>: Uses <code>start</code></li>
</ul>
<hr />
<h2 id="creating-your-own-plugin"><a class="header" href="#creating-your-own-plugin">Creating Your Own Plugin</a></h2>
<h3 id="template-repository"><a class="header" href="#template-repository">Template Repository</a></h3>
<p>Start with the official template:</p>
<pre><code class="language-bash">git clone https://github.com/amiable-dev/midimon-wasm-plugin-template
cd midimon-wasm-plugin-template
</code></pre>
<h3 id="example-simple-notification-plugin"><a class="header" href="#example-simple-notification-plugin">Example: Simple Notification Plugin</a></h3>
<pre><code class="language-rust">// src/lib.rs
use serde::Deserialize;

#[derive(Deserialize)]
struct NotifyParams {
    message: String,
}

#[no_mangle]
pub extern "C" fn init() {
    eprintln!("Notification plugin initialized");
}

#[no_mangle]
pub extern "C" fn execute(params_ptr: *const u8, params_len: usize) -&gt; i32 {
    let params_bytes = unsafe {
        std::slice::from_raw_parts(params_ptr, params_len)
    };

    let params: NotifyParams = match serde_json::from_slice(params_bytes) {
        Ok(p) =&gt; p,
        Err(e) =&gt; {
            eprintln!("Invalid params: {}", e);
            return 1;
        }
    };

    // Platform-specific notification (simplified)
    #[cfg(target_os = "macos")]
    {
        let cmd = format!(
            "osascript -e 'display notification \"{}\" with title \"MIDIMon\"'",
            params.message
        );
        std::process::Command::new("sh")
            .arg("-c")
            .arg(&amp;cmd)
            .output()
            .expect("Failed to show notification");
    }

    eprintln!("Notification sent: {}", params.message);
    0
}</code></pre>
<h3 id="build-and-test"><a class="header" href="#build-and-test">Build and Test</a></h3>
<pre><code class="language-bash"># Build
cargo build --target wasm32-wasip1 --release

# Sign
midimon-sign sign \
  target/wasm32-wasip1/release/my_notify_plugin.wasm \
  ~/.midimon/my-key \
  --name "Your Name" --email "you@example.com"

# Test
cat &gt; test_config.toml &lt;&lt;EOF
[[modes.mappings]]
trigger = { Note = { note = 60 } }
action = { WasmPlugin = {
    path = "target/wasm32-wasip1/release/my_notify_plugin.wasm",
    params = { "message": "Test notification" }
}}
EOF

midimon --config test_config.toml 0
</code></pre>
<h2 id="best-practices-7"><a class="header" href="#best-practices-7">Best Practices</a></h2>
<h3 id="error-handling-1"><a class="header" href="#error-handling-1">Error Handling</a></h3>
<pre><code class="language-rust">#[no_mangle]
pub extern "C" fn execute(params_ptr: *const u8, params_len: usize) -&gt; i32 {
    // Always validate inputs
    if params_len == 0 {
        eprintln!("ERROR: Empty parameters");
        return 1;
    }

    // Handle JSON parsing errors
    let params: MyParams = match serde_json::from_slice(params_bytes) {
        Ok(p) =&gt; p,
        Err(e) =&gt; {
            eprintln!("ERROR: Invalid JSON: {}", e);
            return 1;
        }
    };

    // Handle operation errors
    match perform_action(&amp;params) {
        Ok(_) =&gt; 0,   // Success
        Err(e) =&gt; {
            eprintln!("ERROR: Action failed: {}", e);
            1  // Error
        }
    }
}</code></pre>
<h3 id="performance-optimization-1"><a class="header" href="#performance-optimization-1">Performance Optimization</a></h3>
<pre><code class="language-rust">use std::sync::OnceLock;

// Lazy initialization (runs once)
static HTTP_CLIENT: OnceLock&lt;reqwest::Client&gt; = OnceLock::new();

fn get_client() -&gt; &amp;'static reqwest::Client {
    HTTP_CLIENT.get_or_init(|| {
        reqwest::Client::builder()
            .timeout(Duration::from_secs(5))
            .build()
            .expect("Failed to create HTTP client")
    })
}

#[no_mangle]
pub extern "C" fn execute(params_ptr: *const u8, params_len: usize) -&gt; i32 {
    // Reuse client instead of creating new one
    let client = get_client();

    // Your code...
    0
}</code></pre>
<h3 id="resource-management"><a class="header" href="#resource-management">Resource Management</a></h3>
<pre><code class="language-rust">// Use Drop for cleanup
struct PluginState {
    connection: Option&lt;Connection&gt;,
}

impl Drop for PluginState {
    fn drop(&amp;mut self) {
        if let Some(conn) = &amp;mut self.connection {
            let _ = conn.close();
        }
        eprintln!("Plugin state cleaned up");
    }
}

static mut STATE: Option&lt;PluginState&gt; = None;

#[no_mangle]
pub extern "C" fn init() {
    unsafe {
        STATE = Some(PluginState {
            connection: None,
        });
    }
}

#[no_mangle]
pub extern "C" fn shutdown() {
    unsafe {
        STATE = None;  // Triggers Drop
    }
}</code></pre>
<h2 id="troubleshooting-23"><a class="header" href="#troubleshooting-23">Troubleshooting</a></h2>
<h3 id="plugin-not-executing"><a class="header" href="#plugin-not-executing">Plugin Not Executing</a></h3>
<ol>
<li>
<p><strong>Check logs:</strong></p>
<pre><code class="language-bash">DEBUG=1 midimon --config config.toml 0 2&gt;&amp;1 | grep WASM
</code></pre>
</li>
<li>
<p><strong>Verify WASM format:</strong></p>
<pre><code class="language-bash">file my_plugin.wasm
# Should show: WebAssembly (wasm) binary module
</code></pre>
</li>
<li>
<p><strong>Check signature:</strong></p>
<pre><code class="language-bash">midimon-sign verify my_plugin.wasm
</code></pre>
</li>
</ol>
<h3 id="out-of-fuel-1"><a class="header" href="#out-of-fuel-1">Out of Fuel</a></h3>
<pre><code class="language-rust">// Symptoms: Plugin terminates early

// Solution 1: Optimize code
// - Move heavy work to init()
// - Reduce loop iterations
// - Use lazy initialization

// Solution 2: Increase fuel limit (config.toml)
[wasm]
max_fuel = 200_000_000</code></pre>
<h3 id="network-requests-failing"><a class="header" href="#network-requests-failing">Network Requests Failing</a></h3>
<pre><code class="language-rust">// Check capability is granted
fn capabilities() -&gt; Vec&lt;String&gt; {
    vec!["Network".to_string()]
}

// Use appropriate timeout
let client = reqwest::Client::builder()
    .timeout(Duration::from_secs(5))
    .build()?;

// Handle errors gracefully
match client.get(url).send().await {
    Ok(response) =&gt; { /* ... */ },
    Err(e) =&gt; {
        eprintln!("Network error: {}", e);
        return 1;
    }
}</code></pre>
<h2 id="further-reading-5"><a class="header" href="#further-reading-5">Further Reading</a></h2>
<ul>
<li><a href="development/wasm-plugin-development.html">WASM Plugin Development Guide</a></li>
<li><a href="development/plugin-security.html">Plugin Security</a></li>
<li><a href="development/wasm-plugins.html">WASM Plugins Overview</a></li>
<li><a href="https://github.com/amiable-dev/midimon/tree/main/plugins">Official Plugin Source Code</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contributing-guide"><a class="header" href="#contributing-guide">Contributing Guide</a></h1>
<blockquote>
<p><strong>Note</strong>: This section is under development and will be completed in Phase 1 (Q1 2025).</p>
<p>For now, please refer to:</p>
<ul>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/README.md">README.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/CLAUDE.md">CLAUDE.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/discussions">GitHub Discussions</a></li>
</ul>
</blockquote>
<h2 id="coming-soon-12"><a class="header" href="#coming-soon-12">Coming Soon</a></h2>
<p>This page will cover:</p>
<ul>
<li>TBD</li>
</ul>
<hr />
<p><strong>Help Wanted</strong>: We're looking for contributors to help write documentation. See <a href="development/../development/contributing.html">Contributing Guide</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="testing-guide"><a class="header" href="#testing-guide">Testing Guide</a></h1>
<p>This guide covers testing strategies for MIDIMon, including hardware-independent testing using the MIDI device simulator.</p>
<h2 id="table-of-contents-1"><a class="header" href="#table-of-contents-1">Table of Contents</a></h2>
<ul>
<li><a href="development/testing.html#midi-device-simulator">MIDI Device Simulator</a></li>
<li><a href="development/testing.html#running-tests">Running Tests</a></li>
<li><a href="development/testing.html#end-to-end-test-suite">End-to-End Test Suite</a></li>
<li><a href="development/testing.html#code-coverage">Code Coverage</a></li>
<li><a href="development/testing.html#test-reporting">Test Reporting</a></li>
<li><a href="development/testing.html#writing-tests">Writing Tests</a></li>
<li><a href="development/testing.html#interactive-cli-tool">Interactive CLI Tool</a></li>
<li><a href="development/testing.html#test-scenarios">Test Scenarios</a></li>
</ul>
<h2 id="midi-device-simulator"><a class="header" href="#midi-device-simulator">MIDI Device Simulator</a></h2>
<p>The MIDI device simulator allows comprehensive testing of MIDIMon without requiring physical hardware. It simulates all MIDI events and complex user interactions with precise timing control.</p>
<h3 id="features-4"><a class="header" href="#features-4">Features</a></h3>
<p>The simulator supports:</p>
<ul>
<li><strong>Basic MIDI Events</strong>: Note On/Off, Control Change, Aftertouch, Pitch Bend, Program Change</li>
<li><strong>Velocity Levels</strong>: Soft (0-40), Medium (41-80), Hard (81-127)</li>
<li><strong>Timing-Based Triggers</strong>: Long press, double-tap detection</li>
<li><strong>Complex Gestures</strong>: Chords, encoder rotation, velocity ramps</li>
<li><strong>Precise Timing</strong>: Configurable delays and durations</li>
<li><strong>Event Capture</strong>: Inspect all generated MIDI messages</li>
</ul>
<h3 id="quick-start-4"><a class="header" href="#quick-start-4">Quick Start</a></h3>
<pre><code class="language-rust">use midi_simulator::{MidiSimulator, Gesture, EncoderDirection};

// Create a simulator on MIDI channel 0
let sim = MidiSimulator::new(0);

// Simulate a simple note press
sim.note_on(60, 100);
sim.note_off(60);

// Get captured events
let events = sim.get_events();
assert_eq!(events.len(), 2); // Note on + Note off</code></pre>
<h2 id="running-tests"><a class="header" href="#running-tests">Running Tests</a></h2>
<h3 id="unit-tests-1"><a class="header" href="#unit-tests-1">Unit Tests</a></h3>
<p>Run the simulator's built-in unit tests:</p>
<pre><code class="language-bash">cargo test --test midi_simulator
</code></pre>
<p>Expected output:</p>
<pre><code>running 12 tests
test tests::test_note_on_off ... ok
test tests::test_velocity_levels ... ok
test tests::test_control_change ... ok
test tests::test_aftertouch ... ok
test tests::test_pitch_bend ... ok
test tests::test_program_change ... ok
test tests::test_simple_tap_gesture ... ok
test tests::test_chord_gesture ... ok
test tests::test_encoder_simulation ... ok
test tests::test_velocity_ramp_gesture ... ok
test tests::test_scenario_builder ... ok
test tests::test_channel_masking ... ok

test result: ok. 12 passed; 0 failed
</code></pre>
<h3 id="integration-tests-1"><a class="header" href="#integration-tests-1">Integration Tests</a></h3>
<p>Run integration tests that verify the complete event processing pipeline:</p>
<pre><code class="language-bash">cargo test --test integration_tests
</code></pre>
<p>These tests cover:</p>
<ul>
<li>Basic note event handling</li>
<li>Velocity level detection</li>
<li>Long press simulation with timing validation</li>
<li>Double-tap detection</li>
<li>Chord detection with multiple notes</li>
<li>Encoder direction detection (CW/CCW)</li>
<li>Aftertouch and pitch bend</li>
<li>Complex multi-event scenarios</li>
</ul>
<h3 id="all-tests"><a class="header" href="#all-tests">All Tests</a></h3>
<p>Run all tests including unit and integration:</p>
<pre><code class="language-bash">cargo test
</code></pre>
<h3 id="using-nextest-recommended"><a class="header" href="#using-nextest-recommended">Using Nextest (Recommended)</a></h3>
<p>For improved test output and parallel execution, use cargo-nextest:</p>
<pre><code class="language-bash"># Install nextest
cargo install cargo-nextest

# Run tests with nextest
cargo nextest run --all-features

# Or use the convenience script
./scripts/test-nextest.sh
</code></pre>
<p>Nextest provides:</p>
<ul>
<li>Faster test execution through parallelization</li>
<li>Better output formatting with progress indicators</li>
<li>More detailed failure reporting</li>
<li>Per-test timing information</li>
</ul>
<h2 id="end-to-end-test-suite"><a class="header" href="#end-to-end-test-suite">End-to-End Test Suite</a></h2>
<p>The E2E test suite (<code>tests/e2e_tests.rs</code>) provides comprehensive validation of the complete MIDIMon pipeline from MIDI input through event processing, mapping, and action execution. See <a href="development/testing.html#integration-test-suites">Integration Test Suites</a> section below for full documentation of all E2E workflows, test architecture, and writing E2E tests.</p>
<h3 id="quick-start-5"><a class="header" href="#quick-start-5">Quick Start</a></h3>
<pre><code class="language-bash"># Run all E2E tests (20+ workflow tests)
cargo test --test e2e_tests

# Expected: 37 tests passed covering all critical workflows
</code></pre>
<h2 id="code-coverage"><a class="header" href="#code-coverage">Code Coverage</a></h2>
<p>MIDIMon uses <code>cargo-llvm-cov</code> for code coverage tracking. The project maintains a minimum coverage threshold of 0.35% (baseline) with a Phase 1 target of 85%.</p>
<h3 id="installing-coverage-tools"><a class="header" href="#installing-coverage-tools">Installing Coverage Tools</a></h3>
<pre><code class="language-bash"># Install cargo-llvm-cov
cargo install cargo-llvm-cov
</code></pre>
<h3 id="generating-coverage-reports"><a class="header" href="#generating-coverage-reports">Generating Coverage Reports</a></h3>
<h4 id="terminal-summary-default"><a class="header" href="#terminal-summary-default">Terminal Summary (Default)</a></h4>
<p>Generate a coverage summary in the terminal:</p>
<pre><code class="language-bash"># Using cargo-llvm-cov directly
cargo llvm-cov --all-features --workspace

# Or use the convenience script
./scripts/coverage.sh

# Or use just command
just coverage
</code></pre>
<p>Output example:</p>
<pre><code>Filename                      Regions    Missed Regions     Cover   Functions  Missed Functions  Executed       Lines      Missed Lines     Cover
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
actions.rs                        212               212     0.00%          12                12     0.00%         134               134     0.00%
config.rs                          52                42    19.23%           3                 2    33.33%          52                47     9.62%
main.rs                           278               278     0.00%          13                13     0.00%         151               151     0.00%
mappings.rs                        96                96     0.00%           8                 8     0.00%          71                71     0.00%
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
TOTAL                            2263              2253     0.44%          66                65     1.52%        1413              1408     0.35%
</code></pre>
<h4 id="html-report"><a class="header" href="#html-report">HTML Report</a></h4>
<p>Generate an interactive HTML coverage report:</p>
<pre><code class="language-bash"># Generate HTML report
./scripts/coverage.sh --html

# Or use just command
just coverage-html

# Report saved to: target/llvm-cov/html/index.html
</code></pre>
<h4 id="html-report-with-auto-open"><a class="header" href="#html-report-with-auto-open">HTML Report with Auto-Open</a></h4>
<p>Generate and automatically open the coverage report in your browser:</p>
<pre><code class="language-bash"># Generate and open HTML report
./scripts/coverage.sh --open

# Or use just command
just coverage-open
</code></pre>
<h4 id="lcov-format-for-ci"><a class="header" href="#lcov-format-for-ci">LCOV Format (for CI)</a></h4>
<p>Generate coverage in LCOV format for Codecov or other CI tools:</p>
<pre><code class="language-bash"># Generate lcov.info
./scripts/coverage.sh --lcov

# Or use just command
just coverage-lcov

# Output: lcov.info
</code></pre>
<h3 id="coverage-configuration"><a class="header" href="#coverage-configuration">Coverage Configuration</a></h3>
<p>Coverage settings are configured in <code>.llvm-cov.toml</code>:</p>
<pre><code class="language-toml">[report]
# Fail if coverage is below this percentage
fail-under-lines = 0.35

[filter]
# Exclude test files and binaries from coverage
exclude-filename-regex = [
    ".*/tests/.*",
    ".*/bin/.*"
]
</code></pre>
<h3 id="coverage-targets"><a class="header" href="#coverage-targets">Coverage Targets</a></h3>
<ul>
<li><strong>Phase 0 Baseline</strong>: 0.35% (established)</li>
<li><strong>Phase 1 Target</strong>: 85% line coverage</li>
<li><strong>Minimum Threshold</strong>: 80% (enforced in CI)</li>
</ul>
<h3 id="coverage-in-cicd"><a class="header" href="#coverage-in-cicd">Coverage in CI/CD</a></h3>
<p>Coverage is automatically tracked on every pull request:</p>
<ol>
<li><strong>GitHub Actions</strong> runs coverage on all PRs</li>
<li><strong>Codecov</strong> receives coverage reports and provides:
<ul>
<li>Coverage percentage badge</li>
<li>Line-by-line coverage visualization</li>
<li>Coverage diffs on PRs</li>
<li>Historical coverage trends</li>
</ul>
</li>
<li><strong>PR Comments</strong> show coverage delta (increase/decrease)</li>
<li><strong>Status Checks</strong> fail if coverage drops below threshold</li>
</ol>
<p>View current coverage: <a href="https://codecov.io/gh/amiable-dev/midimon"><img src="https://codecov.io/gh/amiable-dev/midimon/branch/main/graph/badge.svg" alt="codecov" /></a></p>
<h3 id="local-coverage-workflow"><a class="header" href="#local-coverage-workflow">Local Coverage Workflow</a></h3>
<p>Recommended workflow for maintaining coverage:</p>
<pre><code class="language-bash"># 1. Write tests for new code
vim tests/my_feature_test.rs

# 2. Run tests to verify they pass
cargo nextest run

# 3. Generate coverage report
just coverage-open

# 4. Identify uncovered lines (shown in red in HTML report)

# 5. Add tests for uncovered code paths

# 6. Verify coverage improved
just coverage
</code></pre>
<h2 id="test-reporting"><a class="header" href="#test-reporting">Test Reporting</a></h2>
<h3 id="github-actions-integration"><a class="header" href="#github-actions-integration">GitHub Actions Integration</a></h3>
<p>All tests run automatically on:</p>
<ul>
<li><strong>Push to main/develop branches</strong></li>
<li><strong>Pull requests</strong></li>
<li><strong>Manual workflow dispatch</strong></li>
</ul>
<p>Test results are displayed in the GitHub Actions UI with:</p>
<ul>
<li>Test count (passed/failed/skipped)</li>
<li>Execution time</li>
<li>Detailed failure logs</li>
<li>Coverage percentage</li>
</ul>
<h3 id="nextest-reports"><a class="header" href="#nextest-reports">Nextest Reports</a></h3>
<p>Nextest provides enhanced test reporting:</p>
<pre><code class="language-bash"># Run with detailed output
cargo nextest run --verbose

# Generate JUnit XML report
cargo nextest run --junit junit.xml

# Show only failed tests
cargo nextest run --failure-output immediate
</code></pre>
<h3 id="coverage-reports-in-prs"><a class="header" href="#coverage-reports-in-prs">Coverage Reports in PRs</a></h3>
<p>When you create a pull request, Codecov automatically:</p>
<ol>
<li>Analyzes coverage for changed files</li>
<li>Posts a comment with coverage diff</li>
<li>Updates status checks</li>
<li>Shows coverage on changed lines</li>
</ol>
<p>Example PR comment:</p>
<pre><code>Coverage: 85.2% (+2.1%) vs main

Files changed coverage:
  - src/new_feature.rs: 92.3% ‚úì
  - src/existing.rs: 78.1% ‚ö†Ô∏è (below target)
</code></pre>
<h3 id="local-test-scripts"><a class="header" href="#local-test-scripts">Local Test Scripts</a></h3>
<p>Use convenience scripts for common testing tasks:</p>
<pre><code class="language-bash"># Run all tests
./scripts/test.sh

# Run with nextest
./scripts/test-nextest.sh

# Generate coverage
./scripts/coverage.sh [--html|--open|--lcov]
</code></pre>
<h3 id="just-commands"><a class="header" href="#just-commands">Just Commands</a></h3>
<p>The <code>justfile</code> provides convenient shortcuts:</p>
<pre><code class="language-bash"># View all available commands
just

# Run tests
just test              # Standard cargo test
just test-nextest      # With nextest
just test-watch        # Watch mode (requires cargo-watch)

# Coverage
just coverage          # Terminal summary
just coverage-html     # HTML report
just coverage-open     # HTML report + open in browser
just coverage-lcov     # LCOV format for CI

# Linting and formatting
just lint              # Run clippy
just fmt               # Format code
just fmt-check         # Check formatting

# Complete CI check locally
just ci                # Run all CI checks (fmt, lint, test, coverage)
</code></pre>
<h2 id="writing-tests"><a class="header" href="#writing-tests">Writing Tests</a></h2>
<h3 id="basic-event-tests"><a class="header" href="#basic-event-tests">Basic Event Tests</a></h3>
<p>Test simple MIDI event generation:</p>
<pre><code class="language-rust">#[test]
fn test_my_feature() {
    let sim = MidiSimulator::new(0);

    // Simulate user action
    sim.note_on(60, 100);
    sim.note_off(60);

    // Verify events
    let events = sim.get_events();
    assert_eq!(events.len(), 2);
    assert_eq!(events[0], vec![0x90, 60, 100]); // Note On
    assert_eq!(events[1], vec![0x80, 60, 0x40]); // Note Off
}</code></pre>
<h3 id="velocity-level-tests"><a class="header" href="#velocity-level-tests">Velocity Level Tests</a></h3>
<p>Test velocity-sensitive actions:</p>
<pre><code class="language-rust">#[test]
fn test_velocity_levels() {
    let sim = MidiSimulator::new(0);

    // Test soft, medium, hard presses
    sim.note_on(60, 30);   // Soft (0-40)
    sim.note_on(60, 70);   // Medium (41-80)
    sim.note_on(60, 110);  // Hard (81-127)

    let events = sim.get_events();
    assert_eq!(events.len(), 3);
}</code></pre>
<h3 id="timing-based-tests"><a class="header" href="#timing-based-tests">Timing-Based Tests</a></h3>
<p>Test long press and timing detection:</p>
<pre><code class="language-rust">#[test]
fn test_long_press() {
    let sim = MidiSimulator::new(0);
    let start = Instant::now();

    sim.perform_gesture(Gesture::LongPress {
        note: 60,
        velocity: 80,
        hold_ms: 2500,
    });

    let duration = start.elapsed();
    assert!(duration &gt;= Duration::from_millis(2500));
}</code></pre>
<h3 id="double-tap-tests"><a class="header" href="#double-tap-tests">Double-Tap Tests</a></h3>
<p>Test double-tap detection with gap timing:</p>
<pre><code class="language-rust">#[test]
fn test_double_tap() {
    let sim = MidiSimulator::new(0);

    sim.perform_gesture(Gesture::DoubleTap {
        note: 60,
        velocity: 80,
        tap_duration_ms: 50,
        gap_ms: 200,
    });

    let events = sim.get_events();
    assert_eq!(events.len(), 4); // 2 note ons + 2 note offs
}</code></pre>
<h3 id="chord-tests"><a class="header" href="#chord-tests">Chord Tests</a></h3>
<p>Test chord detection with multiple simultaneous notes:</p>
<pre><code class="language-rust">#[test]
fn test_chord() {
    let sim = MidiSimulator::new(0);

    sim.perform_gesture(Gesture::Chord {
        notes: vec![60, 64, 67], // C major chord
        velocity: 80,
        stagger_ms: 10,
        hold_ms: 500,
    });

    let events = sim.get_events();
    assert_eq!(events.len(), 6); // 3 note ons + 3 note offs
}</code></pre>
<h3 id="encoder-tests"><a class="header" href="#encoder-tests">Encoder Tests</a></h3>
<p>Test encoder rotation with direction detection:</p>
<pre><code class="language-rust">#[test]
fn test_encoder() {
    let sim = MidiSimulator::new(0);

    sim.perform_gesture(Gesture::EncoderTurn {
        cc: 1,
        direction: EncoderDirection::Clockwise,
        steps: 5,
        step_delay_ms: 0,
    });

    let events = sim.get_events();
    assert_eq!(events.len(), 5);

    // Verify values are increasing
    for i in 1..events.len() {
        assert!(events[i][2] &gt; events[i-1][2]);
    }
}</code></pre>
<h3 id="scenario-builder"><a class="header" href="#scenario-builder">Scenario Builder</a></h3>
<p>Create complex test scenarios with the builder pattern:</p>
<pre><code class="language-rust">use midi_simulator::ScenarioBuilder;

#[test]
fn test_complex_scenario() {
    let sim = MidiSimulator::new(0);

    let scenario = ScenarioBuilder::new()
        .note_on(60, 100)
        .wait(100)
        .control_change(1, 64)
        .wait(100)
        .aftertouch(80)
        .wait(100)
        .note_off(60)
        .build();

    sim.execute_sequence(scenario);

    let events = sim.get_events();
    assert_eq!(events.len(), 4);
}</code></pre>
<h2 id="interactive-cli-tool"><a class="header" href="#interactive-cli-tool">Interactive CLI Tool</a></h2>
<p>The simulator includes an interactive command-line interface for manual testing and experimentation.</p>
<h3 id="starting-the-cli"><a class="header" href="#starting-the-cli">Starting the CLI</a></h3>
<pre><code class="language-bash">cargo run --bin midi_simulator
</code></pre>
<h3 id="available-commands-1"><a class="header" href="#available-commands-1">Available Commands</a></h3>
<pre><code>‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
‚îÇ COMMANDS                                                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Basic:                                                      ‚îÇ
‚îÇ   help, h, ?              Show help message                 ‚îÇ
‚îÇ   quit, exit, q           Exit the simulator                ‚îÇ
‚îÇ   clear, c                Clear event queue                 ‚îÇ
‚îÇ   events, e               Show captured events              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ MIDI Events:                                                ‚îÇ
‚îÇ   note &lt;num&gt; &lt;vel&gt;        Send note on/off                  ‚îÇ
‚îÇ   velocity &lt;note&gt;         Test velocity levels              ‚îÇ
‚îÇ   long &lt;note&gt; [ms]        Simulate long press               ‚îÇ
‚îÇ   double &lt;note&gt; [gap_ms]  Simulate double-tap               ‚îÇ
‚îÇ   chord &lt;n1&gt; &lt;n2&gt; ...     Simulate chord                    ‚îÇ
‚îÇ   encoder &lt;cc&gt; &lt;cw|ccw&gt;   Simulate encoder rotation         ‚îÇ
‚îÇ   aftertouch &lt;pressure&gt;   Send aftertouch                   ‚îÇ
‚îÇ   pitch &lt;value&gt;           Send pitch bend (0-16383)         ‚îÇ
‚îÇ   cc &lt;num&gt; &lt;val&gt;          Send control change               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Scenarios:                                                  ‚îÇ
‚îÇ   demo                    Run full demonstration            ‚îÇ
‚îÇ   scenario [name]         Run specific test scenario        ‚îÇ
‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
</code></pre>
<h3 id="example-session"><a class="header" href="#example-session">Example Session</a></h3>
<pre><code class="language-bash"># Start the CLI
cargo run --bin midi_simulator

# Test velocity levels
&gt; velocity 60
Simulating velocity levels (soft, medium, hard)...
‚úì Velocity test complete

# Test long press
&gt; long 60 2500
Simulating long press for 2500ms...
‚úì Long press complete

# Test double-tap
&gt; double 60 200
Simulating double-tap with 200ms gap...
‚úì Double-tap complete

# Test chord (C major)
&gt; chord 60 64 67
Simulating chord: [60, 64, 67]
‚úì Chord complete

# Test encoder rotation
&gt; encoder 1 cw 5
Simulating encoder CC1 Clockwise 5 steps...
‚úì Encoder simulation complete

# Show captured events
&gt; events
Captured events:
  1: [90, 60, 64, ...]
  2: [80, 60, 40, ...]
  ...

# Run full demo
&gt; demo
Running demonstration scenarios...
1. Testing velocity levels...
2. Testing long press...
3. Testing double-tap...
4. Testing chord...
5. Testing encoder...
‚úì Demo complete

# Exit
&gt; quit
Goodbye!
</code></pre>
<h2 id="test-scenarios"><a class="header" href="#test-scenarios">Test Scenarios</a></h2>
<p>The simulator includes pre-built test scenarios for common testing needs.</p>
<h3 id="velocity-scenario"><a class="header" href="#velocity-scenario">Velocity Scenario</a></h3>
<p>Tests all three velocity levels:</p>
<pre><code class="language-bash">&gt; scenario velocity
Testing velocity levels: Soft (30), Medium (70), Hard (110)
‚úì Velocity scenario complete
</code></pre>
<h3 id="timing-scenario"><a class="header" href="#timing-scenario">Timing Scenario</a></h3>
<p>Tests short, medium, and long press durations:</p>
<pre><code class="language-bash">&gt; scenario timing
Testing press durations: Short (100ms), Medium (500ms), Long (2500ms)
‚úì Timing scenario complete
</code></pre>
<h3 id="double-tap-scenario"><a class="header" href="#double-tap-scenario">Double-Tap Scenario</a></h3>
<p>Tests double-tap detection:</p>
<pre><code class="language-bash">&gt; scenario doubletap
Testing double-tap with 200ms gap
‚úì Double-tap scenario complete
</code></pre>
<h3 id="chord-scenario"><a class="header" href="#chord-scenario">Chord Scenario</a></h3>
<p>Tests chord detection with C major:</p>
<pre><code class="language-bash">&gt; scenario chord
Testing chord detection: C major (60, 64, 67)
‚úì Chord scenario complete
</code></pre>
<h3 id="encoder-scenario"><a class="header" href="#encoder-scenario">Encoder Scenario</a></h3>
<p>Tests encoder rotation in both directions:</p>
<pre><code class="language-bash">&gt; scenario encoder
Testing encoder: 5 steps CW, then 5 steps CCW
‚úì Encoder scenario complete
</code></pre>
<h3 id="complex-scenario"><a class="header" href="#complex-scenario">Complex Scenario</a></h3>
<p>Tests mixed events and complex interactions:</p>
<pre><code class="language-bash">&gt; scenario complex
Running complex scenario: mixed events...
‚úì Complex scenario complete
</code></pre>
<h2 id="advanced-gestures"><a class="header" href="#advanced-gestures">Advanced Gestures</a></h2>
<h3 id="velocity-ramp"><a class="header" href="#velocity-ramp">Velocity Ramp</a></h3>
<p>Simulate a velocity ramp from soft to hard:</p>
<pre><code class="language-rust">sim.perform_gesture(Gesture::VelocityRamp {
    note: 60,
    min_velocity: 20,
    max_velocity: 120,
    steps: 5,
});</code></pre>
<h3 id="simple-tap"><a class="header" href="#simple-tap">Simple Tap</a></h3>
<p>Simulate a quick tap with precise duration:</p>
<pre><code class="language-rust">sim.perform_gesture(Gesture::SimpleTap {
    note: 60,
    velocity: 80,
    duration_ms: 100,
});</code></pre>
<h2 id="event-inspection"><a class="header" href="#event-inspection">Event Inspection</a></h2>
<h3 id="getting-events"><a class="header" href="#getting-events">Getting Events</a></h3>
<pre><code class="language-rust">// Get all events and clear the queue
let events = sim.get_events();

// Peek at last event without clearing
let last = sim.peek_last_event();

// Clear the queue
sim.clear_events();</code></pre>
<h3 id="parsing-events"><a class="header" href="#parsing-events">Parsing Events</a></h3>
<pre><code class="language-rust">for event in events {
    let status = event[0];
    let message_type = status &amp; 0xF0;
    let channel = status &amp; 0x0F;

    match message_type {
        0x90 =&gt; println!("Note On: {} vel {}", event[1], event[2]),
        0x80 =&gt; println!("Note Off: {}", event[1]),
        0xB0 =&gt; println!("CC{}: {}", event[1], event[2]),
        0xD0 =&gt; println!("Aftertouch: {}", event[1]),
        0xE0 =&gt; println!("Pitch Bend: {} {}", event[1], event[2]),
        _ =&gt; println!("Unknown message type"),
    }
}</code></pre>
<h2 id="debug-output"><a class="header" href="#debug-output">Debug Output</a></h2>
<p>Enable debug output to see all MIDI messages:</p>
<pre><code class="language-rust">let mut sim = MidiSimulator::new(0);
sim.set_debug(true);

sim.note_on(60, 100);
// Output: [SIM] Sending: [90, 3C, 64]</code></pre>
<h2 id="best-practices-8"><a class="header" href="#best-practices-8">Best Practices</a></h2>
<ol>
<li><strong>Clear events between tests</strong>: Always clear the event queue between tests to avoid interference</li>
<li><strong>Use gestures for complex interactions</strong>: Prefer high-level gestures over manual event sequences</li>
<li><strong>Verify timing</strong>: Use <code>Instant::now()</code> to verify timing-sensitive operations</li>
<li><strong>Test edge cases</strong>: Test velocity boundaries (0, 40, 41, 80, 81, 127)</li>
<li><strong>Test multiple channels</strong>: Verify channel masking works correctly</li>
<li><strong>Use scenario builder</strong>: Build complex scenarios declaratively with the builder pattern</li>
</ol>
<h2 id="continuous-integration"><a class="header" href="#continuous-integration">Continuous Integration</a></h2>
<p>The simulator is designed to work in CI environments without hardware:</p>
<pre><code class="language-yaml"># .github/workflows/test.yml
name: Test

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions-rust-lang/setup-rust-toolchain@v1
      - name: Run tests
        run: cargo test --all-features
</code></pre>
<h2 id="troubleshooting-24"><a class="header" href="#troubleshooting-24">Troubleshooting</a></h2>
<h3 id="tests-timeout"><a class="header" href="#tests-timeout">Tests Timeout</a></h3>
<p>If timing-based tests timeout, increase tolerance:</p>
<pre><code class="language-rust">assert!(duration &gt;= Duration::from_millis(2500));
assert!(duration &lt; Duration::from_millis(2700)); // 200ms tolerance</code></pre>
<h3 id="event-count-mismatch"><a class="header" href="#event-count-mismatch">Event Count Mismatch</a></h3>
<p>Remember that <code>get_events()</code> clears the queue:</p>
<pre><code class="language-rust">let events1 = sim.get_events(); // Gets and clears
let events2 = sim.get_events(); // Empty, events were already consumed</code></pre>
<h3 id="velocity-detection"><a class="header" href="#velocity-detection">Velocity Detection</a></h3>
<p>Ensure velocities match expected ranges:</p>
<pre><code class="language-rust">// Soft: 0-40
// Medium: 41-80
// Hard: 81-127</code></pre>
<h2 id="integration-test-suites"><a class="header" href="#integration-test-suites">Integration Test Suites</a></h2>
<p>MIDIMon includes comprehensive integration test suites that verify complete feature sets without requiring physical hardware.</p>
<h3 id="event-processing-tests-ami-117"><a class="header" href="#event-processing-tests-ami-117">Event Processing Tests (AMI-117)</a></h3>
<p>Location: <code>tests/event_processing_tests.rs</code></p>
<p>Tests for aftertouch and pitch bend event processing:</p>
<p><strong>Aftertouch Tests (26 tests)</strong>:</p>
<ul>
<li>Full pressure range validation (0-127)</li>
<li>Continuous pressure variation</li>
<li>Boundary value testing (min/max)</li>
<li>Aftertouch with note press scenarios</li>
<li>Multi-channel aftertouch support</li>
</ul>
<p><strong>Pitch Bend Tests (26 tests)</strong>:</p>
<ul>
<li>Center position verification (8192)</li>
<li>Full 14-bit range testing (0-16383)</li>
<li>Positive and negative bend ranges</li>
<li>Smooth sweep simulations</li>
<li>Pitch bend with note combinations</li>
<li>Multi-channel pitch bend support</li>
</ul>
<pre><code class="language-bash"># Run event processing tests
cargo test --test event_processing_tests
</code></pre>
<h3 id="action-tests-ami-118"><a class="header" href="#action-tests-ami-118">Action Tests (AMI-118)</a></h3>
<p>Location: <code>tests/action_tests.rs</code></p>
<p>Tests for application launch and volume control actions:</p>
<p><strong>Launch Application Tests (14 tests)</strong>:</p>
<ul>
<li>Valid application path handling</li>
<li>Invalid path error handling</li>
<li>Paths with spaces</li>
<li>Process spawning verification</li>
<li>Permission denied scenarios</li>
<li>Concurrent process spawning</li>
<li>Platform-specific behavior detection</li>
</ul>
<p><strong>Volume Control Tests (14 tests)</strong>:</p>
<ul>
<li>Command detection (macOS, Linux, Windows)</li>
<li>Volume up/down command structure</li>
<li>Mute toggle command structure</li>
<li>Volume set command structure</li>
<li>Mock volume control execution</li>
<li>Shell command escaping</li>
</ul>
<pre><code class="language-bash"># Run action tests
cargo test --test action_tests
</code></pre>
<h3 id="action-orchestration-tests-ami-119"><a class="header" href="#action-orchestration-tests-ami-119">Action Orchestration Tests (AMI-119)</a></h3>
<p>Location: <code>tests/action_orchestration_tests.rs</code></p>
<p>Tests for complex action orchestration (38 tests):</p>
<p><strong>Sequence Actions (F16)</strong>:</p>
<ul>
<li>Action ordering verification</li>
<li>Empty sequence handling</li>
<li>Single action sequences</li>
<li>Sequences with delays</li>
<li>Error propagation in sequences</li>
</ul>
<p><strong>Delay Actions (F17)</strong>:</p>
<ul>
<li>Timing accuracy (50ms, 100ms, 500ms)</li>
<li>Zero delay handling</li>
<li>Multiple sequential delays</li>
<li>Timing precision validation (¬±10ms tolerance)</li>
</ul>
<p><strong>MouseClick Actions (F18)</strong>:</p>
<ul>
<li>Click simulation structure</li>
<li>Coordinate validation</li>
<li>Button type validation (left, right, middle)</li>
<li>Click sequences with delays</li>
</ul>
<p><strong>Repeat Actions (F19)</strong>:</p>
<ul>
<li>Repeat count verification</li>
<li>Repeat with delays</li>
<li>Zero and single repetitions</li>
<li>High-volume repeat handling (100+ iterations)</li>
</ul>
<p><strong>Conditional Actions (F20)</strong>:</p>
<ul>
<li>Application-based conditions</li>
<li>Time-based conditions (hour ranges)</li>
<li>Modifier key conditions</li>
<li>Mode-based conditions</li>
<li>Multiple condition combinations (AND/OR logic)</li>
<li>Complex conditional expressions</li>
</ul>
<pre><code class="language-bash"># Run action orchestration tests
cargo test --test action_orchestration_tests
</code></pre>
<h3 id="end-to-end-tests-ami-120"><a class="header" href="#end-to-end-tests-ami-120">End-to-End Tests (AMI-120)</a></h3>
<p>Location: <code>tests/e2e_tests.rs</code></p>
<p>Comprehensive E2E testing of the complete MIDIMon pipeline (MIDI Input ‚Üí Event Processing ‚Üí Mapping ‚Üí Action Execution):</p>
<p><strong>Critical Workflows (20 tests)</strong>:</p>
<ul>
<li>Simple pad press ‚Üí keystroke</li>
<li>Velocity-sensitive mapping (soft/medium/hard)</li>
<li>Long press detection (‚â•1000ms threshold)</li>
<li>Double-tap recognition (&lt;300ms window)</li>
<li>Chord detection (&lt;50ms window)</li>
<li>Mode switching via encoder</li>
<li>Mode-specific vs global mappings</li>
<li>Action sequences with delays</li>
<li>Conditional actions (app/time/mode)</li>
<li>Volume control via encoder</li>
</ul>
<p><strong>Performance &amp; Edge Cases (5 tests)</strong>:</p>
<ul>
<li>Timing latency verification (&lt;1ms)</li>
<li>Rapid note events (20+ events)</li>
<li>Invalid note range handling (0, 1, 126, 127)</li>
<li>Throughput testing (200 events &lt;10ms)</li>
<li>Memory stability (1000 events)</li>
</ul>
<pre><code class="language-bash"># Run all E2E tests
cargo test --test e2e_tests

# Expected: 37 tests passed
</code></pre>
<h3 id="test-coverage-summary"><a class="header" href="#test-coverage-summary">Test Coverage Summary</a></h3>
<p>Total test count: <strong>183 tests</strong></p>
<p>Breakdown by suite:</p>
<ul>
<li><code>integration_tests.rs</code>: 29 tests (basic event processing)</li>
<li><code>event_processing_tests.rs</code>: 26 tests (aftertouch &amp; pitch bend)</li>
<li><code>action_tests.rs</code>: 14 tests (launch &amp; volume control)</li>
<li><code>action_orchestration_tests.rs</code>: 38 tests (sequences &amp; conditionals)</li>
<li><code>e2e_tests.rs</code>: 37 tests (end-to-end critical workflows) ‚Üê <strong>NEW</strong></li>
<li><code>config_compatibility_test.rs</code>: 15 tests (config validation)</li>
<li><code>midi_simulator.rs</code>: 12 tests (simulator validation)</li>
<li>Additional unit tests: 12 tests (various modules)</li>
</ul>
<h3 id="running-all-integration-tests"><a class="header" href="#running-all-integration-tests">Running All Integration Tests</a></h3>
<pre><code class="language-bash"># Run all integration tests
cargo test --test integration_tests \
           --test event_processing_tests \
           --test action_tests \
           --test action_orchestration_tests

# Run all tests with coverage
cargo test --all-features
</code></pre>
<h3 id="writing-new-integration-tests"><a class="header" href="#writing-new-integration-tests">Writing New Integration Tests</a></h3>
<p>When adding new integration tests:</p>
<ol>
<li><strong>Use the MIDI simulator</strong> for all MIDI event generation</li>
<li><strong>Test edge cases</strong> (boundary values, timing variations)</li>
<li><strong>Include negative tests</strong> (error conditions, invalid inputs)</li>
<li><strong>Verify timing</strong> with tolerance (¬±10-35ms for CI stability)</li>
<li><strong>Document test purpose</strong> with clear comments</li>
<li><strong>Group related tests</strong> into logical test modules</li>
</ol>
<p>Example template:</p>
<pre><code class="language-rust">#[test]
fn test_feature_name() {
    let sim = MidiSimulator::new(0);

    // Setup: Generate test events
    sim.note_on(60, 80);

    // Execute: Perform action
    let events = sim.get_events();

    // Verify: Check results
    assert_eq!(events.len(), 1);
    assert_eq!(events[0][0] &amp; 0xF0, 0x90); // Note On
}</code></pre>
<h3 id="cicd-integration"><a class="header" href="#cicd-integration">CI/CD Integration</a></h3>
<p>All integration tests run automatically in GitHub Actions:</p>
<ul>
<li><strong>No hardware required</strong>: Uses MIDI simulator</li>
<li><strong>Fast execution</strong>: &lt;5 seconds total for all tests</li>
<li><strong>Timing tolerance</strong>: Increased for CI environments (¬±35ms)</li>
<li><strong>Platform coverage</strong>: Tests run on macOS, Linux, Windows</li>
</ul>
<h2 id="related-documentation-5"><a class="header" href="#related-documentation-5">Related Documentation</a></h2>
<ul>
<li><a href="development/../architecture/event-processing.html">Event Processing Architecture</a></li>
<li><a href="development/../reference/midi-events.html">MIDI Event Types</a></li>
<li><a href="development/../reference/actions.html">Action System</a></li>
<li><a href="development/../contributing.html">Contributing Guide</a></li>
</ul>
<h2 id="examples-4"><a class="header" href="#examples-4">Examples</a></h2>
<p>See the integration tests in <code>tests/integration_tests.rs</code> for complete examples of:</p>
<ul>
<li>Velocity detection tests</li>
<li>Long press simulation</li>
<li>Double-tap detection</li>
<li>Chord detection</li>
<li>Encoder simulation</li>
<li>Complex multi-event scenarios</li>
</ul>
<p>Additional examples in specialized test suites:</p>
<ul>
<li><code>tests/event_processing_tests.rs</code>: Aftertouch and pitch bend</li>
<li><code>tests/action_tests.rs</code>: Application launch and volume control</li>
<li><code>tests/action_orchestration_tests.rs</code>: Action sequences and conditionals</li>
</ul>
<h2 id="support"><a class="header" href="#support">Support</a></h2>
<p>For questions or issues with testing:</p>
<ul>
<li>Check existing integration tests for examples</li>
<li>Use the interactive CLI tool to experiment</li>
<li>Review the simulator source code in <code>tests/midi_simulator.rs</code></li>
<li>Open an issue on GitHub with test failure details</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="release-process"><a class="header" href="#release-process">Release Process</a></h1>
<blockquote>
<p><strong>Note</strong>: This section is under development and will be completed in Phase 1 (Q1 2025).</p>
<p>For now, please refer to:</p>
<ul>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/README.md">README.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/CLAUDE.md">CLAUDE.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/discussions">GitHub Discussions</a></li>
</ul>
</blockquote>
<h2 id="coming-soon-13"><a class="header" href="#coming-soon-13">Coming Soon</a></h2>
<p>This page will cover:</p>
<ul>
<li>TBD</li>
</ul>
<hr />
<p><strong>Help Wanted</strong>: We're looking for contributors to help write documentation. See <a href="development/../development/contributing.html">Contributing Guide</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="common-issues-and-solutions"><a class="header" href="#common-issues-and-solutions">Common Issues and Solutions</a></h1>
<h2 id="overview-18"><a class="header" href="#overview-18">Overview</a></h2>
<p>This guide covers the most frequently encountered issues when using MIDIMon, along with step-by-step solutions. For detailed diagnostic procedures, see <a href="troubleshooting/diagnostics.html">Diagnostics Guide</a>.</p>
<h2 id="midi-device-not-found"><a class="header" href="#midi-device-not-found">MIDI Device Not Found</a></h2>
<h3 id="symptoms"><a class="header" href="#symptoms">Symptoms</a></h3>
<pre><code>Error: No MIDI input ports available
</code></pre>
<p>Or:</p>
<pre><code>Available MIDI input ports:
0: IAC Driver Bus 1
# Your device is missing from the list
</code></pre>
<h3 id="causes"><a class="header" href="#causes">Causes</a></h3>
<ul>
<li>USB cable not connected</li>
<li>Device not powered on</li>
<li>MIDI driver not installed (macOS/Windows)</li>
<li>Device in wrong mode (some controllers have multiple modes)</li>
<li>MIDI port disabled in system settings</li>
</ul>
<h3 id="solutions"><a class="header" href="#solutions">Solutions</a></h3>
<h4 id="1-check-physical-connection"><a class="header" href="#1-check-physical-connection">1. Check Physical Connection</a></h4>
<pre><code class="language-bash"># macOS: Check USB device enumeration
system_profiler SPUSBDataType | grep -i mikro
# or
system_profiler SPUSBDataType | grep -i midi

# Expected output:
# Maschine Mikro MK3:
#   Product ID: 0x1600
#   Vendor ID: 0x17cc (Native Instruments)
</code></pre>
<p><strong>If device not found</strong>:</p>
<ul>
<li>Try a different USB port</li>
<li>Try a different USB cable</li>
<li>Power cycle the device (unplug, wait 10 seconds, replug)</li>
<li>Check device is powered on (some controllers have power switches)</li>
</ul>
<h4 id="2-verify-midi-setup-macos"><a class="header" href="#2-verify-midi-setup-macos">2. Verify MIDI Setup (macOS)</a></h4>
<pre><code class="language-bash"># Open Audio MIDI Setup
open -a "Audio MIDI Setup"
</code></pre>
<p>In the <strong>MIDI Studio</strong> window (Window ‚Üí Show MIDI Studio):</p>
<ul>
<li>Verify your device appears</li>
<li>Check it's not grayed out (indicates active connection)</li>
<li>If grayed out, right-click and select "Enable"</li>
</ul>
<p><strong>Reset MIDI configuration</strong> (if corrupted):</p>
<pre><code class="language-bash"># Quit Audio MIDI Setup first
rm ~/Library/Preferences/com.apple.audio.AudioMIDISetup.plist
rm ~/Library/Preferences/ByHost/com.apple.audio.AudioMIDISetup.*
# Reopen Audio MIDI Setup
</code></pre>
<h4 id="3-installreinstall-drivers"><a class="header" href="#3-installreinstall-drivers">3. Install/Reinstall Drivers</a></h4>
<p><strong>macOS/Windows</strong>:</p>
<ol>
<li>Download <a href="https://www.native-instruments.com/en/support/downloads/">Native Access</a></li>
<li>Sign in (free account)</li>
<li>Install drivers for your device</li>
<li>Restart computer after installation</li>
<li>Reconnect device</li>
</ol>
<p><strong>Linux</strong>:</p>
<ul>
<li>Most MIDI controllers work with built-in ALSA drivers</li>
<li>Install <code>alsa-utils</code>: <code>sudo apt install alsa-utils</code></li>
<li>List devices: <code>aconnect -l</code></li>
</ul>
<h4 id="4-test-with-system-tools"><a class="header" href="#4-test-with-system-tools">4. Test with System Tools</a></h4>
<p><strong>macOS</strong>:</p>
<pre><code class="language-bash"># List MIDI devices using system_profiler
system_profiler SPUSBDataType | grep -B 10 -A 10 MIDI

# Test with midimon diagnostic
cargo run --bin test_midi
</code></pre>
<p><strong>Linux</strong>:</p>
<pre><code class="language-bash"># List ALSA MIDI devices
aconnect -l

# Test with amidi
amidi -l
</code></pre>
<h4 id="5-check-port-numbers"><a class="header" href="#5-check-port-numbers">5. Check Port Numbers</a></h4>
<pre><code class="language-bash"># List all available ports
cargo run --release

# Try each port number
cargo run --bin midi_diagnostic 0
cargo run --bin midi_diagnostic 1
cargo run --bin midi_diagnostic 2
# ... press a pad/key on your controller to verify connection
</code></pre>
<h3 id="still-not-working"><a class="header" href="#still-not-working">Still Not Working?</a></h3>
<ol>
<li>Try a different computer (to rule out hardware failure)</li>
<li>Test with manufacturer's software (e.g., NI Controller Editor)</li>
<li>Check for firmware updates</li>
<li>Contact manufacturer support</li>
</ol>
<h2 id="leds-not-working-2"><a class="header" href="#leds-not-working-2">LEDs Not Working</a></h2>
<h3 id="symptoms-1"><a class="header" href="#symptoms-1">Symptoms</a></h3>
<ul>
<li>Pads press correctly but LEDs don't light up</li>
<li>LEDs flash once then go dark</li>
<li>Wrong pads lighting up</li>
<li>LEDs stuck on or flickering</li>
</ul>
<h3 id="causes-1"><a class="header" href="#causes-1">Causes</a></h3>
<ul>
<li>Input Monitoring permission not granted (macOS)</li>
<li>HID driver not installed</li>
<li>Profile/coordinate mapping issues</li>
<li>HID device already in use by another application</li>
<li>Incorrect LED scheme selected</li>
</ul>
<h3 id="solutions-1"><a class="header" href="#solutions-1">Solutions</a></h3>
<h4 id="1-grant-input-monitoring-permission-macos"><a class="header" href="#1-grant-input-monitoring-permission-macos">1. Grant Input Monitoring Permission (macOS)</a></h4>
<p><strong>Step-by-step</strong>:</p>
<ol>
<li>
<p>Run MIDIMon:</p>
<pre><code class="language-bash">cargo run --release 2
</code></pre>
</li>
<li>
<p>macOS will show a permission dialog</p>
</li>
<li>
<p>Click <strong>Open System Settings</strong></p>
</li>
<li>
<p>In <strong>Privacy &amp; Security</strong> ‚Üí <strong>Input Monitoring</strong>:</p>
<ul>
<li>Find <code>midimon</code> or <code>Terminal</code> (if running via cargo)</li>
<li>Toggle switch to <strong>ON</strong></li>
<li>If switch is already ON, toggle OFF then ON again</li>
</ul>
</li>
<li>
<p>Restart MIDIMon:</p>
<pre><code class="language-bash">cargo run --release 2
</code></pre>
</li>
</ol>
<p><strong>Verify permission granted</strong>:</p>
<pre><code class="language-bash">DEBUG=1 cargo run --release 2
</code></pre>
<p>Look for:</p>
<pre><code>[DEBUG] HID device opened successfully
[DEBUG] LED controller initialized
</code></pre>
<p>If you see "Failed to open HID device", permission is not granted.</p>
<h4 id="2-test-led-hardware"><a class="header" href="#2-test-led-hardware">2. Test LED Hardware</a></h4>
<pre><code class="language-bash"># Run LED diagnostic tool
cargo run --bin led_diagnostic
</code></pre>
<p><strong>Expected output</strong>:</p>
<pre><code>‚úì Device found: Maschine Mikro MK3
‚úì HID device opened successfully
‚úì Testing LED control...
‚úì LED diagnostic complete
</code></pre>
<p><strong>Error output</strong>:</p>
<pre><code>‚úó Failed to open HID device
</code></pre>
<p>If this fails, see <a href="troubleshooting/diagnostics.html">Diagnostics Guide</a> for HID troubleshooting.</p>
<h4 id="3-installverify-native-instruments-drivers"><a class="header" href="#3-installverify-native-instruments-drivers">3. Install/Verify Native Instruments Drivers</a></h4>
<p><strong>macOS/Windows</strong>:</p>
<ol>
<li>Open Native Access</li>
<li>Verify "Maschine" or controller-specific software is installed</li>
<li>Check for updates</li>
<li>Reinstall if necessary</li>
<li>Restart computer</li>
</ol>
<p><strong>Test after driver installation</strong>:</p>
<pre><code class="language-bash">cargo run --bin led_diagnostic
</code></pre>
<h4 id="4-try-different-led-schemes"><a class="header" href="#4-try-different-led-schemes">4. Try Different LED Schemes</a></h4>
<p>Some schemes might not work due to profile issues:</p>
<pre><code class="language-bash"># Try rainbow (doesn't require note mapping)
cargo run --release 2 --led rainbow

# Try static
cargo run --release 2 --led static

# Try reactive (default)
cargo run --release 2 --led reactive
</code></pre>
<p>If rainbow/static work but reactive doesn't, it's a profile/mapping issue.</p>
<h4 id="5-fix-coordinate-mapping-issues"><a class="header" href="#5-fix-coordinate-mapping-issues">5. Fix Coordinate Mapping Issues</a></h4>
<p><strong>Wrong pads lighting up</strong> indicates coordinate mapping problems.</p>
<p><strong>Solution</strong>: Use a device profile:</p>
<pre><code class="language-bash"># Auto-detect page
cargo run --release 2 --profile path/to/profile.ncmm3

# Force specific page
cargo run --release 2 --profile profile.ncmm3 --pad-page A
</code></pre>
<p>Create a profile using Native Instruments Controller Editor if you don't have one.</p>
<p>See <a href="troubleshooting/../DEVICE_PROFILES.html">Device Profiles Documentation</a> for complete guide.</p>
<h4 id="6-check-shared-device-access"><a class="header" href="#6-check-shared-device-access">6. Check Shared Device Access</a></h4>
<p>If Controller Editor is running simultaneously:</p>
<p><strong>macOS</strong>: MIDIMon uses shared device access (should work)</p>
<p><strong>Verify</strong>:</p>
<pre><code class="language-bash"># Check Cargo.toml includes:
hidapi = { version = "2.4", features = ["macos-shared-device"] }
</code></pre>
<p>If LEDs work when Controller Editor is closed but not when it's running:</p>
<ul>
<li>Update to latest MIDIMon version</li>
<li>Rebuild from source: <code>cargo build --release</code></li>
</ul>
<h3 id="advanced-debugging"><a class="header" href="#advanced-debugging">Advanced Debugging</a></h3>
<p>Enable debug logging and watch for LED updates:</p>
<pre><code class="language-bash">DEBUG=1 cargo run --release 2 --led reactive
</code></pre>
<p>Press pads and look for:</p>
<pre><code>[DEBUG] LED update: pad 0 -&gt; color 7 (Green) brightness 2
[DEBUG] HID write: 81 bytes
</code></pre>
<p>If you see LED updates logged but LEDs don't light:</p>
<ul>
<li>Hardware issue (try different USB port)</li>
<li>Firmware issue (update device firmware)</li>
<li>Driver issue (reinstall NI drivers)</li>
</ul>
<h2 id="events-not-triggering"><a class="header" href="#events-not-triggering">Events Not Triggering</a></h2>
<h3 id="symptoms-2"><a class="header" href="#symptoms-2">Symptoms</a></h3>
<ul>
<li>Pads press but no actions execute</li>
<li>Some pads work, others don't</li>
<li>LEDs work but actions don't fire</li>
<li>Actions trigger randomly or inconsistently</li>
</ul>
<h3 id="causes-2"><a class="header" href="#causes-2">Causes</a></h3>
<ul>
<li>Note numbers don't match config.toml</li>
<li>Wrong mode active</li>
<li>Trigger conditions not met (velocity, timing)</li>
<li>Config syntax errors</li>
<li>Event processing disabled</li>
</ul>
<h3 id="solutions-2"><a class="header" href="#solutions-2">Solutions</a></h3>
<h4 id="1-verify-note-numbers"><a class="header" href="#1-verify-note-numbers">1. Verify Note Numbers</a></h4>
<pre><code class="language-bash"># Find actual note numbers
cargo run --bin pad_mapper 2
</code></pre>
<p>Press each pad and write down the note numbers.</p>
<p><strong>Compare with config.toml</strong>:</p>
<pre><code class="language-toml">[[modes.mappings]]
[modes.mappings.trigger]
type = "Note"
note = 12  # Must match the actual note number from pad_mapper
</code></pre>
<p>If they don't match, update config.toml with correct note numbers.</p>
<h4 id="2-check-active-mode"><a class="header" href="#2-check-active-mode">2. Check Active Mode</a></h4>
<p>MIDIMon prints the current mode to console:</p>
<pre><code>Mode changed: Default -&gt; Developer
Currently in mode: Developer
</code></pre>
<p><strong>Verify you're in the expected mode</strong>:</p>
<ul>
<li>Check encoder hasn't switched modes accidentally</li>
<li>Verify mode-specific mappings are in the correct mode section</li>
<li>Try using global mappings for testing</li>
</ul>
<p><strong>Force to Default mode</strong>:</p>
<pre><code class="language-toml">[[global_mappings]]
description = "Reset to default mode"
[global_mappings.trigger]
type = "Note"
note = 0
[global_mappings.action]
type = "ModeChange"
mode = "Default"
</code></pre>
<h4 id="3-test-with-simple-mapping"><a class="header" href="#3-test-with-simple-mapping">3. Test with Simple Mapping</a></h4>
<p>Add a simple test mapping to verify basic functionality:</p>
<pre><code class="language-toml">[[global_mappings]]
description = "Test mapping - Should print to console"
[global_mappings.trigger]
type = "Note"
note = 0  # Bottom-left pad
[global_mappings.action]
type = "Shell"
command = "echo 'Mapping works!' &amp;&amp; say 'Mapping works'"
</code></pre>
<p>If this works, the issue is with specific trigger/action configuration.</p>
<h4 id="4-enable-debug-logging"><a class="header" href="#4-enable-debug-logging">4. Enable Debug Logging</a></h4>
<pre><code class="language-bash">DEBUG=1 cargo run --release 2
</code></pre>
<p>Press pads and watch for:</p>
<p><strong>Good output</strong> (mapping working):</p>
<pre><code>[MIDI] NoteOn ch:0 note:12 vel:87
[DEBUG] Processed: Note(12) with velocity Medium
[DEBUG] Matched mapping: "Copy text" (mode: Default)
[DEBUG] Executing action: Keystroke(keys: "c", modifiers: ["cmd"])
‚úì Action executed successfully
</code></pre>
<p><strong>Bad output</strong> (no match):</p>
<pre><code>[MIDI] NoteOn ch:0 note:12 vel:87
[DEBUG] Processed: Note(12) with velocity Medium
[DEBUG] No mapping matched for event
</code></pre>
<p>If no mapping matched:</p>
<ul>
<li>Note number mismatch</li>
<li>Wrong mode</li>
<li>Trigger conditions not met</li>
</ul>
<h4 id="5-check-velocitytiming-requirements"><a class="header" href="#5-check-velocitytiming-requirements">5. Check Velocity/Timing Requirements</a></h4>
<p><strong>VelocityRange</strong> triggers require specific velocity:</p>
<pre><code class="language-toml">[trigger]
type = "VelocityRange"
note = 12
min_velocity = 81  # Only triggers on HARD press (81-127)
max_velocity = 127
</code></pre>
<p><strong>Solution</strong>: Press harder or adjust velocity range:</p>
<pre><code class="language-toml">min_velocity = 0   # Accept any velocity
max_velocity = 127
</code></pre>
<p><strong>LongPress</strong> triggers require holding:</p>
<pre><code class="language-toml">[trigger]
type = "LongPress"
note = 12
hold_duration_ms = 2000  # Must hold for 2 seconds
</code></pre>
<p><strong>Solution</strong>: Hold longer or reduce threshold:</p>
<pre><code class="language-toml">hold_duration_ms = 500  # Only 0.5 seconds
</code></pre>
<p><strong>DoubleTap</strong> requires two quick taps:</p>
<pre><code class="language-toml">[trigger]
type = "DoubleTap"
note = 12
double_tap_timeout_ms = 300  # Must tap twice within 300ms
</code></pre>
<p><strong>Solution</strong>: Tap faster or increase timeout:</p>
<pre><code class="language-toml">double_tap_timeout_ms = 500  # 0.5 seconds between taps
</code></pre>
<h4 id="6-validate-config-syntax"><a class="header" href="#6-validate-config-syntax">6. Validate Config Syntax</a></h4>
<pre><code class="language-bash"># Check for TOML syntax errors
cargo check

# Or use online validator
# https://www.toml-lint.com/
</code></pre>
<p>Common syntax errors:</p>
<ul>
<li>Missing quotes around strings</li>
<li>Wrong bracket type (<code>[]</code> vs <code>[[]]</code>)</li>
<li>Typos in field names</li>
<li>Missing required fields</li>
</ul>
<h4 id="7-test-midi-events"><a class="header" href="#7-test-midi-events">7. Test MIDI Events</a></h4>
<p>Verify your device is sending events:</p>
<pre><code class="language-bash">cargo run --bin midi_diagnostic 2
</code></pre>
<p>Press pads - you should see:</p>
<pre><code>[NoteOn]  ch:0 note:12 vel:87
[NoteOff] ch:0 note:12 vel:0
</code></pre>
<p><strong>If no events appear</strong>:</p>
<ul>
<li>MIDI connection issue (see "MIDI Device Not Found" above)</li>
<li>Device in wrong mode</li>
<li>Device needs reset (power cycle)</li>
</ul>
<h3 id="still-not-working-1"><a class="header" href="#still-not-working-1">Still Not Working?</a></h3>
<p>Create a minimal test config:</p>
<pre><code class="language-bash">cat &gt; test-config.toml &lt;&lt; 'EOF'
[[modes]]
name = "Test"

[[modes.mappings]]
description = "Test"
[modes.mappings.trigger]
type = "Note"
note = 0
[modes.mappings.action]
type = "Shell"
command = "say 'test works'"
EOF

cargo run --release 2 --config test-config.toml
</code></pre>
<p>Press pad 0. If you hear "test works", the system is functioning.</p>
<h2 id="profile-detection-issues"><a class="header" href="#profile-detection-issues">Profile Detection Issues</a></h2>
<h3 id="symptoms-3"><a class="header" href="#symptoms-3">Symptoms</a></h3>
<ul>
<li>"Failed to load profile" error</li>
<li>Wrong pads lighting up</li>
<li>LEDs work without profile but not with profile</li>
<li>Auto-page detection not working</li>
</ul>
<h3 id="causes-3"><a class="header" href="#causes-3">Causes</a></h3>
<ul>
<li>Profile file not found</li>
<li>Invalid XML format</li>
<li>Wrong pad page active</li>
<li>Note numbers not in profile</li>
<li>Profile path has spaces or special characters</li>
</ul>
<h3 id="solutions-3"><a class="header" href="#solutions-3">Solutions</a></h3>
<h4 id="1-verify-profile-file-exists"><a class="header" href="#1-verify-profile-file-exists">1. Verify Profile File Exists</a></h4>
<pre><code class="language-bash"># Check file exists
ls -la path/to/profile.ncmm3

# Try absolute path
cargo run --release 2 --profile "$HOME/Downloads/profile.ncmm3"

# Escape spaces in path
cargo run --release 2 --profile "My\ Profile.ncmm3"
</code></pre>
<h4 id="2-validate-profile-xml"><a class="header" href="#2-validate-profile-xml">2. Validate Profile XML</a></h4>
<p>Open the .ncmm3 file in a text editor and verify it's valid XML:</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;DeviceProfile&gt;
  &lt;DeviceProperties&gt;
    &lt;Name&gt;My Profile&lt;/Name&gt;
    &lt;Type&gt;MASCHINE_MIKRO_MK3&lt;/Type&gt;
  &lt;/DeviceProperties&gt;

  &lt;Mapping&gt;
    &lt;PageList&gt;
      &lt;Page name="Pad Page A"&gt;
        &lt;!-- ... --&gt;
      &lt;/Page&gt;
    &lt;/PageList&gt;
  &lt;/Mapping&gt;
&lt;/DeviceProfile&gt;
</code></pre>
<p><strong>Common issues</strong>:</p>
<ul>
<li>Missing <code>&lt;?xml</code> declaration</li>
<li>Unclosed tags</li>
<li>Invalid characters</li>
<li>Corrupted file</li>
</ul>
<p><strong>Fix</strong>: Re-export from Controller Editor or use a backup.</p>
<h4 id="3-force-specific-pad-page"><a class="header" href="#3-force-specific-pad-page">3. Force Specific Pad Page</a></h4>
<p>Auto-detection might fail if notes overlap between pages:</p>
<pre><code class="language-bash"># Instead of auto-detect
cargo run --release 2 --profile profile.ncmm3

# Force page A
cargo run --release 2 --profile profile.ncmm3 --pad-page A

# Try each page
for page in A B C D E F G H; do
    echo "Testing page $page"
    cargo run --release 2 --profile profile.ncmm3 --pad-page $page
    sleep 5
    killall midimon
done
</code></pre>
<h4 id="4-create-new-profile"><a class="header" href="#4-create-new-profile">4. Create New Profile</a></h4>
<p>If profile is corrupted:</p>
<ol>
<li>Open <strong>Native Instruments Controller Editor</strong></li>
<li>Select <strong>Maschine Mikro MK3</strong></li>
<li>Create a simple profile:
<ul>
<li>Page A: Notes 12-27 (chromatic)</li>
<li>Page B: Notes 36-51 (drums)</li>
</ul>
</li>
<li>Save as <code>test-profile.ncmm3</code></li>
<li>Test: <code>cargo run --release 2 --profile test-profile.ncmm3</code></li>
</ol>
<h4 id="5-debug-profile-loading"><a class="header" href="#5-debug-profile-loading">5. Debug Profile Loading</a></h4>
<pre><code class="language-bash">DEBUG=1 cargo run --release 2 --profile profile.ncmm3
</code></pre>
<p>Look for:</p>
<pre><code>[DEBUG] Loading profile: profile.ncmm3
[DEBUG] Profile loaded: My Profile (MASCHINE_MIKRO_MK3)
[DEBUG] Found 8 pad pages
[DEBUG] Page A: 16 pads mapped (notes 12-27)
</code></pre>
<p><strong>If you see errors</strong>:</p>
<pre><code>[ERROR] Failed to parse profile: XML error at line 42
[ERROR] Profile validation failed: Missing required element
</code></pre>
<p>Fix the profile XML or create a new one.</p>
<h4 id="6-verify-note-numbers-match-profile"><a class="header" href="#6-verify-note-numbers-match-profile">6. Verify Note Numbers Match Profile</a></h4>
<pre><code class="language-bash"># Run pad mapper
cargo run --bin pad_mapper 2
</code></pre>
<p>Press pads and verify the notes are in your profile.</p>
<p>If note 50 is pressed but your profile only has notes 12-27, no LED will light.</p>
<p><strong>Solution</strong>: Either:</p>
<ul>
<li>Update profile to include note 50</li>
<li>Change hardware to send notes 12-27 (in Controller Editor)</li>
</ul>
<h2 id="platform-specific-issues"><a class="header" href="#platform-specific-issues">Platform-Specific Issues</a></h2>
<h3 id="macos-permission-dialogs-keep-appearing"><a class="header" href="#macos-permission-dialogs-keep-appearing">macOS: Permission Dialogs Keep Appearing</a></h3>
<p><strong>Cause</strong>: Binary changes (recompiling) invalidates permissions</p>
<p><strong>Solution</strong>: Grant permission to Terminal.app instead:</p>
<ol>
<li>System Settings ‚Üí Privacy &amp; Security ‚Üí Input Monitoring</li>
<li>Add <code>Terminal</code> (or your terminal emulator)</li>
<li>Run via <code>cargo run</code> - permission persists across rebuilds</li>
</ol>
<p><strong>Alternative</strong>: Code-sign the binary:</p>
<pre><code class="language-bash">codesign --force --deep --sign - target/release/midimon
</code></pre>
<h3 id="macos-cannot-be-opened-because-the-developer-cannot-be-verified"><a class="header" href="#macos-cannot-be-opened-because-the-developer-cannot-be-verified">macOS: "Cannot be opened because the developer cannot be verified"</a></h3>
<p><strong>Solution</strong>:</p>
<pre><code class="language-bash"># Remove quarantine attribute
xattr -d com.apple.quarantine target/release/midimon

# Or allow in System Settings
# Right-click binary ‚Üí Open ‚Üí Allow
</code></pre>
<h3 id="linux-permission-denied-usbhid-access"><a class="header" href="#linux-permission-denied-usbhid-access">Linux: Permission Denied (USB/HID Access)</a></h3>
<p><strong>Cause</strong>: User not in <code>plugdev</code> group or missing udev rules</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Add udev rules:</li>
</ol>
<pre><code class="language-bash">sudo tee /etc/udev/rules.d/50-midimon.rules &lt;&lt; 'EOF'
# Native Instruments Maschine Mikro MK3
SUBSYSTEM=="usb", ATTRS{idVendor}=="17cc", ATTRS{idProduct}=="1600", MODE="0666", GROUP="plugdev"
SUBSYSTEM=="usb", ATTRS{bInterfaceClass}=="01", ATTRS{bInterfaceSubClass}=="03", MODE="0666", GROUP="plugdev"
EOF

sudo udevadm control --reload-rules
sudo udevadm trigger
</code></pre>
<ol start="2">
<li>Add user to plugdev:</li>
</ol>
<pre><code class="language-bash">sudo usermod -a -G plugdev $USER
</code></pre>
<ol start="3">
<li>
<p>Log out and back in</p>
</li>
<li>
<p>Test:</p>
</li>
</ol>
<pre><code class="language-bash">cargo run --release 2
</code></pre>
<h3 id="windows-midi-device-not-recognized"><a class="header" href="#windows-midi-device-not-recognized">Windows: MIDI Device Not Recognized</a></h3>
<p><strong>Cause</strong>: Driver not installed or generic USB driver used</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Open Device Manager</li>
<li>Look for "MIDI Device" or your controller under "Sound, video and game controllers"</li>
<li>Right-click ‚Üí Update Driver</li>
<li>Choose manufacturer driver (not generic USB)</li>
<li>Or install via Native Access</li>
</ol>
<h2 id="performance-issues"><a class="header" href="#performance-issues">Performance Issues</a></h2>
<h3 id="high-cpu-usage"><a class="header" href="#high-cpu-usage">High CPU Usage</a></h3>
<p><strong>Symptom</strong>: MIDIMon using &gt;10% CPU</p>
<p><strong>Causes</strong>:</p>
<ul>
<li>Debug logging enabled</li>
<li>Animated LED scheme with high update rate</li>
<li>Shell actions running slowly</li>
<li>Event processing loop not optimizing</li>
</ul>
<p><strong>Solutions</strong>:</p>
<ol>
<li>
<p>Disable debug logging:</p>
<pre><code class="language-bash"># Don't use DEBUG=1 in production
cargo run --release 2
</code></pre>
</li>
<li>
<p>Use simpler LED scheme:</p>
<pre><code class="language-bash"># Instead of animated schemes
cargo run --release 2 --led reactive  # or off
</code></pre>
</li>
<li>
<p>Optimize shell actions:</p>
<pre><code class="language-bash"># Avoid long-running commands in mappings
# Bad:
command = "sleep 10 &amp;&amp; echo done"

# Good:
command = "echo done &amp;"  # Background process
</code></pre>
</li>
<li>
<p>Build release mode:</p>
<pre><code class="language-bash"># Debug builds are 20-30% slower
cargo build --release
./target/release/midimon 2
</code></pre>
</li>
</ol>
<h3 id="high-latency-delayed-response"><a class="header" href="#high-latency-delayed-response">High Latency (Delayed Response)</a></h3>
<p><strong>Symptom</strong>: Actions trigger 50-100ms+ after pad press</p>
<p><strong>Solutions</strong>:</p>
<ol>
<li>Use release build (not debug)</li>
<li>Check system load (Activity Monitor/Task Manager)</li>
<li>Close unnecessary applications</li>
<li>Check MIDI buffer settings in Audio MIDI Setup (macOS)</li>
</ol>
<p><strong>Verify latency</strong>:</p>
<pre><code class="language-bash">DEBUG=1 cargo run --release 2
</code></pre>
<p>Watch timestamps:</p>
<pre><code>[16:32:45.123] NoteOn received
[16:32:45.124] Action executed  # Should be &lt;2ms
</code></pre>
<p>If &gt;10ms, investigate system performance.</p>
<h2 id="getting-additional-help"><a class="header" href="#getting-additional-help">Getting Additional Help</a></h2>
<p>If your issue isn't covered here:</p>
<ol>
<li>Check <a href="troubleshooting/diagnostics.html">Diagnostics Guide</a> for detailed troubleshooting</li>
<li>Enable debug logging: <code>DEBUG=1 cargo run --release 2</code></li>
<li>Run diagnostic tools:
<pre><code class="language-bash">cargo run --bin midi_diagnostic 2
cargo run --bin led_diagnostic
cargo run --bin test_midi
</code></pre>
</li>
<li>Collect information:
<ul>
<li>macOS/Linux/Windows version</li>
<li>MIDIMon version: <code>cargo --version</code></li>
<li>Device model</li>
<li>Error messages (full output)</li>
<li>Debug log output</li>
</ul>
</li>
<li>File an issue on GitHub with collected information</li>
</ol>
<hr />
<p><strong>Last Updated</strong>: November 11, 2025
<strong>Status</strong>: Actively maintained</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="midi-output-troubleshooting"><a class="header" href="#midi-output-troubleshooting">MIDI Output Troubleshooting</a></h1>
<p>This guide helps you diagnose and resolve common issues with MIDIMon's MIDI output functionality, including SendMIDI actions, virtual MIDI ports, and DAW integration.</p>
<h2 id="quick-diagnostic-checklist"><a class="header" href="#quick-diagnostic-checklist">Quick Diagnostic Checklist</a></h2>
<p>Before diving into specific issues, run through this quick checklist:</p>
<ul>
<li><input disabled="" type="checkbox"/>
Virtual MIDI port is created and online (IAC Driver, loopMIDI, ALSA)</li>
<li><input disabled="" type="checkbox"/>
DAW has MIDI input enabled for the virtual port</li>
<li><input disabled="" type="checkbox"/>
MIDIMon config specifies the correct port name (case-sensitive)</li>
<li><input disabled="" type="checkbox"/>
MIDI messages are being sent (check <code>midimon --verbose</code> logs)</li>
<li><input disabled="" type="checkbox"/>
DAW is receiving MIDI (check DAW's MIDI monitor)</li>
<li><input disabled="" type="checkbox"/>
Correct MIDI channel is used (usually Channel 0)</li>
<li><input disabled="" type="checkbox"/>
No other applications are blocking the MIDI port</li>
</ul>
<h2 id="common-issues-1"><a class="header" href="#common-issues-1">Common Issues</a></h2>
<h3 id="issue-1-port-not-found-error"><a class="header" href="#issue-1-port-not-found-error">Issue 1: "Port not found" Error</a></h3>
<p><strong>Symptoms</strong>:</p>
<pre><code>ERROR: MIDI output port "IAC Driver Bus 1" not found
Available ports: []
</code></pre>
<p><strong>Possible Causes</strong>:</p>
<ol>
<li>Virtual MIDI port not created or offline</li>
<li>Port name mismatch (case-sensitive)</li>
<li>MIDIMon started before port was created</li>
<li>Permissions issue (Linux/Windows)</li>
</ol>
<p><strong>Solutions</strong>:</p>
<h4 id="macos-iac-driver-2"><a class="header" href="#macos-iac-driver-2">macOS (IAC Driver)</a></h4>
<ol>
<li>
<p><strong>Verify IAC Driver is online</strong>:</p>
<pre><code class="language-bash"># Open Audio MIDI Setup
open -a "Audio MIDI Setup"
</code></pre>
<ul>
<li>Window ‚Üí Show MIDI Studio</li>
<li>Double-click <strong>IAC Driver</strong></li>
<li>Check <strong>"Device is online"</strong></li>
<li>Click <strong>Apply</strong></li>
</ul>
</li>
<li>
<p><strong>List available MIDI ports</strong> to verify the exact name:</p>
<pre><code class="language-bash"># Use midimon diagnostic tool
cargo run --bin test_midi
</code></pre>
</li>
<li>
<p><strong>Restart MIDIMon daemon</strong>:</p>
<pre><code class="language-bash">midimonctl stop
midimon
</code></pre>
</li>
</ol>
<h4 id="windows-loopmidi-2"><a class="header" href="#windows-loopmidi-2">Windows (loopMIDI)</a></h4>
<ol>
<li>
<p><strong>Verify loopMIDI is running</strong>:</p>
<ul>
<li>Check system tray for loopMIDI icon</li>
<li>If not running, launch loopMIDI from Start Menu</li>
</ul>
</li>
<li>
<p><strong>Verify port exists</strong> in loopMIDI:</p>
<ul>
<li>Open loopMIDI application</li>
<li>Ensure at least one port is listed (e.g., "MIDIMon Virtual")</li>
</ul>
</li>
<li>
<p><strong>Check exact port name</strong> (case-sensitive):</p>
<ul>
<li>Note the exact name shown in loopMIDI</li>
<li>Update <code>config.toml</code> to match exactly:
<pre><code class="language-toml">[modes.mappings.action.then_action]
type = "SendMIDI"
port = "MIDIMon Virtual"  # Must match exactly
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>Restart MIDIMon</strong>:</p>
<pre><code class="language-bash">midimonctl stop
midimon
</code></pre>
</li>
</ol>
<h4 id="linux-alsa-1"><a class="header" href="#linux-alsa-1">Linux (ALSA)</a></h4>
<ol>
<li>
<p><strong>Verify virtual MIDI port exists</strong>:</p>
<pre><code class="language-bash">aconnect -l
</code></pre>
<p>Look for "Virtual Raw MIDI" or similar.</p>
</li>
<li>
<p><strong>Load ALSA virtual MIDI module</strong> if missing:</p>
<pre><code class="language-bash">sudo modprobe snd-virmidi
</code></pre>
</li>
<li>
<p><strong>Verify port name</strong> and update config:</p>
<pre><code class="language-bash"># List MIDI ports
aconnect -l
</code></pre>
<p>Update <code>config.toml</code> with the exact port name.</p>
</li>
<li>
<p><strong>Permissions</strong> (if port access denied):</p>
<pre><code class="language-bash"># Add user to audio group
sudo usermod -a -G audio $USER

# Log out and log back in for changes to take effect
</code></pre>
</li>
</ol>
<hr />
<h3 id="issue-2-messages-sent-but-not-received-by-daw"><a class="header" href="#issue-2-messages-sent-but-not-received-by-daw">Issue 2: Messages Sent But Not Received by DAW</a></h3>
<p><strong>Symptoms</strong>:</p>
<ul>
<li>MIDIMon logs show messages being sent</li>
<li>DAW doesn't respond (no transport control, no parameter changes)</li>
<li>No error messages</li>
</ul>
<p><strong>Diagnosis</strong>:</p>
<ol>
<li>
<p><strong>Enable verbose logging</strong> in MIDIMon:</p>
<pre><code class="language-bash">midimon --verbose
</code></pre>
<p>Look for lines like:</p>
<pre><code>[DEBUG] Sending MIDI: NoteOn(note=60, velocity=100, channel=0) to port "IAC Driver Bus 1"
</code></pre>
</li>
<li>
<p><strong>Check DAW's MIDI monitor</strong>:</p>
<ul>
<li><strong>Logic Pro</strong>: View ‚Üí Show MIDI Environment ‚Üí Monitor</li>
<li><strong>Ableton Live</strong>: Preferences ‚Üí Link, Tempo &amp; MIDI ‚Üí MIDI Ports (check Track/Remote enabled)</li>
<li><strong>Reaper</strong>: View ‚Üí MIDI Device Diagnostics</li>
</ul>
</li>
</ol>
<p><strong>Possible Causes &amp; Solutions</strong>:</p>
<h4 id="cause-1-daw-midi-input-not-enabled"><a class="header" href="#cause-1-daw-midi-input-not-enabled">Cause 1: DAW MIDI Input Not Enabled</a></h4>
<p><strong>Logic Pro</strong>:</p>
<ol>
<li>Open <strong>Logic Pro ‚Üí Settings ‚Üí MIDI ‚Üí Inputs</strong> (‚åò,)</li>
<li>Locate your virtual MIDI port</li>
<li>Check the box to enable it</li>
<li>Close Settings</li>
</ol>
<p><strong>Ableton Live</strong>:</p>
<ol>
<li>Open <strong>Preferences ‚Üí Link, Tempo &amp; MIDI</strong></li>
<li>In <strong>MIDI Ports</strong> section, find your virtual port</li>
<li>Enable <strong>Track</strong> and <strong>Remote</strong> for the input port</li>
<li>Close Preferences</li>
</ol>
<p><strong>Reaper</strong>:</p>
<ol>
<li>Open <strong>Preferences ‚Üí MIDI Devices</strong></li>
<li>Find your virtual MIDI port in the input list</li>
<li>Enable <strong>Enable input from this device</strong></li>
<li>Click <strong>OK</strong></li>
</ol>
<h4 id="cause-2-wrong-midi-channel"><a class="header" href="#cause-2-wrong-midi-channel">Cause 2: Wrong MIDI Channel</a></h4>
<p><strong>Solution</strong>: Most DAWs use Channel 0 (sometimes labeled as "Channel 1" in DAW UI). Verify your config:</p>
<pre><code class="language-toml">[modes.mappings.action.then_action.message]
type = "NoteOn"
note = 60
velocity = 100
channel = 0  # Change to match DAW expectations
</code></pre>
<p><strong>Test different channels</strong> (0-15) to find the correct one.</p>
<h4 id="cause-3-wrong-cc-numbers-or-note-numbers"><a class="header" href="#cause-3-wrong-cc-numbers-or-note-numbers">Cause 3: Wrong CC Numbers or Note Numbers</a></h4>
<p><strong>Solution</strong>: Use DAW's MIDI Learn feature to discover correct values:</p>
<p><strong>Logic Pro</strong>:</p>
<ol>
<li><strong>Logic Pro ‚Üí Control Surfaces ‚Üí Learn Assignment</strong></li>
<li>Click the parameter to control</li>
<li>Note the CC number shown (update your config)</li>
</ol>
<p><strong>Ableton Live</strong>:</p>
<ol>
<li>Click <strong>MIDI</strong> button (top-right, or press ‚åòM)</li>
<li>Click the parameter to control</li>
<li>Press your MIDI controller (Ableton learns the mapping)</li>
<li>Note the CC/Note number (if you want to replicate in config)</li>
</ol>
<h4 id="cause-4-control-surface-conflicts"><a class="header" href="#cause-4-control-surface-conflicts">Cause 4: Control Surface Conflicts</a></h4>
<p><strong>Solution</strong>: Disable conflicting control surfaces in DAW:</p>
<p><strong>Logic Pro</strong>:</p>
<ul>
<li><strong>Logic Pro ‚Üí Control Surfaces ‚Üí Setup</strong></li>
<li>Disable any control surfaces using the same MIDI port</li>
</ul>
<p><strong>Ableton Live</strong>:</p>
<ul>
<li><strong>Preferences ‚Üí Link, Tempo &amp; MIDI</strong></li>
<li>In <strong>Control Surface</strong> section, ensure no conflicting surface is assigned to the same port</li>
</ul>
<hr />
<h3 id="issue-3-latency--delayed-response"><a class="header" href="#issue-3-latency--delayed-response">Issue 3: Latency / Delayed Response</a></h3>
<p><strong>Symptoms</strong>:</p>
<ul>
<li>Noticeable delay (&gt;50ms) between pad press and DAW response</li>
<li>Audio/MIDI feels "laggy"</li>
</ul>
<p><strong>Possible Causes &amp; Solutions</strong>:</p>
<h4 id="cause-1-high-audio-buffer-size"><a class="header" href="#cause-1-high-audio-buffer-size">Cause 1: High Audio Buffer Size</a></h4>
<p><strong>Solution</strong>: Lower DAW's audio buffer size:</p>
<p><strong>Logic Pro</strong>:</p>
<ol>
<li><strong>Logic Pro ‚Üí Settings ‚Üí Audio</strong></li>
<li>Reduce <strong>I/O Buffer Size</strong> to 128 or 64 samples</li>
<li>Note: Lower buffer = lower latency, but higher CPU usage</li>
</ol>
<p><strong>Ableton Live</strong>:</p>
<ol>
<li><strong>Preferences ‚Üí Audio</strong></li>
<li>Reduce <strong>Buffer Size</strong> to 128 or 64 samples</li>
</ol>
<p><strong>Reaper</strong>:</p>
<ol>
<li><strong>Preferences ‚Üí Audio ‚Üí Device</strong></li>
<li>Reduce <strong>Block size</strong> to 128 or 64 samples</li>
</ol>
<h4 id="cause-2-third-party-virtual-midi-drivers"><a class="header" href="#cause-2-third-party-virtual-midi-drivers">Cause 2: Third-Party Virtual MIDI Drivers</a></h4>
<p><strong>Windows</strong>: loopMIDI adds ~5-10ms latency. This is usually acceptable, but if critical:</p>
<ul>
<li>Consider rtpMIDI (network MIDI) for even lower latency</li>
<li>Ensure loopMIDI is up to date</li>
</ul>
<p><strong>macOS</strong>: Use IAC Driver (native, near-zero latency) instead of third-party apps.</p>
<p><strong>Linux</strong>: Use ALSA virtual ports (native, low latency) instead of JACK MIDI (higher latency).</p>
<h4 id="cause-3-system-cpu-load"><a class="header" href="#cause-3-system-cpu-load">Cause 3: System CPU Load</a></h4>
<p><strong>Solution</strong>:</p>
<ol>
<li>Close unnecessary applications</li>
<li>Freeze/bounce tracks in DAW to reduce CPU usage</li>
<li>Increase audio buffer size if CPU is maxed out (trade latency for stability)</li>
</ol>
<h4 id="cause-4-midimon-processing-delay"><a class="header" href="#cause-4-midimon-processing-delay">Cause 4: MIDIMon Processing Delay</a></h4>
<p><strong>Diagnosis</strong>: Check MIDIMon logs for processing time:</p>
<pre><code class="language-bash">midimon --verbose
</code></pre>
<p>If you see warnings about slow processing, check:</p>
<ol>
<li>Complex velocity curves (use simpler curves)</li>
<li>Conditional actions with many conditions (simplify)</li>
<li>Sequence actions with many steps (reduce)</li>
</ol>
<p><strong>Solution</strong>: Simplify mappings to reduce processing overhead.</p>
<hr />
<h3 id="issue-4-messages-sent-to-wrong-port"><a class="header" href="#issue-4-messages-sent-to-wrong-port">Issue 4: Messages Sent to Wrong Port</a></h3>
<p><strong>Symptoms</strong>:</p>
<ul>
<li>DAW receives MIDI from a different source</li>
<li>MIDIMon logs show correct port, but DAW sees different port</li>
</ul>
<p><strong>Possible Causes &amp; Solutions</strong>:</p>
<h4 id="cause-1-multiple-virtual-midi-ports"><a class="header" href="#cause-1-multiple-virtual-midi-ports">Cause 1: Multiple Virtual MIDI Ports</a></h4>
<p><strong>Solution</strong>: List all available MIDI ports and verify exact name:</p>
<pre><code class="language-bash"># Use MIDIMon diagnostic tool
cargo run --bin test_midi
</code></pre>
<p>Update config to use the correct port name (case-sensitive):</p>
<pre><code class="language-toml">[modes.mappings.action.then_action]
type = "SendMIDI"
port = "IAC Driver Bus 1"  # Not "IAC Driver Bus 2"
</code></pre>
<h4 id="cause-2-port-name-changed"><a class="header" href="#cause-2-port-name-changed">Cause 2: Port Name Changed</a></h4>
<p><strong>macOS (IAC Driver)</strong>:</p>
<ul>
<li>If you renamed the bus in Audio MIDI Setup, update your config</li>
</ul>
<p><strong>Windows (loopMIDI)</strong>:</p>
<ul>
<li>If you renamed the port in loopMIDI, update your config</li>
<li>Restart MIDIMon after renaming</li>
</ul>
<hr />
<h3 id="issue-5-velocity-not-working"><a class="header" href="#issue-5-velocity-not-working">Issue 5: Velocity Not Working</a></h3>
<p><strong>Symptoms</strong>:</p>
<ul>
<li>All MIDI messages sent with same velocity (e.g., always 127)</li>
<li>Velocity curves not being applied</li>
</ul>
<p><strong>Possible Causes &amp; Solutions</strong>:</p>
<h4 id="cause-1-fixed-velocity-in-config"><a class="header" href="#cause-1-fixed-velocity-in-config">Cause 1: Fixed Velocity in Config</a></h4>
<p><strong>Problem</strong>: Config specifies a fixed velocity value:</p>
<pre><code class="language-toml">[modes.mappings.action.then_action.message]
type = "NoteOn"
note = 60
velocity = 127  # Fixed velocity
channel = 0
</code></pre>
<p><strong>Solution</strong>: Use a velocity curve to map input velocity:</p>
<pre><code class="language-toml">[modes.mappings.action.then_action.message]
type = "NoteOn"
note = 60
channel = 0

[modes.mappings.action.then_action.message.velocity_curve]
type = "PassThrough"  # Use controller velocity directly
</code></pre>
<h4 id="cause-2-trigger-doesnt-capture-velocity"><a class="header" href="#cause-2-trigger-doesnt-capture-velocity">Cause 2: Trigger Doesn't Capture Velocity</a></h4>
<p><strong>Problem</strong>: Trigger type doesn't include velocity information.</p>
<p><strong>Solution</strong>: Use a trigger that captures velocity:</p>
<pre><code class="language-toml">[modes.mappings.trigger]
type = "Note"  # Captures velocity
note = 1
# Velocity is automatically available to velocity_curve
</code></pre>
<hr />
<h3 id="issue-6-virtual-port-not-visible-in-daw"><a class="header" href="#issue-6-virtual-port-not-visible-in-daw">Issue 6: Virtual Port Not Visible in DAW</a></h3>
<p><strong>Symptoms</strong>:</p>
<ul>
<li>Virtual MIDI port exists (verified via OS tools)</li>
<li>DAW doesn't list the port in MIDI preferences</li>
</ul>
<p><strong>Possible Causes &amp; Solutions</strong>:</p>
<h4 id="macos-iac-driver-3"><a class="header" href="#macos-iac-driver-3">macOS (IAC Driver)</a></h4>
<p><strong>Cause</strong>: DAW started before IAC Driver was enabled.</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Enable IAC Driver in Audio MIDI Setup</li>
<li>Restart the DAW</li>
<li>Alternatively: <strong>Logic Pro ‚Üí Settings ‚Üí MIDI ‚Üí Reset MIDI Drivers</strong></li>
</ol>
<h4 id="windows-loopmidi-3"><a class="header" href="#windows-loopmidi-3">Windows (loopMIDI)</a></h4>
<p><strong>Cause</strong>: DAW doesn't detect dynamically created ports.</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Create loopMIDI port <strong>before</strong> launching DAW</li>
<li>If DAW is running, restart it after creating the port</li>
</ol>
<h4 id="linux-alsa-2"><a class="header" href="#linux-alsa-2">Linux (ALSA)</a></h4>
<p><strong>Cause</strong>: ALSA virtual port created after DAW startup.</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Load <code>snd-virmidi</code> module before launching DAW:
<pre><code class="language-bash">sudo modprobe snd-virmidi
</code></pre>
</li>
<li>Restart DAW</li>
<li>Alternatively: Use <code>aconnect</code> to manually connect ports</li>
</ol>
<hr />
<h2 id="platform-specific-issues-1"><a class="header" href="#platform-specific-issues-1">Platform-Specific Issues</a></h2>
<h3 id="macos-specific"><a class="header" href="#macos-specific">macOS Specific</a></h3>
<h4 id="iac-driver-device-is-offline-after-reboot"><a class="header" href="#iac-driver-device-is-offline-after-reboot">IAC Driver "Device is offline" After Reboot</a></h4>
<p><strong>Problem</strong>: IAC Driver unchecks itself after macOS reboot.</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Open <strong>Audio MIDI Setup</strong></li>
<li>Double-click <strong>IAC Driver</strong></li>
<li>Check <strong>"Device is online"</strong></li>
<li>This should persist, but if not, consider using an AppleScript to auto-enable on login</li>
</ol>
<h4 id="permissions-issues-with-hid-device"><a class="header" href="#permissions-issues-with-hid-device">Permissions Issues with HID Device</a></h4>
<p><strong>Problem</strong>: MIDIMon can't access MIDI controller hardware.</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Grant <strong>Input Monitoring</strong> permissions:
<ul>
<li><strong>System Settings ‚Üí Privacy &amp; Security ‚Üí Input Monitoring</strong></li>
<li>Enable for Terminal (if running <code>cargo run</code>)</li>
</ul>
</li>
<li>Restart MIDIMon</li>
</ol>
<h3 id="windows-specific"><a class="header" href="#windows-specific">Windows Specific</a></h3>
<h4 id="loopmidi-port-disappears"><a class="header" href="#loopmidi-port-disappears">loopMIDI Port Disappears</a></h4>
<p><strong>Problem</strong>: loopMIDI port intermittently disappears.</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Ensure loopMIDI is set to <strong>start with Windows</strong>:
<ul>
<li>Right-click loopMIDI tray icon ‚Üí Settings ‚Üí <strong>Start with Windows</strong></li>
</ul>
</li>
<li>If port disappears, restart loopMIDI application</li>
<li>Restart MIDIMon daemon</li>
</ol>
<h4 id="multiple-midi-drivers-conflict"><a class="header" href="#multiple-midi-drivers-conflict">Multiple MIDI Drivers Conflict</a></h4>
<p><strong>Problem</strong>: Multiple virtual MIDI drivers (loopMIDI, rtpMIDI, etc.) cause conflicts.</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Use only one virtual MIDI driver at a time</li>
<li>Disable/uninstall unused drivers</li>
<li>Assign unique port names if using multiple drivers</li>
</ol>
<h3 id="linux-specific"><a class="header" href="#linux-specific">Linux Specific</a></h3>
<h4 id="alsa-permissions-denied"><a class="header" href="#alsa-permissions-denied">ALSA Permissions Denied</a></h4>
<p><strong>Problem</strong>: MIDIMon can't access ALSA virtual MIDI ports.</p>
<p><strong>Solution</strong>:</p>
<pre><code class="language-bash"># Add user to audio group
sudo usermod -a -G audio $USER

# Log out and log back in

# Verify group membership
groups | grep audio
</code></pre>
<h4 id="jack-midi-vs-alsa"><a class="header" href="#jack-midi-vs-alsa">JACK MIDI vs ALSA</a></h4>
<p><strong>Problem</strong>: DAW uses JACK MIDI, but MIDIMon uses ALSA.</p>
<p><strong>Solution</strong>:</p>
<ol>
<li>Bridge ALSA to JACK using <code>a2jmidid</code>:
<pre><code class="language-bash">sudo apt-get install a2jmidid
a2jmidid -e &amp;
</code></pre>
</li>
<li>Use <code>qjackctl</code> to route ALSA virtual port to JACK</li>
<li>Alternatively: Use JACK-native virtual MIDI ports instead of ALSA</li>
</ol>
<hr />
<h2 id="advanced-debugging-1"><a class="header" href="#advanced-debugging-1">Advanced Debugging</a></h2>
<h3 id="enable-midimon-debug-logging"><a class="header" href="#enable-midimon-debug-logging">Enable MIDIMon Debug Logging</a></h3>
<p>Run MIDIMon with verbose logging to see detailed MIDI output:</p>
<pre><code class="language-bash">midimon --verbose
</code></pre>
<p><strong>What to look for</strong>:</p>
<ul>
<li><code>[DEBUG] Sending MIDI: ...</code> - Confirms messages are being sent</li>
<li><code>[ERROR] Port not found: ...</code> - Port name issues</li>
<li><code>[WARN] Slow processing time: ...</code> - Performance issues</li>
</ul>
<h3 id="monitor-midi-traffic-in-daw"><a class="header" href="#monitor-midi-traffic-in-daw">Monitor MIDI Traffic in DAW</a></h3>
<p><strong>Logic Pro</strong>:</p>
<ol>
<li>View ‚Üí Show MIDI Environment</li>
<li>Click <strong>Monitor</strong> object</li>
<li>Watch for incoming MIDI messages</li>
</ol>
<p><strong>Ableton Live</strong>:</p>
<ol>
<li>Preferences ‚Üí Link, Tempo &amp; MIDI</li>
<li>Enable <strong>Track</strong> and <strong>Remote</strong> for the port</li>
<li>Create a MIDI track</li>
<li>Arm the track for recording</li>
<li>Watch the MIDI input meter</li>
</ol>
<p><strong>Reaper</strong>:</p>
<ol>
<li>View ‚Üí MIDI Device Diagnostics</li>
<li>Select your virtual MIDI port</li>
<li>Watch for incoming messages</li>
</ol>
<h3 id="test-midi-loopback"><a class="header" href="#test-midi-loopback">Test MIDI Loopback</a></h3>
<p>Create a loopback test to verify MIDI output is working:</p>
<ol>
<li>
<p><strong>Route virtual output back to MIDIMon input</strong> (macOS):</p>
<ul>
<li>Audio MIDI Setup ‚Üí IAC Driver</li>
<li>Create two buses: "MIDIMon Out" and "MIDIMon In"</li>
<li>Configure MIDIMon to send to "MIDIMon Out"</li>
<li>Configure MIDIMon to receive from "MIDIMon In"</li>
<li>Use a MIDI routing app to bridge them</li>
</ul>
</li>
<li>
<p><strong>Send a test message</strong>:</p>
<pre><code class="language-bash"># Press a pad and verify it's received on the input
midimon --verbose
</code></pre>
</li>
</ol>
<hr />
<h2 id="getting-help-2"><a class="header" href="#getting-help-2">Getting Help</a></h2>
<p>If you've tried all troubleshooting steps and still have issues:</p>
<ol>
<li>
<p><strong>Gather diagnostic information</strong>:</p>
<pre><code class="language-bash"># List MIDI ports
cargo run --bin test_midi &gt; midi_ports.txt

# Run MIDIMon with verbose logging
midimon --verbose 2&gt;&amp;1 | tee midimon_debug.log

# (Press pads to trigger actions)

# Stop after 30 seconds
midimonctl stop
</code></pre>
</li>
<li>
<p><strong>Check configuration</strong>:</p>
<pre><code class="language-bash">cat ~/.config/midimon/config.toml
</code></pre>
</li>
<li>
<p><strong>Report the issue</strong>:</p>
<ul>
<li>GitHub: https://github.com/amiable-dev/midimon/issues</li>
<li>Include:
<ul>
<li>Platform (macOS, Windows, Linux)</li>
<li>MIDIMon version (<code>midimon --version</code>)</li>
<li>DAW name and version</li>
<li>MIDI port name</li>
<li>Relevant config.toml sections</li>
<li>Debug logs (midimon_debug.log)</li>
<li>midi_ports.txt</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr />
<h2 id="see-also-10"><a class="header" href="#see-also-10">See Also</a></h2>
<ul>
<li><a href="troubleshooting/../guides/daw-control.html">DAW Control Guide</a> - General MIDI output concepts</li>
<li><a href="troubleshooting/../examples/logic-pro.html">Logic Pro Integration</a> - Logic Pro-specific setup</li>
<li><a href="troubleshooting/../examples/ableton-live.html">Ableton Live Integration</a> - Ableton Live-specific setup</li>
<li><a href="troubleshooting/../configuration/actions.html">Configuration Reference</a> - SendMIDI action syntax</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="faq"><a class="header" href="#faq">FAQ</a></h1>
<blockquote>
<p><strong>Note</strong>: This section is under development and will be completed in Phase 1 (Q1 2025).</p>
<p>For now, please refer to:</p>
<ul>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/README.md">README.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/CLAUDE.md">CLAUDE.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/discussions">GitHub Discussions</a></li>
</ul>
</blockquote>
<h2 id="coming-soon-14"><a class="header" href="#coming-soon-14">Coming Soon</a></h2>
<p>This page will cover:</p>
<ul>
<li>TBD</li>
</ul>
<hr />
<p><strong>Help Wanted</strong>: We're looking for contributors to help write documentation. See <a href="troubleshooting/../development/contributing.html">Contributing Guide</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="diagnostic-tools-and-procedures"><a class="header" href="#diagnostic-tools-and-procedures">Diagnostic Tools and Procedures</a></h1>
<h2 id="overview-19"><a class="header" href="#overview-19">Overview</a></h2>
<p>MIDIMon includes a comprehensive suite of diagnostic tools for debugging connectivity, event processing, LED control, and configuration issues. This guide covers each tool in detail and provides systematic troubleshooting procedures.</p>
<h2 id="quick-diagnostic-checklist-1"><a class="header" href="#quick-diagnostic-checklist-1">Quick Diagnostic Checklist</a></h2>
<p>Before diving deep, run through this quick checklist:</p>
<pre><code class="language-bash"># 1. Check USB/MIDI connectivity
cargo run --bin test_midi

# 2. Verify MIDI events are received
cargo run --bin midi_diagnostic 2

# 3. Test LED/HID access
cargo run --bin led_diagnostic

# 4. Find note numbers
cargo run --bin pad_mapper 2

# 5. Enable debug logging
DEBUG=1 cargo run --release 2
</code></pre>
<p>If all five succeed, the hardware and drivers are working correctly.</p>
<h2 id="diagnostic-tool-reference"><a class="header" href="#diagnostic-tool-reference">Diagnostic Tool Reference</a></h2>
<h3 id="1-test_midi---midi-port-testing"><a class="header" href="#1-test_midi---midi-port-testing">1. test_midi - MIDI Port Testing</a></h3>
<p><strong>Purpose</strong>: Verify MIDI connectivity, enumerate all available ports, test basic MIDI communication.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">cargo run --bin test_midi
</code></pre>
<p><strong>What it does</strong>:</p>
<ol>
<li>Lists all MIDI input ports</li>
<li>Lists all MIDI output ports</li>
<li>Attempts to open port 2 (default)</li>
<li>Waits for a MIDI event (5-second timeout)</li>
<li>Reports success or failure</li>
</ol>
<p><strong>Expected output</strong> (working):</p>
<pre><code>MIDI Port Test
==============

Available input ports:
0: USB MIDI Device
1: IAC Driver Bus 1
2: Maschine Mikro MK3 - Input
3: Digital Keyboard

Available output ports:
0: USB MIDI Device
1: IAC Driver Bus 1
2: Maschine Mikro MK3 - Output

Testing port 2 (input)...
‚úì Successfully opened port: Maschine Mikro MK3 - Input

Waiting for MIDI event... (5 second timeout)
‚úì Received MIDI event: NoteOn ch:0 note:12 vel:87

Connection test: PASSED
All MIDI functionality working correctly.
</code></pre>
<p><strong>Error output</strong> (device not found):</p>
<pre><code>Available input ports:
0: IAC Driver Bus 1
# Device missing!

Testing port 2 (input)...
‚úó Error: Port index 2 out of range (only 1 ports available)

Connection test: FAILED
</code></pre>
<p><strong>Interpreting results</strong>:</p>
<ul>
<li><strong>Device not listed</strong>: USB/driver issue (see <a href="troubleshooting/common-issues.html#midi-device-not-found">Common Issues - MIDI Device Not Found</a>)</li>
<li><strong>Timeout on event</strong>: Device connected but not sending data
<ul>
<li>Check device is in MIDI mode (not HID-only mode)</li>
<li>Verify pads/keys are functional</li>
<li>Try different port number</li>
</ul>
</li>
<li><strong>"Permission denied"</strong>: User permission issue (Linux)
<ul>
<li>Add user to <code>audio</code> or <code>plugdev</code> group</li>
<li>Check udev rules</li>
</ul>
</li>
</ul>
<p><strong>When to use</strong>:</p>
<ul>
<li>First step in any MIDI troubleshooting</li>
<li>After connecting a new device</li>
<li>After driver installation</li>
<li>Verifying port numbers before running midimon</li>
</ul>
<h3 id="2-midi_diagnostic---midi-event-monitor"><a class="header" href="#2-midi_diagnostic---midi-event-monitor">2. midi_diagnostic - MIDI Event Monitor</a></h3>
<p><strong>Purpose</strong>: Real-time visualization of all MIDI events for debugging event detection and mapping issues.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">cargo run --bin midi_diagnostic &lt;PORT&gt;

# Example
cargo run --bin midi_diagnostic 2
</code></pre>
<p><strong>What it does</strong>:</p>
<ul>
<li>Opens specified MIDI port</li>
<li>Listens for all MIDI events</li>
<li>Displays events in human-readable format</li>
<li>Shows channel, note/cc number, velocity/value</li>
<li>Runs until Ctrl+C</li>
</ul>
<p><strong>Output format</strong>:</p>
<pre><code>Connected to MIDI port 2: Maschine Mikro MK3 - Input
Listening for MIDI events... (Ctrl+C to exit)

[16:32:45] [NoteOn]  ch:0 note:12 vel:87
[16:32:45] [NoteOff] ch:0 note:12 vel:0
[16:32:46] [NoteOn]  ch:0 note:13 vel:64
[16:32:46] [NoteOff] ch:0 note:13 vel:0
[16:32:47] [CC]      ch:0 cc:1 value:64
[16:32:48] [PitchBend] ch:0 value:8192
[16:32:49] [Aftertouch] ch:0 note:12 pressure:48
</code></pre>
<p><strong>Event types shown</strong>:</p>
<ul>
<li>
<p><strong>NoteOn</strong>: Note pressed</p>
<ul>
<li><code>ch</code>: MIDI channel (0-15)</li>
<li><code>note</code>: Note number (0-127)</li>
<li><code>vel</code>: Velocity (0-127)</li>
</ul>
</li>
<li>
<p><strong>NoteOff</strong>: Note released</p>
<ul>
<li><code>vel</code> is usually 0, some devices use release velocity</li>
</ul>
</li>
<li>
<p><strong>CC</strong> (Control Change): Knob, slider, encoder</p>
<ul>
<li><code>cc</code>: Controller number (0-127)</li>
<li><code>value</code>: Value (0-127)</li>
</ul>
</li>
<li>
<p><strong>PitchBend</strong>: Touch strip, pitch wheel</p>
<ul>
<li><code>value</code>: Bend amount (0-16383, center=8192)</li>
</ul>
</li>
<li>
<p><strong>Aftertouch</strong>: Pressure sensitivity</p>
<ul>
<li><code>note</code>: Which note (if polyphonic)</li>
<li><code>pressure</code>: Pressure value (0-127)</li>
</ul>
</li>
<li>
<p><strong>ProgramChange</strong>: Program/patch change</p>
<ul>
<li><code>program</code>: Program number (0-127)</li>
</ul>
</li>
</ul>
<p><strong>Use cases</strong>:</p>
<ol>
<li>
<p><strong>Verify MIDI events are being sent</strong>:</p>
<pre><code class="language-bash">cargo run --bin midi_diagnostic 2
# Press pads - you should see NoteOn/NoteOff events
</code></pre>
</li>
<li>
<p><strong>Find note numbers for config</strong>:</p>
<pre><code class="language-bash">cargo run --bin midi_diagnostic 2
# Press pad ‚Üí note:12 ‚Üí use 12 in config.toml
</code></pre>
</li>
<li>
<p><strong>Debug why mappings aren't triggering</strong>:</p>
<pre><code class="language-bash"># Compare MIDI diagnostic output with config.toml
# If you see note:25 but config has note:12, they don't match
</code></pre>
</li>
<li>
<p><strong>Verify velocity ranges</strong>:</p>
<pre><code class="language-bash">cargo run --bin midi_diagnostic 2
# Soft tap:  vel:32  (0-40 range)
# Medium:    vel:68  (41-80 range)
# Hard hit:  vel:105 (81-127 range)
</code></pre>
</li>
<li>
<p><strong>Check encoder/knob CC numbers</strong>:</p>
<pre><code class="language-bash">cargo run --bin midi_diagnostic 2
# Turn encoder ‚Üí [CC] ch:0 cc:1 value:65
# Use cc:1 in EncoderTurn trigger
</code></pre>
</li>
</ol>
<p><strong>Troubleshooting with midi_diagnostic</strong>:</p>
<p><strong>Problem</strong>: No events appear when pressing pads</p>
<p><strong>Solutions</strong>:</p>
<ul>
<li>Wrong port number (try 0, 1, 2, 3, etc.)</li>
<li>Device not sending MIDI (check device settings)</li>
<li>USB cable issue (try different cable)</li>
<li>Driver issue (reinstall drivers)</li>
</ul>
<p><strong>Problem</strong>: Wrong note numbers appearing</p>
<p><strong>Cause</strong>: Device is on different pad page or has custom profile</p>
<p><strong>Solution</strong>: Either:</p>
<ul>
<li>Change device to expected page</li>
<li>Update config.toml with actual note numbers</li>
<li>Use <code>--profile</code> flag with correct profile</li>
</ul>
<p><strong>Problem</strong>: Events appear but with unexpected values</p>
<p><strong>Example</strong>: Expecting ch:0 but seeing ch:1</p>
<p><strong>Solution</strong>: Update trigger channel in config:</p>
<pre><code class="language-toml">[trigger]
type = "Note"
note = 12
channel = 1  # Add channel specification
</code></pre>
<h3 id="3-led_diagnostic---ledhid-testing"><a class="header" href="#3-led_diagnostic---ledhid-testing">3. led_diagnostic - LED/HID Testing</a></h3>
<p><strong>Purpose</strong>: Test LED control and HID device access for troubleshooting lighting issues.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">cargo run --bin led_diagnostic
</code></pre>
<p><strong>What it does</strong>:</p>
<ol>
<li>Searches for HID device (Maschine Mikro MK3)</li>
<li>Attempts to open HID device</li>
<li>Tests LED control by cycling through all pads</li>
<li>Displays each step's success/failure</li>
</ol>
<p><strong>Expected output</strong> (working):</p>
<pre><code>LED Diagnostic Tool
==================

Searching for Maschine Mikro MK3...
‚úì Device found: Maschine Mikro MK3 (VID:17cc PID:1600)
  Serial: XXXXXXXX
  Manufacturer: Native Instruments
  Product: Maschine Mikro MK3

Opening HID device...
‚úì HID device opened successfully
‚úì Device supports shared access

Testing LED control...
- Lighting pad 0 (Red Bright)... ‚úì
- Lighting pad 1 (Orange Bright)... ‚úì
- Lighting pad 2 (Yellow Bright)... ‚úì
- Lighting pad 3 (Green Bright)... ‚úì
- Lighting pad 4 (Blue Bright)... ‚úì
- Lighting pad 5 (Purple Bright)... ‚úì
[... continues for all 16 pads ...]

Testing patterns...
‚úì Rainbow pattern
‚úì All pads lit (White)
‚úì All pads cleared

LED Diagnostic: PASSED
All LED functionality working correctly.
</code></pre>
<p><strong>Error output</strong> (permission denied - macOS):</p>
<pre><code>Searching for Maschine Mikro MK3...
‚úì Device found: Maschine Mikro MK3 (VID:17cc PID:1600)

Opening HID device...
‚úó Failed to open HID device
  Error: Permission denied (os error 13)

  Possible causes:
  1. Input Monitoring permission not granted
  2. Device already in exclusive use
  3. Native Instruments drivers not installed

  Solutions:
  1. Grant Input Monitoring permission:
     System Settings ‚Üí Privacy &amp; Security ‚Üí Input Monitoring
     Enable Terminal or midimon

  2. Close other applications using the device:
     - Native Instruments Controller Editor
     - Maschine software
     - Other MIDI software

  3. Install NI drivers:
     Download Native Access and install Maschine drivers

LED Diagnostic: FAILED
</code></pre>
<p><strong>Error output</strong> (device not found):</p>
<pre><code>Searching for Maschine Mikro MK3...
‚úó Device not found

Checked for:
- Vendor ID: 0x17cc (Native Instruments)
- Product ID: 0x1600 (Maschine Mikro MK3)

Possible causes:
1. Device not connected
2. Wrong USB port or cable
3. Device powered off
4. HID driver not installed

Solutions:
1. Check USB connection:
   system_profiler SPUSBDataType | grep -i mikro

2. Try different USB port/cable

3. Power cycle device (unplug, wait 10s, replug)

LED Diagnostic: FAILED
</code></pre>
<p><strong>Interpreting results</strong>:</p>
<ul>
<li><strong>Device found, opened, LEDs working</strong>: All HID/LED functionality OK</li>
<li><strong>Device found but won't open</strong>: Permission or driver issue</li>
<li><strong>Device not found</strong>: USB/hardware issue</li>
<li><strong>Opens but LEDs don't light</strong>: Coordinate mapping or hardware issue</li>
</ul>
<p><strong>When to use</strong>:</p>
<ul>
<li>LEDs not working in main application</li>
<li>After granting Input Monitoring permission (verify it worked)</li>
<li>After installing NI drivers (verify driver installation)</li>
<li>Testing LED hardware functionality</li>
<li>Before reporting LED bugs</li>
</ul>
<h3 id="4-led_tester---interactive-led-control"><a class="header" href="#4-led_tester---interactive-led-control">4. led_tester - Interactive LED Control</a></h3>
<p><strong>Purpose</strong>: Manual control of individual LEDs for testing coordinate mapping and hardware.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">cargo run --bin led_tester
</code></pre>
<p><strong>Interactive mode</strong>:</p>
<pre><code>LED Tester - Interactive Mode
==============================
Device: Maschine Mikro MK3 (VID:17cc PID:1600)
Status: Connected

Commands:
  on &lt;pad&gt; &lt;color&gt; &lt;brightness&gt;   Turn on specific LED
  off &lt;pad&gt;                       Turn off specific LED
  all &lt;color&gt; &lt;brightness&gt;        Set all LEDs
  clear                           Clear all LEDs
  rainbow                         Show rainbow pattern
  test                            Cycle through all pads
  coords                          Show pad coordinate mapping
  help                            Show this help
  quit                            Exit

Pad numbers: 0-15
Colors: red, orange, yellow, green, blue, purple, magenta, white
Brightness: 0 (off), 1 (dim), 2 (normal), 3 (bright)

&gt;
</code></pre>
<p><strong>Example session</strong>:</p>
<pre><code>&gt; on 0 red 3
‚úì Pad 0: Red Bright

&gt; on 1 green 2
‚úì Pad 1: Green Normal

&gt; all blue 1
‚úì All pads: Blue Dim

&gt; rainbow
‚úì Rainbow pattern displayed

&gt; test
Testing all pads (press Ctrl+C to stop)...
Pad 0... Pad 1... Pad 2... [continues]

&gt; coords
Pad Coordinate Mapping:
Pad Index -&gt; LED Position

Physical Layout (bottom-up):
12  13  14  15  &lt;- Top row
 8   9  10  11
 4   5   6   7
 0   1   2   3  &lt;- Bottom row

LED Buffer (top-down):
 0   1   2   3  &lt;- Top (buffer 0-3)
 4   5   6   7
 8   9  10  11
12  13  14  15  &lt;- Bottom (buffer 12-15)

Mapping Table:
  Pad  0 -&gt; LED 12    Pad  8 -&gt; LED  4
  Pad  1 -&gt; LED 13    Pad  9 -&gt; LED  5
  Pad  2 -&gt; LED 14    Pad 10 -&gt; LED  6
  Pad  3 -&gt; LED 15    Pad 11 -&gt; LED  7
  Pad  4 -&gt; LED  8    Pad 12 -&gt; LED  0
  Pad  5 -&gt; LED  9    Pad 13 -&gt; LED  1
  Pad  6 -&gt; LED 10    Pad 14 -&gt; LED  2
  Pad  7 -&gt; LED 11    Pad 15 -&gt; LED  3

&gt; clear
‚úì All LEDs cleared

&gt; quit
Goodbye!
</code></pre>
<p><strong>Use cases</strong>:</p>
<ol>
<li>
<p><strong>Test individual pad LEDs</strong>:</p>
<pre><code>&gt; on 0 white 3
# Bottom-left pad should light up bright white
</code></pre>
</li>
<li>
<p><strong>Verify coordinate mapping</strong>:</p>
<pre><code>&gt; coords
# Shows physical layout vs LED buffer
&gt; on 0 red 3
# Verify bottom-left pad lights (should be LED buffer position 12)
</code></pre>
</li>
<li>
<p><strong>Test all colors</strong>:</p>
<pre><code>&gt; on 0 red 3
&gt; on 1 orange 3
&gt; on 2 yellow 3
&gt; on 3 green 3
&gt; on 4 blue 3
&gt; on 5 purple 3
</code></pre>
</li>
<li>
<p><strong>Brightness testing</strong>:</p>
<pre><code>&gt; on 0 white 0   # Off
&gt; on 0 white 1   # Dim
&gt; on 0 white 2   # Normal
&gt; on 0 white 3   # Bright
</code></pre>
</li>
</ol>
<p><strong>When to use</strong>:</p>
<ul>
<li>Debugging coordinate mapping issues</li>
<li>Testing specific pad LEDs (identify dead LEDs)</li>
<li>Understanding LED coordinate system</li>
<li>Verifying color/brightness encoding</li>
</ul>
<h3 id="5-pad_mapper---note-number-discovery"><a class="header" href="#5-pad_mapper---note-number-discovery">5. pad_mapper - Note Number Discovery</a></h3>
<p><strong>Purpose</strong>: Identify MIDI note numbers for physical pads to use in config.toml.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">cargo run --bin pad_mapper &lt;PORT&gt;

# Example
cargo run --bin pad_mapper 2
</code></pre>
<p><strong>What it does</strong>:</p>
<ul>
<li>Opens MIDI port</li>
<li>Listens for NoteOn events</li>
<li>Displays note number and velocity for each press</li>
<li>Continues until Ctrl+C</li>
</ul>
<p><strong>Output</strong>:</p>
<pre><code>Pad Mapper - Find Note Numbers for Your Controller
===================================================
Connected to port 2: Maschine Mikro MK3 - Input

Press pads in order (bottom-left to top-right) and write down note numbers.
Ctrl+C to exit when done.

Pad pressed: Note 12 (velocity: 87)
Pad pressed: Note 13 (velocity: 64)
Pad pressed: Note 14 (velocity: 92)
Pad pressed: Note 15 (velocity: 73)
Pad pressed: Note 8  (velocity: 55)
Pad pressed: Note 9  (velocity: 81)
[continues as you press pads...]
</code></pre>
<p><strong>Recommended workflow</strong>:</p>
<ol>
<li>
<p><strong>Run pad_mapper</strong>:</p>
<pre><code class="language-bash">cargo run --bin pad_mapper 2
</code></pre>
</li>
<li>
<p><strong>Draw a grid</strong> on paper:</p>
<pre><code>[ ] [ ] [ ] [ ]  &lt;- Top row
[ ] [ ] [ ] [ ]
[ ] [ ] [ ] [ ]
[ ] [ ] [ ] [ ]  &lt;- Bottom row
</code></pre>
</li>
<li>
<p><strong>Press each pad</strong> starting bottom-left, moving right:</p>
<ul>
<li>Press bottom-left ‚Üí write down note number (e.g., 12)</li>
<li>Press next pad right ‚Üí write down note number (e.g., 13)</li>
<li>Continue for all 16 pads</li>
</ul>
</li>
<li>
<p><strong>Result</strong>:</p>
<pre><code>[12][13][14][15]  &lt;- Top row
[ 8][ 9][10][11]
[ 4][ 5][ 6][ 7]
[ 0][ 1][ 2][ 3]  &lt;- Bottom row
</code></pre>
<p>Wait, those look wrong! That's because your device might be on a different page or have a custom profile. The numbers you write down are the ones to use in config.toml.</p>
</li>
<li>
<p><strong>Update config.toml</strong> with actual note numbers:</p>
<pre><code class="language-toml">[[modes.mappings]]
description = "Bottom-left pad"
[modes.mappings.trigger]
type = "Note"
note = 0  # Or whatever number you wrote down
</code></pre>
</li>
</ol>
<p><strong>Use cases</strong>:</p>
<ul>
<li>Initial setup of a new device</li>
<li>Creating config.toml for the first time</li>
<li>Verifying note numbers after changing device profile</li>
<li>Debugging why specific pads don't work</li>
</ul>
<p><strong>Tips</strong>:</p>
<ul>
<li>Press pads gently and consistently (velocity affects detection)</li>
<li>Write down numbers immediately (easy to forget)</li>
<li>Take a photo of your paper grid for reference</li>
<li>Some controllers send different notes on different "pages" or "banks"</li>
</ul>
<h2 id="advanced-debugging-with-debug1"><a class="header" href="#advanced-debugging-with-debug1">Advanced Debugging with DEBUG=1</a></h2>
<p>Enable verbose debug logging to see internal event processing:</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-bash">DEBUG=1 cargo run --release 2
</code></pre>
<h3 id="debug-output-format"><a class="header" href="#debug-output-format">Debug Output Format</a></h3>
<p><strong>MIDI Events</strong>:</p>
<pre><code>[16:32:45.123] [MIDI] NoteOn ch:0 note:12 vel:87
[16:32:45.124] [MIDI] NoteOff ch:0 note:12 vel:0
</code></pre>
<p><strong>Event Processing</strong>:</p>
<pre><code>[DEBUG] Processing NoteOn: note=12 vel=87
[DEBUG] Detected velocity range: Medium (41-80)
[DEBUG] Stored note 12 in press tracker (time: 16:32:45.123)
</code></pre>
<p><strong>Mapping Engine</strong>:</p>
<pre><code>[DEBUG] Checking 24 mappings in mode 'Default'
[DEBUG] Matched mapping: "Copy text" (trigger: Note(12))
[DEBUG] Compiled action: Keystroke { keys: "c", modifiers: ["cmd"] }
</code></pre>
<p><strong>Action Execution</strong>:</p>
<pre><code>[DEBUG] Executing Keystroke action
[DEBUG] Pressing key: C
[DEBUG] Holding modifiers: [Cmd]
[DEBUG] Releasing key: C
‚úì Action executed successfully (1.2ms)
</code></pre>
<p><strong>LED Updates</strong>:</p>
<pre><code>[DEBUG] LED update request: pad=0 color=Green brightness=2
[DEBUG] Mapped pad 0 -&gt; LED position 12
[DEBUG] HID buffer: [80 00 00 ... 1D ... 00] (81 bytes)
[DEBUG] HID write successful (4 bytes written)
</code></pre>
<p><strong>Mode Changes</strong>:</p>
<pre><code>[DEBUG] Mode change requested: next
[DEBUG] Current mode: 0 (Default)
[DEBUG] Switching to mode: 1 (Developer)
[INFO] Mode changed: Default -&gt; Developer
</code></pre>
<p><strong>Timers and State</strong>:</p>
<pre><code>[DEBUG] Long press timer started: note=12 threshold=2000ms
[DEBUG] Note released after 1523ms (threshold: 2000ms)
[DEBUG] Long press NOT triggered (held too short)
</code></pre>
<pre><code>[DEBUG] Double-tap window started: note=12 timeout=300ms
[DEBUG] Second tap detected within 287ms
[DEBUG] Double-tap triggered: note=12
</code></pre>
<pre><code>[DEBUG] Chord detection: notes=[12, 13, 14] timeout=100ms
[DEBUG] All notes pressed within 47ms
[DEBUG] Chord triggered: [12, 13, 14]
</code></pre>
<h3 id="interpreting-debug-output"><a class="header" href="#interpreting-debug-output">Interpreting Debug Output</a></h3>
<h4 id="problem-mapping-not-triggering"><a class="header" href="#problem-mapping-not-triggering">Problem: Mapping not triggering</a></h4>
<p><strong>Look for</strong>:</p>
<pre><code>[DEBUG] No mapping matched for event: Note(12)
</code></pre>
<p><strong>Possible causes</strong>:</p>
<ul>
<li>Note number mismatch (check pad_mapper output)</li>
<li>Wrong mode (check current mode in debug output)</li>
<li>Trigger conditions not met (velocity, timing)</li>
</ul>
<p><strong>Solution</strong>: Compare debug output with config.toml</p>
<hr />
<h4 id="problem-action-not-executing"><a class="header" href="#problem-action-not-executing">Problem: Action not executing</a></h4>
<p><strong>Look for</strong>:</p>
<pre><code>[DEBUG] Matched mapping: "Test"
[ERROR] Failed to execute action: Command not found
</code></pre>
<p><strong>Cause</strong>: Action configuration error (e.g., invalid shell command)</p>
<p><strong>Solution</strong>: Fix action in config.toml</p>
<hr />
<h4 id="problem-leds-not-updating"><a class="header" href="#problem-leds-not-updating">Problem: LEDs not updating</a></h4>
<p><strong>Look for</strong>:</p>
<pre><code>[DEBUG] LED update request: pad=0
[ERROR] HID write failed: Device not open
</code></pre>
<p><strong>Cause</strong>: HID device not accessible</p>
<p><strong>Solution</strong>: Check permissions, run led_diagnostic</p>
<hr />
<h2 id="usb-connection-verification"><a class="header" href="#usb-connection-verification">USB Connection Verification</a></h2>
<h3 id="macos-3"><a class="header" href="#macos-3">macOS</a></h3>
<p><strong>Check USB device enumeration</strong>:</p>
<pre><code class="language-bash"># List all USB devices
system_profiler SPUSBDataType

# Filter for your device
system_profiler SPUSBDataType | grep -i mikro

# More detailed output
system_profiler SPUSBDataType | grep -B 10 -A 10 "Mikro"
</code></pre>
<p><strong>Expected output</strong>:</p>
<pre><code>Maschine Mikro MK3:
  Product ID: 0x1600
  Vendor ID: 0x17cc  (Native Instruments)
  Version: 1.00
  Serial Number: XXXXXXXX
  Speed: Up to 12 Mb/s
  Manufacturer: Native Instruments
  Location ID: 0x14200000 / 5
  Current Available (mA): 500
  Current Required (mA): 100
  Extra Operating Current (mA): 0
</code></pre>
<p><strong>Check for device disappearance</strong>:</p>
<pre><code class="language-bash"># Monitor USB devices
log stream --predicate 'eventMessage contains "USB"' --level info
</code></pre>
<p>Then plug/unplug device - you should see connection events.</p>
<h3 id="linux-2"><a class="header" href="#linux-2">Linux</a></h3>
<p><strong>Check USB devices</strong>:</p>
<pre><code class="language-bash"># List USB devices
lsusb

# Filter for Native Instruments (VID: 17cc)
lsusb | grep 17cc

# Detailed info
lsusb -v -d 17cc:1600
</code></pre>
<p><strong>Check dmesg for USB events</strong>:</p>
<pre><code class="language-bash"># Show recent USB events
dmesg | grep -i usb | tail -20

# Monitor in real-time
dmesg -w | grep -i usb
</code></pre>
<p><strong>Check ALSA MIDI</strong>:</p>
<pre><code class="language-bash"># List ALSA MIDI devices
aconnect -l

# Or
amidi -l
</code></pre>
<h3 id="windows-2"><a class="header" href="#windows-2">Windows</a></h3>
<p><strong>Device Manager</strong>:</p>
<ol>
<li>Open Device Manager (Win+X ‚Üí Device Manager)</li>
<li>Expand "Sound, video and game controllers"</li>
<li>Look for your MIDI device</li>
<li>Right-click ‚Üí Properties ‚Üí Check status</li>
</ol>
<p><strong>Check MIDI devices via PowerShell</strong>:</p>
<pre><code class="language-powershell">Get-PnpDevice -Class MEDIA | Format-Table -AutoSize
</code></pre>
<h2 id="interpreting-error-messages"><a class="header" href="#interpreting-error-messages">Interpreting Error Messages</a></h2>
<h3 id="common-error-patterns"><a class="header" href="#common-error-patterns">Common Error Patterns</a></h3>
<h4 id="no-midi-input-ports-available"><a class="header" href="#no-midi-input-ports-available">"No MIDI input ports available"</a></h4>
<p><strong>Meaning</strong>: No MIDI devices detected at all</p>
<p><strong>Debug steps</strong>:</p>
<ol>
<li><code>system_profiler SPUSBDataType | grep -i usb</code></li>
<li><code>cargo run --bin test_midi</code></li>
<li>Check USB connection</li>
<li>Verify drivers installed</li>
</ol>
<hr />
<h4 id="failed-to-open-hid-device"><a class="header" href="#failed-to-open-hid-device">"Failed to open HID device"</a></h4>
<p><strong>Meaning</strong>: Device found but can't access HID interface</p>
<p><strong>Debug steps</strong>:</p>
<ol>
<li>Check permissions (Input Monitoring on macOS)</li>
<li><code>cargo run --bin led_diagnostic</code></li>
<li>Close other applications using device</li>
<li>Reinstall NI drivers</li>
</ol>
<hr />
<h4 id="toml-parse-error-at-line-x"><a class="header" href="#toml-parse-error-at-line-x">"TOML parse error at line X"</a></h4>
<p><strong>Meaning</strong>: Syntax error in config.toml</p>
<p><strong>Debug steps</strong>:</p>
<ol>
<li>Open config.toml in editor</li>
<li>Go to line X</li>
<li>Check for:
<ul>
<li>Missing quotes</li>
<li>Wrong brackets</li>
<li>Typos in field names</li>
</ul>
</li>
<li>Validate at https://www.toml-lint.com/</li>
</ol>
<hr />
<h4 id="missing-field-type-in-trigger"><a class="header" href="#missing-field-type-in-trigger">"Missing field 'type' in trigger"</a></h4>
<p><strong>Meaning</strong>: Invalid config structure</p>
<p><strong>Debug steps</strong>:</p>
<ol>
<li>Find the mapping missing <code>type</code></li>
<li>Add <code>type</code> field:
<pre><code class="language-toml">[trigger]
type = "Note"  # Add this
note = 12
</code></pre>
</li>
</ol>
<hr />
<h4 id="permission-denied-os-error-13"><a class="header" href="#permission-denied-os-error-13">"Permission denied (os error 13)"</a></h4>
<p><strong>Meaning</strong>: Insufficient permissions</p>
<p><strong>macOS</strong>: Grant Input Monitoring permission</p>
<p><strong>Linux</strong>: Add user to <code>plugdev</code> group and create udev rules</p>
<p><strong>Windows</strong>: Run as Administrator (not recommended for regular use)</p>
<hr />
<h2 id="systematic-troubleshooting-procedure"><a class="header" href="#systematic-troubleshooting-procedure">Systematic Troubleshooting Procedure</a></h2>
<p>When something doesn't work, follow this systematic approach:</p>
<h3 id="level-1-hardware-connectivity"><a class="header" href="#level-1-hardware-connectivity">Level 1: Hardware Connectivity</a></h3>
<pre><code class="language-bash"># 1. Check USB enumeration
system_profiler SPUSBDataType | grep -i mikro

# 2. Test MIDI ports
cargo run --bin test_midi

# 3. Monitor MIDI events
cargo run --bin midi_diagnostic 2
</code></pre>
<p><strong>If Level 1 fails</strong>: Hardware or driver issue (see <a href="troubleshooting/common-issues.html">Common Issues</a>)</p>
<h3 id="level-2-software-connectivity"><a class="header" href="#level-2-software-connectivity">Level 2: Software Connectivity</a></h3>
<pre><code class="language-bash"># 4. Test HID access
cargo run --bin led_diagnostic

# 5. Find note numbers
cargo run --bin pad_mapper 2

# 6. Run with debug logging
DEBUG=1 cargo run --release 2
</code></pre>
<p><strong>If Level 2 fails</strong>: Permission or configuration issue</p>
<h3 id="level-3-configuration-validation"><a class="header" href="#level-3-configuration-validation">Level 3: Configuration Validation</a></h3>
<pre><code class="language-bash"># 7. Validate config syntax
cargo check

# 8. Test with minimal config
cat &gt; test.toml &lt;&lt; 'EOF'
[[modes]]
name = "Test"
[[modes.mappings]]
description = "Test"
[modes.mappings.trigger]
type = "Note"
note = 0
[modes.mappings.action]
type = "Shell"
command = "say test"
EOF

cargo run --release 2 --config test.toml

# 9. Compare note numbers
# pad_mapper output vs config.toml
</code></pre>
<p><strong>If Level 3 fails</strong>: Config syntax or mapping issue</p>
<h3 id="level-4-deep-debugging"><a class="header" href="#level-4-deep-debugging">Level 4: Deep Debugging</a></h3>
<pre><code class="language-bash"># 10. Enable trace-level logging
RUST_LOG=trace cargo run --release 2

# 11. Check for resource exhaustion
# Activity Monitor (macOS) / Task Manager (Windows)

# 12. Test on different computer
# (isolates hardware vs software issues)
</code></pre>
<h2 id="performance-profiling-1"><a class="header" href="#performance-profiling-1">Performance Profiling</a></h2>
<h3 id="response-time-analysis"><a class="header" href="#response-time-analysis">Response Time Analysis</a></h3>
<pre><code class="language-bash">DEBUG=1 cargo run --release 2 2&gt;&amp;1 | grep -E 'NoteOn|executed'
</code></pre>
<p><strong>Measure latency</strong>:</p>
<pre><code>[16:32:45.123456] NoteOn
[16:32:45.124789] Action executed (1.3ms)
</code></pre>
<p>Latency = 1.3ms (excellent, &lt;5ms is good)</p>
<h3 id="cpu-usage-monitoring"><a class="header" href="#cpu-usage-monitoring">CPU Usage Monitoring</a></h3>
<p><strong>macOS</strong>:</p>
<pre><code class="language-bash"># Monitor CPU in real-time
top | grep midimon

# Or use Activity Monitor GUI
open -a "Activity Monitor"
</code></pre>
<p><strong>Expected CPU usage</strong>:</p>
<ul>
<li>Idle: &lt;1%</li>
<li>Active (pad presses): 2-5%</li>
<li>With animated LEDs: 3-7%</li>
</ul>
<p><strong>If &gt;10%</strong>: Performance issue (check debug logging enabled)</p>
<h3 id="memory-usage-1"><a class="header" href="#memory-usage-1">Memory Usage</a></h3>
<pre><code class="language-bash"># macOS
ps aux | grep midimon

# Expected RSS: 5-10 MB
</code></pre>
<p><strong>If &gt;50MB</strong>: Memory leak (file a bug report)</p>
<h2 id="logs-and-diagnostics-output"><a class="header" href="#logs-and-diagnostics-output">Logs and Diagnostics Output</a></h2>
<h3 id="redirecting-output"><a class="header" href="#redirecting-output">Redirecting Output</a></h3>
<p><strong>Save all output</strong>:</p>
<pre><code class="language-bash">cargo run --release 2 &gt; midimon.log 2&gt;&amp;1
</code></pre>
<p><strong>Save only errors</strong>:</p>
<pre><code class="language-bash">cargo run --release 2 2&gt; midimon.err
</code></pre>
<p><strong>Separate stdout and stderr</strong>:</p>
<pre><code class="language-bash">cargo run --release 2 &gt; midimon.out 2&gt; midimon.err
</code></pre>
<h3 id="analyzing-logs"><a class="header" href="#analyzing-logs">Analyzing Logs</a></h3>
<p><strong>Count events</strong>:</p>
<pre><code class="language-bash">grep -c "NoteOn" midimon.log
</code></pre>
<p><strong>Find errors</strong>:</p>
<pre><code class="language-bash">grep -i error midimon.log
grep -i failed midimon.log
</code></pre>
<p><strong>Extract timings</strong>:</p>
<pre><code class="language-bash">grep "Action executed" midimon.log | sed 's/.*(\(.*\)ms).*/\1/'
</code></pre>
<h2 id="see-also-11"><a class="header" href="#see-also-11">See Also</a></h2>
<ul>
<li><a href="troubleshooting/common-issues.html">Common Issues</a> - Quick solutions to frequent problems</li>
<li><a href="troubleshooting/../reference/cli-commands.html">CLI Commands</a> - Complete command reference</li>
<li><a href="troubleshooting/../configuration/overview.html">Configuration Overview</a> - Config syntax validation</li>
</ul>
<hr />
<p><strong>Last Updated</strong>: November 11, 2025
<strong>Diagnostic Tool Version</strong>: 0.1.0</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="performance-5"><a class="header" href="#performance-5">Performance</a></h1>
<blockquote>
<p><strong>Note</strong>: This section is under development and will be completed in Phase 1 (Q1 2025).</p>
<p>For now, please refer to:</p>
<ul>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/README.md">README.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/blob/main/CLAUDE.md">CLAUDE.md</a></li>
<li><a href="https://github.com/amiable-dev/midimon/discussions">GitHub Discussions</a></li>
</ul>
</blockquote>
<h2 id="coming-soon-15"><a class="header" href="#coming-soon-15">Coming Soon</a></h2>
<p>This page will cover:</p>
<ul>
<li>TBD</li>
</ul>
<hr />
<p><strong>Help Wanted</strong>: We're looking for contributors to help write documentation. See <a href="troubleshooting/../development/contributing.html">Contributing Guide</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="changelog"><a class="header" href="#changelog">Changelog</a></h1>
<p>See the main <a href="https://github.com/amiable-dev/midimon/blob/main/CHANGELOG.md">CHANGELOG.md</a> in the repository.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="roadmap"><a class="header" href="#roadmap">Roadmap</a></h1>
<p>See the main <a href="https://github.com/amiable-dev/midimon/blob/main/ROADMAP.md">ROADMAP.md</a> in the repository.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="community-1"><a class="header" href="#community-1">Community</a></h1>
<p>Join the MIDIMon community:</p>
<ul>
<li><strong>GitHub Discussions</strong>: <a href="https://github.com/amiable-dev/midimon/discussions">https://github.com/amiable-dev/midimon/discussions</a></li>
<li><strong>Issues</strong>: <a href="https://github.com/amiable-dev/midimon/issues">https://github.com/amiable-dev/midimon/issues</a></li>
<li><strong>Discord</strong>: Coming soon!</li>
</ul>
<p>See <a href="https://github.com/amiable-dev/midimon/blob/main/GOVERNANCE.md">GOVERNANCE.md</a> for community structure.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="support-1"><a class="header" href="#support-1">Support</a></h1>
<p>See the main <a href="https://github.com/amiable-dev/midimon/blob/main/SUPPORT.md">SUPPORT.md</a> for getting help.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>
